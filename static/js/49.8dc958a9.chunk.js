(this["webpackJsonpdl-model"]=this["webpackJsonpdl-model"]||[]).push([[49],{190:function(e,t,n){"use strict";var a=n(57),i=n.n(a),o=n(69),r=n(3),c=n(6),d=n(29),u=n(4),s=n(5),m=n(264),l=n(1),p=n(43),f=function(e){Object(u.a)(n,e);var t=Object(s.a)(n);function n(){var e;Object(r.a)(this,n);for(var a=arguments.length,c=new Array(a),u=0;u<a;u++)c[u]=arguments[u];return(e=t.call.apply(t,[this].concat(c))).afterMainModelLoad=function(){e.saveMainModelInitState(),e.addAnimation()},e.afterMainModelUpdate=function(){e.saveMainModelInitState(),e.addAnimation()},e.updateModel=function(){var t=Object(o.a)(i.a.mark((function t(n,a){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.updateMainModel(n.model,a.model);case 2:e.updateAnimation(n.animation,a.animation);case 3:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),e.otherUpdate=function(t,n){n.capture.enable&&!t.capture.enable&&e.captureAnimation()},e.saveMainModelInitState=function(){var t=e.models.main;t.initPos=t.position.clone(),t.initRot=t.rotation.clone()},e.resetFace=function(){var t=e.props.model,n=t.eyeIdx,a=t.mouthIdx;e.eyeIdx=n,e.mouthIdx=a},e.beforeAddAni=function(){e.resetFace()},e.addAnimation=Object(o.a)(i.a.mark((function t(){var n,a,o,r,c,d,u;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(null===(n=(a=e).beforeAddAni)||void 0===n||n.call(a),o=e.props.animation,r=o.code,c=o.timeScale,r){t.next=4;break}return t.abrupt("return");case 4:return e.disableInput(),d=e.models.main,u=Object(p.a)(r),e.nAni=u.length,d.mixer=new l.AnimationMixer(d),e.mixer=d.mixer,e._aniIdx=0,d.mixer.timeScale=c,d.mixer.addEventListener("finished",e.playNextAni),e.aniSettings=u,t.next=16,Object(p.v)(u);case 16:e.animations=t.sent,e.aniIdx=0,e.enableInput();case 19:case"end":return t.stop()}}),t)}))),e.removeAnimation=function(){var t,n,a=e.models.main;null===(t=a.mixer)||void 0===t||null===(n=t.stopAllAction)||void 0===n||n.call(t);var i=a.initPos,o=a.initRot;a.position.copy(i),a.rotation.copy(o),e.mixer=null,e.animations=[],e.aniSettings=[]},e.playNextAni=function(){var t=Object(d.a)(e).nAni;e.props.capture.enable&&e._aniIdx===t-1&&(e.mediaRecorder.stop(),e.props.toggleCapture());var n=(e._aniIdx+1)%t;e.aniIdx=n},e.updateAnimation=function(t,n){var a=n.code,i=n.timeScale;if(t.code!==a)return e.removeAnimation(),void e.addAnimation();t.timeScale!==i&&(e.mixer.timeScale=i)},e.captureAnimation=function(){var t,n;if(e.chunks=[],e.videoStream=e.canvas.captureStream(30),!e.mediaRecorder){var a=e.props.capture.codec;e.mediaRecorder=new MediaRecorder(e.videoStream,{mimeType:a}),e.mediaRecorder.ondataavailable=function(t){return e.chunks.push(t.data)},e.mediaRecorder.onstop=function(){e.enableInput();var t=new Blob(e.chunks,{type:"video/webm"}),n=URL.createObjectURL(t),a=document.createElement("a");a.style="display: none",a.href=n,a.download="animation.webm",document.body.appendChild(a),a.click(),window.URL.revokeObjectURL(n),document.body.removeChild(a)}}e.disableInput("Recording"),null===(t=(n=e).beforeCaptureAnimation)||void 0===t||t.call(n),e.aniIdx=0,e.mediaRecorder.start()},e.everyAnimate=function(){var t,n=e.clock.getDelta();if((e.rotateFloor(n),null===(t=e.mixer)||void 0===t||t.update(n),e.faceChanges&&e.faceChanges.length)&&e.mixer.time>=e.faceChangeTime[0]){e.faceChangeTime.shift();var a=e.faceChanges.shift(),i=a.eyeIdx,o=a.mouthIdx;e.eyeIdx=i,e.mouthIdx=o}},e}return Object(c.a)(n,[{key:"aniIdx",set:function(e){this._aniIdx=e;var t=this.mixer;t.stopAllAction();var n=this.animations[e],a=t.clipAction(n),i=this.aniSettings[e],o=i.timeScale,r=i.repetitions,c=i.faceChanges,d=n.duration;a.setLoop(l.LoopRepeat,r),a.clampWhenFinished=!0,a.timeScale=o,a.time=0,this.faceChanges=Object(p.r)(c,r),this.faceChangeTime=this.faceChanges.map((function(e){return d*e.time/100})),t.setTime(0),a.play()}}]),n}(m.default);t.a=f},456:function(e,t,n){"use strict";n.r(t),n.d(t,"DragonViewer",(function(){return l}));var a=n(57),i=n.n(a),o=n(69),r=n(3),c=n(6),d=n(4),u=n(5),s=n(190),m=n(43),l=function(e){Object(d.a)(n,e);var t=Object(u.a)(n);function n(){var e;return Object(r.a)(this,n),(e=t.call(this)).initNewModel=function(){e.saveMainModelInitState(),e.initFace(),e.addAnimation()},e.afterMainModelLoad=function(){e.initNewModel()},e.updateModel=function(){var t=Object(o.a)(i.a.mark((function t(n,a){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.updateMainModel(n.model,a.model);case 2:e.updateFace(a.model),e.updateAnimation(n.animation,a.animation);case 4:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),e.updateFace=function(t){var n=t.eyeIdx,a=t.mouthIdx;e.eyeIdx=n,e.mouthIdx=a},e.afterMainModelUpdate=function(){e.initNewModel()},e.initFace=function(){var t=e.models.main;e.eyes=Object(m.p)(t),e.eyes.forEach((function(e){return e.frustumCulled=!1})),e.mouths=Object(m.q)(t),e.mouths.forEach((function(e){return e.frustumCulled=!1}));var n=e.props.model,a=n.eyeIdx,i=n.mouthIdx;e.eyeIdx=a,e.mouthIdx=i},e._eyeIdx=e._mouthIdx=0,e}return Object(c.a)(n,[{key:"eyeIdx",set:function(e){var t=parseInt(e),n=this._eyeIdx;if(t!==n){this._eyeIdx=t;var a=/[0-9]{2}/;this.eyes.forEach((function(e){var n=e.name,i=a.exec(n)[0];e.visible=parseInt(i)===t}))}}},{key:"mouthIdx",set:function(e){var t=parseInt(e),n=this._mouthIdx;if(t!==n){this._mouthIdx=t;var a=/[0-9]{2}/;this.mouths.forEach((function(e){var n=e.name,i=a.exec(n)[0];e.visible=parseInt(i)===t}))}}}]),n}(s.a);t.default=l}}]);
//# sourceMappingURL=49.8dc958a9.chunk.js.map