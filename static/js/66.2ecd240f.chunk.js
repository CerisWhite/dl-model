(this["webpackJsonpdl-model"]=this["webpackJsonpdl-model"]||[]).push([[66],{478:function(e,t,a){"use strict";a.r(t),a.d(t,"AdvViewer",(function(){return h}));var n=a(11),r=a(8),o=a.n(r),c=a(13),u=a(0),i=a(2),d=a(3),p=a(4),s=a(240),l=a(14),f=a(49),m=["Right","Left"],h=function(e){Object(d.a)(a,e);var t=Object(p.a)(a);function a(e){var r;return Object(u.a)(this,a),(r=t.call(this,e)).afterMainModelLoad=function(){r.saveMainModelInitState(),r.initFace(),r.addWeapons(),r.addAnimation()},r.beforeMainModelUpdate=function(){r.detachAllWeapons()},r.afterMainModelUpdate=function(){r.saveMainModelInitState(),r.initFace(),r.attachAllWeapons(),r.addAnimation()},r.updateModel=function(){var e=Object(c.a)(o.a.mark((function e(t,a){var n,c;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t!==a){e.next=2;break}return e.abrupt("return");case 2:return n=t.model,c=a.model,e.next=6,r.updateMainModel(n,c);case 6:n.id===c.id&&r.updateFace(n,c),r.updateWeapons(n,c),r.updateAnimation(t.animation,a.animation);case 9:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),r.initFace=function(){var e=r.props.model.id;r._eyeIdx=r._mouthIdx=l.c;var t={mouthTexture:e,mouthIdx:l.c,eyeTexture:e,eyeIdx:l.c};r.updateFace(t,r.props.model)},r.addWeapons=Object(c.a)(o.a.mark((function e(){var t,a,c,u;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.getWeaponInfo(),e.next=3,r.initWeaponLoad();case 3:return t=e.sent,a=Object(n.a)(t,2),c=a[0],u=a[1],r.models=Object.assign(r.models,{weaponRight:c,weaponLeft:u}),e.next=10,r.initAllWeapons();case 10:r.attachAllWeapons();case 11:case"end":return e.stop()}}),e)}))),r.getWeaponInfo=function(){var e=r.props.model,t=e.weaponRight,a=e.weaponLeft,n={weaponRight:Object(f.b)(t),weaponLeft:Object(f.b)(a)};r.modelInfo=Object.assign(r.modelInfo,n)},r.initWeaponLoad=function(){var e,t,a=null===(e=r.modelInfo.weaponRight)||void 0===e?void 0:e.modelPath,n=Object(f.w)(a),o=null===(t=r.modelInfo.weaponLeft)||void 0===t?void 0:t.modelPath,c=Object(f.w)(o);return Promise.all([n,c])},r.initAllWeapons=Object(c.a)(o.a.mark((function e(){var t;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=r.matType,m.forEach(function(){var e=Object(c.a)(o.a.mark((function e(a){var n,c,u,i,d,p;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n="weapon".concat(a),c=r.models[n]){e.next=4;break}return e.abrupt("return");case 4:return u=r.modelInfo[n],i=u.texturePath,d=u.flipped,Object(f.l)(c,{materialType:t,texturePath:i}),d&&(c.rotation.y+=Math.PI),p=r.props.outline,e.next=11,Object(f.n)(c,p);case 11:r.outlines[n]=e.sent;case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 2:case"end":return e.stop()}}),e)}))),r.attachWeapon=function(e,t){var a="jWeapon".concat(t[0]);r.models.main.traverse((function(t){t.name.includes(a)&&0===t.children.length&&t.add(e)}))},r.attachAllWeapons=function(){m.forEach((function(e){var t="weapon".concat(e),a=r.models[t];a&&r.attachWeapon(a,e)}))},r.detachWeapon=function(e){var t="weapon".concat(e),a=r.models[t];a&&a.parent.remove(a)},r.detachAllWeapons=function(){return m.forEach((function(e){return r.detachWeapon(e)}))},r.updateEyeTexture=function(e,t){var a=t.eyeTexture,n=e.eyeTexture;if(a===n)return!1;var o=r.matType;Object(f.d)(r.models.main,{materialType:o,textureId:a});var c=Object(f.j)(a,n);return Object(f.c)(r.models.main,c),!0},r.updateMouthTexture=function(e,t){var a=t.mouthTexture,n=e.mouthTexture;if(a===n)return!1;var o=r.matType;Object(f.g)(r.models.main,{materialType:o,textureId:a});var c=Object(f.j)(a,n);return Object(f.f)(r.models.main,c),!0},r.updateFaceTexture=function(e,t){var a=r.updateEyeTexture(e,t),n=r.updateMouthTexture(e,t);if(a||n){var o=r.models.main;r.applyNewModelMat(o)}},r.updateFaceOffset=function(e){var t=e.eyeIdx,a=e.mouthIdx;r.eyeIdx=t,r.mouthIdx=a},r.updateFace=function(e,t){r.updateFaceTexture(e,t),r.updateFaceOffset(t)},r.updateWeapons=function(){var e=Object(c.a)(o.a.mark((function e(t,a){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r.disableInput(),m.forEach(function(){var e=Object(c.a)(o.a.mark((function e(n){var c,u,i,d,p,s,l,m;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c="weapon".concat(n),t[c]!==a[c]){e.next=3;break}return e.abrupt("return");case 3:if(r.detachWeapon(n),Object(f.p)(r.models[c]),a[c]){e.next=10;break}return r.models[c]=null,r.modelInfo[c]="",r.outlines[c]=null,e.abrupt("return");case 10:return r.modelInfo[c]=Object(f.b)(a[c]),u=r.modelInfo[c],i=u.modelPath,d=u.texturePath,p=u.flipped,e.next=14,Object(f.w)(i);case 14:return s=e.sent,r.models[c]=s,l=r.matType,Object(f.l)(s,{materialType:l,texturePath:d}),r.applyNewModelMat(s),p&&(s.rotation.y+=Math.PI),m=r.props.outline,e.next=23,Object(f.n)(s,m);case 23:r.outlines[c]=e.sent,r.attachWeapon(s,n);case 25:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),r.enableInput();case 3:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),r._eyeIdx=r._mouthIdx=l.c,r}return Object(i.a)(a,[{key:"eyeIdx",set:function(e){if(e){var t=this._eyeIdx;if(e!==t){var a=Object(f.i)(e,t);Object(f.c)(this.models.main,a),this._eyeIdx=e}}}},{key:"mouthIdx",set:function(e){if(e){var t=this._mouthIdx;if(e!==t){var a=Object(f.i)(e,t);Object(f.f)(this.models.main,a),this._mouthIdx=e}}}}]),a}(s.default);t.default=h}}]);
//# sourceMappingURL=66.2ecd240f.chunk.js.map