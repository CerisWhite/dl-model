{"version":3,"sources":["reducer/settingsReducer.js","context/SettingsContext.js","helpers.js","ModelViewer.js","Display.js","MainPage.js","App.js","data/face_offset.js","hooks/useToggleState.js","styles/MainPageStyles.js","styles/Rose-Petals.svg","consts.js","viewerHelpers.js","serviceWorker.js","index.js"],"names":["settingsReducer","state","action","key","value","type","currentValue","defaultSetting","defaultSettings","update","forEach","v","SettingsContext","createContext","DispatchContext","initAniChain","chainCodeToList","animation","code","initSettings","model","scene","app","outline","capture","chainMaker","chain","SettingsProvider","props","useReducer","settings","dispatch","Provider","children","isBlade","startsWith","isSheath","endsWith","callbackOnPotentialArray","object","callback","Array","isArray","child","setInitialSettings","params","length","faceTextureDefined","param","split","keycode","setValue","join","chainList","map","n","parseFloat","initKey","group","isBooleanValue","Boolean","generateChainCode","defaultMod","timeScale","repetitions","modList","ts","r","output","ani","i","fileName","aniName","concat","Object","keys","modKey","collectFilter","toggleState","collected","tmp","k","push","multiCondFilter","input","filters","filterKeys","filter","el","every","includes","complementaryColor","color","hexColor","replace","toString","slice","aniButtonsFromObject","handleSelect","groupName","style","maxWidth","variant","data-value","data-name","onClick","getStandbyCode","weapon","gender","WEAPON_CODE","GENDER_CODE","getVictoryCode","getDashAtkCode","getRollCode","getComboCode","comboLength","COMBO_LENGTH","result","getFSCode","fsAniLength","FS_LENGTH","getLobbyCode","ModelViewer","animate","frameId","requestAnimationFrame","dt","clock","getDelta","floor","rotateY","rotateSpeed","Math","PI","mixers","mixer","renderer","render","camera","init","models","modelInfo","main","weaponLeft","analyzeWeaponCode","weaponRight","outlines","outlineDetails","outlineColor","size","outlineSize","enable","showOutline","opacity","outlineOpacity","viewport","width","window","innerWidth","height","innerHeight","THREE","background","bgColor","floorGeometry","rotateX","floorMaterial","visible","add","CAM_PARAMS","angle","near","far","cameraPosition","position","set","updateProjectionMatrix","controls","OrbitControls","mount","controlsPosition","target","light","rendererAA","antialias","alpha","outputEncoding","rendererNoAA","antiAliasing","canvas","domElement","setSize","appendChild","playNextAni","_aniIdx","nAni","mediaRecorder","stop","toggleCapture","newIdx","aniIdx","addAnimationChain","animationChain","a","analyzeChainCode","fileList","animationList","setIsLoading","addEventListener","aniSettings","batchLoader","file","path","fbxSource","loadModel","animations","Promise","all","animFiles","anim","fileIdx","find","name","initLoad","modelId","modelPath","loadMain","loadWeaponR","loadWeaponL","addWeapon","side","boneName","traverse","removeWeapon","remove","this","addOutline","initPos","clone","initRot","rotation","changeMaterialToBasic","weaponInfo","weaponModel","texture","y","flipped","faceOverride","faceTexture","faceOffset","x","offsetFix","offsetFixBase","offsetFixOverride","offset","applyFace","aniCode","prevProps","aspect","videoStream","captureStream","MediaRecorder","mimeType","captureSetting","codec","chunks","ondataavailable","event","data","onstop","superBuffer","Blob","url","URL","createObjectURL","document","createElement","body","href","download","click","revokeObjectURL","start","currentSize","getSize","removeChild","disposeItem","faceTextureChanged","dx","dy","faceOffsetFix","oldFaceOffsetFix","currentFaceOffsetFix","stopAllAction","copy","newValue","changeOutlineSize","changeOpacity","changeOutlineColor","cancelAnimationFrame","renderLists","dispose","ref","clipAction","setLoop","clampWhenFinished","time","play","PureComponent","AniControl","lazy","Display","useContext","id","face","chainCode","initCameraPosition","showAniControl","useCallback","faceOffsets","defaultCameraPosition","cameraPositions","isNaN","controlsPositions","className","fallback","ControlPanel","SideBar","MainPage","location","classes","useStyles","useState","currentMode","setCurrentMode","useToggleState","sidebarOpen","toggleSidebarOpen","controlOpen","toggleControlOpen","isLoading","initLoadDone","setInitLoadDone","showSettings","viewerRef","useRef","setViewport","useEffect","pathname","updateViewportSize","removeEventListener","current","clientHeight","clientWidth","loadingMsg","root","CssBaseline","mode","open","openSidebarButton","openControl","content","process","App","routeProps","c110267_01","c110050_02","c110291_01","c110354_01","c110345_01","c110266_01","c110365_01","c110346_01","c110366_01","c110299_02","c110360_01","c110307_01","c110322_01","c110356_01","c110300_01","c110344_01","c110053_03","c110368_01","c110367_01","c110003_02","c110270_02","c110341_03","initVal","setState","drawerWidth","DRAWER_WIDTH","drawerBG","DRAWER_BGCOLOR","makeStyles","theme","display","drawer","overflowY","drawerPaper","alignItems","backgroundColor","backgroundImage","bg","backgroundSize","backgroundPosition","marginBottom","padding","top","left","margin","borderRadius","transition","cursor","zIndex","justifyContent","fontSize","module","exports","baseUrl","sideContent","supportedCodecs","ft","f","wr","wl","cam","showAC","AA","cc","Sword","Blade","Dagger","Axe","Lance","Bow","Wand","Staff","Manacaster","WEAPON_LIST","Male","Female","FILTERS","rarity","element","WEAPON_FILTERS","spFaceTextures","commonBG","green","black","grey","white","c","d","c100034_01","d210078_01","d210114_01","smith","face1","face2","face3","face4","face5","face6","face7","face8","face9","videoCodecs","resolve","FBXLoader","load","weaponCode","substring","item","disposedList","Set","needToDispose","has","uuid","notDisposed","disposeObject","isMesh","material","obj","geometry","texturePath","encoding","newMaterial","matType","createNewMaterial","skinning","fill","updateOutlineShader","fog","needsUpdate","onBeforeCompile","shader","customTransform","vertexShader","setTimeout","updated","m","details","replaceMaterial","transparent","createOutlineMaterial","isSkinnedMesh","bind","skeleton","bindMatrix","parent","faceTexturePath","faceMaterial","groups","faceGroups","count","materialIndex","min","end","max","uv","attributes","u","getX","getY","setXY","aniCodes","currentAni","currentParts","Infinity","parseInt","hostname","match","ReactDOM","getElementById","navigator","serviceWorker","ready","then","registration","unregister","catch","error","console","message"],"mappings":"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","file":"static/js/main.c73183b0.chunk.js","sourcesContent":["import { defaultSettings } from \"../consts\";\r\n\r\nexport const settingsReducer = (state, action) => {\r\n    let key, value;\r\n    switch (action.type) {\r\n        case \"toggle\":\r\n            key = action.key;\r\n            value = action.value;\r\n            const currentValue = state[key][value];\r\n            return {\r\n                ...state,\r\n                [key]: { ...state[key], [value]: !currentValue },\r\n            };\r\n        case \"reset\":\r\n            // reset values\r\n            // value = array of keys in settings[key] to be reset, null -> reset all\r\n            key = action.key;\r\n            value = action.value;\r\n            const defaultSetting = defaultSettings[key];\r\n            // no value -> reset all\r\n            if (!value)\r\n                return {\r\n                    ...state,\r\n                    [key]: { ...state[key], ...defaultSetting },\r\n                };\r\n            // if value is defined, reset only the specified keys\r\n            const update = {};\r\n            value.forEach(v => {\r\n                update[v] = defaultSetting[v];\r\n            });\r\n            return { ...state, [key]: { ...state[key], ...update } };\r\n        case \"load\":\r\n            // load preset values\r\n            return;\r\n        case \"update\":\r\n            // update state[key] with values from value\r\n            key = action.key;\r\n            value = action.value;\r\n            return { ...state, [key]: { ...state[key], ...value } };\r\n        default:\r\n            return state;\r\n    }\r\n};\r\n","import React, { createContext, useReducer } from \"react\";\r\nimport { settingsReducer } from \"../reducer/settingsReducer\";\r\nimport { defaultSettings } from \"../consts\";\r\nimport { chainCodeToList } from \"../viewerHelpers\";\r\n\r\nexport const SettingsContext = createContext();\r\nexport const DispatchContext = createContext();\r\n\r\nconst initAniChain = chainCodeToList(defaultSettings.animation.code, \"init\");\r\n\r\nexport const initSettings = {\r\n    model: { ...defaultSettings.model },\r\n    scene: { ...defaultSettings.scene },\r\n    animation: { ...defaultSettings.animation },\r\n    app: { ...defaultSettings.app },\r\n    outline: { ...defaultSettings.outline },\r\n    capture: { ...defaultSettings.capture },\r\n    chainMaker: { chain: initAniChain },\r\n};\r\n\r\nexport function SettingsProvider(props) {\r\n    const [settings, dispatch] = useReducer(settingsReducer, initSettings);\r\n\r\n    return (\r\n        <SettingsContext.Provider value={settings}>\r\n            <DispatchContext.Provider value={dispatch}>\r\n                {props.children}\r\n            </DispatchContext.Provider>\r\n        </SettingsContext.Provider>\r\n    );\r\n}\r\n","import React from \"react\";\r\nimport Button from \"@material-ui/core/Button\";\r\n\r\nimport { initSettings } from \"./context/SettingsContext\";\r\nimport {\r\n    initKey,\r\n    WEAPON_CODE,\r\n    GENDER_CODE,\r\n    COMBO_LENGTH,\r\n    FS_LENGTH,\r\n} from \"./consts\";\r\n\r\nimport { chainCodeToList } from \"./viewerHelpers\";\r\n\r\nexport const isBlade = code => code.startsWith(\"w302\");\r\n\r\nexport const isSheath = code => isBlade(code) && code.endsWith(\"02\");\r\n\r\n// if object is an array, apply callback on each element of object, otherwise, apply call back on the object\r\nexport const callbackOnPotentialArray = (object, callback) => {\r\n    if (Array.isArray(object)) {\r\n        object.forEach(child => callback(child));\r\n        return;\r\n    }\r\n    callback(object);\r\n};\r\n\r\nexport const setInitialSettings = params => {\r\n    if (params.length === 0) return;\r\n    let faceTextureDefined = false;\r\n    params.forEach(param => {\r\n        // if no string given, skip\r\n        if (!param) return;\r\n\r\n        const [keycode, ...value] = param.split(\"=\"); // animation code can have \"=\" inside\r\n        // if no value given, skip\r\n        if (!value[0]) return;\r\n\r\n        let setValue = value.length === 1 ? value[0] : value.join(\"=\");\r\n\r\n        switch (keycode) {\r\n            case \"ft\":\r\n                faceTextureDefined = true;\r\n                break;\r\n            case \"cc\":\r\n                // initialize chain maker chain\r\n                const chainList = chainCodeToList(setValue, \"Animation\");\r\n                initSettings[\"chainMaker\"][\"chain\"] = chainList;\r\n                break;\r\n            case \"bg\":\r\n                if (setValue !== \"transparent\") {\r\n                    setValue = `#${setValue}`;\r\n                }\r\n                break;\r\n            case \"cam\": // parameters in form x, y, z\r\n                setValue = setValue.split(\",\").map(n => parseFloat(n));\r\n                break;\r\n            default:\r\n        }\r\n        const { group, key } = initKey[keycode];\r\n\r\n        const isBooleanValue = setValue === \"true\" || setValue === \"false\";\r\n\r\n        initSettings[group][key] = isBooleanValue\r\n            ? Boolean(setValue === \"true\")\r\n            : setValue;\r\n    });\r\n\r\n    initSettings[\"model\"][\"texture\"] = initSettings[\"model\"][\"id\"];\r\n\r\n    if (!faceTextureDefined) {\r\n        initSettings[\"model\"][\"faceTexture\"] = initSettings[\"model\"][\"id\"];\r\n    }\r\n};\r\n\r\nexport const generateChainCode = chain => {\r\n    const defaultMod = {\r\n        timeScale: 1,\r\n        repetitions: 1,\r\n    };\r\n    const modList = {\r\n        ts: \"timeScale\",\r\n        r: \"repetitions\",\r\n    };\r\n    const length = chain.length;\r\n    let output = \"\";\r\n    chain.forEach((ani, i) => {\r\n        const { fileName, aniName } = ani;\r\n        if (fileName) {\r\n            if (i === 0) {\r\n                output = output.concat(fileName);\r\n            } else {\r\n                output = output.concat(\r\n                    fileName !== chain[i - 1].fileName ? fileName : \"\"\r\n                );\r\n            }\r\n            output = output.concat(\"+\");\r\n        }\r\n        output = output.concat(aniName);\r\n        // Add modifiers\r\n        Object.keys(modList).forEach(modKey => {\r\n            const key = modList[modKey];\r\n            if (ani[key] !== defaultMod[key]) {\r\n                output = output.concat(`&${modKey}=${ani[key]}`);\r\n            }\r\n        });\r\n        if (i < length - 1) {\r\n            output = output.concat(\">\");\r\n        }\r\n    });\r\n    return output;\r\n};\r\n\r\nexport const collectFilter = toggleState => {\r\n    let collected = {};\r\n    Object.keys(toggleState).forEach(key => {\r\n        let tmp = [];\r\n        Object.keys(toggleState[key]).forEach(k => {\r\n            if (toggleState[key][k]) {\r\n                tmp.push(k);\r\n            }\r\n        });\r\n        collected[key] = tmp;\r\n    });\r\n    return collected;\r\n};\r\n\r\nexport const multiCondFilter = (input, filters) => {\r\n    const filterKeys = Object.keys(filters);\r\n\r\n    return input.filter(el => {\r\n        return filterKeys.every(key => {\r\n            if (!filters[key].length) return true;\r\n            return filters[key].includes(el[key]);\r\n        });\r\n    });\r\n};\r\n\r\nexport const complementaryColor = color => {\r\n    const hexColor = color.replace(\"#\", \"0x\");\r\n\r\n    return `#${(\"000000\" + (\"0xffffff\" ^ hexColor).toString(16)).slice(-6)}`;\r\n};\r\n\r\nexport const aniButtonsFromObject = (object, handleSelect, groupName) => {\r\n    if (!object) return null;\r\n    const style = { maxWidth: \"13.5rem\" };\r\n    return Object.keys(object).map(key => (\r\n        <Button\r\n            variant=\"contained\"\r\n            key={key}\r\n            data-value={object[key]}\r\n            data-name={`${groupName ? `${groupName} ` : \"\"}${key}`}\r\n            onClick={handleSelect}\r\n            style={style}\r\n        >\r\n            {key}\r\n        </Button>\r\n    ));\r\n};\r\n\r\n// Animation chain code generator\r\nexport const getStandbyCode = (weapon, gender) =>\r\n    `LOB_${WEAPON_CODE[weapon]}+${WEAPON_CODE[weapon]}_ONT_${GENDER_CODE[gender]}`;\r\n\r\nexport const getVictoryCode = weapon =>\r\n    `WIN_${WEAPON_CODE[weapon]}+${WEAPON_CODE[weapon]}_WIN_01>+${WEAPON_CODE[weapon]}_WIN_02`;\r\n\r\nexport const getDashAtkCode = weapon => `DAS+${WEAPON_CODE[weapon]}_DAS_02`;\r\n\r\nexport const getRollCode = weapon => `ROL+${WEAPON_CODE[weapon]}_ROL_01`;\r\n\r\nexport const getComboCode = weapon => {\r\n    const comboLength = COMBO_LENGTH[weapon];\r\n    const code = WEAPON_CODE[weapon];\r\n    let result = `CMB_${code}`;\r\n    // Weapon combo has 5 animations each\r\n    for (let i = 1; i <= comboLength; i++) {\r\n        result = result.concat(`+${code}_CMB_0${i}>`);\r\n    }\r\n    result = result.slice(0, -1); // Remove last '>' character\r\n    return result;\r\n};\r\n\r\n// Force Strike chain code\r\nexport const getFSCode = weapon => {\r\n    const fsAniLength = FS_LENGTH[weapon];\r\n    const code = WEAPON_CODE[weapon];\r\n    let result = `FS_${code}`;\r\n    // Weapon combo has 5 animations each\r\n    for (let i = 1; i <= fsAniLength; i++) {\r\n        result = result.concat(`+${code}_CHR_0${i}>`);\r\n    }\r\n    result = result.slice(0, -1); // Remove last '>' character\r\n    return result;\r\n};\r\n\r\n// Join Lobby chain code\r\nexport const getLobbyCode = (weapon, gender) => {\r\n    const code = WEAPON_CODE[weapon];\r\n    if (gender === \"Male\")\r\n        return `LOB_${code}+${code}_ONT_05&ts=-0.5>+${code}_ONT_02>+${code}_ONT_07>+${code}_ONT_08>+${code}_ONT_21`;\r\n    // Female\r\n    return `LOB_${code}+${code}_ONT_06&ts=-0.5>+${code}_ONT_04>+${code}_ONT_09>+${code}_ONT_10>+${code}_ONT_23`;\r\n};\r\n","import React, { PureComponent } from \"react\";\r\n\r\nimport * as THREE from \"three\";\r\nimport { OrbitControls } from \"three/examples/jsm/controls/OrbitControls\";\r\n\r\nimport { fbxSource } from \"./App\";\r\nimport { CAM_PARAMS } from \"./consts\";\r\nimport faceOffset from \"./data/face_offset\";\r\nimport {\r\n    changeMaterialToBasic,\r\n    analyzeWeaponCode,\r\n    loadModel,\r\n    applyFace,\r\n    disposeItem,\r\n    analyzeChainCode,\r\n    addOutline,\r\n    changeOpacity,\r\n    changeOutlineSize,\r\n    changeOutlineColor,\r\n} from \"./viewerHelpers\";\r\n\r\nclass ModelViewer extends PureComponent {\r\n    animate = () => {\r\n        this.frameId = requestAnimationFrame(this.animate);\r\n        const dt = this.clock.getDelta();\r\n        // Rotate the floor\r\n        this.floor.rotateY((this.props.rotateSpeed * dt * Math.PI) / 2);\r\n\r\n        if (this.mixers.length > 0) {\r\n            this.mixers.forEach(mixer => mixer.update(dt));\r\n        }\r\n        this.renderer.render(this.scene, this.camera);\r\n    };\r\n\r\n    // set up initial scene\r\n    init = () => {\r\n        this.models = {};\r\n        this.modelInfo = {\r\n            main: this.props.model,\r\n            weaponLeft: this.props.weaponLeft\r\n                ? analyzeWeaponCode(this.props.weaponLeft)\r\n                : \"\",\r\n            weaponRight: this.props.weaponRight\r\n                ? analyzeWeaponCode(this.props.weaponRight)\r\n                : \"\",\r\n        };\r\n\r\n        // save reference and specifications for outlines\r\n        this.outlines = {};\r\n        this.outlineDetails = {\r\n            color: this.props.outlineColor,\r\n            size: this.props.outlineSize,\r\n            enable: this.props.showOutline,\r\n            opacity: this.props.outlineOpacity,\r\n        };\r\n\r\n        // viewport\r\n        this.viewport = this.props.viewport || {\r\n            width: window.innerWidth,\r\n            height: window.innerHeight,\r\n        };\r\n\r\n        // mixers\r\n        this.mixers = [];\r\n\r\n        // clock\r\n        this.clock = new THREE.Clock();\r\n\r\n        // Scene\r\n        this.scene = new THREE.Scene();\r\n        this.scene.background =\r\n            this.props.bgColor !== \"transparent\"\r\n                ? new THREE.Color(this.props.bgColor)\r\n                : null;\r\n\r\n        // Create a floor to add the models on\r\n        const floorGeometry = new THREE.PlaneBufferGeometry(0.1, 0.1);\r\n        floorGeometry.rotateX(Math.PI / 2);\r\n        const floorMaterial = new THREE.MeshBasicMaterial();\r\n        floorMaterial.visible = false;\r\n        this.floor = new THREE.Mesh(floorGeometry, floorMaterial);\r\n        this.scene.add(this.floor);\r\n\r\n        // Camera\r\n        this.camera = new THREE.PerspectiveCamera(\r\n            CAM_PARAMS.angle,\r\n            this.viewport.width / this.viewport.height,\r\n            CAM_PARAMS.near,\r\n            CAM_PARAMS.far\r\n        );\r\n        this.cameraPosition = this.props.cameraPosition || [2, 0, 10];\r\n        this.camera.position.set(...this.cameraPosition);\r\n        this.camera.updateProjectionMatrix();\r\n\r\n        // Controls\r\n        this.controls = new OrbitControls(this.camera, this.mount);\r\n        this.controlsPosition = this.props.controlsPosition || [0, 0, 0];\r\n        this.controls.target.set(...this.controlsPosition);\r\n        this.controls.update();\r\n\r\n        // Light\r\n        let light = new THREE.DirectionalLight(0xffffff);\r\n        light.position.set(0, 200, 100);\r\n        this.scene.add(light);\r\n\r\n        // Renderer\r\n        this.rendererAA = new THREE.WebGLRenderer({\r\n            antialias: true,\r\n            alpha: true,\r\n        });\r\n        this.rendererAA.outputEncoding = THREE.sRGBEncoding;\r\n\r\n        this.rendererNoAA = new THREE.WebGLRenderer({\r\n            antialias: false,\r\n            alpha: true,\r\n        });\r\n        this.rendererNoAA.outputEncoding = THREE.sRGBEncoding;\r\n\r\n        this.renderer = this.props.antiAliasing\r\n            ? this.rendererAA\r\n            : this.rendererNoAA;\r\n        this.canvas = this.renderer.domElement;\r\n        this.renderer.setSize(this.viewport.width, this.viewport.height);\r\n        this.mount.appendChild(this.canvas);\r\n\r\n        this.animate();\r\n    };\r\n\r\n    playNextAni = () => {\r\n        // if capturing and finished recording current chain, stop capturing and set capture flag back to false\r\n        if (this.props.capture && this._aniIdx === this.nAni - 1) {\r\n            this.mediaRecorder.stop();\r\n            this.props.toggleCapture();\r\n        }\r\n        const newIdx = (this._aniIdx + 1) % this.nAni;\r\n        this.aniIdx = newIdx;\r\n    };\r\n\r\n    // add Animation Chain\r\n    addAnimationChain = async (object, animationChain, timeScale) => {\r\n        if (!animationChain) return; // If no Animation, return\r\n\r\n        const [fileList, animationList] = analyzeChainCode(animationChain);\r\n        this.nAni = animationList.length;\r\n\r\n        this.props.setIsLoading(true);\r\n\r\n        object.mixer = new THREE.AnimationMixer(object);\r\n        this.mixers.push(object.mixer);\r\n\r\n        this._aniIdx = 0;\r\n        object.mixer.timeScale = timeScale; // Global timeScale\r\n        object.mixer.addEventListener(\"finished\", this.playNextAni);\r\n        this.aniSettings = animationList.map(ani => {\r\n            return {\r\n                timeScale: ani.timeScale,\r\n                repetitions: ani.repetitions,\r\n            };\r\n        });\r\n        const batchLoader = fileList.map(file => {\r\n            const path = `${fbxSource}/fbx/${file}.fbx`;\r\n            return loadModel(path);\r\n        });\r\n\r\n        const animations = [];\r\n        // load all animation files\r\n        const animFiles = await Promise.all(batchLoader);\r\n\r\n        animationList.forEach(anim => {\r\n            const { fileIdx, aniName } = anim;\r\n            const animation = aniName\r\n                ? animFiles[fileIdx].animations.find(\r\n                      ani => ani.name === aniName\r\n                  )\r\n                : animFiles[fileIdx].animations[0];\r\n            animations.push(animation);\r\n        });\r\n        this.animations = animations;\r\n        // play first animation\r\n        this.aniIdx = 0;\r\n        this.props.setIsLoading(false);\r\n    };\r\n\r\n    // this.aniIdx = n => play animation with index n\r\n    set aniIdx(newIdx) {\r\n        this._aniIdx = newIdx;\r\n        const anim = this.animations[newIdx];\r\n        const mixer = this.models.main.mixer;\r\n        mixer.stopAllAction();\r\n        const action = mixer.clipAction(anim);\r\n        const { timeScale, repetitions } = this.aniSettings[newIdx];\r\n\r\n        action.setLoop(THREE.LoopRepeat, repetitions);\r\n        action.clampWhenFinished = true;\r\n        action.timeScale = timeScale;\r\n        action.time = 0;\r\n        action.play();\r\n    }\r\n\r\n    // Promise to load all models at initialize\r\n    initLoad = () => {\r\n        const modelId = this.modelInfo.main;\r\n        const modelPath = `${fbxSource}/fbx/${modelId}/${modelId}.fbx`;\r\n        const loadMain = loadModel(modelPath);\r\n\r\n        const weaponRight = this.props.weaponRight\r\n            ? this.modelInfo.weaponRight.model\r\n            : \"\";\r\n        const loadWeaponR = loadModel(weaponRight);\r\n\r\n        const weaponLeft = this.props.weaponLeft\r\n            ? this.modelInfo.weaponLeft.model\r\n            : \"\";\r\n        const loadWeaponL = loadModel(weaponLeft);\r\n\r\n        return Promise.all([loadMain, loadWeaponR, loadWeaponL]);\r\n    };\r\n\r\n    addWeapon = (weapon, side) => {\r\n        const boneName = `jWeapon${side[0]}`;\r\n        this.models.main.traverse(child => {\r\n            if (child.name === boneName && child.children.length === 0) {\r\n                child.add(weapon);\r\n            }\r\n        });\r\n    };\r\n\r\n    removeWeapon = side => {\r\n        const boneName = `jWeapon${side[0]}`;\r\n        this.models.main.traverse(child => {\r\n            if (child.children.length === 1 && child.name === boneName) {\r\n                if (child.children[0].type === \"Group\") {\r\n                    child.remove(this.models[`weapon${side}`]);\r\n                }\r\n            }\r\n        });\r\n    };\r\n\r\n    async componentDidMount() {\r\n        this.init();\r\n        this.props.setIsLoading(true);\r\n\r\n        // Load the models\r\n        const [main, weaponRight, weaponLeft] = await this.initLoad();\r\n\r\n        // save references\r\n        this.models = {\r\n            main,\r\n            weaponRight,\r\n            weaponLeft,\r\n        };\r\n        // add outline to main model and save reference\r\n        this.outlines.main = addOutline(main, this.outlineDetails);\r\n\r\n        // Save initial position and rotation\r\n        main.initPos = main.position.clone();\r\n        main.initRot = main.rotation.clone();\r\n\r\n        // change the materials to MeshBasicMaterial\r\n        changeMaterialToBasic(main);\r\n\r\n        // process weapons\r\n        [\"Right\", \"Left\"].forEach(side => {\r\n            const key = `weapon${side}`;\r\n            // if weapon not specified, return\r\n            if (!this.props[key]) return;\r\n            // add weapon\r\n            const weaponInfo = this.modelInfo[key];\r\n            const weaponModel = this.models[key];\r\n            const texture = weaponInfo.texture;\r\n            changeMaterialToBasic(weaponModel, texture);\r\n            // flip weapon if needed\r\n            weaponModel.rotation.y += weaponInfo.flipped ? Math.PI : 0;\r\n            // add outline to weapon and save reference\r\n            this.outlines[key] = addOutline(weaponModel, this.outlineDetails);\r\n            // add weapon to main body\r\n            this.addWeapon(this.models[`weapon${side}`], side);\r\n        });\r\n\r\n        // Apply face settings\r\n        const faceOverride = this.props.texture !== this.props.faceTexture;\r\n        if (\r\n            this.props.faceOffset.x !== 0 ||\r\n            this.props.faceOffset.y !== 0 ||\r\n            faceOverride\r\n        ) {\r\n            let offsetFix = { x: 0, y: 0 };\r\n            if (faceOverride) {\r\n                const offsetFixBase = faceOffset[this.props.texture] || {\r\n                    x: 0,\r\n                    y: 0,\r\n                };\r\n                const offsetFixOverride = faceOffset[\r\n                    this.props.faceTexture\r\n                ] || {\r\n                    x: 0,\r\n                    y: 0,\r\n                };\r\n                offsetFix = {\r\n                    x: offsetFixOverride.x - offsetFixBase.x,\r\n                    y: offsetFixOverride.y - offsetFixBase.y,\r\n                };\r\n            }\r\n            const offset = {\r\n                x: this.props.faceOffset.x + offsetFix.x,\r\n                y: this.props.faceOffset.y + offsetFix.y,\r\n            };\r\n            applyFace(main, this.props.faceTexture, offset);\r\n        }\r\n\r\n        // Add character to scene\r\n        this.floor.add(main);\r\n        // main model loading finished\r\n        this.props.setIsLoading(false);\r\n\r\n        // Add animation\r\n        this.addAnimationChain(main, this.props.aniCode, this.props.timeScale);\r\n    }\r\n\r\n    async componentDidUpdate(prevProps) {\r\n        // console.log(\"component did update\");\r\n\r\n        // // print updated props to console\r\n        // Object.keys(prevProps).forEach(key => {\r\n        //     if (prevProps[key] !== this.props[key]) {\r\n        //         console.log(\r\n        //             `${key}: ${JSON.stringify(\r\n        //                 prevProps[key]\r\n        //             )} to ${JSON.stringify(this.props[key])}`\r\n        //         );\r\n        //     }\r\n        // });\r\n\r\n        // Update viewport\r\n        if (\r\n            prevProps.viewport.width !== this.props.viewport.width ||\r\n            prevProps.viewport.height !== this.props.viewport.height\r\n        ) {\r\n            const { width, height } = this.props.viewport;\r\n            this.renderer.setSize(width, height);\r\n            this.camera.aspect = width / height;\r\n            this.camera.updateProjectionMatrix();\r\n        }\r\n\r\n        // Capture\r\n        if (prevProps.capture !== this.props.capture && this.props.capture) {\r\n            this.videoStream = this.canvas.captureStream(30);\r\n            this.mediaRecorder = new MediaRecorder(this.videoStream, {\r\n                mimeType: this.props.captureSetting.codec,\r\n            });\r\n            this.chunks = [];\r\n            this.mediaRecorder.ondataavailable = event =>\r\n                this.chunks.push(event.data);\r\n            this.mediaRecorder.onstop = () => {\r\n                this.props.setIsLoading(false);\r\n                const superBuffer = new Blob(this.chunks, {\r\n                    type: \"video/webm\",\r\n                });\r\n                var url = URL.createObjectURL(superBuffer);\r\n                var a = document.createElement(\"a\");\r\n                document.body.appendChild(a);\r\n                a.style = \"display: none\";\r\n                a.href = url;\r\n                a.download = \"animation.webm\";\r\n                a.click();\r\n                window.URL.revokeObjectURL(url);\r\n            };\r\n            // disable user input\r\n            this.props.setIsLoading(true);\r\n            // play first animation and start capturing\r\n            this.aniIdx = 0;\r\n            this.mediaRecorder.start();\r\n        }\r\n\r\n        // update anti aliasing setting\r\n        if (prevProps.antiAliasing !== this.props.antiAliasing) {\r\n            // get current viewport size\r\n            const currentSize = new THREE.Vector2();\r\n            this.renderer.getSize(currentSize);\r\n            // switch renderer\r\n            this.renderer = this.props.antiAliasing\r\n                ? this.rendererAA\r\n                : this.rendererNoAA;\r\n            this.renderer.setSize(currentSize.x, currentSize.y);\r\n            // remove old canvas\r\n            this.mount.removeChild(this.canvas);\r\n            // Add new canvas\r\n            this.canvas = this.renderer.domElement;\r\n            this.mount.appendChild(this.canvas);\r\n        }\r\n\r\n        // Update main model\r\n        if (prevProps.model !== this.props.model) {\r\n            this.props.setIsLoading(true);\r\n            const modelPath = `${fbxSource}/fbx/${this.props.model}/${this.props.model}.fbx`;\r\n            // load new model\r\n            const model = await loadModel(modelPath);\r\n            changeMaterialToBasic(model);\r\n            // add outline\r\n            this.outlines.main = addOutline(model, this.outlineDetails);\r\n\r\n            // remove weapons from old model if they exist\r\n            [\"Right\", \"Left\"].forEach(side => {\r\n                const key = `weapon${side}`;\r\n                if (prevProps[key]) {\r\n                    this.removeWeapon(side);\r\n                }\r\n            });\r\n            // remove and dispose old model\r\n            this.floor.remove(this.models.main);\r\n            disposeItem(this.models.main);\r\n            // add reference\r\n            this.models.main = model;\r\n\r\n            // Save initial position and rotation\r\n            model.initPos = model.position.clone();\r\n            model.initRot = model.rotation.clone();\r\n\r\n            // Add new model to scene\r\n            this.floor.add(model);\r\n\r\n            // Apply face to new model\r\n            const faceOverride = this.props.texture !== this.props.faceTexture;\r\n            if (\r\n                this.props.faceOffset.x !== 0 ||\r\n                this.props.faceOffset.y !== 0 ||\r\n                faceOverride\r\n            ) {\r\n                applyFace(model, this.props.faceTexture, this.props.faceOffset);\r\n            }\r\n\r\n            // Add weapons to new model\r\n            [\"Right\", \"Left\"].forEach(side => {\r\n                const key = `weapon${side}`;\r\n                const weaponModel = this.models[key];\r\n                // if no weapon, return\r\n                if (!weaponModel) return;\r\n\r\n                this.addWeapon(weaponModel, side);\r\n                // add outline if not exist\r\n                if (!this.outlines[key]) {\r\n                    this.outlines[key] = addOutline(\r\n                        weaponModel,\r\n                        this.outlineDetails\r\n                    );\r\n                }\r\n            });\r\n\r\n            // Add animation to new model\r\n            this.addAnimationChain(\r\n                model,\r\n                this.props.aniCode,\r\n                this.props.timeScale\r\n            );\r\n\r\n            this.props.setIsLoading(false);\r\n        } else {\r\n            // Update face when main model not changed\r\n            const faceTextureChanged =\r\n                prevProps.faceTexture !== this.props.faceTexture;\r\n            if (\r\n                prevProps.faceOffset !== this.props.faceOffset ||\r\n                faceTextureChanged\r\n            ) {\r\n                const dx = this.props.faceOffset.x - prevProps.faceOffset.x;\r\n                const dy = this.props.faceOffset.y - prevProps.faceOffset.y;\r\n                let faceOffsetFix = { x: 0, y: 0 };\r\n                if (faceTextureChanged) {\r\n                    const oldFaceOffsetFix = faceOffset[\r\n                        prevProps.faceTexture\r\n                    ] || {\r\n                        x: 0,\r\n                        y: 0,\r\n                    };\r\n                    const currentFaceOffsetFix = faceOffset[\r\n                        this.props.faceTexture\r\n                    ] || { x: 0, y: 0 };\r\n                    faceOffsetFix = {\r\n                        x: currentFaceOffsetFix.x - oldFaceOffsetFix.x,\r\n                        y: currentFaceOffsetFix.y - oldFaceOffsetFix.y,\r\n                    };\r\n                }\r\n                const offset = {\r\n                    x: dx + faceOffsetFix.x,\r\n                    y: dy + faceOffsetFix.y,\r\n                };\r\n                applyFace(this.models.main, this.props.faceTexture, offset);\r\n            }\r\n        }\r\n\r\n        // Update Weapons\r\n        [\"Right\", \"Left\"].forEach(async side => {\r\n            const key = `weapon${side}`;\r\n            // if not changed, return\r\n            if (prevProps[key] === this.props[key]) return;\r\n            // Update weapon\r\n            this.removeWeapon(side); // remove old weapon\r\n            disposeItem(this.models[key]); // dispose old weapon\r\n            // if current weapon is empty (weapon removed)\r\n            if (!this.props[key]) {\r\n                this.models[key] = null;\r\n                this.modelInfo[key] = \"\";\r\n                // remove reference to outline\r\n                this.outlines[key] = null;\r\n                return;\r\n            }\r\n            // load new weapon\r\n            this.props.setIsLoading(true);\r\n\r\n            this.modelInfo[key] = analyzeWeaponCode(this.props[key]);\r\n            const { model: modelPath, texture } = this.modelInfo[key];\r\n\r\n            // load new model\r\n            const model = await loadModel(modelPath);\r\n            this.models[key] = model;\r\n            // process new weapon\r\n            changeMaterialToBasic(this.models[key], texture);\r\n            if (this.modelInfo[key].flipped) {\r\n                this.models[key].rotation.y = Math.PI;\r\n            }\r\n            // add outline to new weapon\r\n            this.outlines[key] = addOutline(model, this.outlineDetails);\r\n            // add new weapon to main model\r\n            this.addWeapon(model, side);\r\n\r\n            this.props.setIsLoading(false);\r\n        });\r\n\r\n        // Update animation\r\n        if (prevProps.aniCode !== this.props.aniCode) {\r\n            if (prevProps.aniCode) {\r\n                this.models.main.mixer.stopAllAction();\r\n\r\n                // Reset position and rotation to initial value\r\n                const { initPos, initRot } = this.models.main;\r\n                this.models.main.position.copy(initPos);\r\n                this.models.main.rotation.copy(initRot);\r\n\r\n                this.mixers = [];\r\n                this.animations = [];\r\n            }\r\n            this.addAnimationChain(\r\n                this.models.main,\r\n                this.props.aniCode,\r\n                this.props.timeScale\r\n            );\r\n        }\r\n\r\n        //Update timeScale\r\n        if (prevProps.timeScale !== this.props.timeScale) {\r\n            if (this.mixers.length > 0) {\r\n                this.mixers.forEach(\r\n                    mixer => (mixer.timeScale = this.props.timeScale)\r\n                );\r\n            }\r\n        }\r\n\r\n        // Update background color\r\n        if (prevProps.bgColor !== this.props.bgColor) {\r\n            this.scene.background =\r\n                this.props.bgColor !== \"transparent\"\r\n                    ? new THREE.Color(this.props.bgColor)\r\n                    : null;\r\n        }\r\n\r\n        // Update outline visibility\r\n        if (prevProps.showOutline !== this.props.showOutline) {\r\n            const newValue = this.props.showOutline;\r\n            this.outlineDetails.enable = newValue;\r\n\r\n            Object.keys(this.outlines).forEach(key => {\r\n                if (!this.outlines[key]) return;\r\n                this.outlines[key].forEach(\r\n                    outline => (outline.visible = newValue)\r\n                );\r\n            });\r\n        }\r\n\r\n        // Update outline size\r\n        if (prevProps.outlineSize !== this.props.outlineSize) {\r\n            const size = this.props.outlineSize;\r\n            this.outlineDetails.size = size;\r\n\r\n            Object.keys(this.outlines).forEach(key => {\r\n                if (!this.outlines[key]) return;\r\n                this.outlines[key].forEach(outline =>\r\n                    changeOutlineSize(outline, size)\r\n                );\r\n            });\r\n        }\r\n\r\n        // Update outline opacity\r\n        if (prevProps.outlineOpacity !== this.props.outlineOpacity) {\r\n            const newValue = this.props.outlineOpacity;\r\n            this.outlineDetails.opacity = newValue;\r\n\r\n            Object.keys(this.outlines).forEach(key => {\r\n                if (!this.outlines[key]) return;\r\n                this.outlines[key].forEach(outline =>\r\n                    changeOpacity(outline, newValue)\r\n                );\r\n            });\r\n        }\r\n\r\n        // Update outline color\r\n        if (prevProps.outlineColor !== this.props.outlineColor) {\r\n            const newValue = this.props.outlineColor;\r\n\r\n            Object.keys(this.outlines).forEach(key => {\r\n                if (!this.outlines[key]) return;\r\n                this.outlines[key].forEach(outline =>\r\n                    changeOutlineColor(outline, newValue)\r\n                );\r\n            });\r\n        }\r\n    }\r\n\r\n    componentWillUnmount() {\r\n        cancelAnimationFrame(this.frameId);\r\n        disposeItem(this.scene);\r\n        this.mixers = null;\r\n        this.clock = null;\r\n        this.camera = null;\r\n        this.controls = null;\r\n        this.scene = null;\r\n        this.renderer = null;\r\n        this.rendererAA.renderLists.dispose();\r\n        this.rendererAA.dispose();\r\n        this.rendererAA = null;\r\n        this.rendererNoAA.renderLists.dispose();\r\n        this.rendererNoAA.dispose();\r\n        this.rendererNoAA = null;\r\n    }\r\n    render() {\r\n        return (\r\n            <div\r\n                ref={el => {\r\n                    this.mount = el;\r\n                }}\r\n            />\r\n        );\r\n    }\r\n}\r\n\r\nexport default ModelViewer;\r\n","import React, { lazy, Suspense, useContext, useCallback } from \"react\";\r\n\r\nimport { SettingsContext, DispatchContext } from \"./context/SettingsContext\";\r\nimport ModelViewer from \"./ModelViewer\";\r\nimport \"./styles/Display.css\";\r\n\r\nimport { faceOffsets, cameraPositions, controlsPositions } from \"./consts\";\r\n\r\nconst AniControl = lazy(() => import(\"./AniControl\"));\r\n\r\nfunction Display(props) {\r\n    const { viewport } = props;\r\n\r\n    const settings = useContext(SettingsContext);\r\n    const {\r\n        model: {\r\n            id: modelId,\r\n            texture,\r\n            faceTexture,\r\n            face,\r\n            weaponRight,\r\n            weaponLeft,\r\n        },\r\n        animation: { code: chainCode, timeScale },\r\n        scene: { rotateSpeed, background: bgColor, initCameraPosition },\r\n        app: { showAniControl, antiAliasing },\r\n        capture: { enable: capture },\r\n        outline: {\r\n            enable: showOutline,\r\n            color: outlineColor,\r\n            size: outlineSize,\r\n            opacity: outlineOpacity,\r\n        },\r\n    } = settings;\r\n\r\n    const dispatch = useContext(DispatchContext);\r\n    const toggleCapture = useCallback(() => {\r\n        const action = {\r\n            type: \"toggle\",\r\n            key: \"capture\",\r\n            value: \"enable\",\r\n        };\r\n        dispatch(action);\r\n    }, [dispatch]);\r\n\r\n    const faceOffset = faceOffsets[`face${face}`];\r\n\r\n    const type = modelId[0];\r\n\r\n    const defaultCameraPosition = cameraPositions[modelId]\r\n        ? cameraPositions[modelId]\r\n        : cameraPositions[type];\r\n\r\n    const cameraPosition = initCameraPosition\r\n        ? initCameraPosition.map((n, i) =>\r\n              isNaN(n) ? defaultCameraPosition[i] : n\r\n          )\r\n        : defaultCameraPosition;\r\n\r\n    const controlsPosition = controlsPositions[modelId]\r\n        ? controlsPositions[modelId]\r\n        : controlsPositions[type];\r\n\r\n    return (\r\n        <div className=\"Display\">\r\n            {showAniControl && (\r\n                <div className=\"Display-AniControl\">\r\n                    <Suspense fallback={null}>\r\n                        <AniControl value={settings.animation.timeScale} />\r\n                    </Suspense>\r\n                </div>\r\n            )}\r\n            <ModelViewer\r\n                setIsLoading={props.setIsLoading}\r\n                capture={capture}\r\n                captureSetting={settings.capture}\r\n                toggleCapture={toggleCapture}\r\n                viewport={viewport}\r\n                cameraPosition={cameraPosition}\r\n                controlsPosition={controlsPosition}\r\n                model={modelId}\r\n                texture={texture}\r\n                faceTexture={faceTexture}\r\n                faceOffset={faceOffset}\r\n                weaponRight={weaponRight}\r\n                weaponLeft={weaponLeft}\r\n                aniCode={chainCode}\r\n                timeScale={timeScale}\r\n                rotateSpeed={rotateSpeed}\r\n                bgColor={bgColor}\r\n                showOutline={showOutline}\r\n                outlineColor={outlineColor}\r\n                outlineSize={outlineSize}\r\n                outlineOpacity={outlineOpacity}\r\n                antiAliasing={antiAliasing}\r\n            />\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default Display;\r\n","import React, {\r\n    lazy,\r\n    Suspense,\r\n    useState,\r\n    useRef,\r\n    useEffect,\r\n    useContext,\r\n} from \"react\";\r\nimport useToggleState from \"./hooks/useToggleState\";\r\n\r\nimport Menu from \"@material-ui/icons/Menu\";\r\n\r\nimport CssBaseline from \"@material-ui/core/CssBaseline\";\r\nimport useStyles from \"./styles/MainPageStyles\";\r\n\r\nimport Display from \"./Display\";\r\nimport { SettingsContext } from \"./context/SettingsContext\";\r\nimport { setInitialSettings } from \"./helpers\";\r\n\r\nconst ControlPanel = lazy(() => import(\"./ControlPanel\"));\r\nconst SideBar = lazy(() => import(\"./SideBar\"));\r\n\r\nfunction MainPage({ location }) {\r\n    const classes = useStyles();\r\n\r\n    const [currentMode, setCurrentMode] = useState(\"model\");\r\n    const [sidebarOpen, toggleSidebarOpen] = useToggleState(true);\r\n    const [controlOpen, toggleControlOpen] = useToggleState(false);\r\n    const [isLoading, setIsLoading] = useState(false);\r\n    const [initLoadDone, setInitLoadDone] = useState(false);\r\n    const {\r\n        app: { showSettings },\r\n    } = useContext(SettingsContext);\r\n\r\n    const viewerRef = useRef();\r\n    const [viewport, setViewport] = useState({\r\n        width: window.innerWidth,\r\n        height: window.innerHeight,\r\n    });\r\n\r\n    useEffect(() => {\r\n        const params = location.pathname.split(\"/\");\r\n        setInitialSettings(params);\r\n        setInitLoadDone(true);\r\n\r\n        window.addEventListener(\"resize\", updateViewportSize);\r\n\r\n        return function () {\r\n            window.removeEventListener(\"resize\", updateViewportSize);\r\n        };\r\n    }, [location.pathname]);\r\n\r\n    const updateViewportSize = () => {\r\n        const height = viewerRef.current.clientHeight;\r\n        const width = viewerRef.current.clientWidth;\r\n        setViewport({ width, height });\r\n    };\r\n\r\n    const openControl = mode => {\r\n        toggleControlOpen();\r\n        setCurrentMode(mode);\r\n    };\r\n\r\n    return (\r\n        <>\r\n            {isLoading && <div className={classes.loadingMsg}>Loading...</div>}\r\n            <div className={classes.root}>\r\n                <Suspense fallback={null}>\r\n                    <CssBaseline />\r\n                    <ControlPanel\r\n                        mode={currentMode}\r\n                        open={controlOpen}\r\n                        toggleControlOpen={toggleControlOpen}\r\n                    />\r\n                    {initLoadDone && showSettings && (\r\n                        <>\r\n                            <button\r\n                                onClick={toggleSidebarOpen}\r\n                                className={classes.openSidebarButton}\r\n                            >\r\n                                <Menu />\r\n                            </button>\r\n\r\n                            <SideBar\r\n                                toggleSidebarOpen={toggleSidebarOpen}\r\n                                open={sidebarOpen}\r\n                                openControl={openControl}\r\n                            />\r\n                        </>\r\n                    )}\r\n                </Suspense>\r\n                {initLoadDone && (\r\n                    <main ref={viewerRef} className={classes.content}>\r\n                        <Display\r\n                            setIsLoading={setIsLoading}\r\n                            viewport={viewport}\r\n                        />\r\n                    </main>\r\n                )}\r\n            </div>\r\n        </>\r\n    );\r\n}\r\n\r\nexport default MainPage;\r\n","import React from \"react\";\r\n\r\nimport { SettingsProvider } from \"./context/SettingsContext\";\r\n\r\nimport { Route, HashRouter } from \"react-router-dom\";\r\nimport MainPage from \"./MainPage\";\r\n\r\nimport \"./styles/App.css\";\r\n\r\nfunction App() {\r\n    return (\r\n        <SettingsProvider>\r\n            <HashRouter>\r\n                <Route render={routeProps => <MainPage {...routeProps} />} />\r\n            </HashRouter>\r\n        </SettingsProvider>\r\n    );\r\n}\r\n\r\nexport const fbxSource = process.env.PUBLIC_URL;\r\n\r\nexport default App;\r\n","const faceOffset = {\r\n    c110267_01: { x: 0.08, y: -0.03 },\r\n    c110050_02: { x: 0.07, y: 0.13 },\r\n    c110291_01: { x: 0.07, y: 0.14 },\r\n    c110354_01: { x: 0.07, y: 0.01 },\r\n    c110345_01: { x: 0.08, y: -0.13 },\r\n    c110266_01: { x: 0.01, y: 0.03 },\r\n    c110365_01: { x: 0.043, y: -0.0625 },\r\n    c110346_01: { x: 0.07, y: 0.08 },\r\n    c110366_01: { x: 0.043, y: -0.0625 },\r\n    c110299_02: { x: 0.07, y: 0.08 },\r\n    c110360_01: { x: 0.07, y: 0.14 },\r\n    c110307_01: { x: 0.08, y: -0.03 },\r\n    c110322_01: { x: 0.043, y: 0.08 },\r\n    c110356_01: { x: 0.07, y: 0.08 },\r\n    c110300_01: { x: 0.07, y: -0.1 },\r\n    c110344_01: { x: 0.07, y: -0.02 },\r\n    c110053_03: { x: 0.043, y: -0.0625 },\r\n    c110368_01: { x: 0.043, y: -0.0625 },\r\n    c110367_01: { x: 0.043, y: -0.0625 },\r\n    c110003_02: { x: 0.043, y: -0.0625 },\r\n    c110270_02: { x: 0.043, y: -0.0625 },\r\n    c110341_03: { x: 0.043, y: -0.0625 },\r\n};\r\nexport default faceOffset;\r\n","import { useState, useRef } from \"react\";\r\n\r\nfunction useToggleState(initVal = false) {\r\n    const [state, setState] = useState(initVal);\r\n    const toggleState = useRef(() => {\r\n        setState(state => !state);\r\n    });\r\n    return [state, toggleState.current];\r\n}\r\n\r\nexport default useToggleState;\r\n","import { makeStyles } from \"@material-ui/core/styles\";\r\nimport { DRAWER_WIDTH, DRAWER_BGCOLOR } from \"../consts\";\r\nimport bg from \"./Rose-Petals.svg\";\r\n\r\nconst drawerWidth = DRAWER_WIDTH;\r\nconst drawerBG = DRAWER_BGCOLOR;\r\n\r\nconst useStyles = makeStyles(theme => ({\r\n    root: {\r\n        display: \"block\",\r\n        width: \"100vw\",\r\n        height: \"100vh\",\r\n    },\r\n    drawer: {\r\n        width: drawerWidth,\r\n        overflowY: \"scroll\",\r\n    },\r\n    drawerPaper: {\r\n        alignItems: \"center\",\r\n        backgroundColor: drawerBG,\r\n        backgroundImage: `url(${bg})`,\r\n        /* background by SVGBackgrounds.com */\r\n        backgroundSize: \"cover\",\r\n        backgroundPosition: \"center\",\r\n        width: drawerWidth,\r\n        \"& button\": {\r\n            marginBottom: \"0.2rem\",\r\n        },\r\n    },\r\n    content: {\r\n        height: \"100vh\",\r\n        width: \"100vw\",\r\n        padding: 0,\r\n    },\r\n    openSidebarButton: {\r\n        position: \"absolute\",\r\n        top: 0,\r\n        left: 0,\r\n        margin: \"2rem\",\r\n        opacity: \"0.5\",\r\n        borderRadius: \"0.25rem\",\r\n        transition: \"0.5s all ease-in-out\",\r\n        cursor: \"pointer\",\r\n        \"&:hover\": {\r\n            opacity: \"1\",\r\n        },\r\n    },\r\n    loadingMsg: {\r\n        position: \"absolute\",\r\n        zIndex: \"9999\",\r\n        width: \"100vw\",\r\n        height: \"100vh\",\r\n        display: \"flex\",\r\n        justifyContent: \"center\",\r\n        alignItems: \"center\",\r\n        color: \"white\",\r\n        fontSize: \"x-large\",\r\n        backgroundColor: \"rgba(0,0,0,0.5)\",\r\n    },\r\n}));\r\n\r\nexport default useStyles;\r\n","module.exports = __webpack_public_path__ + \"static/media/Rose-Petals.1911e778.svg\";","export const DRAWER_WIDTH = \"15rem\";\r\nexport const DRAWER_BGCOLOR = \"#330000\";\r\n\r\nexport const baseUrl = \"https://dgk3593.github.io/dl-model/#/\";\r\n\r\nconst defaultAni = \"MWM_CMN+CMN_MWM_03\";\r\n\r\nexport const defaultSettings = {\r\n    model: {\r\n        id: \"c100001_01\",\r\n        texture: \"c100001_01\",\r\n        faceTexture: \"c100001_01\",\r\n        face: 2,\r\n        weaponRight: \"\",\r\n        weaponLeft: \"\",\r\n    },\r\n    scene: {\r\n        rotateSpeed: 0,\r\n        background: \"#cccccc\",\r\n        initCameraPosition: null,\r\n    },\r\n    animation: {\r\n        code: defaultAni,\r\n        timeScale: 1,\r\n    },\r\n    app: {\r\n        sideContent: \"settings\",\r\n        showSettings: true,\r\n        showAniControl: true,\r\n        antiAliasing: false,\r\n        capture: false,\r\n    },\r\n    outline: {\r\n        enable: true,\r\n        size: 5, // 1 -> 10\r\n        color: \"#000000\",\r\n        opacity: 1, // 0.1 -> 10%, 1-> 100%\r\n    },\r\n    capture: {\r\n        enable: false,\r\n        supportedCodecs: [],\r\n        codec: \"\",\r\n    },\r\n};\r\n\r\nexport const initKey = {\r\n    id: { group: \"model\", key: \"id\" },\r\n    ft: { group: \"model\", key: \"faceTexture\" },\r\n    f: { group: \"model\", key: \"face\" },\r\n    wr: { group: \"model\", key: \"weaponRight\" },\r\n    wl: { group: \"model\", key: \"weaponLeft\" },\r\n    bg: { group: \"scene\", key: \"background\" },\r\n    cam: { group: \"scene\", key: \"initCameraPosition\" },\r\n    ts: { group: \"animation\", key: \"timeScale\" },\r\n    showAC: { group: \"app\", key: \"showAniControl\" },\r\n    showSettings: { group: \"app\", key: \"showSettings\" },\r\n    showOutline: { group: \"outline\", key: \"enable\" },\r\n    AA: { group: \"app\", key: \"antiAliasing\" },\r\n    cc: { group: \"animation\", key: \"code\" },\r\n};\r\n\r\nexport const WEAPON_CODE = {\r\n    Sword: \"SWD\",\r\n    Blade: \"KAT\",\r\n    Dagger: \"DAG\",\r\n    Axe: \"AXE\",\r\n    Lance: \"LAN\",\r\n    Bow: \"BOW\",\r\n    Wand: \"ROD\",\r\n    Staff: \"CAN\",\r\n    Manacaster: \"GUN\",\r\n};\r\n\r\nexport const WEAPON_LIST = [\r\n    \"Sword\",\r\n    \"Blade\",\r\n    \"Dagger\",\r\n    \"Axe\",\r\n    \"Lance\",\r\n    \"Bow\",\r\n    \"Wand\",\r\n    \"Staff\",\r\n    \"Manacaster\",\r\n];\r\n\r\nexport const GENDER_CODE = {\r\n    Male: 21,\r\n    Female: 23,\r\n};\r\n\r\nexport const COMBO_LENGTH = {\r\n    Axe: 5,\r\n    Bow: 6,\r\n    Staff: 5,\r\n    Dagger: 6,\r\n    Blade: 5,\r\n    Lance: 5,\r\n    Wand: 5,\r\n    Sword: 5,\r\n};\r\n\r\nexport const FS_LENGTH = {\r\n    Axe: 3,\r\n    Bow: 3,\r\n    Staff: 5,\r\n    Dagger: 3,\r\n    Blade: 3,\r\n    Lance: 4,\r\n    Wand: 3,\r\n    Sword: 3,\r\n};\r\n\r\nexport const FILTERS = {\r\n    rarity: [\"3\", \"4\", \"5\"],\r\n    element: [\"Flame\", \"Water\", \"Wind\", \"Light\", \"Shadow\"],\r\n    weapon: [\r\n        \"Sword\",\r\n        \"Blade\",\r\n        \"Dagger\",\r\n        \"Axe\",\r\n        \"Lance\",\r\n        \"Bow\",\r\n        \"Wand\",\r\n        \"Staff\",\r\n        \"Manacaster\",\r\n    ],\r\n};\r\n\r\nexport const WEAPON_FILTERS = {\r\n    rarity: [\"1\", \"2\", \"3\", \"4\", \"5\", \"6\"],\r\n    element: [\"Flame\", \"Water\", \"Wind\", \"Light\", \"Shadow\", \"None\"],\r\n    weapon: [\r\n        \"Sword\",\r\n        \"Blade\",\r\n        \"Dagger\",\r\n        \"Axe\",\r\n        \"Lance\",\r\n        \"Bow\",\r\n        \"Wand\",\r\n        \"Staff\",\r\n        \"Manacaster\",\r\n    ],\r\n};\r\n\r\nexport const spFaceTextures = {\r\n    c110300_01: \"ec110300_01\",\r\n};\r\n\r\nexport const commonBG = {\r\n    green: \"#00ff00\",\r\n    black: \"#000000\",\r\n    grey: \"#cccccc\",\r\n    white: \"#ffffff\",\r\n};\r\n\r\nexport const CAM_PARAMS = {\r\n    angle: 45,\r\n    far: 300,\r\n    near: 0.01,\r\n};\r\n\r\nexport const cameraPositions = {\r\n    c: [0, 0.5, 1.5],\r\n    d: [3, 0.5, 6],\r\n\r\n    c100034_01: [0, 0.5, 1.75],\r\n    d210078_01: [3, 3, 20],\r\n    d210114_01: [3, 3, 20],\r\n\r\n    smith: [1, 1, 2],\r\n};\r\n\r\nexport const controlsPositions = {\r\n    c: [0, 0.5, 0],\r\n    d: [0, 1, 0],\r\n\r\n    d210078_01: [0, 3, 0],\r\n    d210114_01: [0, 3, 0],\r\n\r\n    smith: [0, 0.5, 0],\r\n};\r\n\r\nexport const faceOffsets = {\r\n    face1: { x: 2, y: 1 },\r\n    face2: { x: 0, y: 0 },\r\n    face3: { x: 1, y: 0 },\r\n    face4: { x: 2, y: 0 },\r\n    face5: { x: 3, y: 0 },\r\n    face6: { x: 0, y: -1 },\r\n    face7: { x: 1, y: -1 },\r\n    face8: { x: 2, y: -1 },\r\n    face9: { x: 3, y: -1 },\r\n};\r\n\r\nexport const videoCodecs = [\r\n    \"video/webm;codecs=h264\",\r\n    \"video/webm;codecs=vp9\",\r\n    \"video/webm;codecs=vp8\",\r\n    \"video/webm\",\r\n];\r\n\r\nexport const asciiSet = [\r\n    \" .:-=+*#%@\",\r\n    \" .'`^\\\",:;Il!i~+_-?][}{1)(|/tfjrxnuvczXYUJCLQ0OZmwqpdbkhao*#MW&8%B@$\",\r\n];\r\n","import * as THREE from \"three\";\r\nimport { fbxSource } from \"./App\";\r\nimport { v4 as uuid } from \"uuid\";\r\n\r\nimport { FBXLoader } from \"three/examples/jsm/loaders/FBXLoader\";\r\nimport { callbackOnPotentialArray, isSheath } from \"./helpers\";\r\n\r\nexport const loadModel = url => {\r\n    return (\r\n        url &&\r\n        new Promise(resolve => {\r\n            new FBXLoader().load(url, resolve);\r\n        })\r\n    );\r\n};\r\n\r\nexport const loadTexture = url => {\r\n    return (\r\n        url &&\r\n        new Promise(resolve => {\r\n            new THREE.TextureLoader().load(url, resolve);\r\n        })\r\n    );\r\n};\r\n\r\nexport const analyzeWeaponCode = code => {\r\n    const flipped = code.endsWith(\"b\");\r\n    const weaponCode = code.substring(0, code.length - 1);\r\n    const model = `${fbxSource}/fbx/${weaponCode}/${weaponCode}.fbx`;\r\n    const texture = `${fbxSource}/fbx/${weaponCode}/${weaponCode}.png`;\r\n\r\n    return { model, texture, flipped, isSheath: isSheath(weaponCode) };\r\n};\r\n\r\nexport const disposeItem = item => {\r\n    if (!item) return;\r\n\r\n    // keep track of disposed objects\r\n    const disposedList = new Set();\r\n    // true if object's uuid is not in disposedList\r\n    const notDisposed = object => !disposedList.has(object.uuid);\r\n    // true if object exists and not disposed yet\r\n    const needToDispose = object => object && notDisposed(object);\r\n    // add object's uuid to disposedList and call object's dispose method\r\n    const disposeObject = object => {\r\n        disposedList.add(object.uuid);\r\n        object.dispose();\r\n    };\r\n    // dispose an object if need to\r\n    const dispose = object => {\r\n        if (needToDispose(object)) disposeObject(object);\r\n    };\r\n\r\n    item.traverse(child => {\r\n        if (!child.isMesh) return;\r\n        // child is mesh\r\n        // dispose material\r\n        callbackOnPotentialArray(child.material, obj => {\r\n            dispose(obj.map);\r\n            dispose(obj);\r\n        });\r\n        // dispose geometry\r\n        dispose(child.geometry);\r\n    });\r\n};\r\n\r\nconst createNewMaterial = ({ type, params }) => {\r\n    const matType = `Mesh${type}Material`;\r\n    return new THREE[matType](params);\r\n};\r\n\r\nexport const changeMaterialToBasic = (object, texturePath) => {\r\n    if (!object) return;\r\n    object.traverse(child => {\r\n        if (!child.isMesh || child.name === \"outline\") return;\r\n        // child is mesh and is not outline\r\n        const material = child.material;\r\n        let texture;\r\n        if (texturePath) {\r\n            texture = new THREE.TextureLoader().load(texturePath);\r\n        } else {\r\n            texture = Array.isArray(child.material)\r\n                ? material[0].map\r\n                : material.map;\r\n        }\r\n        // correct texture gamma\r\n        texture.encoding = THREE.sRGBEncoding;\r\n        // define new material\r\n        const newMaterial = createNewMaterial({\r\n            type: \"Basic\",\r\n            params: { map: texture, skinning: true },\r\n        });\r\n\r\n        // dispose old material\r\n        callbackOnPotentialArray(material, obj => {\r\n            if (texturePath && obj.map) obj.map.dispose();\r\n            obj.dispose();\r\n        });\r\n        // apply new material\r\n        if (Array.isArray(material)) {\r\n            child.material = new Array(material.length).fill(newMaterial);\r\n        } else {\r\n            child.material = newMaterial;\r\n        }\r\n    });\r\n};\r\n\r\nconst createOutlineMaterial = ({ size, color, opacity }) => {\r\n    const newMaterial = new THREE.MeshToonMaterial({\r\n        color,\r\n        opacity,\r\n        side: THREE.BackSide,\r\n        transparent: true,\r\n        skinning: true,\r\n    });\r\n    newMaterial.onBeforeCompile = shader => {\r\n        const token = \"#include <begin_vertex>\";\r\n        const customTransform = `\r\n            vec3 transformed = position + objectNormal*${size * 0.0005};\r\n        `;\r\n        shader.vertexShader = shader.vertexShader.replace(\r\n            token,\r\n            customTransform\r\n        );\r\n    };\r\n    return newMaterial;\r\n};\r\n\r\n// replace material of an object\r\nconst replaceMaterial = (object, newMaterial) => {\r\n    // dispose old material\r\n    callbackOnPotentialArray(object.material, obj => {\r\n        if (obj.map) obj.map.dispose();\r\n        obj.dispose();\r\n    });\r\n    // apply new material\r\n    if (Array.isArray(object.material)) {\r\n        object.material = new Array(object.material.length).fill(newMaterial);\r\n    } else {\r\n        object.material = newMaterial;\r\n    }\r\n};\r\n\r\n// change opacity of an object\r\nexport const changeOpacity = ({ material }, opacity) => {\r\n    callbackOnPotentialArray(material, obj => {\r\n        obj.opacity = opacity;\r\n    });\r\n};\r\n\r\n// update outline shader to change size\r\nconst updateOutlineShader = (material, size) => {\r\n    // Hacky way to force shader recompilation, needs fixing !!!!!!!!!!!!!!!!!!\r\n    material.fog = !material.fog;\r\n    material.needsUpdate = true;\r\n\r\n    material.onBeforeCompile = shader => {\r\n        const token = \"#include <begin_vertex>\";\r\n        const customTransform = `\r\n                vec3 transformed = position + objectNormal*${size * 0.0005};\r\n            `;\r\n        shader.vertexShader = shader.vertexShader.replace(\r\n            token,\r\n            customTransform\r\n        );\r\n    };\r\n    setTimeout(() => {\r\n        material.fog = !material.fog;\r\n        material.needsUpdate = true;\r\n    }, 100); // Sometimes doesn't work with 0 delay\r\n};\r\n\r\n// change size of outline\r\nexport const changeOutlineSize = ({ material }, size) => {\r\n    if (Array.isArray(material)) {\r\n        const updated = new Set();\r\n        material.forEach(m => {\r\n            if (updated.has(m.uuid)) return;\r\n\r\n            updateOutlineShader(m, size);\r\n            updated.add(m.uuid);\r\n        });\r\n    } else {\r\n        updateOutlineShader(material, size);\r\n    }\r\n};\r\n\r\n// Change color of outline\r\nexport const changeOutlineColor = ({ material }, color) => {\r\n    if (Array.isArray(material)) {\r\n        const updated = new Set();\r\n        material.forEach(m => {\r\n            if (updated.has(m.uuid)) return;\r\n\r\n            m.color = new THREE.Color(color);\r\n            updated.add(m.uuid);\r\n        });\r\n    } else {\r\n        material.color = new THREE.Color(color);\r\n    }\r\n};\r\n\r\n// Add outline to object and return reference to outlines\r\nexport const addOutline = (object, details) => {\r\n    if (!object) return;\r\n    const outlines = []; // return value\r\n    object.traverse(child => {\r\n        if (!child.isMesh) return;\r\n        // child is mesh\r\n        const outline = child.clone();\r\n        outline.name = \"outline\";\r\n        outline.visible = details.enable;\r\n\r\n        outlines.push(outline);\r\n        const newMaterial = createOutlineMaterial(details);\r\n        replaceMaterial(outline, newMaterial);\r\n\r\n        if (child.isSkinnedMesh) {\r\n            outline.bind(child.skeleton, child.bindMatrix);\r\n        }\r\n        child.parent.add(outline);\r\n    });\r\n    return outlines;\r\n};\r\n\r\nexport const applyFace = (object, faceTexture, faceOffset) => {\r\n    const faceTexturePath = `${fbxSource}/fbx/${faceTexture}/${faceTexture}.png`;\r\n    const texture = new THREE.TextureLoader().load(faceTexturePath);\r\n    texture.encoding = THREE.sRGBEncoding;\r\n    const faceMaterial = new THREE.MeshBasicMaterial({\r\n        map: texture,\r\n        skinning: true,\r\n    });\r\n\r\n    object.traverse(child => {\r\n        if (child.name === \"mBodyAll\" && child.geometry.groups.length === 3) {\r\n            const faceGroups = child.geometry.groups.filter(\r\n                k => k.count < 1000\r\n            );\r\n            if (faceGroups.length === 2) {\r\n                const materialIndexes = faceGroups.map(\r\n                    group => group.materialIndex\r\n                );\r\n                materialIndexes.forEach(\r\n                    i => (child.material[i] = faceMaterial)\r\n                );\r\n                if (faceOffset.x !== 0 || faceOffset.y !== 0) {\r\n                    const start = Math.min(\r\n                        faceGroups[0].start,\r\n                        faceGroups[1].start\r\n                    );\r\n                    const end = Math.max(\r\n                        faceGroups[0].start + faceGroups[0].count,\r\n                        faceGroups[1].start + faceGroups[1].count\r\n                    );\r\n\r\n                    const uv = child.geometry.attributes.uv;\r\n                    for (let i = start; i < end; i++) {\r\n                        const u = uv.getX(i) + 0.25 * faceOffset.x;\r\n                        const v = uv.getY(i) + 0.25 * faceOffset.y;\r\n                        uv.setXY(i, u, v);\r\n                    }\r\n                    uv.needsUpdate = true;\r\n                }\r\n            }\r\n        }\r\n    });\r\n};\r\n\r\n// Chain Code is invalid if starts with the character \"+\"\r\nexport const analyzeChainCode = code => {\r\n    if (!code) return [\"\", \"\"];\r\n    const aniCodes = code.split(\">\");\r\n    const nAni = aniCodes.length;\r\n    const fileList = [];\r\n    const animationList = [];\r\n    for (let i = 0; i < nAni; i++) {\r\n        let timeScale = 1,\r\n            repetitions = 1,\r\n            fileIdx = null,\r\n            aniName = null,\r\n            fileName = null,\r\n            details,\r\n            currentAni = {};\r\n        const currentParts = aniCodes[i].split(\"+\");\r\n        const fromModelFile = currentParts.length === 1;\r\n        if (fromModelFile) {\r\n            details = currentParts[0];\r\n        } else {\r\n            [fileName, details] = currentParts;\r\n            fileIdx = fileList.length - 1;\r\n        }\r\n        if (fileName) {\r\n            fileIdx = fileList.length;\r\n            fileList.push(fileName);\r\n        }\r\n        if (details.includes(\"&\")) {\r\n            const [name, ...settings] = details.split(\"&\");\r\n            aniName = name;\r\n            for (let setting of settings) {\r\n                const [key, value] = setting.split(\"=\");\r\n                if (key === \"ts\") {\r\n                    timeScale = parseFloat(value);\r\n                }\r\n                if (key === \"r\") {\r\n                    repetitions = value === \"inf\" ? Infinity : parseInt(value);\r\n                }\r\n            }\r\n        } else {\r\n            aniName = details;\r\n        }\r\n        currentAni = {\r\n            fileIdx,\r\n            aniName,\r\n            timeScale,\r\n            repetitions,\r\n        };\r\n        animationList.push(currentAni);\r\n    }\r\n    return [fileList, animationList];\r\n};\r\n\r\nexport const chainCodeToList = (code, name) => {\r\n    const [fileList, animationList] = analyzeChainCode(code);\r\n    const length = animationList.length;\r\n    const output = animationList.map((ani, i) => {\r\n        const { fileIdx, aniName, timeScale, repetitions } = ani;\r\n        const partName = name.concat(length > 1 ? `#${i + 1}` : \"\");\r\n        return {\r\n            name: partName,\r\n            fileName: fileList[fileIdx],\r\n            aniName,\r\n            timeScale,\r\n            repetitions,\r\n            id: uuid(),\r\n        };\r\n    });\r\n    return output;\r\n};\r\n","// This optional code is used to register a service worker.\r\n// register() is not called by default.\r\n\r\n// This lets the app load faster on subsequent visits in production, and gives\r\n// it offline capabilities. However, it also means that developers (and users)\r\n// will only see deployed updates on subsequent visits to a page, after all the\r\n// existing tabs open on the page have been closed, since previously cached\r\n// resources are updated in the background.\r\n\r\n// To learn more about the benefits of this model and instructions on how to\r\n// opt-in, read https://bit.ly/CRA-PWA\r\n\r\nconst isLocalhost = Boolean(\r\n  window.location.hostname === 'localhost' ||\r\n    // [::1] is the IPv6 localhost address.\r\n    window.location.hostname === '[::1]' ||\r\n    // 127.0.0.0/8 are considered localhost for IPv4.\r\n    window.location.hostname.match(\r\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\r\n    )\r\n);\r\n\r\nexport function register(config) {\r\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\r\n    // The URL constructor is available in all browsers that support SW.\r\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\r\n    if (publicUrl.origin !== window.location.origin) {\r\n      // Our service worker won't work if PUBLIC_URL is on a different origin\r\n      // from what our page is served on. This might happen if a CDN is used to\r\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\r\n      return;\r\n    }\r\n\r\n    window.addEventListener('load', () => {\r\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\r\n\r\n      if (isLocalhost) {\r\n        // This is running on localhost. Let's check if a service worker still exists or not.\r\n        checkValidServiceWorker(swUrl, config);\r\n\r\n        // Add some additional logging to localhost, pointing developers to the\r\n        // service worker/PWA documentation.\r\n        navigator.serviceWorker.ready.then(() => {\r\n          console.log(\r\n            'This web app is being served cache-first by a service ' +\r\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\r\n          );\r\n        });\r\n      } else {\r\n        // Is not localhost. Just register service worker\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nfunction registerValidSW(swUrl, config) {\r\n  navigator.serviceWorker\r\n    .register(swUrl)\r\n    .then(registration => {\r\n      registration.onupdatefound = () => {\r\n        const installingWorker = registration.installing;\r\n        if (installingWorker == null) {\r\n          return;\r\n        }\r\n        installingWorker.onstatechange = () => {\r\n          if (installingWorker.state === 'installed') {\r\n            if (navigator.serviceWorker.controller) {\r\n              // At this point, the updated precached content has been fetched,\r\n              // but the previous service worker will still serve the older\r\n              // content until all client tabs are closed.\r\n              console.log(\r\n                'New content is available and will be used when all ' +\r\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\r\n              );\r\n\r\n              // Execute callback\r\n              if (config && config.onUpdate) {\r\n                config.onUpdate(registration);\r\n              }\r\n            } else {\r\n              // At this point, everything has been precached.\r\n              // It's the perfect time to display a\r\n              // \"Content is cached for offline use.\" message.\r\n              console.log('Content is cached for offline use.');\r\n\r\n              // Execute callback\r\n              if (config && config.onSuccess) {\r\n                config.onSuccess(registration);\r\n              }\r\n            }\r\n          }\r\n        };\r\n      };\r\n    })\r\n    .catch(error => {\r\n      console.error('Error during service worker registration:', error);\r\n    });\r\n}\r\n\r\nfunction checkValidServiceWorker(swUrl, config) {\r\n  // Check if the service worker can be found. If it can't reload the page.\r\n  fetch(swUrl, {\r\n    headers: { 'Service-Worker': 'script' },\r\n  })\r\n    .then(response => {\r\n      // Ensure service worker exists, and that we really are getting a JS file.\r\n      const contentType = response.headers.get('content-type');\r\n      if (\r\n        response.status === 404 ||\r\n        (contentType != null && contentType.indexOf('javascript') === -1)\r\n      ) {\r\n        // No service worker found. Probably a different app. Reload the page.\r\n        navigator.serviceWorker.ready.then(registration => {\r\n          registration.unregister().then(() => {\r\n            window.location.reload();\r\n          });\r\n        });\r\n      } else {\r\n        // Service worker found. Proceed as normal.\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    })\r\n    .catch(() => {\r\n      console.log(\r\n        'No internet connection found. App is running in offline mode.'\r\n      );\r\n    });\r\n}\r\n\r\nexport function unregister() {\r\n  if ('serviceWorker' in navigator) {\r\n    navigator.serviceWorker.ready\r\n      .then(registration => {\r\n        registration.unregister();\r\n      })\r\n      .catch(error => {\r\n        console.error(error.message);\r\n      });\r\n  }\r\n}\r\n","import React from \"react\";\r\nimport ReactDOM from \"react-dom\";\r\nimport \"./styles/index.css\";\r\nimport App from \"./App\";\r\nimport { BrowserRouter as Router } from \"react-router-dom\";\r\nimport * as serviceWorker from \"./serviceWorker\";\r\n\r\nReactDOM.render(\r\n    <Router>\r\n        <App />\r\n    </Router>,\r\n    document.getElementById(\"root\")\r\n);\r\n\r\n// If you want your app to work offline and load faster, you can change\r\n// unregister() to register() below. Note this comes with some pitfalls.\r\n// Learn more about service workers: https://bit.ly/CRA-PWA\r\nserviceWorker.unregister();\r\n"],"sourceRoot":""}