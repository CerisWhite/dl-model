{"version":3,"sources":["serviceWorker.js","index.js","helpers/consts.js","helpers/helpers.js","reducer/settingsReducer.js","context/SettingsContext.js","MainPage/MainPageStyles.js","data/controlsPositions.js","MainPage/Display/Display.js","helpers/async/setParamsFromPath.js","MainPage/MainPage.js","App.js","data/face_offset.js","helpers/async/getModelMod.js","data/matcapList.js","helpers/viewerHelpers.js","helpers/async/getDefaultAni.js","data/cameraPositions.js","hooks/useToggleState.js","helpers/getTextColor.js"],"names":["Boolean","window","location","hostname","match","ReactDOM","render","App","document","getElementById","navigator","serviceWorker","ready","then","registration","unregister","catch","error","console","message","DRAWER_WIDTH","DRAWER_BGCOLOR","DEFAULT_MODEL_ID","DEFAULT_FACE_IDX","baseUrl","matcapDir","process","DEFAULT_ADV_ANI","WEAPON_LIST","matParamsDetails","wireframe","name","type","default","useTexture","transparent","flatShading","color","emissive","opacity","min","max","step","emissiveIntensity","specular","metalness","roughness","shininess","gradientMap","options","matcap","matcapList","map","matColorParams","matParamsEntries","Object","entries","defaultMatParams","fromEntries","needsUpdateParams","defaultLights","id","enable","intensity","position","asciiSet","defaultSettings","model","texture","eyeTexture","eyeIdx","NaN","mouthTexture","mouthIdx","weaponRight","weaponLeft","material","scene","rotateSpeed","background","initCameraPosition","lights","animation","code","timeScale","chainMaker","chain","app","sidebarContent","showSettings","showAniControl","antiAliasing","pixelRatio","viewerType","outline","size","capture","supportedCodecs","codec","format","export","binary","ascii","charSet","invert","bgColor","initKeyMap","group","key","modName","tx","et","ei","mt","mi","wr","wl","bg","cam","showAC","showOutline","AA","rot","ts","cc","commonInitKeys","aniInitKeys","initKeys","adv","dragon","ani","basic","MATERIALS","NO_LIGHT_MATERIALS","matCommonParams","matExtraParams","Basic","Toon","Lambert","Phong","Standard","Matcap","spFaceTextures","c110300_01","incompatibleModels","Set","specialBlades","commonColors","green","black","grey","white","CAM_PARAMS","angle","far","near","aniModList","defaultValue","r","videoCodecs","capitalize","first","rest","toUpperCase","join","getDateTimeString","date","Date","dateStr","toDateString","replace","timeStr","toLocaleTimeString","getDefaultTexture","filterObject","object","keys","filtered","filter","includes","getUpdated","prev","current","isBlade","modelId","has","startsWith","isCharaWithAni","endsWith","isDragon","getViewerType","getDefaultFace","callbackOnEach","list","callback","flat","forEach","child","generateChainCode","aniToCode","aniName","faceChanges","modCode","generateAniModCode","faceCode","generateFaceCode","modCodes","modKey","push","faceCodes","change","time","collectFilter","filterState","groupName","groupData","length","multiCondFilter","input","filterConditions","el","every","propName","listToAniButtons","handleSelect","style","maxWidth","variant","onClick","settingsReducer","state","action","value","currentValue","defaultSetting","changes","SettingsContext","createContext","DispatchContext","initSettings","SettingsProvider","props","useReducer","settings","dispatch","Provider","children","useSettings","context","useContext","undefined","Error","useDispatch","light","useStyles","makeStyles","theme","root","display","width","height","content","padding","openSidebarButton","top","left","margin","borderRadius","transition","backgroundColor","cursor","loadingMsg","zIndex","justifyContent","alignItems","fontSize","controlsPosition","c","d","w","b","e","h","o","d200017_01","d210001_01","d210002_01","d210003_01","d210004_01","d210005_01","d210020_01","d210038_01","d210039_01","d210040_01","d210041_01","d210042_01","d210048_01","d210052_01","d210054_01","d210072_01","d210076_01","d210077_01","d210078_01","d210079_01","d210081_01","d210082_01","d210087_01","d210093_01","d210094_01","d210095_01","d210102_01","d210103_01","d210104_01","d210109_01","d210111_01","d210112_01","d210113_01","d210114_01","d210115_01","d210116_01","d210117_01","d210118_01","d210123_01","d210125_01","d210126_01","d210127_01","d210128_01","d210133_01","d210146_01","d210136_01","h0010001_02","h0110401","h0080501","h0090501","h0100301","r0070401","r0070501","r0080401","smith","AniControl","lazy","viewers","Display","viewport","toggleSetting","useCallback","onCaptureFinish","onExportFinish","modelType","defaultCameraPosition","cameraPositions","cameraPosition","n","i","isNaN","controlPosition","ModelViewer","className","getTextColor","fallback","setLoadingMsg","str2bool","str","str2xyz","split","parseFloat","str2bg","convertParamValue","xyz","float","int","parseInt","boolean","getParamsFromPath","path","reduce","output","paramText","keycode","valueParts","extractParam","filterParamsByGroup","params","setModelParams","a","modelParams","part","setModelMod","modelData","getDefaultModelMod","defaultMod","updateValue","getModelModByName","mod","setAniParams","aniParams","find","getDefaultAni","aniCode","chainCodeToList","setOtherParams","paramList","setParamsFromPath","definedGroups","delete","groups","groupSetPromise","Promise","all","Sidebar","Dock","MainPage","classes","useToggleState","sidebar","toggleSidebar","useState","initLoadDone","setInitLoadDone","innerWidth","innerHeight","setViewport","dockMode","setDockMode","dockHandle","useRef","viewerRef","currentId","updateViewportSize","clientWidth","clientHeight","updateSetings","useEffect","pathname","newViewerType","viewerChanged","viewerChangedToAdv","needResetAni","resetAni","modelMod","addEventListener","removeEventListener","CssBaseline","open","setDock","mode","ref","close","fbxSource","routeProps","textureOffsets","c110345_03","c110313_03","c100005_08","c100002_07","c100010_10","c110352_03","c110392_01","c110391_01","c100029_04","c100045_01","c110064_02","c110389_01","c110285_01","c110388_01","c110385_01","c100003_10","c110386_01","c110387_01","c100031_03","c100007_07","c110384_01","c110383_01","c110382_01","c110381_01","c110342_03","c110377_01","c110378_01","c110379_01","c110380_01","c100015_05","c100006_11","c110376_01","c110375_01","c110374_01","c110307_02","c110252_02","c110296_02","c100004_17","c110371_01","c110350_02","c110340_02","c110018_02","c110370_01","c100015_04","c110342_01","c110267_01","c110050_02","c110291_01","c110354_01","c110345_01","c110266_01","c110365_01","c110346_01","c110366_01","c110299_02","c110360_01","c110307_01","c110322_01","c110356_01","c110344_01","c110053_03","c110368_01","c110367_01","c110003_02","c110270_02","c110341_03","idxOffsets","face1","face2","face3","face4","face5","face6","face7","face8","face9","result","loadModel","url","resolve","FBXLoader","load","loadTexture","THREE","loadMatcap","getMatcapPath","loadSingleAni","fetch","response","json","parse","loadAnimations","aniList","getMeshes","getOutline","meshes","traverse","isMesh","unshift","getMaterial","flatMap","mesh","getModelPath","getTexturePath","analyzeWeaponCode","flipped","weaponCode","substring","modelPath","texturePath","dispose3dObject","disposedList","needToDispose","uuid","notDisposed","dispose","add","disposeObject","mat","userData","backupMap","disposeMaterial","geometry","getParamsList","matType","getDragonEye","eyes","nameRegex","test","getDragonMouth","mouths","removeEffects","visible","disableFrustumCulling","frustumCulled","createNewMaterial","materialType","changeMaterial","target","forced","materials","matIsArray","Array","isArray","checkParam","some","encoding","newMaterial","skinning","createOutline","outlines","createOutlineMaterial","outlineMaterial","skipList","word","clone","replaceMaterial","isSkinnedMesh","bind","skeleton","bindMatrix","loadRawText","text","loadShaderFiles","dir","filePaths","loadShader","shaderDir","uniforms","vertexShader","fragmentShader","side","depthFunc","applyOutlineSettings","fill","calculateTextureOffset","currentTexture","prevTexture","offset","x","y","prevOffsetX","prevOffsetY","currentOffsetX","currentOffsetY","calculateIdxOffset","currentIdx","prevIdx","applyOffset","offsetX","offsetY","targetGroup","materialIndex","start","end","count","uv","attributes","u","getX","v","getY","setXY","needsUpdate","applyEyeOffset","applyMouthOffset","applyTexture","textureId","oldMaterial","applyEyeTexture","applyMouthTexture","getAniData","modifiers","modList","repetitions","faceMod","processFaceChanges","getAniModifiers","analyzeChainCode","sorted","sort","timeStamps","nanoid","simplified","assign","getFaceChangesQueue","_","others","concat","applyMaterialParam","param","handler","nTones","newMap","colors","Uint8Array","minFilter","magFilter","generateMipmaps","createGradientMap","matcapPromise","isColor","updateMatParams","prevParams","update","createLight","constructor","setValue","set","replaceTexture","oldTexture","newTexture","textureName","applyMod","trim","cmd","opcode","outArgs","analyzeModelModCode","show","hide","logUpdate","oldValue","subkeys","log","JSON","stringify","subkey","getDefaultDragonAni","getDefaultEnemyAni","dragonAni","enemyAni","c100034_01","d210142_01","d210147_01","d210152_01","h0010001","h0040101","initVal","setState","toggleState","rgb","hex","exec","g","hexToRgb"],"mappings":"oOAYoBA,QACW,cAA7BC,OAAOC,SAASC,UAEe,UAA7BF,OAAOC,SAASC,UAEhBF,OAAOC,SAASC,SAASC,MACvB,2D,YCZNC,IAASC,OACL,cAAC,IAAD,UACI,cAACC,EAAA,EAAD,MAEJC,SAASC,eAAe,SDyHtB,kBAAmBC,WACrBA,UAAUC,cAAcC,MACrBC,MAAK,SAAAC,GACJA,EAAaC,gBAEdC,OAAM,SAAAC,GACLC,QAAQD,MAAMA,EAAME,a,k9BEvIfC,EAAe,QACfC,EAAiB,UAEjBC,EAAmB,aACnBC,EAAmB,EAGnBC,EAAU,uCACVC,EAAS,UAAMC,YAAN,eAETC,EAAkB,aAKlBC,EAAc,CACvB,QACA,QACA,SACA,MACA,QACA,MACA,OACA,QACA,cAMSC,EAAmB,CAC5BC,UAAW,CACPC,KAAM,YACNC,KAAM,UACNC,SAAS,GAEbC,WAAY,CACRH,KAAM,UACNC,KAAM,UACNC,SAAS,GAEbE,YAAa,CACTJ,KAAM,cACNC,KAAM,UACNC,SAAS,GAEbG,YAAa,CACTL,KAAM,eACNC,KAAM,UACNC,SAAS,GAEbI,MAAO,CACHN,KAAM,QACNC,KAAM,QACNC,QAAS,WAEbK,SAAU,CACNP,KAAM,WACNC,KAAM,QACNC,QAAS,WAEbM,QAAS,CACLR,KAAM,UACNC,KAAM,aACNC,QAAS,EACTO,IAAK,EACLC,IAAK,EACLC,KAAM,KAEVC,kBAAmB,CACfZ,KAAM,qBACNC,KAAM,aACNC,QAAS,EACTO,IAAK,EACLC,IAAK,EACLC,KAAM,KAEVE,SAAU,CACNb,KAAM,WACNC,KAAM,QACNC,QAAS,WAEbY,UAAW,CACPd,KAAM,YACNC,KAAM,aACNC,QAAS,EACTO,IAAK,EACLC,IAAK,EACLC,KAAM,KAEVI,UAAW,CACPf,KAAM,YACNC,KAAM,aACNC,QAAS,EACTO,IAAK,EACLC,IAAK,EACLC,KAAM,KAEVK,UAAW,CACPhB,KAAM,YACNC,KAAM,SACNC,QAAS,GACTO,IAAK,EACLC,IAAK,IACLC,KAAM,GAEVM,YAAa,CACTjB,KAAM,eACNC,KAAM,SACNC,QAAS,OACTgB,QAAS,CAAC,OAAQ,UAAW,UAAW,UAAW,YAEvDC,OAAQ,CACJnB,KAAM,SACNC,KAAM,SACNC,QAASkB,IAAW,GAAGpB,KACvBkB,QAASE,IAAWC,KAAI,qBAAGrB,UAgBtBsB,EAAiB,CAAC,QAAS,WAAY,YAK9CC,EAAmBC,OAAOC,QAAQ3B,GAKlC4B,EAAmBF,OAAOG,YAC5BJ,EAAiBF,KAAI,yCAA0B,CAA1B,UAA8CnB,aAI1D0B,EAAoB,CAC7B,cACA,cACA,aACA,UAMSC,EAAgB,CACzB,CACIC,GAAI,IACJ7B,KAAM,UACNK,MAAO,UACPyB,QAAQ,EACRC,UAAW,GAEf,CACIF,GAAI,IACJ7B,KAAM,cACNK,MAAO,UACPyB,QAAQ,EACRE,SAAU,CAAC,GAAI,EAAG,KAClBD,UAAW,KAKNE,EAAW,CACpB,aACA,wEAMSC,EAAkB,CAC3BC,MAAO,CACHN,GAAI,GACJO,QAAS,GACTC,WAAY,GACZC,OAAQC,IACRC,aAAc,GACdC,SAAUF,IACVG,YAAa,GACbC,WAAY,IAGhBC,SAAS,aACL5C,KAAM,SACHyB,GAEPoB,MAAO,CACHC,YAAa,EACbC,WAAY,UACZC,mBAAoB,MAExBC,OAAQrB,EACRsB,UAAW,CACPC,KAAM,GACNC,UAAW,GAEfC,WAAY,CAAEC,MAAO,MACrBC,IAAK,CACDC,eAAgB,WAChBC,cAAc,EACdC,gBAAgB,EAChBC,cAAc,EACdC,WAAY,EACZC,WAAY,IAEhBC,QAAS,CACLhC,QAAQ,EACRiC,KAAM,EACN1D,MAAO,UACPE,QAAS,GAEbyD,QAAS,CACLlC,QAAQ,EACRmC,gBAAiB,GACjBC,MAAO,GACPC,OAAQ,IAEZC,OAAQ,CACJtC,QAAQ,EACRqC,OAAQ,MACRE,QAAQ,GAEZC,MAAO,CACHxC,QAAQ,EACRyC,QAAStC,EAAS,GAClBuC,QAAQ,EACRnE,MAAO,UACPoE,QAAS,YAOJC,EAAa,CACtB7C,GAAI,CAAE8C,MAAO,QAASC,IAAK,KAAM5E,KAAM,UACvC6E,QAAS,CAAEF,MAAO,QAASC,IAAK,UAAW5E,KAAM,UACjD8E,GAAI,CAAEH,MAAO,QAASC,IAAK,UAAW5E,KAAM,UAC5C+E,GAAI,CAAEJ,MAAO,QAASC,IAAK,aAAc5E,KAAM,UAC/CgF,GAAI,CAAEL,MAAO,QAASC,IAAK,SAAU5E,KAAM,OAC3CiF,GAAI,CAAEN,MAAO,QAASC,IAAK,eAAgB5E,KAAM,UACjDkF,GAAI,CAAEP,MAAO,QAASC,IAAK,WAAY5E,KAAM,OAC7CmF,GAAI,CAAER,MAAO,QAASC,IAAK,cAAe5E,KAAM,UAChDoF,GAAI,CAAET,MAAO,QAASC,IAAK,aAAc5E,KAAM,UAC/CqF,GAAI,CAAEV,MAAO,QAASC,IAAK,aAAc5E,KAAM,MAC/CsF,IAAK,CAAEX,MAAO,QAASC,IAAK,qBAAsB5E,KAAM,OACxDuF,OAAQ,CAAEZ,MAAO,MAAOC,IAAK,iBAAkB5E,KAAM,WACrDyD,aAAc,CAAEkB,MAAO,MAAOC,IAAK,eAAgB5E,KAAM,WACzDwF,YAAa,CAAEb,MAAO,UAAWC,IAAK,SAAU5E,KAAM,WACtDyF,GAAI,CAAEd,MAAO,MAAOC,IAAK,eAAgB5E,KAAM,WAC/C0F,IAAK,CAAEf,MAAO,QAASC,IAAK,cAAe5E,KAAM,SACjD2F,GAAI,CAAEhB,MAAO,YAAaC,IAAK,YAAa5E,KAAM,SAClD4F,GAAI,CAAEjB,MAAO,YAAaC,IAAK,OAAQ5E,KAAM,WAG3C6F,EAAiB,CACnB,KACA,UACA,KACA,MACA,cACA,KACA,OAGEC,EAAc,CAAC,KAAM,MAKdC,EAAW,CACpBC,IAAI,CACA,KACA,KACA,KACA,KACA,KACA,MAND,OAOIH,EACAC,GAEPG,OAAO,CAAE,KAAM,MAAT,OAAkBJ,EAAmBC,GAC3CI,IAAI,GAAD,OAAML,EAAmBC,GAC5BK,MAAM,GAAD,OAAMN,IAIFO,EAAY,CACrB,QACA,OACA,UACA,QACA,WACA,UAISC,EAAqB,CAAC,QAAS,UAG/BC,EAAkB,CAC3B,cACA,UACA,YACA,aACA,SAMSC,EAAiB,CAC1BC,MAAO,GACPC,KAAM,CAAC,WAAY,oBAAqB,eACxCC,QAAS,CAAC,WAAY,qBACtBC,MAAO,CACH,WACA,oBACA,WACA,YACA,eAEJC,SAAU,CACN,WACA,oBACA,YACA,YACA,eAEJC,OAAQ,CAAC,cAAe,WAGfC,EAAiB,CAC1BC,WAAY,eAIHC,EAAqB,IAAIC,IAAI,CACtC,aACA,aACA,aACA,aACA,aACA,aACA,aACA,eAGSC,EAAgB,IAAID,IAAI,CAAC,eAKzBE,EAAe,CACxBC,MAAO,UACPC,MAAO,UACPC,KAAM,UACNC,MAAO,WAGEC,EAAa,CACtBC,MAAO,GACPC,IAAK,IACLC,KAAM,KAGGC,EAAa,CACtBjC,GAAI,CAAEf,IAAK,YAAaiD,aAAc,GACtCC,EAAG,CAAElD,IAAK,cAAeiD,aAAc,IAI9BE,EAAc,CACvB,wBACA,yBACA,wBACA,wBACA,e,0kBClYSC,EAAa,SAAC,GAAD,qBAAEC,EAAF,KAAYC,EAAZ,2BACnBD,EAAME,eADa,OACGD,EAAKE,KAAK,MAG1BC,EAAoB,WAC7B,IAAMC,EAAO,IAAIC,KACXC,EAAUF,EAAKG,eAAeC,QAAQ,KAAM,KAC5CC,EAAUL,EACXM,qBACAF,QAAQ,KAAM,KACdA,QAAQ,KAAM,IACnB,MAAM,GAAN,OAAUF,EAAV,YAAqBG,IAMZE,EAAoB,SAAAhH,GAAE,OAC/BA,EAAGzD,MAAM,aAAeyD,EAAxB,UAAgCA,EAAhC,QAOSiH,EAAe,SAACC,EAAQC,GACjC,IACMC,EADU1H,OAAOC,QAAQuH,GACNG,QAAO,mCAAEtE,EAAF,iBAAcoE,EAAKG,SAASvE,MAC5D,OAAOrD,OAAOG,YAAYuH,IAQjBG,EAAa,SAACC,EAAMC,GAI7B,OAHgB/H,OAAOC,QAAQ8H,GAASJ,QACpC,mCAAEtE,EAAF,mBAA4ByE,EAAKzE,OAa5B2E,EAAU,SAAAC,GAAO,OAC1BtC,IAAcuC,IAAID,IAAYA,EAAQE,WAAW,SAUxCC,EAAiB,SAAAH,GAAO,OACjCA,EAAQE,WAAW,OAClBF,EAAQI,SAAS,QACjB5C,IAAmByC,IAAID,IAKfK,EAAW,SAAAL,GAAO,OAC3BA,EAAQE,WAAW,MAAoB,UAAZF,GAKlBM,EAAgB,SAAAN,GACzB,OAAIK,EAASL,GAAiB,SAE1BA,EAAQE,WAAW,MAAQ1C,IAAmByC,IAAID,GAC3C,MAEPG,EAAeH,GAAiB,MAE7B,SAMEO,EAAiB,SAAAP,GAAO,OAAKK,EAASL,GAAW,EAAI,GAMrDQ,EAAiB,SAACC,EAAMC,GAAP,MAC1B,CAACD,GAAME,OAAOC,SAAQ,SAAAC,GAAK,OAAIH,EAASG,OAK/BC,EAAoB,SAAAhH,GAE7B,OADgBA,EAAMlC,IAAImJ,GACXnC,KAAK,MAMlBmC,EAAY,SAAArE,GACd,IAAQsE,EAAyBtE,EAAzBsE,QAASC,EAAgBvE,EAAhBuE,YACXC,EAAUC,EAAmBzE,GAC7B0E,EAAWC,EAAiBJ,GAClC,MAAM,GAAN,OAAUD,GAAV,OAAoBE,GAApB,OAA8BE,IAM5BD,EAAqB,SAAAzE,GACvB,IAAM4E,EAAW,GAOjB,OANAvJ,OAAOyH,KAAKpB,KAAYwC,SAAQ,SAAAW,GAC5B,MAA8BnD,IAAWmD,GAAjCnG,EAAR,EAAQA,IAAKiD,EAAb,EAAaA,aACT3B,EAAItB,KAASiD,GACbiD,EAASE,KAAT,WAAkBD,EAAlB,YAA4B7E,EAAItB,QAGjCkG,EAAS1C,KAAK,KAMnByC,EAAmB,SAAAJ,GACrB,IAAKA,EAAa,MAAO,GAEzB,IAAMQ,EAAY,GASlB,OARAR,EAAYL,SAAQ,SAAAc,GAChB,IAAQC,EAA2BD,EAA3BC,KAAM7I,EAAqB4I,EAArB5I,OAAQG,EAAayI,EAAbzI,SACjB0I,IAEL7I,GAAU2I,EAAUD,KAAV,aAAqBG,EAArB,YAA6B7I,IAEvCG,GAAYwI,EAAUD,KAAV,aAAqBG,EAArB,YAA6B1I,QAEtCwI,EAAU7C,KAAK,KAObgD,EAAgB,SAAAC,GASzB,OARqB9J,OAAOC,QAAQ6J,GAIEjK,KAAI,mCAAEkK,EAAF,KAAaC,EAAb,WAA4B,CAClED,EACA/J,OAAOyH,KAAKuC,GAAWrC,QAAO,SAAAtE,GAAG,OAAI2G,EAAU3G,UAE3BsE,QAAO,uCAA6BsC,WAOnDC,EAAkB,SAACC,EAAOC,GACnC,OAAOD,EAAMxC,QAAO,SAAA0C,GAAE,OAClBD,EAAiBE,OAAM,mCAAEC,EAAF,iBACT3C,SAASyC,EAAGE,WAUrBC,EAAmB,SAAC9B,EAAM+B,GAAkC,IAApBV,EAAmB,uDAAP,GAC7D,GAAKrB,EAAL,CAEA,IAAMgC,EAAQ,CAAEC,SAAU,WAC1B,OAAOjC,EAAK7I,KAAI,gBAAGrB,EAAH,EAAGA,KAAMoD,EAAT,EAASA,KAAT,OACZ,cAAC,IAAD,CACIgJ,QAAQ,YAER,aAAYhJ,EACZ,sBAAcmI,EAAS,UAAMA,EAAN,KAAqB,IAA5C,OAAiDvL,GACjDqM,QAASJ,EACTC,MAAOA,EANX,SAQKlM,GANIA,S,wLC5LJsM,EAAkB,SAACC,EAAOC,GACnC,IAAQvM,EAAqBuM,EAArBvM,KAAM4E,EAAe2H,EAAf3H,IAAK4H,EAAUD,EAAVC,MACnB,OAAQxM,GACJ,IAAK,SACD,IAAMyM,EAAeH,EAAM1H,GAAK4H,GAChC,OAAO,2BACAF,GADP,kBAEK1H,EAFL,2BAEgB0H,EAAM1H,IAFtB,kBAE6B4H,GAASC,MAG1C,IAAK,QAED,IAAMC,EAAiBxK,IAAgB0C,GACjC+H,EAAUH,EACV1D,YAAa4D,EAAgBF,GADd,eAEVE,GAEX,OAAO,2BAAKJ,GAAZ,kBAAoB1H,EAApB,2BAA+B0H,EAAM1H,IAAS+H,KAElD,IAAK,SAED,OAAO,2BAAKL,GAAZ,kBAAoB1H,EAApB,2BAA+B0H,EAAM1H,IAAS4H,KAElD,IAAK,YACD,OAAO,2BAAKF,GAAZ,kBAAoB1H,EAAM4H,IAE9B,QACI,OAAOF,I,QC5BbM,EAAkBC,wBAAc,MAKhCC,EAAkBD,wBAAc,MAKhCE,EAAe,GAUd,SAASC,EAAiBC,GAC7B,MAA6BC,qBAAWb,EAAiBU,GAAzD,mBAAOI,EAAP,KAAiBC,EAAjB,KAEA,OACI,cAACR,EAAgBS,SAAjB,CAA0Bb,MAAOW,EAAjC,SACI,cAACL,EAAgBO,SAAjB,CAA0Bb,MAAOY,EAAjC,SACKH,EAAMK,aAMhB,SAASC,IACZ,IAAMC,EAAUC,qBAAWb,GAC3B,QAAgBc,IAAZF,EACA,MAAM,IAAIG,MAAM,sDAEpB,OAAOH,EAGJ,SAASI,IACZ,IAAMJ,EAAUC,qBAAWX,GAC3B,QAAgBY,IAAZF,EACA,MAAM,IAAIG,MAAM,sDAEpB,OAAOH,EAlCXjM,OAAOyH,KAAK9G,KAAiBkI,SACzB,SAAAxF,GAAG,OAAKmI,EAAanI,GAAb,eAAyB1C,IAAgB0C,OAErDmI,EAAa9J,OAASf,IAAgBe,OAAO7B,KAAI,SAAAyM,GAAK,sBAC/CA,O,wLCmBQC,EAvCGC,aAAW,SAAAC,GAAK,MAAK,CACnCC,KAAM,CACFC,QAAS,QACTC,MAAO,QACPC,OAAQ,SAEZC,QAAS,CACLF,MAAO,QACPC,OAAQ,QACRE,QAAS,GAEbC,kBAAmB,CACfvM,SAAU,WACVwM,IAAK,EACLC,KAAM,EACNC,OAAQ,OACRnO,QAAS,MACToO,aAAc,UACdC,WAAY,uBACZC,gBAAiB,UACjBC,OAAQ,UACR,UAAW,CACPvO,QAAS,MAGjBwO,WAAY,CACR/M,SAAU,WACVgN,OAAQ,KACRb,MAAO,QACPC,OAAQ,QACRF,QAAS,OACTe,eAAgB,SAChBC,WAAY,SACZ7O,MAAO,QACP8O,SAAU,UACVN,gBAAiB,uB,yBCmCVO,EArEiB,CAC5BC,EAAG,CAAC,EAAG,GAAK,GACZC,EAAG,CAAC,EAAG,IAAK,GACZC,EAAG,CAAC,EAAG,EAAG,GACVC,EAAG,CAAC,EAAG,EAAG,GACVC,EAAG,CAAC,EAAG,GAAK,GACZC,EAAG,CAAC,EAAG,EAAG,GACVC,EAAG,CAAC,EAAG,EAAG,GACV7H,EAAG,CAAC,EAAG,EAAG,GAEV8H,WAAY,CAAC,EAAG,EAAG,GACnBC,WAAY,CAAC,EAAG,EAAG,GACnBC,WAAY,CAAC,EAAG,EAAG,GACnBC,WAAY,CAAC,EAAG,EAAG,GACnBC,WAAY,CAAC,EAAG,EAAG,GACnBC,WAAY,CAAC,EAAG,EAAG,GACnBC,WAAY,CAAC,EAAG,IAAK,GACrBC,WAAY,CAAC,EAAG,EAAG,GACnBC,WAAY,CAAC,EAAG,EAAG,GACnBC,WAAY,CAAC,EAAG,EAAG,GACnBC,WAAY,CAAC,EAAG,EAAG,GACnBC,WAAY,CAAC,EAAG,EAAG,GACnBC,WAAY,CAAC,EAAG,IAAK,GACrBC,WAAY,CAAC,EAAG,IAAK,GACrBC,WAAY,CAAC,EAAG,EAAG,GACnBC,WAAY,CAAC,EAAG,EAAG,GACnBC,WAAY,CAAC,EAAG,IAAK,GACrBC,WAAY,CAAC,EAAG,IAAK,GACrBC,WAAY,CAAC,EAAG,EAAG,GACnBC,WAAY,CAAC,EAAG,IAAK,GACrBC,WAAY,CAAC,EAAG,IAAK,GACrBC,WAAY,CAAC,EAAG,EAAG,GACnBC,WAAY,CAAC,EAAG,IAAK,GACrBC,WAAY,CAAC,EAAG,EAAG,GACnBC,WAAY,CAAC,EAAG,EAAG,GACnBC,WAAY,CAAC,EAAG,EAAG,GACnBC,WAAY,CAAC,EAAG,IAAK,GACrBC,WAAY,CAAC,EAAG,IAAK,GACrBC,WAAY,CAAC,EAAG,EAAG,GACnBC,WAAY,CAAC,EAAG,EAAG,GACnBC,WAAY,CAAC,EAAG,GAAK,GACrBC,WAAY,CAAC,EAAG,IAAK,GACrBC,WAAY,CAAC,EAAG,EAAG,GACnBC,WAAY,CAAC,EAAG,EAAG,GACnBC,WAAY,CAAC,EAAG,EAAG,GACnBC,WAAY,CAAC,EAAG,EAAG,GACnBC,WAAY,CAAC,EAAG,EAAG,GACnBC,WAAY,CAAC,EAAG,EAAG,GACnBC,WAAY,CAAC,EAAG,EAAG,GACnBC,WAAY,CAAC,EAAG,EAAG,GACnBC,WAAY,CAAC,EAAG,IAAK,GACrBC,WAAY,CAAC,EAAG,GAAK,GACrBC,WAAY,CAAC,EAAG,GAAK,GACrBC,WAAY,CAAC,EAAG,GAAK,GACrBC,WAAY,CAAC,EAAG,GAAK,GACrBC,WAAY,CAAC,EAAG,EAAG,GAEnBC,YAAa,CAAC,EAAG,EAAG,GACpBC,SAAU,CAAC,EAAG,IAAK,GACnBC,SAAU,CAAC,EAAG,EAAG,GACjBC,SAAU,CAAC,EAAG,EAAG,GACjBC,SAAU,CAAC,EAAG,IAAK,GACnBC,SAAU,CAAC,EAAG,GAAI,GAClBC,SAAU,CAAC,EAAG,GAAI,GAClBC,SAAU,CAAC,EAAG,EAAG,GAEjBC,MAAO,CAAC,EAAG,GAAK,I,QC5DdC,EAAaC,gBAAK,kBAAM,wDAMxBC,EAAU,CACZlN,MANgBiN,gBAAK,kBAAM,wDAO3BlN,IANckN,gBAAK,kBAAM,uDAOzBpN,IANcoN,gBAAK,kBAAM,+DAOzBnN,OANiBmN,gBAAK,kBAAM,gEA6FjBE,MA/Ef,SAAiBrG,GACb,IAAQsG,EAAatG,EAAbsG,SAEFpG,EAAWI,cAEA/D,EAGb2D,EAHAhL,MAASN,GADb,EAIIsL,EAFAtK,MAASC,EAFb,EAEaA,YAAaC,EAF1B,EAE0BA,WAAYC,EAFtC,EAEsCA,mBAFtC,EAIImK,EADA5J,IAAOG,EAHX,EAGWA,eAAgBC,EAH3B,EAG2BA,aAAcC,EAHzC,EAGyCA,WAAYC,EAHrD,EAGqDA,WAG/CuJ,EAAWQ,cAEX4F,EAAgBC,uBAClB,SAAC7O,EAAK4H,GAAN,OAAgBY,EAAS,CAAEpN,KAAM,SAAU4E,MAAK4H,YAChD,CAACY,IAECsG,EAAkBD,uBACpB,kBAAMD,EAAc,UAAW,YAC/B,CAACA,IAECG,EAAiBF,uBACnB,kBAAMD,EAAc,SAAU,YAC9B,CAACA,IAGCI,EAAYpK,EAAQ,GAEpBqK,EACFC,UAAgBtK,IAAYsK,UAAgBF,GAE1CG,EAAiB/Q,EACjBA,EAAmB5B,KAAI,SAAC4S,EAAGC,GAAJ,OACnBC,MAAMF,GAAKH,EAAsBI,GAAKD,KAE1CH,EAEAM,EACF/E,EAAiB5F,IAAY4F,EAAiBwE,GAE5CQ,EAAcf,EAAQxP,GAE5B,OACI,sBAAKwQ,UAAU,UAAf,UACK3Q,GACG,qBACI2Q,UAAU,qBACVpI,MAAO,CAAE5L,MAAOiU,YAAavR,IAFjC,SAII,cAAC,WAAD,CAAUwR,SAAU,KAApB,SACI,cAACpB,EAAD,CAAY3G,MAAOW,EAASjK,UAAUE,gBAIlD,cAAC,WAAD,CAAUmR,SAAU,KAApB,SACI,cAACH,EAAD,CACII,cAAevH,EAAMuH,cACrBxQ,QAASmJ,EAASnJ,QAClB0P,gBAAiBA,EACjBtP,OAAQ+I,EAAS/I,OACjBuP,eAAgBA,EAChBxR,MAAOgL,EAAShL,MAChBS,SAAUuK,EAASvK,SACnBkB,QAASqJ,EAASrJ,QAClBZ,UAAWiK,EAASjK,UACpBD,OAAQkK,EAASlK,OACjBqB,MAAO6I,EAAS7I,MAChBX,aAAcA,EACdC,WAAYA,EACZb,WAAYA,EACZwQ,SAAUA,EACVQ,eAAgBA,EAChB3E,iBAAkB+E,EAClBrR,YAAaA,U,wDC1F3B2R,EAAW,SAAAC,GAAG,OAAI1W,QAAgB,SAAR0W,IAM1BC,EAAU,SAAAD,GACZ,MAAkBA,EAAIE,MAAM,KAA5B,mBAKA,MADmB,CAJnB,gBAI6BxT,IAAIyT,aAQ/BC,EAAS,SAAAJ,GACX,OAAQA,GACJ,IAAK,cACD,OAAOA,EACX,IAAK,SACD,MAAO,UACX,QAEI,MAAM,IAAN,OAAWA,KAQjBK,EAAoB,SAACL,EAAK1U,GAC5B,MAAa,WAATA,EAA0B0U,EACZ,CACdrP,GAAIyP,EACJE,IAAKL,EACLM,MAAOJ,WACPK,IAAKC,SACLC,QAASX,GAGIzU,GAAM0U,IAyBrBW,EAAoB,SAAAC,GAAI,OAC1BA,EACKV,MAAM,KACNW,QACG,SAACC,EAAQC,GAAT,4BAA2BD,GAA3B,YArBS,SAAAC,GACjB,IAAKA,EAAW,MAAO,GAEvB,MAAiCA,EAAUb,MAAM,KAAjD,iBAAOc,EAAP,KAAmBC,EAAnB,WACA,IAAKjR,IAAWgR,KAAaC,EAAW,GAAI,MAAO,GAEnD,IAAMnJ,EAAQmJ,EAAWvN,KAAK,KACtBpI,EAAS0E,IAAWgR,GAApB1V,KAER,MAAO,CAAC,CAAC0V,EAASX,EAAkBvI,EAAOxM,KAYG4V,CAAaH,OACnD,KAQNI,EAAsB,SAACC,EAAQxK,GAAT,OACxBwK,EAAOP,QAAO,SAACC,EAAD,GAA+B,IAAD,mBAApBE,EAAoB,KAAXlJ,EAAW,KACxC,EAAuB9H,IAAWgR,GAA1B/Q,EAAR,EAAQA,MAAOC,EAAf,EAAeA,IACf,OAAID,IAAU2G,EAAkBkK,EAE1B,GAAN,mBAAWA,GAAX,CAAmB,CAAC5Q,EAAK4H,OAC1B,KAMDuJ,EAAc,uCAAG,WAAOD,EAAQ1I,GAAf,qBAAA4I,EAAA,6DACbC,EAAcJ,EAAoBC,EAAQ,UAC1C3T,EAAQZ,OAAOG,YAAYuU,IAG3BpU,GAAN,UAAWM,EAAMN,UAAjB,QAAuBvC,IACjBkK,EAAUrH,EAAMN,GAEtB,CAAC,QAAS,OAAOuI,SAAQ,SAAA8L,GAAS,IAAD,IAG7B/T,EAAM,GAAD,OAAI+T,EAAJ,YAAL,UAA0B/T,EAAM,GAAD,OAAI+T,EAAJ,mBAA/B,QAAqD1M,EACrDrH,EAAM,GAAD,OAAI+T,EAAJ,QAAL,UAAsB/T,EAAM,GAAD,OAAI+T,EAAJ,eAA3B,QAA6CnM,YAAeP,MAGhE4D,EAAS,CAAEpN,KAAM,SAAU4E,IAAK,QAAS4H,MAAOrK,IAChDiL,EAAS,CACLpN,KAAM,SACN4E,IAAK,MACL4H,MAAO,CAAE3I,WAAYiG,YAAcN,MAnBpB,SAsBb2M,EAAYhU,EAAOiL,GAtBN,2CAAH,wDA4Bd+I,EAAW,uCAAG,WAAOC,EAAWhJ,GAAlB,qBAAA4I,EAAA,6DACVxM,EAAU4M,EAAUvU,GADV,SAGSwU,YAAmB7M,GAH5B,UAGV8M,EAHU,2DAMVC,EAAc,IAChBH,EAAUvR,QAPE,kCAQM2R,YAAkBhN,EAAS4M,EAAUvR,SAR3C,QAQN4R,EARM,OAUZF,EAAYE,IAAMA,EAAItT,KACtBoT,EAAY1R,QAAU4R,EAAI1W,KAXd,wBAaZwW,EAAYE,IAAMH,EAAWnT,KAC7BoT,EAAY1R,QAAUyR,EAAWvW,KAdrB,QAiBhBqN,EAAS,CACLpN,KAAM,SACN4E,IAAK,QACL4H,MAAO+J,IApBK,4CAAH,wDA4BXG,EAAY,uCAAG,WAAOZ,EAAQ1I,GAAf,yBAAA4I,EAAA,yDACXW,EAAYd,EAAoBC,EAAQ,aAExC5S,EAAY3B,OAAOG,YAAYiV,GAE/BnN,GACF,UAAAsM,EAAOc,MAAK,kBAA2B,OAA3B,8BAAZ,eAA+C,KAAMtX,IANxC,UAQA4D,EAAUC,YARV,oEAQyB0T,YAAcrN,GARvC,2BAQjBtG,EAAUC,KARO,KASjBiK,EAAS,CAAEpN,KAAM,SAAU4E,IAAK,YAAa4H,MAAOtJ,IAE9C4T,EAAU5T,EAAUC,KAC1BiK,EAAS,CACLpN,KAAM,SACN4E,IAAK,aACL4H,MAAO,CAAElJ,MAAOyT,YAAgBD,EAAS,WAf5B,4CAAH,wDAwBZE,EAAiB,SAAClB,EAAQ1I,EAAUzI,GACtC,IAAMsS,EAAYpB,EAAoBC,EAAQnR,GAG9CyI,EAAS,CACLpN,KAAM,SACN4E,IAAKD,EACL6H,MALajL,OAAOG,YAAYuV,MAiCzBC,EApBe,uCAAG,WAAO5B,EAAMlI,GAAb,qBAAA4I,EAAA,6DACvBF,EAAST,EAAkBC,IAE3B6B,EAAgB,IAAIlQ,IACtB6O,EAAO1U,KAAI,gBAAEsU,EAAF,2BAAehR,IAAWgR,GAAS/Q,WAGpCyS,OAAO,SACrBD,EAAcC,OAAO,aARQ,SAUvBrB,EAAeD,EAAQ1I,GAVA,cAYvBiK,EAZuB,YAYVF,GACbG,EAAkBD,EAAOjW,KAAI,SAAAuD,GAAK,OACpCqS,EAAelB,EAAQ1I,EAAUzI,MAdR,UAiBvB4S,QAAQC,IAAR,CAAad,EAAaZ,EAAQ1I,IAAlC,mBAAgDkK,KAjBzB,4CAAH,wDC7KxBG,EAAUrE,gBAAK,kBACjB,iEAEEsE,EAAOtE,gBAAK,kBAAM,yDA0JTuE,MAxJf,YAAiC,IAAbzZ,EAAY,EAAZA,SACV0Z,EAAU9J,IAEhB,EAAiC+J,aAAe,GAAhD,mBAAOC,EAAP,KAAgBC,EAAhB,KACA,EAAoCC,mBAAS,cAA7C,mBAAOjJ,EAAP,KAAmByF,EAAnB,KACA,EAAwCwD,oBAAS,GAAjD,mBAAOC,EAAP,KAAqBC,EAArB,KACA,EAAgCF,mBAAS,CACrC7J,MAAOlQ,OAAOka,WACd/J,OAAQnQ,OAAOma,cAFnB,mBAAO7E,EAAP,KAAiB8E,EAAjB,KAKA,EAAgCL,mBAAS,IAAzC,mBAAOM,EAAP,KAAiBC,EAAjB,KACMC,EAAaC,mBAEnB,EAGIlL,cAFApL,EADJ,EACIA,MADJ,IAEIoB,IAAOE,EAFX,EAEWA,aAAcI,EAFzB,EAEyBA,WAEnBuJ,EAAWQ,cAEX8K,EAAYD,mBACZE,EAAYF,iBAAO,IAEnBG,EAAqB,WACvB,IAAMzK,EAAQuK,EAAUpP,QAAQuP,YAC1BzK,EAASsK,EAAUpP,QAAQwP,aACjCT,EAAY,CAAElK,QAAOC,YAUnB2K,EAAgBtF,uBAClB,SAAA7O,GAAG,OAAI,SAAA4H,GAAK,OAAIY,EAAS,CAAEpN,KAAM,SAAU4E,MAAK4H,aAChD,CAACY,IAsEL,OAlEA4L,qBAAU,YACN,uCAAC,sBAAAhD,EAAA,6DACGxB,EAAc,cADjB,SAES0C,EAAkBhZ,EAAS+a,SAAU7L,GAF9C,OAGGoH,EAAc,IACd0D,GAAgB,GAJnB,2CAAD,yDAMD,CAACha,EAAS+a,SAAU7L,IAGvB4L,qBAAU,WACN,IAAQnX,EAAOM,EAAPN,GACR,GAAK8W,EAAUrP,SAKf,GAAIzH,IAAO8W,EAAUrP,QAArB,CAEA,IAAM4P,EAAgBpP,YAAcjI,GAC9BsX,EAAgBD,IAAkBrV,EACxCkV,EAAc,MAAdA,CAAqB,CAAElV,WAAYqV,IAEnC,IAAME,EAAuC,QAAlBF,GAA2BC,EAClDC,GACAL,EAAc,QAAdA,CAAuB,CAAEzW,OAAQ,EAAGG,SAAU,IAG9C0W,GAAmC,WAAlBD,GACjBH,EAAc,QAAdA,CAAuB,CAAEzW,OAAQ,EAAGG,SAAU,IAGlD,IAAM4W,EACF,CAAC,SAAU,OAAOlQ,SAAS+P,IAAkBE,EAE3CE,EAAQ,uCAAG,4BAAAtD,EAAA,sEACKa,YAAchV,GADnB,OACPqE,EADO,OAEb6S,EAAc,YAAdA,CAA2B,CAAE5V,KAAM+C,IACnC6S,EAAc,aAAdA,CAA4B,CACxBzV,MAAOyT,YAAgB7Q,EAAK,UAJnB,2CAAH,qDAQRiQ,EAAW,uCAAG,4BAAAH,EAAA,sEACOK,YAAmBxU,GAD1B,QACV0X,EADU,SAGZR,EAAc,QAAdA,CAAuB,CACnBtC,IAAG,OAAE8C,QAAF,IAAEA,OAAF,EAAEA,EAAUpW,KACf0B,QAAO,OAAE0U,QAAF,IAAEA,OAAF,EAAEA,EAAUxZ,OALX,2CAAH,qDASjBwX,QAAQC,IAAI,CAACrB,IAAekD,GAAgBC,MAE5CX,EAAUrP,QAAUzH,QAzChB8W,EAAUrP,QAAUzH,IA0CzB,CAACM,EAAO4W,EAAelV,IAG1BmV,qBAAU,WAGN,OAFA/a,OAAOub,iBAAiB,SAAUZ,GAE3B,WACH3a,OAAOwb,oBAAoB,SAAUb,MAE1C,IAGC,qCACK7J,GACG,qBAAKsF,UAAWuD,EAAQ7I,WAAxB,SAAqCA,IAExCkJ,GACG,sBAAK5D,UAAWuD,EAAQ3J,KAAxB,UACKxK,GACG,eAAC,WAAD,CAAU8Q,SAAU,KAApB,UACI,cAACmF,EAAA,EAAD,IACA,wBACItN,QAAS2L,EACT1D,UAAWuD,EAAQrJ,kBAFvB,SAII,cAAC,IAAD,MAEJ,cAACkJ,EAAD,CACIM,cAAeA,EACf4B,KAAM7B,EACN8B,QAlGZ,SAACC,EAAM7N,GACnBuM,EAAYsB,GACZrB,EAAWlP,QAAU0C,QAoGT,sBAAM8N,IAAKpB,EAAWrE,UAAWuD,EAAQvJ,QAAzC,SACI,cAAC,EAAD,CACImG,cAAeA,EACfjB,SAAUA,MAGjB+E,GACG,cAAC,WAAD,CAAU/D,SAAU,KAApB,SACI,cAACmD,EAAD,CACImC,KAAMvB,EACNtM,aAAcwM,EAAWlP,QACzByQ,MA5GV,kBAAMxB,EAAY,gB,OChDjC,IAAMyB,EAAYta,YAEVnB,IAZf,WACI,OACI,cAAC,IAAD,UACI,cAAC,IAAD,UACI,cAAC,IAAD,CAAOD,OAAQ,SAAA2b,GAAU,OAAI,cAAC,EAAD,eAAcA,a,gCCX3D,kCAyEeC,IAtEQ,CACnBC,WAAY,CAAC,IAAM,KACnBC,WAAY,CAAC,GAAI,MACjBC,WAAY,CAAC,KAAO,KACpBC,WAAY,CAAC,KAAO,KACpBC,WAAY,CAAC,KAAO,KACpBC,WAAY,CAAC,KAAO,KACpBC,WAAY,CAAC,KAAO,KACpBC,WAAY,CAAC,KAAO,KACpBC,WAAY,CAAC,KAAO,KACpBC,WAAY,CAAC,KAAO,KACpBC,WAAY,CAAC,KAAO,KACpBC,WAAY,CAAC,KAAO,KACpBC,WAAY,CAAC,KAAO,KACpBC,WAAY,CAAC,KAAO,KACpBC,WAAY,CAAC,KAAO,KACpBC,WAAY,CAAC,KAAO,KACpBC,WAAY,CAAC,KAAO,KACpBC,WAAY,CAAC,KAAO,KACpBC,WAAY,CAAC,KAAO,KACpBC,WAAY,CAAC,KAAO,KACpBC,WAAY,CAAC,KAAO,KACpBC,WAAY,CAAC,KAAO,KACpBC,WAAY,CAAC,KAAO,KACpBC,WAAY,CAAC,KAAO,KACpBC,WAAY,CAAC,KAAO,KACpBC,WAAY,CAAC,MAAQ,KACrBC,WAAY,CAAC,MAAQ,KACrBC,WAAY,CAAC,MAAQ,KACrBC,WAAY,CAAC,MAAQ,IACrBC,WAAY,CAAC,KAAO,KACpBC,WAAY,CAAC,MAAQ,OACrBC,WAAY,CAAC,MAAQ,OACrBC,WAAY,CAAC,MAAQ,OACrBC,WAAY,CAAC,MAAQ,OACrBC,WAAY,CAAC,KAAO,GACpBC,WAAY,CAAC,MAAQ,OACrBC,WAAY,CAAC,MAAQ,OACrBC,WAAY,CAAC,MAAQ,OACrBC,WAAY,CAAC,MAAQ,OACrBC,WAAY,CAAC,MAAQ,OACrBC,WAAY,CAAC,MAAQ,OACrBC,WAAY,CAAC,MAAQ,OACrBC,WAAY,CAAC,MAAQ,OACrBC,WAAY,CAAC,KAAO,KACpBC,WAAY,CAAC,GAAI,KACjBC,WAAY,CAAC,KAAO,KACpBC,WAAY,CAAC,IAAM,KACnBC,WAAY,CAAC,IAAM,KACnBC,WAAY,CAAC,IAAM,KACnBC,WAAY,CAAC,IAAM,KACnBC,WAAY,CAAC,IAAM,KACnBC,WAAY,CAAC,MAAQ,OACrBC,WAAY,CAAC,IAAM,KACnBC,WAAY,CAAC,MAAQ,OACrBC,WAAY,CAAC,IAAM,KACnBC,WAAY,CAAC,IAAM,KACnBC,WAAY,CAAC,KAAO,KACpBC,WAAY,CAAC,KAAO,KACpBC,WAAY,CAAC,IAAM,KACnB9W,WAAY,CAAC,KAAO,IACpB+W,WAAY,CAAC,KAAO,KACpBC,WAAY,CAAC,MAAQ,OACrBC,WAAY,CAAC,MAAQ,OACrBC,WAAY,CAAC,MAAQ,OACrBC,WAAY,CAAC,MAAQ,OACrBC,WAAY,CAAC,MAAQ,OACrBC,WAAY,CAAC,MAAQ,QAQlB,IAAMC,EAAa,CACtBC,MAAO,CAAC,EAAG,GACXC,MAAO,CAAC,EAAG,GACXC,MAAO,CAAC,EAAG,GACXC,MAAO,CAAC,EAAG,GACXC,MAAO,CAAC,EAAG,GACXC,MAAO,CAAC,GAAI,GACZC,MAAO,CAAC,GAAI,GACZC,MAAO,CAAC,GAAI,GACZC,MAAO,CAAC,GAAI,K,gICnFHzI,EAAkB,uCAAG,WAAM7M,GAAN,mBAAAwM,EAAA,sEACM,8BADN,uBACbuD,EADa,EACtBtZ,QADsB,4BAKvBsZ,EAAS/P,UALc,aAKvB,EAAoB,IALG,2CAAH,sDAalBgN,EAAiB,uCAAG,WAAO3U,EAAIgD,GAAX,qBAAAmR,EAAA,sEACO,8BADP,uBACZuD,EADY,EACrBtZ,QAIF8e,EALuB,UAKdxF,EAAS1X,UALK,aAKd,EAAc+U,MACzB,qBAAG7W,KAAgB2I,QAAQ,IAAK,MAAQ7D,KANf,kBAStBka,GAAU,CAAEhf,KAAM,GAAIoD,KAAM,KATN,2CAAH,yD,gCCIfhC,IAlBI,CACf,CAAEpB,KAAM,cAAeuV,KAAM,0BAC7B,CAAEvV,KAAM,WAAYuV,KAAM,uBAC1B,CAAEvV,KAAM,WAAYuV,KAAM,uBAC1B,CAAEvV,KAAM,aAAcuV,KAAM,yBAC5B,CAAEvV,KAAM,kBAAmBuV,KAAM,8BACjC,CAAEvV,KAAM,aAAcuV,KAAM,2BAC5B,CAAEvV,KAAM,YAAauV,KAAM,wBAC3B,CAAEvV,KAAM,cAAeuV,KAAM,0BAC7B,CAAEvV,KAAM,WAAYuV,KAAM,uBAC1B,CAAEvV,KAAM,QAASuV,KAAM,oBACvB,CAAEvV,KAAM,iBAAkBuV,KAAM,6BAChC,CAAEvV,KAAM,iBAAkBuV,KAAM,4BAChC,CAAEvV,KAAM,UAAWuV,KAAM,sBACzB,CAAEvV,KAAM,YAAauV,KAAM,wBAC3B,CAAEvV,KAAM,cAAeuV,KAAM,qB,gnCCGpB0J,EAAY,SAAAC,GACrB,OACIA,GACA,IAAI1H,SAAQ,SAAA2H,IACR,IAAIC,KAAYC,KAAKH,EAAKC,OASzBG,EAAc,SAAAJ,GACvB,OACIA,GACA,IAAI1H,SAAQ,SAAA2H,IACR,IAAII,iBAAsBF,KAAKH,EAAKC,OAiBnCK,EAAa,SAAAxf,GACtB,IAAMuV,EAVY,SAAAvV,GAClB,IAAMmB,EAASC,IAAWyV,MAAK,SAAAnH,GAAC,OAAIA,EAAE1P,OAASA,KAC/C,OAAa,OAANmB,QAAM,IAANA,OAAA,EAAAA,EAAQoU,MAAR,UAAkB7V,IAAlB,YAA+ByB,EAAOoU,MAAS,KAQzCkK,CAAczf,GAC3B,OAAOuV,EAAO+J,EAAY/J,GAAQ,MAYhCmK,EAAgB,SAAC,GAAiB,IANrB1f,EAMMyK,EAAc,EAAdA,QACf8K,GAPSvV,EAOSyK,EAPL,UAAOwP,IAAP,uBAA+Bja,EAA/B,UAQnB,OAAO,IAAIwX,SAAQ,SAAA2H,GAAO,OACtBQ,MAAMpK,GACDzW,MAAK,SAAA8gB,GAAQ,OAAIA,EAASC,UAC1B/gB,MAAK,SAAA+gB,GAAI,OAAIN,gBAAoBO,MAAMD,MACvC/gB,KAAKqgB,OAOLY,EAAiB,SAAAC,GAAO,OACjCxI,QAAQC,IAAIuI,EAAQ3e,IAAIqe,KAOfO,EAAY,SAACjX,GAAgC,IAAxBkX,EAAuB,wDACrD,IAAKlX,EAAQ,MAAO,GAEpB,IAAMmX,EAAS,GAQf,OAPAnX,EAAOoX,UAAS,SAAA9V,GAEPA,EAAM+V,SACNH,GAA6B,YAAf5V,EAAMtK,OAEzBmgB,EAAOG,QAAQhW,MAEZ6V,GAMEI,EAAc,SAAAvX,GACvB,OAAKA,EAEUiX,EAAUjX,GACAwX,SAAQ,SAAAC,GAAI,OAAIA,EAAK5d,YAH1B,IAUX6d,EAAe,SAAA5e,GAAE,gBAAOmY,IAAP,gBAAwBnY,EAAxB,YAA8BA,EAA9B,SAKjB6e,EAAiB,SAAA7e,GAAE,gBAAOmY,IAAP,gBAAwBnY,EAAxB,YAA8BA,EAA9B,SAMnB8e,EAAoB,SAAAxd,GAC7B,IAAKA,EAAM,OAAO,KAElB,IAAMyd,EAAUzd,EAAKyG,SAAS,KACxBiX,EAAa1d,EAAK2d,UAAU,EAAG3d,EAAKqI,OAAS,GAInD,MAAO,CAAEuV,UAHSN,EAAaI,GAGXG,YAFAN,EAAeG,GAEFD,YAIxBK,EAAkB,SAAAlY,GAC3B,GAAKA,EAAL,CAEA,IAAMmY,EAAe,IAAIja,IAInBka,EAAgB,SAAApY,GAAM,OAAIA,GAFZ,SAAAA,GAAM,OAAKmY,EAAazX,IAAIV,EAAOqY,MAEbC,CAAYtY,IAOhDuY,EAAU,SAAAvY,GACRoY,EAAcpY,IANA,SAAAA,GAClBmY,EAAaK,IAAIxY,EAAOqY,MACxBrY,EAAOuY,UAIoBE,CAAczY,IAgB9BiX,EAAUjX,GAAQ,GAC1BqB,SANa,SAAAoW,IARI,SAAAzX,GACpBiB,YAAejB,EAAOnG,UAAU,SAAA6e,GAC5BH,EAAQG,EAAIrgB,KACZkgB,EAAQG,EAAIC,SAASC,WACrBL,EAAQG,MAKZG,CAAgBpB,GAChBc,EAAQd,EAAKqB,eAURC,EAAgB,SAAAC,GAAO,4BAC7Bzb,KAD6B,YAE7BC,IAAewb,MAiBTC,EAAe,SAAA7f,GACxB,IAAM8f,EAAO,GACPC,EAAY,cASlB,OARA/f,EAAMge,UAAS,SAAA9V,GACX,GAAKA,EAAM+V,OAAX,CAEA,IAAQrgB,EAASsK,EAATtK,KACJmiB,EAAUC,KAAKpiB,IACfkiB,EAAKjX,KAAKX,OAGX4X,GAIEG,EAAiB,SAAAjgB,GAC1B,IAAMkgB,EAAS,GACTH,EAAY,gBASlB,OARA/f,EAAMge,UAAS,SAAA9V,GACX,GAAKA,EAAM+V,OAAX,CAEA,IAAQrgB,EAASsK,EAATtK,KACJmiB,EAAUC,KAAKpiB,IACfsiB,EAAOrX,KAAKX,OAGbgY,GAMEC,EAAgB,SAAAngB,GACV6d,EAAU7d,GAClBiI,SAAQ,SAAAoW,GAAI,OAAKA,EAAK+B,SAAW/B,EAAKzgB,KAAKoJ,SAAS,WAIlDqZ,EAAwB,SAAArgB,GACjCA,EAAMge,UAAS,SAAA9V,GACNA,EAAM+V,SAEX/V,EAAMoY,eAAgB,OAWxBC,EAAoB,SAACC,EAAc7M,GACrC,IAAMiM,EAAO,cAAUY,EAAV,YACb,OAAO,IAAIrD,EAAMyC,GAASjM,IAUjB8M,EAAiB,SAC1BC,EAD0B,GAGxB,IADAF,EACD,EADCA,aACD,IADe3B,mBACf,MAD6B,GAC7B,MADiC8B,cACjC,SACID,GAEU7C,EAAU6C,GAClBzY,SAAQ,SAAAoW,GACX,IAAMuC,EAAY,CAACvC,EAAK5d,UAAUuH,OAC5B6Y,EAAaC,MAAMC,QAAQ1C,EAAK5d,UAEtC,IAAKkgB,IAAW9B,EAAa,CACzB,IAAMmC,EAAU,gBAAYR,EAAZ,YAEhB,IADqBI,EAAUK,MAAK,SAAA3B,GAAG,OAAKA,EAAI0B,MAC7B,OAGvBJ,EAAU3Y,SAAQ,SAACqX,EAAKxN,GAIpB,IAAM7R,EAAU4e,GACV,IAAI1B,iBAAsBF,KAAK4B,GAC/B+B,EAAU9O,GAAG7S,IAEf4f,IAAa5e,EAAQihB,SAAW/D,gBAEpC,IAUiB,QANXgE,EAAcZ,EAAkBC,EAJnB,CACfvhB,IAAKgB,EACLmhB,UAAU,KAGdD,EAAYvjB,KAAO0hB,EAAI1hB,KACnB0hB,EAAIC,SAASC,YACb2B,EAAY5B,SAASC,UAAYF,EAAIC,SAASC,WAG9CX,KACA,UAAAS,EAAIrgB,WAAJ,mBAASkgB,eAAT,iBACA,UAAAG,EAAIC,SAASC,iBAAb,mBAAwBL,eAAxB,kBAEJG,EAAIH,UAEA0B,EACAxC,EAAK5d,SAASqR,GAAKqP,EAEnB9C,EAAK5d,SAAW0gB,SAUnBE,EAAa,uCAAG,WAAOza,EAAQ+M,GAAf,mBAAAE,EAAA,yDACpBjN,EADoB,wDAGnB0a,EAAW,GAHQ,SAIKC,EAAsB5N,GAJ3B,cAInB6N,EAJmB,OAOnBC,EAAW,CAAC,MAAO,aACV5D,EAAUjX,GAClBqB,SAAQ,SAAAoW,GACX,IAAQzgB,EAASygB,EAATzgB,KACR,IAAI6jB,EAASR,MAAK,SAAAS,GAAI,OAAI9jB,EAAKoJ,SAAS0a,MAAxC,CAEA,IAAM/f,EAAU0c,EAAKsD,QAErBC,EAAgBjgB,EAAS6f,GACzB7f,EAAQye,QAAUzM,EAAOhU,OACzBgC,EAAQ/D,KAAO,UAEXygB,EAAKwD,eACLlgB,EAAQmgB,KAAKzD,EAAK0D,SAAU1D,EAAK2D,YAErC3D,EAAKe,IAAIzd,GACT2f,EAASzY,KAAKlH,OAvBO,kBAyBlB2f,GAzBkB,4CAAH,wDAgCpBW,EAAW,uCAAG,WAAMnF,GAAN,SAAAjJ,EAAA,+EAChB,IAAIuB,SAAQ,SAAA2H,GACRQ,MAAMT,GACDpgB,MAAK,SAAA8gB,GAAQ,OAAIA,EAAS0E,UAC1BxlB,KAAKqgB,OAJE,2CAAH,sDAYXoF,EAAe,uCAAG,WAAOC,EAAKxkB,GAAZ,eAAAiW,EAAA,6DACdwO,EAAY,CAAC,GAAD,OAAID,EAAJ,YAAWxkB,EAAX,mBAA2BwkB,EAA3B,YAAkCxkB,EAAlC,UADE,kBAIbwX,QAAQC,IAAIgN,EAAUpjB,IAAIgjB,KAJb,2CAAH,wDAWfK,EAAU,uCAAG,WAAM1kB,GAAN,eAAAiW,EAAA,6DACT0O,EADS,UACMhlB,YADN,oBACwCK,GADxC,kBAGRukB,EAAgBI,EAAW3kB,IAHnB,2CAAH,sDASV2jB,EAAqB,uCAAG,6CAAA1N,EAAA,6DAASjS,EAAT,EAASA,KAAM1D,EAAf,EAAeA,MAAOE,EAAtB,EAAsBA,QAC1CokB,EAAW,CACb5gB,KAAM,CAAEyI,MAAOzI,GACf1D,MAAO,CAAEmM,MAAO,IAAI8S,QAAYjf,IAChCE,QAAS,CAAEiM,MAAOjM,IAJI,SAOmBkkB,EAAW,WAP9B,0CAOnBG,EAPmB,KAOLC,EAPK,KASpBlB,EAAkB,IAAIrE,iBAAqB,CAC7CwF,KAAMxF,WACNnf,aAAa,EACb4kB,UAAWzF,YACXsF,eACAC,iBACAF,aAfsB,kBAkBnBhB,GAlBmB,4CAAH,sDAyBdqB,EAAuB,SAAClhB,EAASqJ,GAC1C,GAAKrJ,GAAYqJ,EAAjB,CAEA,IAAQvK,EAAakB,EAAblB,SACRuK,EAAS/C,SAAQ,SAACoC,EAAO5H,GACrB,OAAQA,GACJ,IAAK,SACDd,EAAQye,QAAU/V,EAClB,MACJ,IAAK,QACDxC,YACIpH,GACA,SAAA6e,GAAG,OAAKA,EAAIkD,SAAStkB,MAAMmM,MAAQ,IAAI8S,QAAY9S,MAEvD,MACJ,QACIxC,YACIpH,GACA,SAAA6e,GAAG,OAAKA,EAAIkD,SAAS/f,GAAK4H,MAAQA,WAOhDuX,EAAkB,SAAChb,EAAQua,GAC7B,IAAQ1gB,EAAamG,EAAbnG,SAERoH,YAAepH,GAAU,SAAA6e,GAAQ,IAAD,QAC5B,UAAAA,EAAIrgB,WAAJ,mBAASkgB,eAAT,iBACA,UAAAG,EAAIC,SAASC,iBAAb,mBAAwBL,eAAxB,iBACAG,EAAIH,aAGR,IAAM0B,EAAaC,MAAMC,QAAQna,EAAOnG,UACxCmG,EAAOnG,SAAWogB,EACZ,IAAIC,MAAMla,EAAOnG,SAAS4I,QAAQyZ,KAAK3B,GACvCA,GAQG4B,EAAyB,SAACC,EAAgBC,GACnD,IAAMC,EAAS,CAAEC,EAAG,EAAGC,EAAG,GAC1B,GAAIJ,IAAmBC,EAAa,CAChC,MAAmClL,IAAekL,IAAgB,CAC9D,EAAG,GADP,mBAAOI,EAAP,KAAoBC,EAApB,KAGA,EAAyCvL,IACrCiL,IACC,CAAC,EAAG,GAFT,mBAAOO,EAAP,KAAuBC,EAAvB,KAIAN,EAAOC,EAAII,EAAiBF,EAC5BH,EAAOE,EAAII,EAAiBF,EAEhC,MAAO,CAACJ,EAAOC,EAAGD,EAAOE,IAQhBK,EAAqB,SAACC,EAAYC,GAC3C,IAAMT,EAAS,CAAEC,EAAG,EAAGC,EAAG,GAC1B,GAAIM,IAAeC,EAAS,CACxB,kBAAmCzH,IAAW,OAAD,OAAQyH,IAArD,GAAON,EAAP,KAAoBC,EAApB,KACA,cACIpH,IAAW,OAAD,OAAQwH,IADtB,GAAOH,EAAP,KAAuBC,EAAvB,KAGAN,EAAOC,EAAII,EAAiBF,EAC5BH,EAAOE,EAAII,EAAiBF,EAEhC,MAAO,CAACJ,EAAOC,EAAGD,EAAOE,IAMvBQ,EAAc,SAAA7P,GAAI,OAAI,SAAC2M,EAAQwC,GACjC,kBAA2BA,EAA3B,GAAOW,EAAP,KAAgBC,EAAhB,KACApD,EAAO1C,UAAS,SAAA9V,GAAU,IAAD,EACrB,GAAKA,EAAM+V,OAAX,CAEA,IAAM8F,EAAW,UAAG7b,EAAMwX,SAASxK,cAAlB,aAAG,EAAuBT,MACvC,SAAAjS,GAAK,aAAI,UAAA0F,EAAMzH,SAAS+B,EAAMwhB,sBAArB,eAAqCpmB,QAArC,YAAmDmW,EAAnD,SAEb,GAAKgQ,EAAL,CAKA,IAHA,IAAQE,EAAiBF,EAAjBE,MACFC,EAAMD,EADaF,EAAVI,MAETC,EAAKlc,EAAMwX,SAAS2E,WAAWD,GAC5BtS,EAAImS,EAAOnS,EAAIoS,EAAKpS,IAAK,CAC9B,IAAMwS,EAAIF,EAAGG,KAAKzS,GAAK,IAAO+R,EACxBW,EAAIJ,EAAGK,KAAK3S,GAAK,IAAOgS,EAC9BM,EAAGM,MAAM5S,EAAGwS,EAAGE,GAEnBJ,EAAGO,aAAc,SAIZC,EAAiBhB,EAAY,OAC7BiB,EAAmBjB,EAAY,SAMtCkB,EACF,SAAA/Q,GAAI,OACJ,SAAC2M,EAAD,GAA0C,IAA/BF,EAA8B,EAA9BA,aAAcuE,EAAgB,EAAhBA,UACflG,EAAcN,EAAewG,GAC7B9kB,GAAU,IAAIkd,iBAAsBF,KAAK4B,GAC/C5e,EAAQihB,SAAW/D,eAEnB,IAIMgE,EAAcZ,EAAkBC,EAJf,CACnBvhB,IAAKgB,EACLmhB,UAAU,IAGdV,EAAO1C,UAAS,SAAA9V,GACZ,GAAmB,aAAfA,EAAMtK,MAAwD,IAAjCsK,EAAMwX,SAASxK,OAAO7L,OAAvD,CAGA,IAAM0a,EAAc7b,EAAMwX,SAASxK,OAAOT,MACtC,SAAAjS,GAAK,OACD0F,EAAMzH,SAAS+B,EAAMwhB,eAAepmB,OAApC,YAAkDmW,EAAlD,SAER,GAAKgQ,EAAL,CAEA,IAAQC,EAAkBD,EAAlBC,cACFgB,EAAc9c,EAAMzH,SAASujB,GACnC7C,EAAYvjB,KAAOonB,EAAYpnB,KAE/BsK,EAAMzH,SAASujB,GAAiB7C,SAI/B8D,EAAkBH,EAAa,OAC/BI,EAAoBJ,EAAa,SA2CxCK,GAAa,SAAAnkB,GACf,MAA8BA,EAAKyR,MAAM,KAAzC,iBAAOpK,EAAP,KACM+c,EAtCc,SAAAC,GAIpB,IAAM/c,EAAc,GAChBrH,EAAY,EACZqkB,EAAc,EAmBlB,OAjBAD,EAAQpd,SAAQ,SAAAqM,GACZ,MAAqBA,EAAI7B,MAAM,KAA/B,mBAAOhQ,EAAP,KAAY4H,EAAZ,KAOA,GANY,OAAR5H,IACAxB,EAAYyR,WAAWrI,IAEf,MAAR5H,IACA6iB,EAActS,SAAS3I,IAEvB5H,EAAIuE,SAAS,KAAM,CACnB,MAAqBvE,EAAIgQ,MAAM,KAA/B,mBAAOsB,EAAP,KAAa/K,EAAb,KACMuc,EAAU,CAAEvc,KAAM0J,WAAW1J,IAEnCuc,EADe,UAAe,MAATxR,EAAe,MAAQ,QAA7B,QACM1J,EACrB/B,EAAYO,KAAK0c,OAIlB,CACHtkB,YACAqkB,cACAhd,YAAakd,GAAmBld,IAUlBmd,CADlB,YAEA,OAAO,aAAEpd,WAAY+c,IAOZM,GAAmB,SAAA1kB,GAC5B,OAAKA,EAEYA,EAAKyR,MAAM,KACHxT,IAAIkmB,IAHX,IAYTK,GAAqB,SAAAld,GAC9B,IAAKA,EAAYe,OAAQ,OAAOf,EAEhC,IAAMqd,EAASrd,EAAYsd,MAAK,SAAC/R,EAAGxG,GAAJ,OAAUwG,EAAE7K,KAAOqE,EAAErE,QAC/C6c,EAAa,IAAI/gB,IAAIwD,EAAYrJ,KAAI,SAAA8J,GAAM,OAAIA,EAAOC,SAC5D,GAAIV,EAAYe,SAAWwc,EAAWjkB,KAIlC,OAHA+jB,EAAO1d,SAAQ,SAAAc,GACXA,EAAOrJ,GAAKomB,iBAETH,EAMX,IAAMI,EAAa,GAOnB,OANAF,EAAW5d,SAAQ,SAAAe,GACf,IAAIqK,EAAS,CAAErK,OAAMtJ,GAAIomB,cAAU3lB,OAAQC,IAAKE,SAAUF,KAC1CulB,EAAO5e,QAAO,SAAAgC,GAAM,OAAIA,EAAOC,OAASA,KAChDf,SAAQ,SAAAc,GAAM,OAAKsK,EAASjU,OAAO4mB,OAAO3S,EAAQtK,MAC1Dgd,EAAWld,KAAKwK,MAEb0S,GAQEE,GAAsB,SAAC3d,EAAagd,GAC7C,IAAKhd,EAAa,MAAO,GACzB,GAAoB,IAAhBgd,EAAmB,OAAO,YAAIhd,GAclC,OAZmB,IAAIwY,MAAMwE,GAAaxC,OAAO7jB,KAAI,SAACinB,EAAGpU,GAAJ,OAAc,IAAJA,KAY7CsM,SANQ,SAAA8E,GAAM,OAC5B5a,EAAYrJ,KAAI,gBAAG+J,EAAH,EAAGA,KAAamd,GAAhB,EAASzmB,GAAT,qCAAC,eACVymB,GADS,IAEZnd,KAAMA,EAAOka,WAWZtO,GAAkB,SAAC5T,EAAMpD,GAClC,IAAMggB,EAAU8H,GAAiB1kB,GAC3BqI,EAASuU,EAAQvU,OAiBvB,OAhBeuU,EAAQ3e,KAAI,SAAC8E,EAAK+N,GAC7B,IAAQzJ,EAAiDtE,EAAjDsE,QAASpH,EAAwC8C,EAAxC9C,UAAWqkB,EAA6BvhB,EAA7BuhB,YAAahd,EAAgBvE,EAAhBuE,YAazC,MARiB,CACb1K,KALaA,EAAKwoB,OAAO/c,EAAS,EAAT,WAAiByI,EAAI,GAAM,IAMpDpS,GAAIomB,cACJzd,UACApH,YACAqkB,cACAhd,mBAwBC+d,GAAqB,SAACzF,EAAW0F,GAC1C,IACIC,EADJ,cAAqBD,EAArB,GAAO7jB,EAAP,KAAY4H,EAAZ,KAEMsa,EAAcnlB,IAAkBwH,SAASvE,GAE/C,OAAQA,GACJ,IAAK,cACD,IAAM+jB,EAASxT,SAAS3I,GAClBoc,EAASD,EAtBM,SAAAA,GAC7B,IAAME,EAAS,IAAIC,WAAWH,GAAQvnB,KAAI,SAACinB,EAAGpU,GAAJ,OAAe,IAAJA,EAAW0U,KAC1DvnB,EAAM,IAAIke,cAAkBuJ,EAAQF,EAAQ,EAAGrJ,mBAKrD,OAJAle,EAAI2nB,UAAYzJ,gBAChBle,EAAI4nB,UAAY1J,gBAChBle,EAAI6nB,iBAAkB,EAEf7nB,EAeyB8nB,CAAkBP,GAAU,KACpDD,EAAU,SAAAjH,GAAG,OAAKA,EAAIzgB,YAAc4nB,GACpC,MACJ,IAAK,aACDF,EAAUlc,EACJ,SAAAiV,GACIA,EAAIrgB,IAAMqgB,EAAIC,SAASC,UACvBF,EAAIC,SAASC,UAAY,MAE7B,SAAAF,GACQA,EAAIrgB,MAAKqgB,EAAIC,SAASC,UAAYF,EAAIrgB,KAC1CqgB,EAAIrgB,IAAM,MAEpB,MACJ,IAAK,SACD,IAAM+nB,EAAgB5J,EAAW/S,GACjCkc,EAAU,SAAAjH,GACN0H,EAActqB,MAAK,SAAAqC,GACfugB,EAAIvgB,OAASA,EACbugB,EAAIqF,aAAc,MAG1B,MACJ,QACI,IAAMsC,EAAU/nB,IAAe8H,SAASvE,GACxC8jB,EAAU,SAAAjH,GAAG,OACRA,EAAI7c,GAAOwkB,EAAU,IAAI9J,QAAY9S,GAASA,GAG3DuW,EAAU3Y,SAAQ,SAAAqX,GACdiH,EAAQjH,GACRA,EAAIqF,YAAcA,MAQbuC,GAAkB,SAAClnB,EAAD,GAAyC,IAAD,IAA9BmnB,kBAA8B,MAAjB,GAAiB,EAAbxT,EAAa,EAAbA,OAChDiN,EAAYzC,EAAYne,GACdiH,YAAWkgB,EAAYxT,GAC/B1L,SAAQ,SAAAmf,GAAM,OAAIf,GAAmBzF,EAAWwG,OAO/CC,GAAc,SAAA1T,GAMvB,IALA,IAAQ9V,EAAsC8V,EAAtC9V,KAAMK,EAAgCyV,EAAhCzV,MAAO0B,EAAyB+T,EAAzB/T,UAAcumB,EAAnC,YAA8CxS,EAA9C,GAEM2T,EAAW,UAAMzpB,EAAN,SACX6N,EAAQ,IAAIyR,EAAMmK,GAAappB,EAAO0B,GAE5C,MAA2BR,OAAOC,QAAQ8mB,GAA1C,eAAmD,CAA9C,0BAAO1jB,EAAP,KAAY4H,EAAZ,KACD,GAAY,aAAR5H,EAKJiJ,EAAMjJ,GAAO4H,MALb,CAAyB,IAAD,EACdkd,EAAWld,EAAMpL,KAAI,SAAAulB,GAAC,OAAIA,GAAK,MACrC,EAAA9Y,EAAM7L,UAAS2nB,IAAf,oBAAsBD,KAM9B,OAAO7b,GASE+b,GAAc,uCAAG,WAAO/G,EAAP,sBAAA7M,EAAA,6DAAiB6T,EAAjB,EAAiBA,WAAY7I,EAA7B,EAA6BA,YAA7B,SACD3B,EAAY2B,GADX,QACpB8I,EADoB,QAEfzG,SAAW/D,eAELgB,EAAYuC,GACpBzY,SAAQ,SAAAqX,GAAQ,IAAD,EAEmB,IADjCsI,EAAW,UAAGtI,EAAIrgB,WAAP,aAAG,EAASrB,MAC7B,OAAIgqB,QAAJ,IAAIA,OAAJ,EAAIA,EAAa5gB,SAAS0gB,MACtB,UAAApI,EAAIrgB,WAAJ,mBAASkgB,eAAT,iBACAG,EAAIrgB,IAAM0oB,MATQ,2CAAH,wDAkCdE,GAAW,SAACnH,EAAQnY,GAC7B,GAAKA,EAAL,CAEA,IAAMwV,EAASF,EAAU6C,GACzB,EArBwB,SAAAnY,GACxB,IAAM8K,EAAS,GASf,OARa9K,EAAQkK,MAAM,KAAKxT,KAAI,SAAAsT,GAAG,OAAIA,EAAIuV,UAE1C7f,SAAQ,SAAA8f,GACT,MAA0BA,EAAItV,MAAM,KAApC,iBAAOuV,EAAP,KACMC,EADN,WACqBhiB,KAAK,IAAIwM,MAAM,KACpCY,EAAO2U,GAAUC,KAGd5U,EAWgB6U,CAAoB3f,GAAnC4f,EAAR,EAAQA,KAAMC,EAAd,EAAcA,KAEdrK,EAAO9V,SAAQ,SAAAoW,GACX,UAAI+J,QAAJ,IAAIA,OAAJ,EAAIA,EAAMphB,SAASqX,EAAKzgB,MAAO,CAAC,IAAD,IAC3BygB,EAAK+B,SAAU,EACf,IAAMze,EAAO,UAAG0c,EAAKlT,gBAAR,iBAAG,EAAesJ,YAAlB,aAAG,UACZ,kBAAuB,YAAvB,EAAG7W,QAEP+D,IAAYA,EAAQye,SAAU,GAElC,UAAI+H,QAAJ,IAAIA,OAAJ,EAAIA,EAAMnhB,SAASqX,EAAKzgB,MAAO,CAAC,IAAD,IAC3BygB,EAAK+B,SAAU,EACf,IAAMze,EAAO,UAAG0c,EAAKlT,gBAAR,iBAAG,EAAesJ,YAAlB,aAAG,UACZ,kBAAuB,YAAvB,EAAG7W,QAEP+D,IAAYA,EAAQye,SAAU,SAS7BiI,GAAY,SAACnhB,EAAMC,GACZF,YAAWC,EAAMC,GACzBc,SAAQ,YAAmB,IAAD,mBAAhBxF,EAAgB,KAAX4H,EAAW,KACxBie,EAAWphB,EAAKzE,GAChB8lB,EAAUnpB,OAAOyH,KAAKwD,GAEa,IAAnBke,EAAQlf,QAAiC,kBAAVgB,EAEjDtN,QAAQyrB,IAAR,UACO/lB,EADP,aACegmB,KAAKC,UAAUJ,GAD9B,eAC8CG,KAAKC,UAC3Cre,KAKZke,EAAQtgB,SAAQ,SAAA0gB,GACRL,EAASK,KAAYte,EAAMse,IAE/B5rB,QAAQyrB,IAAR,UACO/lB,EADP,YACckmB,EADd,aACyBF,KAAKC,UACtBJ,EAASK,IAFjB,eAGYF,KAAKC,UAAUre,EAAMse,c,8GCl2BhCjU,EAAa,uCAAG,WAAMrN,GAAN,SAAAwM,EAAA,0DACrBnM,YAASL,GADY,yCACKuhB,EAAoBvhB,IADzB,WAGrBA,EAAQE,WAAW,OAAQ1C,IAAmByC,IAAID,GAH7B,yCAIdwhB,EAAmBxhB,IAJL,WAMrBG,YAAeH,GANM,yCAMW7J,KANX,gCAQlB,IARkB,2CAAH,sDAepBorB,EAAmB,uCAAG,WAAMvhB,GAAN,mBAAAwM,EAAA,sEACa,8BADb,uBACPiV,EADO,EAChBhrB,QADgB,4BAMjBgrB,EAAUzhB,UANO,aAMjB,EAAqB,GAAGrG,MANP,2CAAH,sDAanB6nB,EAAkB,uCAAG,WAAMxhB,GAAN,mBAAAwM,EAAA,sEACa,8BADb,uBACNkV,EADM,EACfjrB,QADe,4BAMhBirB,EAAS1hB,UANO,aAMhB,EAAoB,GAAGrG,MANP,2CAAH,uD,gCCnCxB,uDAGO,IAAM2Q,EAAkB,CAC3BzE,EAAG,CAAC,EAAG,GAAK,KACZC,EAAG,CAAC,EAAG,IAAK,GACZC,EAAG,CAAC,EAAG,EAAG,GACVC,EAAG,CAAC,EAAG,GAAK,GACZC,EAAG,CAAC,EAAG,EAAG,GACVC,EAAG,CAAC,EAAG,EAAG,GACVC,EAAG,CAAC,EAAG,GAAK,GACZ7H,EAAG,CAAC,EAAG,EAAG,IAEVqjB,WAAY,CAAC,EAAG,GAAK,MACrBrP,WAAY,CAAC,EAAG,IAAM,GACtBlM,WAAY,CAAC,EAAG,EAAG,GACnBC,WAAY,CAAC,EAAG,EAAG,GACnBC,WAAY,CAAC,EAAG,EAAG,GACnBC,WAAY,CAAC,EAAG,EAAG,GACnBC,WAAY,CAAC,EAAG,EAAG,GACnBC,WAAY,CAAC,EAAG,EAAG,GACnBC,WAAY,CAAC,EAAG,EAAG,GACnBC,WAAY,CAAC,EAAG,EAAG,GACnBC,WAAY,CAAC,EAAG,EAAG,GACnBC,WAAY,CAAC,EAAG,EAAG,GACnBC,WAAY,CAAC,EAAG,EAAG,GACnBC,WAAY,CAAC,EAAG,EAAG,GACnBC,WAAY,CAAC,EAAG,EAAG,GACnBC,WAAY,CAAC,EAAG,EAAG,GACnBC,WAAY,CAAC,EAAG,IAAK,GACrBC,WAAY,CAAC,EAAG,EAAG,GACnBC,WAAY,CAAC,EAAG,EAAG,GACnBC,WAAY,CAAC,EAAG,EAAG,GACnBC,WAAY,CAAC,EAAG,EAAG,IACnBC,WAAY,CAAC,EAAG,EAAG,GACnBC,WAAY,CAAC,EAAG,EAAG,GACnBC,WAAY,CAAC,EAAG,IAAK,GACrBC,WAAY,CAAC,EAAG,EAAG,GACnBC,WAAY,CAAC,EAAG,EAAG,GACnBC,WAAY,CAAC,EAAG,IAAK,GACrBC,WAAY,CAAC,EAAG,EAAG,GACnBC,WAAY,CAAC,EAAG,EAAG,GACnBC,WAAY,CAAC,EAAG,EAAG,GACnBC,WAAY,CAAC,EAAG,EAAG,GACnBC,WAAY,CAAC,EAAG,EAAG,GACnBC,WAAY,CAAC,EAAG,GAAK,KACrBC,WAAY,CAAC,EAAG,EAAG,GACnBC,WAAY,CAAC,EAAG,EAAG,GACnBC,WAAY,CAAC,EAAG,EAAG,IACnBC,WAAY,CAAC,EAAG,EAAG,GACnBC,WAAY,CAAC,EAAG,EAAG,GACnBC,WAAY,CAAC,EAAG,EAAG,GACnBC,WAAY,CAAC,EAAG,EAAG,GACnBC,WAAY,CAAC,EAAG,EAAG,GACnBC,WAAY,CAAC,EAAG,IAAK,GACrBC,WAAY,CAAC,EAAG,EAAG,GACnBC,WAAY,CAAC,EAAG,GAAK,KACrBC,WAAY,CAAC,EAAG,GAAK,KACrBC,WAAY,CAAC,EAAG,GAAK,KACrBC,WAAY,CAAC,EAAG,GAAK,KACrBC,WAAY,CAAC,EAAG,EAAG,IACnB2Y,WAAY,CAAC,EAAG,EAAG,GACnBC,WAAY,CAAC,EAAG,IAAK,KACrBC,WAAY,CAAC,EAAG,IAAK,GAErBC,SAAU,CAAC,EAAG,GAAK,GACnB7Y,YAAa,CAAC,EAAG,EAAG,GACpB8Y,SAAU,CAAC,EAAG,GAAK,GACnB5Y,SAAU,CAAC,EAAG,EAAG,GACjBC,SAAU,CAAC,EAAG,EAAG,GACjBC,SAAU,CAAC,EAAG,IAAK,GACnBH,SAAU,CAAC,EAAG,IAAK,IACnBI,SAAU,CAAC,GAAI,GAAI,KACnBC,SAAU,CAAC,GAAI,GAAI,KACnBC,SAAU,CAAC,EAAG,EAAG,GAEjBC,MAAO,CAAC,EAAG,EAAG,IAGHY,a,mDCjEA+D,IARf,WAA0C,IAAlB4T,EAAiB,wDACrC,EAA0BzT,mBAASyT,GAAnC,mBAAOnf,EAAP,KAAcof,EAAd,KACMC,EAAclY,uBAAY,WAC5BiY,GAAS,SAAApf,GAAK,OAAKA,OACpB,CAACof,IACJ,MAAO,CAACpf,EAAOqf,K,gCCmBJrX,IAPa,SAAAvR,GACxB,GAAmB,WAAfA,EAAyB,MAAO,UAEpC,IARmB,EAQb6oB,EAtBO,SAAAC,GACb,IAAM9M,EAAS,4CAA4C+M,KAAKD,GAChE,OAAO9M,EACD,CACIjX,EAAGqN,SAAS4J,EAAO,GAAI,IACvBgN,EAAG5W,SAAS4J,EAAO,GAAI,IACvBvP,EAAG2F,SAAS4J,EAAO,GAAI,KAE3B,KAcMiN,CAASjpB,GACrB,OATwC,KAArB,EASE6oB,GATA9jB,EAA6B,IAAhC,EAAMikB,EAAoC,IAA1C,EAASvc,GAAwC,IASvC,IAAM,UAAY,a","file":"static/js/main.58fd76b0.chunk.js","sourcesContent":["// This optional code is used to register a service worker.\r\n// register() is not called by default.\r\n\r\n// This lets the app load faster on subsequent visits in production, and gives\r\n// it offline capabilities. However, it also means that developers (and users)\r\n// will only see deployed updates on subsequent visits to a page, after all the\r\n// existing tabs open on the page have been closed, since previously cached\r\n// resources are updated in the background.\r\n\r\n// To learn more about the benefits of this model and instructions on how to\r\n// opt-in, read https://bit.ly/CRA-PWA\r\n\r\nconst isLocalhost = Boolean(\r\n  window.location.hostname === 'localhost' ||\r\n    // [::1] is the IPv6 localhost address.\r\n    window.location.hostname === '[::1]' ||\r\n    // 127.0.0.0/8 are considered localhost for IPv4.\r\n    window.location.hostname.match(\r\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\r\n    )\r\n);\r\n\r\nexport function register(config) {\r\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\r\n    // The URL constructor is available in all browsers that support SW.\r\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\r\n    if (publicUrl.origin !== window.location.origin) {\r\n      // Our service worker won't work if PUBLIC_URL is on a different origin\r\n      // from what our page is served on. This might happen if a CDN is used to\r\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\r\n      return;\r\n    }\r\n\r\n    window.addEventListener('load', () => {\r\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\r\n\r\n      if (isLocalhost) {\r\n        // This is running on localhost. Let's check if a service worker still exists or not.\r\n        checkValidServiceWorker(swUrl, config);\r\n\r\n        // Add some additional logging to localhost, pointing developers to the\r\n        // service worker/PWA documentation.\r\n        navigator.serviceWorker.ready.then(() => {\r\n          console.log(\r\n            'This web app is being served cache-first by a service ' +\r\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\r\n          );\r\n        });\r\n      } else {\r\n        // Is not localhost. Just register service worker\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nfunction registerValidSW(swUrl, config) {\r\n  navigator.serviceWorker\r\n    .register(swUrl)\r\n    .then(registration => {\r\n      registration.onupdatefound = () => {\r\n        const installingWorker = registration.installing;\r\n        if (installingWorker == null) {\r\n          return;\r\n        }\r\n        installingWorker.onstatechange = () => {\r\n          if (installingWorker.state === 'installed') {\r\n            if (navigator.serviceWorker.controller) {\r\n              // At this point, the updated precached content has been fetched,\r\n              // but the previous service worker will still serve the older\r\n              // content until all client tabs are closed.\r\n              console.log(\r\n                'New content is available and will be used when all ' +\r\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\r\n              );\r\n\r\n              // Execute callback\r\n              if (config && config.onUpdate) {\r\n                config.onUpdate(registration);\r\n              }\r\n            } else {\r\n              // At this point, everything has been precached.\r\n              // It's the perfect time to display a\r\n              // \"Content is cached for offline use.\" message.\r\n              console.log('Content is cached for offline use.');\r\n\r\n              // Execute callback\r\n              if (config && config.onSuccess) {\r\n                config.onSuccess(registration);\r\n              }\r\n            }\r\n          }\r\n        };\r\n      };\r\n    })\r\n    .catch(error => {\r\n      console.error('Error during service worker registration:', error);\r\n    });\r\n}\r\n\r\nfunction checkValidServiceWorker(swUrl, config) {\r\n  // Check if the service worker can be found. If it can't reload the page.\r\n  fetch(swUrl, {\r\n    headers: { 'Service-Worker': 'script' },\r\n  })\r\n    .then(response => {\r\n      // Ensure service worker exists, and that we really are getting a JS file.\r\n      const contentType = response.headers.get('content-type');\r\n      if (\r\n        response.status === 404 ||\r\n        (contentType != null && contentType.indexOf('javascript') === -1)\r\n      ) {\r\n        // No service worker found. Probably a different app. Reload the page.\r\n        navigator.serviceWorker.ready.then(registration => {\r\n          registration.unregister().then(() => {\r\n            window.location.reload();\r\n          });\r\n        });\r\n      } else {\r\n        // Service worker found. Proceed as normal.\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    })\r\n    .catch(() => {\r\n      console.log(\r\n        'No internet connection found. App is running in offline mode.'\r\n      );\r\n    });\r\n}\r\n\r\nexport function unregister() {\r\n  if ('serviceWorker' in navigator) {\r\n    navigator.serviceWorker.ready\r\n      .then(registration => {\r\n        registration.unregister();\r\n      })\r\n      .catch(error => {\r\n        console.error(error.message);\r\n      });\r\n  }\r\n}\r\n","import ReactDOM from \"react-dom\";\r\nimport \"styles/index.css\";\r\nimport App from \"App\";\r\nimport { BrowserRouter as Router } from \"react-router-dom\";\r\nimport * as serviceWorker from \"./serviceWorker\";\r\n\r\nReactDOM.render(\r\n    <Router>\r\n        <App />\r\n    </Router>,\r\n    document.getElementById(\"root\")\r\n);\r\n\r\n// If you want your app to work offline and load faster, you can change\r\n// unregister() to register() below. Note this comes with some pitfalls.\r\n// Learn more about service workers: https://bit.ly/CRA-PWA\r\nserviceWorker.unregister();\r\n","import matcapList from \"data/matcapList\";\r\n\r\nexport const DRAWER_WIDTH = \"16rem\";\r\nexport const DRAWER_BGCOLOR = \"#330000\";\r\n\r\nexport const DEFAULT_MODEL_ID = \"c100001_01\";\r\nexport const DEFAULT_FACE_IDX = 2;\r\nexport const DEFAULT_DRAGON_FACE_IDX = 1;\r\n\r\nexport const baseUrl = \"https://dgk3593.github.io/dl-model/#\";\r\nexport const matcapDir = `${process.env.PUBLIC_URL}/img/matcap`;\r\n\r\nexport const DEFAULT_ADV_ANI = \"CMN_MWM_03\";\r\n\r\n/**\r\n * @type {WeaponType[]}\r\n */\r\nexport const WEAPON_LIST = [\r\n    \"Sword\",\r\n    \"Blade\",\r\n    \"Dagger\",\r\n    \"Axe\",\r\n    \"Lance\",\r\n    \"Bow\",\r\n    \"Wand\",\r\n    \"Staff\",\r\n    \"Manacaster\",\r\n];\r\n\r\n/**\r\n * @type {{ [paramName: string]: MatParamDetails }}\r\n */\r\nexport const matParamsDetails = {\r\n    wireframe: {\r\n        name: \"Wireframe\",\r\n        type: \"boolean\",\r\n        default: false,\r\n    },\r\n    useTexture: {\r\n        name: \"Texture\",\r\n        type: \"boolean\",\r\n        default: true,\r\n    },\r\n    transparent: {\r\n        name: \"Transparent\",\r\n        type: \"boolean\",\r\n        default: false,\r\n    },\r\n    flatShading: {\r\n        name: \"Flat Shading\",\r\n        type: \"boolean\",\r\n        default: false,\r\n    },\r\n    color: {\r\n        name: \"Color\",\r\n        type: \"color\",\r\n        default: \"#ffffff\",\r\n    },\r\n    emissive: {\r\n        name: \"Emissive\",\r\n        type: \"color\",\r\n        default: \"#000000\",\r\n    },\r\n    opacity: {\r\n        name: \"Opacity\",\r\n        type: \"percentage\",\r\n        default: 1,\r\n        min: 0,\r\n        max: 1,\r\n        step: 0.05,\r\n    },\r\n    emissiveIntensity: {\r\n        name: \"Emissive Intensity\",\r\n        type: \"percentage\",\r\n        default: 1,\r\n        min: 0,\r\n        max: 1,\r\n        step: 0.05,\r\n    },\r\n    specular: {\r\n        name: \"Specular\",\r\n        type: \"color\",\r\n        default: \"#111111\",\r\n    },\r\n    metalness: {\r\n        name: \"Metalness\",\r\n        type: \"percentage\",\r\n        default: 0,\r\n        min: 0,\r\n        max: 1,\r\n        step: 0.05,\r\n    },\r\n    roughness: {\r\n        name: \"Roughness\",\r\n        type: \"percentage\",\r\n        default: 1,\r\n        min: 0,\r\n        max: 1,\r\n        step: 0.05,\r\n    },\r\n    shininess: {\r\n        name: \"Shininess\",\r\n        type: \"number\",\r\n        default: 30,\r\n        min: 1,\r\n        max: 100,\r\n        step: 1,\r\n    },\r\n    gradientMap: {\r\n        name: \"Gradient Map\",\r\n        type: \"select\",\r\n        default: \"none\",\r\n        options: [\"none\", \"2 Tones\", \"3 Tones\", \"4 Tones\", \"5 Tones\"],\r\n    },\r\n    matcap: {\r\n        name: \"Matcap\",\r\n        type: \"select\",\r\n        default: matcapList[0].name,\r\n        options: matcapList.map(({ name }) => name),\r\n    },\r\n};\r\n\r\n/** list of parameters that can be set directly */\r\nexport const matDirectSetParams = [\r\n    \"transparent\",\r\n    \"opacity\",\r\n    \"wireframe\",\r\n    \"emissiveIntensity\",\r\n    \"metalness\",\r\n    \"roughness\",\r\n    \"shininess\",\r\n];\r\n\r\n/** list of parameters whose value is a color code */\r\nexport const matColorParams = [\"color\", \"emissive\", \"specular\"];\r\n\r\n/**\r\n * @type { Array< [paramName: string, details: MatParamDetails] > }\r\n */\r\nconst matParamsEntries = Object.entries(matParamsDetails);\r\n\r\n/** default values of material parameters\r\n * @type {{ [paramName: string]: * }}\r\n */\r\nconst defaultMatParams = Object.fromEntries(\r\n    matParamsEntries.map(([paramName, details]) => [paramName, details.default])\r\n);\r\n\r\n/** list of parameters that need to set needsUpdate = true to be updated */\r\nexport const needsUpdateParams = [\r\n    \"gradientMap\",\r\n    \"flatShading\",\r\n    \"useTexture\",\r\n    \"matcap\",\r\n];\r\n\r\n/** default light setting\r\n * @type { Array <LightParam> }\r\n */\r\nexport const defaultLights = [\r\n    {\r\n        id: \"0\",\r\n        type: \"Ambient\",\r\n        color: \"#444444\",\r\n        enable: true,\r\n        intensity: 1,\r\n    },\r\n    {\r\n        id: \"1\",\r\n        type: \"Directional\",\r\n        color: \"#ffffff\",\r\n        enable: true,\r\n        position: [50, 0, 100],\r\n        intensity: 0.8,\r\n    },\r\n];\r\n\r\n/** ASCII sets used to create ASCII art */\r\nexport const asciiSet = [\r\n    \" .:-=+*#%@\",\r\n    \" .'`^\\\",:;Il!i~+_-?][}{1)(|/tfjrxnuvczXYUJCLQ0OZmwqpdbkhao*#MW&8%B@$\",\r\n];\r\n\r\n/** used to initialize global state\r\n * @type {ApplicationState}\r\n */\r\nexport const defaultSettings = {\r\n    model: {\r\n        id: \"\",\r\n        texture: \"\",\r\n        eyeTexture: \"\",\r\n        eyeIdx: NaN,\r\n        mouthTexture: \"\",\r\n        mouthIdx: NaN,\r\n        weaponRight: \"\",\r\n        weaponLeft: \"\",\r\n    },\r\n    // @ts-ignore\r\n    material: {\r\n        type: \"Basic\",\r\n        ...defaultMatParams,\r\n    },\r\n    scene: {\r\n        rotateSpeed: 0,\r\n        background: \"#cccccc\",\r\n        initCameraPosition: null,\r\n    },\r\n    lights: defaultLights,\r\n    animation: {\r\n        code: \"\",\r\n        timeScale: 1,\r\n    },\r\n    chainMaker: { chain: null },\r\n    app: {\r\n        sidebarContent: \"settings\",\r\n        showSettings: true,\r\n        showAniControl: true,\r\n        antiAliasing: false,\r\n        pixelRatio: 1,\r\n        viewerType: \"\",\r\n    },\r\n    outline: {\r\n        enable: true,\r\n        size: 5,\r\n        color: \"#000000\",\r\n        opacity: 1,\r\n    },\r\n    capture: {\r\n        enable: false,\r\n        supportedCodecs: [],\r\n        codec: \"\",\r\n        format: \"\",\r\n    },\r\n    export: {\r\n        enable: false,\r\n        format: \"stl\",\r\n        binary: true,\r\n    },\r\n    ascii: {\r\n        enable: false,\r\n        charSet: asciiSet[1],\r\n        invert: false,\r\n        color: \"#00ff00\",\r\n        bgColor: \"#000000\",\r\n    },\r\n};\r\n\r\n/** map an init key to corresponding group and key in the global state\r\n * @type {{ [initKey: string]: {group: string, key: string, type: string} }}\r\n */\r\nexport const initKeyMap = {\r\n    id: { group: \"model\", key: \"id\", type: \"string\" },\r\n    modName: { group: \"model\", key: \"modName\", type: \"string\" },\r\n    tx: { group: \"model\", key: \"texture\", type: \"string\" },\r\n    et: { group: \"model\", key: \"eyeTexture\", type: \"string\" },\r\n    ei: { group: \"model\", key: \"eyeIdx\", type: \"int\" },\r\n    mt: { group: \"model\", key: \"mouthTexture\", type: \"string\" },\r\n    mi: { group: \"model\", key: \"mouthIdx\", type: \"int\" },\r\n    wr: { group: \"model\", key: \"weaponRight\", type: \"string\" },\r\n    wl: { group: \"model\", key: \"weaponLeft\", type: \"string\" },\r\n    bg: { group: \"scene\", key: \"background\", type: \"bg\" },\r\n    cam: { group: \"scene\", key: \"initCameraPosition\", type: \"xyz\" },\r\n    showAC: { group: \"app\", key: \"showAniControl\", type: \"boolean\" },\r\n    showSettings: { group: \"app\", key: \"showSettings\", type: \"boolean\" },\r\n    showOutline: { group: \"outline\", key: \"enable\", type: \"boolean\" },\r\n    AA: { group: \"app\", key: \"antiAliasing\", type: \"boolean\" },\r\n    rot: { group: \"scene\", key: \"rotateSpeed\", type: \"float\" },\r\n    ts: { group: \"animation\", key: \"timeScale\", type: \"float\" },\r\n    cc: { group: \"animation\", key: \"code\", type: \"string\" },\r\n};\r\n\r\nconst commonInitKeys = [\r\n    \"id\",\r\n    \"modName\",\r\n    \"bg\",\r\n    \"cam\",\r\n    \"showOutline\",\r\n    \"AA\",\r\n    \"rot\",\r\n];\r\n\r\nconst aniInitKeys = [\"ts\", \"cc\"];\r\n\r\n/** list of init keys corresponding to viewer type\r\n * @type {{ [viewerType: string]: Array<string> }}\r\n */\r\nexport const initKeys = {\r\n    adv: [\r\n        \"et\",\r\n        \"ei\",\r\n        \"mt\",\r\n        \"mi\",\r\n        \"wr\",\r\n        \"wl\",\r\n        ...commonInitKeys,\r\n        ...aniInitKeys,\r\n    ],\r\n    dragon: [\"ei\", \"mi\", ...commonInitKeys, ...aniInitKeys],\r\n    ani: [...commonInitKeys, ...aniInitKeys],\r\n    basic: [...commonInitKeys],\r\n};\r\n\r\n/** list of supported materials */\r\nexport const MATERIALS = [\r\n    \"Basic\",\r\n    \"Toon\",\r\n    \"Lambert\",\r\n    \"Phong\",\r\n    \"Standard\",\r\n    \"Matcap\",\r\n];\r\n\r\n/** list of materials not using lights */\r\nexport const NO_LIGHT_MATERIALS = [\"Basic\", \"Matcap\"];\r\n\r\n/** parameters that all material has */\r\nexport const matCommonParams = [\r\n    \"transparent\",\r\n    \"opacity\",\r\n    \"wireframe\",\r\n    \"useTexture\",\r\n    \"color\",\r\n];\r\n\r\n/** parameters specific to each type of materials\r\n * @type {{ [materialName: string]: Array<string> }}\r\n */\r\nexport const matExtraParams = {\r\n    Basic: [],\r\n    Toon: [\"emissive\", \"emissiveIntensity\", \"gradientMap\"],\r\n    Lambert: [\"emissive\", \"emissiveIntensity\"],\r\n    Phong: [\r\n        \"emissive\",\r\n        \"emissiveIntensity\",\r\n        \"specular\",\r\n        \"shininess\",\r\n        \"flatShading\",\r\n    ],\r\n    Standard: [\r\n        \"emissive\",\r\n        \"emissiveIntensity\",\r\n        \"metalness\",\r\n        \"roughness\",\r\n        \"flatShading\",\r\n    ],\r\n    Matcap: [\"flatShading\", \"matcap\"],\r\n};\r\n\r\nexport const spFaceTextures = {\r\n    c110300_01: \"ec110300_01\",\r\n};\r\n\r\n/** Set of ids of models incompatible with AdvViewer */\r\nexport const incompatibleModels = new Set([\r\n    \"c100007_01\",\r\n    \"c100007_05\",\r\n    \"c100007_09\",\r\n    \"c100034_01\",\r\n    \"c100035_01\",\r\n    \"c100036_01\",\r\n    \"c100037_01\",\r\n    \"c100041_01\",\r\n]);\r\n\r\nexport const specialBlades = new Set([\"w397004_01\"]);\r\n\r\n/**\r\n * @type {{[colorName: string]: ColorCode}}\r\n */\r\nexport const commonColors = {\r\n    green: \"#00ff00\",\r\n    black: \"#000000\",\r\n    grey: \"#cccccc\",\r\n    white: \"#ffffff\",\r\n};\r\n\r\nexport const CAM_PARAMS = {\r\n    angle: 45,\r\n    far: 100,\r\n    near: 0.01,\r\n};\r\n\r\nexport const aniModList = {\r\n    ts: { key: \"timeScale\", defaultValue: 1 },\r\n    r: { key: \"repetitions\", defaultValue: 1 },\r\n};\r\n\r\n/** list of video codecs to check for */\r\nexport const videoCodecs = [\r\n    \"video/mp4;codecs=h264\",\r\n    \"video/webm;codecs=h264\",\r\n    \"video/webm;codecs=vp9\",\r\n    \"video/webm;codecs=vp8\",\r\n    \"video/webm\",\r\n];\r\n","import Button from \"@material-ui/core/Button\";\r\n\r\nimport { aniModList, incompatibleModels, specialBlades } from \"./consts\";\r\n\r\n/** capitalize first letter of tring\r\n * @param {string} input\r\n */\r\nexport const capitalize = ([first, ...rest]) =>\r\n    `${first.toUpperCase()}${rest.join(\"\")}`;\r\n\r\n/** generate date time string */\r\nexport const getDateTimeString = () => {\r\n    const date = new Date();\r\n    const dateStr = date.toDateString().replace(/ /g, \"_\");\r\n    const timeStr = date\r\n        .toLocaleTimeString()\r\n        .replace(/:/g, \"-\")\r\n        .replace(/ /g, \"\");\r\n    return `${dateStr}_${timeStr}`;\r\n};\r\n\r\n/** get the default texture file of a model from id\r\n * @param {string} id - model id\r\n */\r\nexport const getDefaultTexture = id =>\r\n    id.match(/_[0-9]{2}/) ? id : `${id}_01`;\r\n\r\n/** create a new object whose entries with key listed in keys are copied from the input object\r\n * @param {{ }} object - object to filter\r\n * @param { string[] } keys - list of keys to filter\r\n * @return {{ }}\r\n */\r\nexport const filterObject = (object, keys) => {\r\n    const entries = Object.entries(object);\r\n    const filtered = entries.filter(([key, _]) => keys.includes(key));\r\n    return Object.fromEntries(filtered);\r\n};\r\n\r\n/** Get the difference between 2 object\r\n * @param {{ }} prev - previous value\r\n * @param {{ }} current - current value\r\n * @returns { Array<[updatedKey: string, value: *]> } array of updated key and value pairs\r\n */\r\nexport const getUpdated = (prev, current) => {\r\n    const updated = Object.entries(current).filter(\r\n        ([key, value]) => value !== prev[key]\r\n    );\r\n    return updated;\r\n};\r\n\r\n/** check if an object is empty\r\n * @param {{}} object\r\n */\r\nexport const isEmpty = object => !Object.keys(object).length;\r\n\r\n/** check if an ID is a blade\r\n * @param {string} modelId - id to check\r\n */\r\nexport const isBlade = modelId =>\r\n    specialBlades.has(modelId) || modelId.startsWith(\"w302\");\r\n\r\n/** check if an ID is a sheath\r\n * @param {string} modelId - id to check\r\n */\r\nexport const isSheath = modelId => isBlade(modelId) && modelId.endsWith(\"02\");\r\n\r\n/** check if model is compatible with AdvViewer\r\n * @param {string} modelId\r\n */\r\nexport const isCharaWithAni = modelId =>\r\n    modelId.startsWith(\"c\") &&\r\n    !modelId.endsWith(\"_h\") &&\r\n    !incompatibleModels.has(modelId);\r\n\r\n/** check if a model is a dragon\r\n * @param {string} modelId\r\n */\r\nexport const isDragon = modelId =>\r\n    modelId.startsWith(\"d\") || modelId === \"smith\";\r\n\r\n/** get the suitable viewer type base on ID\r\n * @param {string} modelId\r\n */\r\nexport const getViewerType = modelId => {\r\n    if (isDragon(modelId)) return \"dragon\";\r\n\r\n    if (modelId.startsWith(\"h\") || incompatibleModels.has(modelId))\r\n        return \"ani\";\r\n\r\n    if (isCharaWithAni(modelId)) return \"adv\";\r\n\r\n    return \"basic\";\r\n};\r\n\r\n/** get default eye and mouth index\r\n * @param {string} modelId\r\n */\r\nexport const getDefaultFace = modelId => (isDragon(modelId) ? 1 : 2);\r\n\r\n/** apply callback on each element of list or on list if list is not an array\r\n * @param {* | Array} list - list of objects to apply callback\r\n * @param {function} callback - callback to apply\r\n */\r\nexport const callbackOnEach = (list, callback) =>\r\n    [list].flat().forEach(child => callback(child));\r\n\r\n/** generate animation chain code from AnimationChain\r\n * @param {AnimationChain} chain\r\n */\r\nexport const generateChainCode = chain => {\r\n    const aniCode = chain.map(aniToCode);\r\n    return aniCode.join(\">\");\r\n};\r\n\r\n/** convert 1 animation chain item to single animation code\r\n * @param {AniListItem} ani\r\n */\r\nconst aniToCode = ani => {\r\n    const { aniName, faceChanges } = ani;\r\n    const modCode = generateAniModCode(ani);\r\n    const faceCode = generateFaceCode(faceChanges);\r\n    return `${aniName}${modCode}${faceCode}`;\r\n};\r\n\r\n/**  generate animation modifier code\r\n * @param {AniListItem} ani\r\n */\r\nconst generateAniModCode = ani => {\r\n    const modCodes = [];\r\n    Object.keys(aniModList).forEach(modKey => {\r\n        const { key, defaultValue } = aniModList[modKey];\r\n        if (ani[key] !== defaultValue) {\r\n            modCodes.push(`&${modKey}=${ani[key]}`);\r\n        }\r\n    });\r\n    return modCodes.join(\"\");\r\n};\r\n\r\n/** create face change code\r\n * @param {FaceChangeArray} faceChanges\r\n */\r\nconst generateFaceCode = faceChanges => {\r\n    if (!faceChanges) return \"\";\r\n\r\n    const faceCodes = [];\r\n    faceChanges.forEach(change => {\r\n        const { time, eyeIdx, mouthIdx } = change;\r\n        if (!time) return;\r\n\r\n        eyeIdx && faceCodes.push(`&e-${time}=${eyeIdx}`);\r\n\r\n        mouthIdx && faceCodes.push(`&m-${time}=${mouthIdx}`);\r\n    });\r\n    return faceCodes.join(\"\");\r\n};\r\n\r\n/**\r\n * @param {FilterState} filterState\r\n * @return {FilterConditions}\r\n */\r\nexport const collectFilter = filterState => {\r\n    const stateEntries = Object.entries(filterState);\r\n    /**\r\n     * @type {FilterConditions}\r\n     */\r\n    const filterConditions = stateEntries.map(([groupName, groupData]) => [\r\n        groupName,\r\n        Object.keys(groupData).filter(key => groupData[key]),\r\n    ]);\r\n    return filterConditions.filter(([, valueList]) => valueList.length);\r\n};\r\n\r\n/** Multiconditional filter\r\n * @param {ModelData[]} input\r\n * @param {FilterConditions} filterConditions\r\n */\r\nexport const multiCondFilter = (input, filterConditions) => {\r\n    return input.filter(el =>\r\n        filterConditions.every(([propName, valueList]) =>\r\n            valueList.includes(el[propName])\r\n        )\r\n    );\r\n};\r\n\r\n/** turn a list of animation data to buttons\r\n * @param {AnimationList} list\r\n * @param {*} handleSelect\r\n * @param {string} [groupName]\r\n */\r\nexport const listToAniButtons = (list, handleSelect, groupName = \"\") => {\r\n    if (!list) return;\r\n\r\n    const style = { maxWidth: \"13.5rem\" };\r\n    return list.map(({ name, code }) => (\r\n        <Button\r\n            variant=\"contained\"\r\n            key={name}\r\n            data-value={code}\r\n            data-name={`${groupName ? `${groupName} ` : \"\"}${name}`}\r\n            onClick={handleSelect}\r\n            style={style}\r\n        >\r\n            {name}\r\n        </Button>\r\n    ));\r\n};\r\n","import { defaultSettings } from \"helpers/consts\";\r\nimport { filterObject } from \"helpers/helpers\";\r\n\r\n/** reducer for settings\r\n * @param {ApplicationState} state\r\n * @param {ReducerAction} action\r\n * @return {ApplicationState} new state\r\n */\r\nexport const settingsReducer = (state, action) => {\r\n    const { type, key, value } = action;\r\n    switch (type) {\r\n        case \"toggle\":\r\n            const currentValue = state[key][value];\r\n            return {\r\n                ...state,\r\n                [key]: { ...state[key], [value]: !currentValue },\r\n            };\r\n\r\n        case \"reset\":\r\n            // value = array of keys in settings[key] to be reset, null -> reset all\r\n            const defaultSetting = defaultSettings[key];\r\n            const changes = value\r\n                ? filterObject(defaultSetting, value)\r\n                : { ...defaultSetting };\r\n\r\n            return { ...state, [key]: { ...state[key], ...changes } };\r\n\r\n        case \"update\":\r\n            // update state[key] with values from value\r\n            return { ...state, [key]: { ...state[key], ...value } };\r\n\r\n        case \"overwrite\":\r\n            return { ...state, [key]: value };\r\n\r\n        default:\r\n            return state;\r\n    }\r\n};\r\n","import { createContext, useReducer, useContext } from \"react\";\r\nimport { settingsReducer } from \"reducer/settingsReducer\";\r\nimport { defaultSettings } from \"helpers/consts\";\r\n\r\n/**\r\n * @type {React.Context<ApplicationState>}\r\n */\r\nconst SettingsContext = createContext(null);\r\n\r\n/**\r\n * @type {React.Context< React.Dispatch<ReducerAction> >}\r\n */\r\nconst DispatchContext = createContext(null);\r\n\r\n/** used to initialize global state\r\n * @type {ApplicationState}\r\n */\r\nconst initSettings = {};\r\nObject.keys(defaultSettings).forEach(\r\n    key => (initSettings[key] = { ...defaultSettings[key] })\r\n);\r\ninitSettings.lights = defaultSettings.lights.map(light => ({\r\n    ...light,\r\n}));\r\n\r\nexport { initSettings };\r\n\r\nexport function SettingsProvider(props) {\r\n    const [settings, dispatch] = useReducer(settingsReducer, initSettings);\r\n\r\n    return (\r\n        <SettingsContext.Provider value={settings}>\r\n            <DispatchContext.Provider value={dispatch}>\r\n                {props.children}\r\n            </DispatchContext.Provider>\r\n        </SettingsContext.Provider>\r\n    );\r\n}\r\n\r\nexport function useSettings() {\r\n    const context = useContext(SettingsContext);\r\n    if (context === undefined) {\r\n        throw new Error(\"useSettings must be used within a SettingsProvider\");\r\n    }\r\n    return context;\r\n}\r\n\r\nexport function useDispatch() {\r\n    const context = useContext(DispatchContext);\r\n    if (context === undefined) {\r\n        throw new Error(\"useDispatch must be used within a DispatchProvider\");\r\n    }\r\n    return context;\r\n}\r\n","import { makeStyles } from \"@material-ui/core/styles\";\r\n\r\nconst useStyles = makeStyles(theme => ({\r\n    root: {\r\n        display: \"block\",\r\n        width: \"100vw\",\r\n        height: \"100vh\",\r\n    },\r\n    content: {\r\n        width: \"100vw\",\r\n        height: \"100vh\",\r\n        padding: 0,\r\n    },\r\n    openSidebarButton: {\r\n        position: \"absolute\",\r\n        top: 0,\r\n        left: 0,\r\n        margin: \"2rem\",\r\n        opacity: \"0.5\",\r\n        borderRadius: \"0.25rem\",\r\n        transition: \"0.5s all ease-in-out\",\r\n        backgroundColor: \"#cccccc\",\r\n        cursor: \"pointer\",\r\n        \"&:hover\": {\r\n            opacity: \"1\",\r\n        },\r\n    },\r\n    loadingMsg: {\r\n        position: \"absolute\",\r\n        zIndex: 9999,\r\n        width: \"100vw\",\r\n        height: \"100vh\",\r\n        display: \"flex\",\r\n        justifyContent: \"center\",\r\n        alignItems: \"center\",\r\n        color: \"white\",\r\n        fontSize: \"x-large\",\r\n        backgroundColor: \"rgba(0,0,0,0.5)\",\r\n    },\r\n}));\r\n\r\nexport default useStyles;\r\n","/** default control coordinates\r\n * @type {{ [key: string]: xyzCoordinate }}\r\n */\r\nexport const controlsPosition = {\r\n    c: [0, 0.5, 0],\r\n    d: [0, 1.5, 0],\r\n    w: [0, 0, 0],\r\n    b: [0, 1, 0],\r\n    e: [0, 0.5, 0],\r\n    h: [0, 1, 0],\r\n    o: [0, 0, 0],\r\n    r: [0, 3, 0],\r\n\r\n    d200017_01: [0, 1, 0],\r\n    d210001_01: [0, 1, 0],\r\n    d210002_01: [0, 1, 0],\r\n    d210003_01: [0, 1, 0],\r\n    d210004_01: [0, 1, 0],\r\n    d210005_01: [0, 1, 0],\r\n    d210020_01: [0, 2.5, 0],\r\n    d210038_01: [0, 1, 0],\r\n    d210039_01: [0, 1, 0],\r\n    d210040_01: [0, 1, 0],\r\n    d210041_01: [0, 1, 0],\r\n    d210042_01: [0, 1, 0],\r\n    d210048_01: [0, 2.5, 0],\r\n    d210052_01: [0, 2.5, 0],\r\n    d210054_01: [0, 2, 0],\r\n    d210072_01: [0, 1, 0],\r\n    d210076_01: [0, 2.5, 0],\r\n    d210077_01: [0, 2.5, 0],\r\n    d210078_01: [0, 6, 0],\r\n    d210079_01: [0, 2.5, 0],\r\n    d210081_01: [0, 2.5, 0],\r\n    d210082_01: [0, 2, 0],\r\n    d210087_01: [0, 2.5, 0],\r\n    d210093_01: [0, 1, 0],\r\n    d210094_01: [0, 2, 0],\r\n    d210095_01: [0, 1, 0],\r\n    d210102_01: [0, 2.5, 0],\r\n    d210103_01: [0, 2.5, 0],\r\n    d210104_01: [0, 1, 0],\r\n    d210109_01: [0, 1, 0],\r\n    d210111_01: [0, 0.5, 0],\r\n    d210112_01: [0, 2.5, 0],\r\n    d210113_01: [0, 1, 0],\r\n    d210114_01: [0, 6, 0],\r\n    d210115_01: [0, 2, 0],\r\n    d210116_01: [0, 2, 0],\r\n    d210117_01: [0, 2, 0],\r\n    d210118_01: [0, 1, 0],\r\n    d210123_01: [0, 3, 0],\r\n    d210125_01: [0, 2, 0],\r\n    d210126_01: [0, 2.5, 0],\r\n    d210127_01: [0, 0.5, 0],\r\n    d210128_01: [0, 0.5, 0], // Puppy\r\n    d210133_01: [0, 0.5, 0],\r\n    d210146_01: [0, 0.5, 0],\r\n    d210136_01: [0, 6, 0],\r\n\r\n    h0010001_02: [0, 3, 0],\r\n    h0110401: [0, 3.5, 0],\r\n    h0080501: [0, 2, 0],\r\n    h0090501: [0, 2, 0],\r\n    h0100301: [0, 1.5, 0],\r\n    r0070401: [0, 20, 0],\r\n    r0070501: [0, 20, 0],\r\n    r0080401: [0, 2, 0],\r\n\r\n    smith: [0, 0.5, 0],\r\n};\r\n\r\nexport default controlsPosition;\r\n","import { lazy, Suspense, useCallback } from \"react\";\r\n\r\nimport { useSettings, useDispatch } from \"context/SettingsContext\";\r\nimport \"./styles/Display.css\";\r\n\r\nimport getTextColor from \"helpers/getTextColor\";\r\nimport cameraPositions from \"data/cameraPositions\";\r\nimport controlsPosition from \"data/controlsPositions\";\r\n\r\nconst AniControl = lazy(() => import(\"./AniControl\"));\r\nconst BasicViewer = lazy(() => import(\"components/viewers/BasicViewer\"));\r\nconst AniViewer = lazy(() => import(\"components/viewers/AniViewer\"));\r\nconst AdvViewer = lazy(() => import(\"components/viewers/AdvViewer\"));\r\nconst DragonViewer = lazy(() => import(\"components/viewers/DragonViewer\"));\r\n\r\nconst viewers = {\r\n    basic: BasicViewer,\r\n    ani: AniViewer,\r\n    adv: AdvViewer,\r\n    dragon: DragonViewer,\r\n};\r\n\r\n/**\r\n * @param {Object} props\r\n * @param {function} props.setLoadingMsg\r\n * @param {{width: number, height: number}} props.viewport\r\n */\r\nfunction Display(props) {\r\n    const { viewport } = props;\r\n\r\n    const settings = useSettings();\r\n    const {\r\n        model: { id: modelId },\r\n        scene: { rotateSpeed, background, initCameraPosition },\r\n        app: { showAniControl, antiAliasing, pixelRatio, viewerType },\r\n    } = settings;\r\n\r\n    const dispatch = useDispatch();\r\n\r\n    const toggleSetting = useCallback(\r\n        (key, value) => dispatch({ type: \"toggle\", key, value }),\r\n        [dispatch]\r\n    );\r\n    const onCaptureFinish = useCallback(\r\n        () => toggleSetting(\"capture\", \"enable\"),\r\n        [toggleSetting]\r\n    );\r\n    const onExportFinish = useCallback(\r\n        () => toggleSetting(\"export\", \"enable\"),\r\n        [toggleSetting]\r\n    );\r\n\r\n    const modelType = modelId[0];\r\n\r\n    const defaultCameraPosition =\r\n        cameraPositions[modelId] || cameraPositions[modelType];\r\n\r\n    const cameraPosition = initCameraPosition\r\n        ? initCameraPosition.map((n, i) =>\r\n              isNaN(n) ? defaultCameraPosition[i] : n\r\n          )\r\n        : defaultCameraPosition;\r\n\r\n    const controlPosition =\r\n        controlsPosition[modelId] || controlsPosition[modelType];\r\n\r\n    const ModelViewer = viewers[viewerType];\r\n\r\n    return (\r\n        <div className=\"Display\">\r\n            {showAniControl && (\r\n                <div\r\n                    className=\"Display-AniControl\"\r\n                    style={{ color: getTextColor(background) }}\r\n                >\r\n                    <Suspense fallback={null}>\r\n                        <AniControl value={settings.animation.timeScale} />\r\n                    </Suspense>\r\n                </div>\r\n            )}\r\n            <Suspense fallback={null}>\r\n                <ModelViewer\r\n                    setLoadingMsg={props.setLoadingMsg}\r\n                    capture={settings.capture}\r\n                    onCaptureFinish={onCaptureFinish}\r\n                    export={settings.export}\r\n                    onExportFinish={onExportFinish}\r\n                    model={settings.model}\r\n                    material={settings.material}\r\n                    outline={settings.outline}\r\n                    animation={settings.animation}\r\n                    lights={settings.lights}\r\n                    ascii={settings.ascii}\r\n                    antiAliasing={antiAliasing}\r\n                    pixelRatio={pixelRatio}\r\n                    background={background}\r\n                    viewport={viewport}\r\n                    cameraPosition={cameraPosition}\r\n                    controlsPosition={controlPosition}\r\n                    rotateSpeed={rotateSpeed}\r\n                />\r\n            </Suspense>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default Display;\r\n","import { initKeyMap, DEFAULT_MODEL_ID } from \"../consts\";\r\nimport { chainCodeToList } from \"../viewerHelpers\";\r\nimport { getDefaultFace, getViewerType } from \"../helpers\";\r\nimport { getDefaultModelMod, getModelModByName } from \"./getModelMod\";\r\nimport { getDefaultAni } from \"./getDefaultAni\";\r\n\r\n/** turn string to the corresponding boolean if it's \"true\" or \"false\"\r\n * @param {string} str\r\n */\r\nconst str2bool = str => Boolean(str === \"true\");\r\n\r\n/** convert string to xyzCoordinate\r\n * @param {string} str\r\n * @return {xyzCoordinate}\r\n */\r\nconst str2xyz = str => {\r\n    const [x, y, z] = str.split(\",\");\r\n    /**\r\n     * @type {array[3]}\r\n     */\r\n    const coordinate = [x, y, z].map(parseFloat);\r\n    return coordinate;\r\n};\r\n\r\n/**\r\n * @param {string} str\r\n * @return {ColorCode | \"transparent\"}\r\n */\r\nconst str2bg = str => {\r\n    switch (str) {\r\n        case \"transparent\":\r\n            return str;\r\n        case \"camera\":\r\n            return \"#cccccc\";\r\n        default:\r\n            // @ts-ignore\r\n            return `#${str}`;\r\n    }\r\n};\r\n\r\n/** convert a string to the specified type\r\n * @param {string} str\r\n * @param {string} type\r\n */\r\nconst convertParamValue = (str, type) => {\r\n    if (type === \"string\") return str;\r\n    const converter = {\r\n        bg: str2bg,\r\n        xyz: str2xyz,\r\n        float: parseFloat,\r\n        int: parseInt,\r\n        boolean: str2bool,\r\n    };\r\n\r\n    return converter[type](str);\r\n};\r\n\r\n/** turn a string of the form 'keycode=value' to [keycode, value],\r\n * return empty array if empty input, or invalid keycode/value\r\n * @param {string} paramText\r\n * @return {[ [keycode: string, value: *]? ]}\r\n */\r\nconst extractParam = paramText => {\r\n    if (!paramText) return [];\r\n\r\n    const [keycode, ...valueParts] = paramText.split(\"=\");\r\n    if (!initKeyMap[keycode] || !valueParts[0]) return [];\r\n\r\n    const value = valueParts.join(\"=\");\r\n    const { type } = initKeyMap[keycode];\r\n\r\n    return [[keycode, convertParamValue(value, type)]];\r\n};\r\n\r\n/** turn a path into an array of keycode and value pair,\r\n * invalid strings will be filtered out\r\n * @param {string} path\r\n * @return {[keycode: string, value: *][]}\r\n */\r\nconst getParamsFromPath = path =>\r\n    path\r\n        .split(\"/\")\r\n        .reduce(\r\n            (output, paramText) => [...output, ...extractParam(paramText)],\r\n            []\r\n        );\r\n\r\n/** return a list of key value pairs corresponding to the specified group of the application state\r\n * @param { [keycode: string, value: *][] } params\r\n * @param {string} groupName\r\n * @return { [key: string, value: *][] }\r\n */\r\nconst filterParamsByGroup = (params, groupName) =>\r\n    params.reduce((output, [keycode, value]) => {\r\n        const { group, key } = initKeyMap[keycode];\r\n        if (group !== groupName) return output;\r\n\r\n        return [...output, [key, value]];\r\n    }, []);\r\n\r\n/** set model related parameters\r\n * @param {[keycode: string, value: *][]} params\r\n * @param {React.Dispatch<ReducerAction>} dispatch\r\n */\r\nconst setModelParams = async (params, dispatch) => {\r\n    const modelParams = filterParamsByGroup(params, \"model\");\r\n    const model = Object.fromEntries(modelParams);\r\n\r\n    // model.id ??= DEFAULT_MODEL_ID;\r\n    model.id = model.id ?? DEFAULT_MODEL_ID;\r\n    const modelId = model.id;\r\n\r\n    [\"mouth\", \"eye\"].forEach(part => {\r\n        // model[`${part}Texture`] ??= modelId;\r\n        // model[`${part}Idx`] ??= getDefaultFace(modelId);\r\n        model[`${part}Texture`] = model[`${part}Texture`] ?? modelId;\r\n        model[`${part}Idx`] = model[`${part}Idx`] ?? getDefaultFace(modelId);\r\n    });\r\n\r\n    dispatch({ type: \"update\", key: \"model\", value: model });\r\n    dispatch({\r\n        type: \"update\",\r\n        key: \"app\",\r\n        value: { viewerType: getViewerType(modelId) },\r\n    });\r\n\r\n    await setModelMod(model, dispatch);\r\n};\r\n\r\n/** set model mod from param init object\r\n * @param {Object} modelData\r\n */\r\nconst setModelMod = async (modelData, dispatch) => {\r\n    const modelId = modelData.id;\r\n\r\n    const defaultMod = await getDefaultModelMod(modelId);\r\n    if (!defaultMod) return;\r\n\r\n    const updateValue = {};\r\n    if (modelData.modName) {\r\n        const mod = await getModelModByName(modelId, modelData.modName);\r\n\r\n        updateValue.mod = mod.code;\r\n        updateValue.modName = mod.name;\r\n    } else {\r\n        updateValue.mod = defaultMod.code;\r\n        updateValue.modName = defaultMod.name;\r\n    }\r\n\r\n    dispatch({\r\n        type: \"update\",\r\n        key: \"model\",\r\n        value: updateValue,\r\n    });\r\n};\r\n\r\n/** set animation related parameters\r\n * @param {[keycode: string, value: *][]} params\r\n * @param {React.Dispatch<ReducerAction>} dispatch\r\n */\r\nconst setAniParams = async (params, dispatch) => {\r\n    const aniParams = filterParamsByGroup(params, \"animation\");\r\n\r\n    const animation = Object.fromEntries(aniParams);\r\n\r\n    const modelId =\r\n        params.find(([keycode]) => keycode === \"id\")?.[1] || DEFAULT_MODEL_ID;\r\n    // newValue.code ??= getDefaultAni(modelId);\r\n    animation.code = animation.code ?? (await getDefaultAni(modelId));\r\n    dispatch({ type: \"update\", key: \"animation\", value: animation });\r\n\r\n    const aniCode = animation.code;\r\n    dispatch({\r\n        type: \"update\",\r\n        key: \"chainMaker\",\r\n        value: { chain: chainCodeToList(aniCode, \"init\") },\r\n    });\r\n};\r\n\r\n/** set other parameters\r\n * @param {[keycode: string, value: *][]} params\r\n * @param {React.Dispatch<ReducerAction>} dispatch\r\n * @param {string} group - name of the parameter group\r\n */\r\nconst setOtherParams = (params, dispatch, group) => {\r\n    const paramList = filterParamsByGroup(params, group);\r\n    const newValue = Object.fromEntries(paramList);\r\n\r\n    dispatch({\r\n        type: \"update\",\r\n        key: group,\r\n        value: newValue,\r\n    });\r\n};\r\n\r\n/** update application state base on information from the URL\r\n * @param {string} path\r\n * @param {React.Dispatch<ReducerAction>} dispatch\r\n */\r\nexport const setParamsFromPath = async (path, dispatch) => {\r\n    const params = getParamsFromPath(path);\r\n\r\n    const definedGroups = new Set(\r\n        params.map(([keycode]) => initKeyMap[keycode].group)\r\n    );\r\n\r\n    definedGroups.delete(\"model\");\r\n    definedGroups.delete(\"animation\");\r\n\r\n    await setModelParams(params, dispatch);\r\n\r\n    const groups = [...definedGroups];\r\n    const groupSetPromise = groups.map(group =>\r\n        setOtherParams(params, dispatch, group)\r\n    );\r\n\r\n    await Promise.all([setAniParams(params, dispatch), ...groupSetPromise]);\r\n};\r\n\r\nexport default setParamsFromPath;\r\n","import {\r\n    lazy,\r\n    Suspense,\r\n    useState,\r\n    useRef,\r\n    useEffect,\r\n    useCallback,\r\n} from \"react\";\r\n\r\nimport useToggleState from \"hooks/useToggleState\";\r\n\r\nimport Menu from \"@material-ui/icons/Menu\";\r\nimport CssBaseline from \"@material-ui/core/CssBaseline\";\r\nimport useStyles from \"./MainPageStyles\";\r\n\r\nimport Display from \"./Display\";\r\n\r\nimport { useSettings, useDispatch } from \"context/SettingsContext\";\r\nimport { getViewerType } from \"helpers/helpers\";\r\nimport { getDefaultAni } from \"helpers/async/getDefaultAni\";\r\n\r\nimport setParamsFromPath from \"helpers/async/setParamsFromPath\";\r\nimport { getDefaultModelMod } from \"helpers/async/getModelMod\";\r\n\r\nimport { chainCodeToList } from \"helpers/viewerHelpers\";\r\n\r\nconst Sidebar = lazy(() =>\r\n    import(/* webpackChunkName: \"Sidebar\" */ \"./Sidebar\")\r\n);\r\nconst Dock = lazy(() => import(/* webpackChunkName: \"Dock\" */ \"./Dock\"));\r\n\r\nfunction MainPage({ location }) {\r\n    const classes = useStyles();\r\n\r\n    const [sidebar, toggleSidebar] = useToggleState(true);\r\n    const [loadingMsg, setLoadingMsg] = useState(\"Loading...\");\r\n    const [initLoadDone, setInitLoadDone] = useState(false);\r\n    const [viewport, setViewport] = useState({\r\n        width: window.innerWidth,\r\n        height: window.innerHeight,\r\n    });\r\n\r\n    const [dockMode, setDockMode] = useState(\"\");\r\n    const dockHandle = useRef();\r\n\r\n    const {\r\n        model,\r\n        app: { showSettings, viewerType },\r\n    } = useSettings();\r\n    const dispatch = useDispatch();\r\n\r\n    const viewerRef = useRef();\r\n    const currentId = useRef(\"\");\r\n\r\n    const updateViewportSize = () => {\r\n        const width = viewerRef.current.clientWidth;\r\n        const height = viewerRef.current.clientHeight;\r\n        setViewport({ width, height });\r\n    };\r\n\r\n    const setDock = (mode, handleSelect) => {\r\n        setDockMode(mode);\r\n        dockHandle.current = handleSelect;\r\n    };\r\n\r\n    const closeDock = () => setDockMode(\"\");\r\n\r\n    const updateSetings = useCallback(\r\n        key => value => dispatch({ type: \"update\", key, value }),\r\n        [dispatch]\r\n    );\r\n\r\n    // load params from path\r\n    useEffect(() => {\r\n        (async function setParams() {\r\n            setLoadingMsg(\"Loading...\");\r\n            await setParamsFromPath(location.pathname, dispatch);\r\n            setLoadingMsg(\"\");\r\n            setInitLoadDone(true);\r\n        })();\r\n    }, [location.pathname, dispatch]);\r\n\r\n    // update settings when id changed\r\n    useEffect(() => {\r\n        const { id } = model;\r\n        if (!currentId.current) {\r\n            currentId.current = id;\r\n            return;\r\n        }\r\n\r\n        if (id === currentId.current) return;\r\n\r\n        const newViewerType = getViewerType(id);\r\n        const viewerChanged = newViewerType !== viewerType;\r\n        updateSetings(\"app\")({ viewerType: newViewerType });\r\n\r\n        const viewerChangedToAdv = newViewerType === \"adv\" && viewerChanged;\r\n        if (viewerChangedToAdv) {\r\n            updateSetings(\"model\")({ eyeIdx: 2, mouthIdx: 2 });\r\n        }\r\n\r\n        if (viewerChanged && newViewerType === \"dragon\") {\r\n            updateSetings(\"model\")({ eyeIdx: 1, mouthIdx: 1 });\r\n        }\r\n\r\n        const needResetAni =\r\n            [\"dragon\", \"ani\"].includes(newViewerType) || viewerChangedToAdv;\r\n\r\n        const resetAni = async () => {\r\n            const ani = await getDefaultAni(id);\r\n            updateSetings(\"animation\")({ code: ani });\r\n            updateSetings(\"chainMaker\")({\r\n                chain: chainCodeToList(ani, \"init\"),\r\n            });\r\n        };\r\n\r\n        const setModelMod = async () => {\r\n            const modelMod = await getDefaultModelMod(id);\r\n            if (modelMod) {\r\n                updateSetings(\"model\")({\r\n                    mod: modelMod?.code,\r\n                    modName: modelMod?.name,\r\n                });\r\n            }\r\n        };\r\n        Promise.all([setModelMod(), needResetAni && resetAni()]);\r\n\r\n        currentId.current = id;\r\n    }, [model, updateSetings, viewerType]);\r\n\r\n    // update viewport size when resized\r\n    useEffect(() => {\r\n        window.addEventListener(\"resize\", updateViewportSize);\r\n\r\n        return function () {\r\n            window.removeEventListener(\"resize\", updateViewportSize);\r\n        };\r\n    }, []);\r\n\r\n    return (\r\n        <>\r\n            {loadingMsg && (\r\n                <div className={classes.loadingMsg}>{loadingMsg}</div>\r\n            )}\r\n            {initLoadDone && (\r\n                <div className={classes.root}>\r\n                    {showSettings && (\r\n                        <Suspense fallback={null}>\r\n                            <CssBaseline />\r\n                            <button\r\n                                onClick={toggleSidebar}\r\n                                className={classes.openSidebarButton}\r\n                            >\r\n                                <Menu />\r\n                            </button>\r\n                            <Sidebar\r\n                                toggleSidebar={toggleSidebar}\r\n                                open={sidebar}\r\n                                setDock={setDock}\r\n                            />\r\n                        </Suspense>\r\n                    )}\r\n                    <main ref={viewerRef} className={classes.content}>\r\n                        <Display\r\n                            setLoadingMsg={setLoadingMsg}\r\n                            viewport={viewport}\r\n                        />\r\n                    </main>\r\n                    {dockMode && (\r\n                        <Suspense fallback={null}>\r\n                            <Dock\r\n                                mode={dockMode}\r\n                                handleSelect={dockHandle.current}\r\n                                close={closeDock}\r\n                            />\r\n                        </Suspense>\r\n                    )}\r\n                </div>\r\n            )}\r\n        </>\r\n    );\r\n}\r\n\r\nexport default MainPage;\r\n","import { SettingsProvider } from \"context/SettingsContext\";\r\n\r\nimport { Route, HashRouter } from \"react-router-dom\";\r\nimport MainPage from \"MainPage\";\r\n\r\nimport \"styles/App.css\";\r\n\r\nfunction App() {\r\n    return (\r\n        <SettingsProvider>\r\n            <HashRouter>\r\n                <Route render={routeProps => <MainPage {...routeProps} />} />\r\n            </HashRouter>\r\n        </SettingsProvider>\r\n    );\r\n}\r\n\r\nexport const fbxSource = process.env.PUBLIC_URL;\r\n\r\nexport default App;\r\n","/**\r\n * @type {{ [id:string]: xyCoordinate }}\r\n */\r\nconst textureOffsets = {\r\n    c110345_03: [0.08, 0.15], // Summer Mitsuhide\r\n    c110313_03: [0, -0.025], // Summer Ieyasu\r\n    c100005_08: [0.05, -0.08], // Summer Alex\r\n    c100002_07: [0.05, -0.08], // Summer Elisanne\r\n    c100010_10: [0.05, -0.08], // Summer Mym\r\n    c110352_03: [0.05, -0.08], // Faeblessed Tobias\r\n    c110392_01: [0.05, -0.08], // Nino\r\n    c110391_01: [0.05, -0.08], // Isaac\r\n    c100029_04: [0.05, -0.08], // Sharpshooter Sarisse\r\n    c100045_01: [0.05, -0.08], // Gala Mascula\r\n    c110064_02: [0.05, -0.08], // Armored Yachiyo\r\n    c110389_01: [0.05, -0.08], // Saiga\r\n    c110285_01: [0.05, -0.08], // Grimnir\r\n    c110388_01: [0.05, -0.08], // Vania\r\n    c110385_01: [0.05, -0.08], // Humanoid Mercury\r\n    c100003_10: [0.05, -0.08], // Child Ranzal\r\n    c110386_01: [0.043, 0.05], // Myriam\r\n    c110387_01: [0.05, -0.08], // Humanoid Midgardsormr\r\n    c100031_03: [0.05, -0.08], // Alberius\r\n    c100007_07: [0.05, -0.08], // Gala Notte\r\n    c110384_01: [0.05, -0.08], // Eirene\r\n    c110383_01: [0.05, -0.08], // Finni\r\n    c110382_01: [0.05, -0.08], // Faris\r\n    c110381_01: [0.05, -0.08], // Ryszarda\r\n    c110342_03: [0.05, -0.08], // Valentine's Chelsea\r\n    c110377_01: [0.043, -0.08], // Joker\r\n    c110378_01: [0.043, -0.08], // Panther\r\n    c110379_01: [0.075, -0.08], // Mona\r\n    c110380_01: [0.043, -0.2], // Sophie\r\n    c100015_05: [0.05, -0.08], // Gala Chelle\r\n    c100006_11: [0.043, -0.0625], // Kimono Luca\r\n    c110376_01: [0.043, -0.0625], // Yoshitsune\r\n    c110375_01: [0.043, -0.0625], // Seimei\r\n    c110374_01: [0.043, -0.0625], // Kuzunoha\r\n    c110307_02: [0.043, 0], // Dragonyule Victor\r\n    c110252_02: [0.043, -0.0625], // Dragonyule Lily\r\n    c110296_02: [0.043, -0.0625], // Forager Mitsuba\r\n    c100004_17: [0.043, -0.0625], // Forager Cleo\r\n    c110371_01: [0.043, -0.0625], // Pecorine\r\n    c110350_02: [0.043, -0.0625], // Formal Joachim\r\n    c110340_02: [0.043, -0.0625], // Formal Noelle\r\n    c110018_02: [0.043, -0.0625], // Opera Karina\r\n    c110370_01: [0.043, -0.0625], // Lapis\r\n    c100015_04: [0.05, -0.08], // Chelle\r\n    c110342_01: [0, -0.02], // Chelsea\r\n    c110267_01: [0.08, -0.03], // Hawk\r\n    c110050_02: [0.07, 0.13], // HBerserker\r\n    c110291_01: [0.07, 0.14], // Marth\r\n    c110354_01: [0.07, 0.01], // Mega Man\r\n    c110345_01: [0.08, 0.15], // Mitsuhide\r\n    c110266_01: [0.01, 0.03], // Naveed\r\n    c110365_01: [0.043, -0.0625], // Nevin\r\n    c110346_01: [0.07, 0.08], // Nobunaga\r\n    c110366_01: [0.043, -0.0625], // Pinon\r\n    c110299_02: [0.07, 0.08], // RXZ\r\n    c110360_01: [0.07, 0.14], // Tiki\r\n    c110307_01: [0.08, -0.03], // Victor\r\n    c110322_01: [0.043, 0.08], // Zhu Bajie\r\n    c110356_01: [0.07, 0.08], // Gauld\r\n    c110300_01: [0.07, -0.1], // Pipple\r\n    c110344_01: [0.07, -0.02], // Yuya\r\n    c110053_03: [0.043, -0.0625], // INefi\r\n    c110368_01: [0.043, -0.0625], // Meene\r\n    c110367_01: [0.043, -0.0625], // Ilia\r\n    c110003_02: [0.043, -0.0625], // Gun Joe\r\n    c110270_02: [0.043, -0.0625], // HMelsa\r\n    c110341_03: [0.043, -0.0625], // Hakasha\r\n};\r\n\r\nexport default textureOffsets;\r\n\r\n/**\r\n * @type {{ [faceNumber: string]: xyCoordinate }}\r\n */\r\nexport const idxOffsets = {\r\n    face1: [2, 1],\r\n    face2: [0, 0],\r\n    face3: [1, 0],\r\n    face4: [2, 0],\r\n    face5: [3, 0],\r\n    face6: [0, -1],\r\n    face7: [1, -1],\r\n    face8: [2, -1],\r\n    face9: [3, -1],\r\n};\r\n","/**\r\n * @param {string} modelId\r\n * @return {Promise<ModelMod | undefined>}\r\n */\r\nexport const getDefaultModelMod = async modelId => {\r\n    const { default: modelMod } = await import(\r\n        /* webpackChunkName: \"ModelMod\" */\r\n        \"data/modelMod\"\r\n    );\r\n    return modelMod[modelId]?.[0];\r\n};\r\n\r\n/**\r\n * @param {string} id\r\n * @param {string} modName\r\n * @return {Promise<ModelMod>}\r\n */\r\nexport const getModelModByName = async (id, modName) => {\r\n    const { default: modelMod } = await import(\r\n        /* webpackChunkName: \"ModelMod\" */\r\n        \"data/modelMod\"\r\n    );\r\n    const result = modelMod[id]?.find(\r\n        ({ name }) => name.replace(\" \", \"\") === modName\r\n    );\r\n\r\n    return result || { name: \"\", code: \"\" };\r\n};\r\n","/**\r\n * @type { Array<{ name: string, path: string }> }\r\n */\r\nconst matcapList = [\r\n    { name: \"Black Stone\", path: \"matcap_black_stone.jpg\" },\r\n    { name: \"Chrome 1\", path: \"matcap_chrome_1.jpg\" },\r\n    { name: \"Chrome 2\", path: \"matcap_chrome_2.jpg\" },\r\n    { name: \"Brown Clay\", path: \"matcap_clay_brown.jpg\" },\r\n    { name: \"Dark Brown Clay\", path: \"matcap_clay_dark_brown.jpg\" },\r\n    { name: \"Flesh Clay\", path: \"matcap_clay_flesh_6.jpg\" },\r\n    { name: \"Gray Clay\", path: \"matcap_clay_gray.jpg\" },\r\n    { name: \"Metal Putty\", path: \"matcap_metal_putty.jpg\" },\r\n    { name: \"Obsidian\", path: \"matcap_obsidian.jpg\" },\r\n    { name: \"Pearl\", path: \"matcap_pearl.jpg\" },\r\n    { name: \"Yellow Plastic\", path: \"matcap_plastic_yellow.jpg\" },\r\n    { name: \"Sci-fi Plastic\", path: \"matcap_scifi_plastic.jpg\" },\r\n    { name: \"Rim Lit\", path: \"matcap_rim_lit.jpg\" },\r\n    { name: \"Slick Mud\", path: \"matcap_slick_mud.jpg\" },\r\n    { name: \"Shiny Metal\", path: \"metal_shiny.jpg\" },\r\n];\r\n\r\nexport default matcapList;\r\n","import * as THREE from \"three\";\r\nimport { fbxSource } from \"App\";\r\nimport { nanoid } from \"nanoid\";\r\n\r\nimport textureOffsets, { idxOffsets } from \"data/face_offset\";\r\nimport matcapList from \"data/matcapList\";\r\n\r\nimport { FBXLoader } from \"three/examples/jsm/loaders/FBXLoader\";\r\nimport { callbackOnEach, getUpdated } from \"helpers/helpers\";\r\nimport {\r\n    matCommonParams,\r\n    matExtraParams,\r\n    matColorParams,\r\n    needsUpdateParams,\r\n    matcapDir,\r\n} from \"helpers/consts\";\r\n\r\n/** load a 3D model\r\n * @param {string} url\r\n * @return { ?Promise<THREE.Group>}\r\n */\r\nexport const loadModel = url => {\r\n    return (\r\n        url &&\r\n        new Promise(resolve => {\r\n            new FBXLoader().load(url, resolve);\r\n        })\r\n    );\r\n};\r\n\r\n/** Load a texture\r\n * @param {string} url\r\n * @return {Promise<THREE.Texture>}\r\n */\r\nexport const loadTexture = url => {\r\n    return (\r\n        url &&\r\n        new Promise(resolve => {\r\n            new THREE.TextureLoader().load(url, resolve);\r\n        })\r\n    );\r\n};\r\n\r\n/**\r\n * @param {string} name\r\n */\r\nconst getMatcapPath = name => {\r\n    const matcap = matcapList.find(e => e.name === name);\r\n    return matcap?.path ? `${matcapDir}/${matcap.path}` : null;\r\n};\r\n\r\n/** load matcap texture\r\n * @param {string} name\r\n * @return {null | Promise< THREE.Texture >}\r\n */\r\nexport const loadMatcap = name => {\r\n    const path = getMatcapPath(name);\r\n    return path ? loadTexture(path) : null;\r\n};\r\n\r\n/** get the path to the animation file\r\n * @param {string} name\r\n */\r\nconst getAniPath = name => `${fbxSource}/animations/${name}.json`;\r\n\r\n/** load a single animation\r\n * @param {AniListItem} aniListItem\r\n * @return {Promise<THREE.AnimationClip>}\r\n */\r\nconst loadSingleAni = ({ aniName }) => {\r\n    const path = getAniPath(aniName);\r\n    return new Promise(resolve =>\r\n        fetch(path)\r\n            .then(response => response.json())\r\n            .then(json => THREE.AnimationClip.parse(json))\r\n            .then(resolve)\r\n    );\r\n};\r\n\r\n/** Load all animations in a list of animation\r\n * @param {AniList} aniList\r\n */\r\nexport const loadAnimations = aniList =>\r\n    Promise.all(aniList.map(loadSingleAni));\r\n\r\n/** get all meshes of a 3D object\r\n * @param {THREE.Group} object\r\n * @param {Boolean} getOutline - whether to include outline meshes\r\n * @returns {Array}\r\n */\r\nexport const getMeshes = (object, getOutline = false) => {\r\n    if (!object) return [];\r\n\r\n    const meshes = [];\r\n    object.traverse(child => {\r\n        // @ts-ignore\r\n        if (!child.isMesh) return;\r\n        if (!getOutline && child.name === \"outline\") return;\r\n\r\n        meshes.unshift(child);\r\n    });\r\n    return meshes;\r\n};\r\n\r\n/** get all materials of a 3D object\r\n * @param {THREE.Group} object\r\n */\r\nexport const getMaterial = object => {\r\n    if (!object) return [];\r\n\r\n    const meshes = getMeshes(object);\r\n    const materials = meshes.flatMap(mesh => mesh.material);\r\n    return materials;\r\n};\r\n\r\n/** get the path to the model's fbx file\r\n * @param {string} id\r\n */\r\nexport const getModelPath = id => `${fbxSource}/fbx/${id}/${id}.fbx`;\r\n\r\n/** get the path to the model's texture file\r\n * @param {string} id\r\n */\r\nexport const getTexturePath = id => `${fbxSource}/fbx/${id}/${id}.png`;\r\n\r\n/** get weapon data from weapon code\r\n * @param {string} code\r\n * @return {AdvWeaponData}\r\n */\r\nexport const analyzeWeaponCode = code => {\r\n    if (!code) return null;\r\n\r\n    const flipped = code.endsWith(\"b\");\r\n    const weaponCode = code.substring(0, code.length - 1);\r\n    const modelPath = getModelPath(weaponCode);\r\n    const texturePath = getTexturePath(weaponCode);\r\n\r\n    return { modelPath, texturePath, flipped };\r\n};\r\n\r\n/** dispose a 3D object */\r\nexport const dispose3dObject = object => {\r\n    if (!object) return;\r\n\r\n    const disposedList = new Set();\r\n\r\n    const notDisposed = object => !disposedList.has(object.uuid);\r\n\r\n    const needToDispose = object => object && notDisposed(object);\r\n\r\n    const disposeObject = object => {\r\n        disposedList.add(object.uuid);\r\n        object.dispose();\r\n    };\r\n\r\n    const dispose = object => {\r\n        if (needToDispose(object)) disposeObject(object);\r\n    };\r\n\r\n    const disposeMaterial = object => {\r\n        callbackOnEach(object.material, mat => {\r\n            dispose(mat.map);\r\n            dispose(mat.userData.backupMap);\r\n            dispose(mat);\r\n        });\r\n    };\r\n\r\n    const disposeMesh = mesh => {\r\n        disposeMaterial(mesh);\r\n        dispose(mesh.geometry);\r\n    };\r\n\r\n    const meshes = getMeshes(object, true);\r\n    meshes.forEach(disposeMesh);\r\n};\r\n\r\n/** get list of parameter names relevant to a material type\r\n * @param {string} matType\r\n */\r\nexport const getParamsList = matType => [\r\n    ...matCommonParams,\r\n    ...matExtraParams[matType],\r\n];\r\n\r\n/** Hide all eye and mouth that's not mEye_01 or mMouth_01 */\r\nexport const initDragonFace = model => {\r\n    const nameRegex = /m[A-Z].*_[0-9]/m;\r\n    model.traverse(child => {\r\n        if (!child.isMesh) return;\r\n\r\n        const { name } = child;\r\n        if (nameRegex.test(name)) {\r\n            child.visible = name.includes(\"01\");\r\n        }\r\n    });\r\n};\r\n\r\n/** get all eye meshes of a dragon model */\r\nexport const getDragonEye = model => {\r\n    const eyes = [];\r\n    const nameRegex = /mEye_[0-9]/m;\r\n    model.traverse(child => {\r\n        if (!child.isMesh) return;\r\n\r\n        const { name } = child;\r\n        if (nameRegex.test(name)) {\r\n            eyes.push(child);\r\n        }\r\n    });\r\n    return eyes;\r\n};\r\n\r\n/** get all mouth meshes of a dragon model */\r\nexport const getDragonMouth = model => {\r\n    const mouths = [];\r\n    const nameRegex = /mMouth_[0-9]/m;\r\n    model.traverse(child => {\r\n        if (!child.isMesh) return;\r\n\r\n        const { name } = child;\r\n        if (nameRegex.test(name)) {\r\n            mouths.push(child);\r\n        }\r\n    });\r\n    return mouths;\r\n};\r\n\r\n/** make all effect meshes of the model invisible\r\n * @param {THREE.Group} model\r\n */\r\nexport const removeEffects = model => {\r\n    const meshes = getMeshes(model);\r\n    meshes.forEach(mesh => (mesh.visible = !mesh.name.includes(\"Eff\")));\r\n};\r\n\r\n/** set frustumCulled = false for all children of a model */\r\nexport const disableFrustumCulling = model => {\r\n    model.traverse(child => {\r\n        if (!child.isMesh) return;\r\n\r\n        child.frustumCulled = false;\r\n    });\r\n};\r\n\r\n/** create a new material\r\n * @param {string} materialType - type of material to create\r\n * @param {Object} params\r\n * @param {THREE.Texture} params.map - texture for new material\r\n * @param {Boolean} params.skinning\r\n * @return {THREE.Material}\r\n */\r\nconst createNewMaterial = (materialType, params) => {\r\n    const matType = `Mesh${materialType}Material`;\r\n    return new THREE[matType](params);\r\n};\r\n\r\n/** change material and optionally the texture of a 3D object\r\n * @param {THREE.Group} target - object to apply change to\r\n * @param {object} params - parameters\r\n * @param {string} params.materialType - type of material to change to\r\n * @param {string} [params.texturePath] - path to texture file\r\n * @param {boolean} [params.forced] - force material change\r\n */\r\nexport const changeMaterial = (\r\n    target,\r\n    { materialType, texturePath = \"\", forced = false }\r\n) => {\r\n    if (!target) return;\r\n\r\n    const meshes = getMeshes(target);\r\n    meshes.forEach(mesh => {\r\n        const materials = [mesh.material].flat();\r\n        const matIsArray = Array.isArray(mesh.material);\r\n\r\n        if (!forced && !texturePath) {\r\n            const checkParam = `isMesh${materialType}Material`;\r\n            const needToChange = materials.some(mat => !mat[checkParam]);\r\n            if (!needToChange) return;\r\n        }\r\n\r\n        materials.forEach((mat, i) => {\r\n            /**\r\n             * @type {THREE.Texture}\r\n             */\r\n            const texture = texturePath\r\n                ? new THREE.TextureLoader().load(texturePath)\r\n                : materials[i].map;\r\n\r\n            if (texturePath) texture.encoding = THREE.sRGBEncoding;\r\n\r\n            const initParams = {\r\n                map: texture,\r\n                skinning: true,\r\n            };\r\n            const newMaterial = createNewMaterial(materialType, initParams);\r\n            newMaterial.name = mat.name;\r\n            if (mat.userData.backupMap) {\r\n                newMaterial.userData.backupMap = mat.userData.backupMap;\r\n            }\r\n\r\n            if (texturePath) {\r\n                mat.map?.dispose?.();\r\n                mat.userData.backupMap?.dispose?.();\r\n            }\r\n            mat.dispose();\r\n\r\n            if (matIsArray) {\r\n                mesh.material[i] = newMaterial;\r\n            } else {\r\n                mesh.material = newMaterial;\r\n            }\r\n        });\r\n    });\r\n};\r\n\r\n/** Add outline to object and return reference to outlines\r\n * @param {THREE.Group} object\r\n * @param {OutlineParams} params\r\n */\r\nexport const createOutline = async (object, params) => {\r\n    if (!object) return;\r\n\r\n    const outlines = [];\r\n    const outlineMaterial = await createOutlineMaterial(params);\r\n\r\n    /** if a mesh's name includes any word in this list, skip */\r\n    const skipList = [\"Eff\", \"Extension\"];\r\n    const meshes = getMeshes(object);\r\n    meshes.forEach(mesh => {\r\n        const { name } = mesh;\r\n        if (skipList.some(word => name.includes(word))) return;\r\n\r\n        const outline = mesh.clone();\r\n\r\n        replaceMaterial(outline, outlineMaterial);\r\n        outline.visible = params.enable;\r\n        outline.name = \"outline\";\r\n\r\n        if (mesh.isSkinnedMesh) {\r\n            outline.bind(mesh.skeleton, mesh.bindMatrix);\r\n        }\r\n        mesh.add(outline);\r\n        outlines.push(outline);\r\n    });\r\n    return outlines;\r\n};\r\n\r\n/**\r\n * @param {string} url\r\n * @return {Promise<string>}\r\n */\r\nconst loadRawText = async url =>\r\n    new Promise(resolve => {\r\n        fetch(url)\r\n            .then(response => response.text())\r\n            .then(resolve);\r\n    });\r\n\r\n/**\r\n * @param {string} dir - shader directory\r\n * @param {string} name - shader name\r\n * @return {Promise<[ vertexShader: string, fragmentShader: string ]>}\r\n */\r\nconst loadShaderFiles = async (dir, name) => {\r\n    const filePaths = [`${dir}/${name}.vert`, `${dir}/${name}.frag`];\r\n\r\n    // @ts-ignore\r\n    return Promise.all(filePaths.map(loadRawText));\r\n};\r\n\r\n/**\r\n * @param {string} name - name of the shader\r\n * @return {Promise<[ vertexShader: string, fragmentShader: string ]>}\r\n */\r\nconst loadShader = async name => {\r\n    const shaderDir = `${process.env.PUBLIC_URL}/shaders/${name}`;\r\n\r\n    return loadShaderFiles(shaderDir, name);\r\n};\r\n\r\n/** create outline material\r\n * @param {OutlineParams} params\r\n */\r\nconst createOutlineMaterial = async ({ size, color, opacity }) => {\r\n    const uniforms = {\r\n        size: { value: size },\r\n        color: { value: new THREE.Color(color) },\r\n        opacity: { value: opacity },\r\n    };\r\n\r\n    const [vertexShader, fragmentShader] = await loadShader(\"outline\");\r\n\r\n    const outlineMaterial = new THREE.ShaderMaterial({\r\n        side: THREE.BackSide,\r\n        transparent: true,\r\n        depthFunc: THREE.LessDepth,\r\n        vertexShader,\r\n        fragmentShader,\r\n        uniforms,\r\n    });\r\n\r\n    return outlineMaterial;\r\n};\r\n\r\n/** apply settings to an outline mesh\r\n * @param {THREE.Mesh} outline\r\n * @param {Map<string, *>} settings\r\n */\r\nexport const applyOutlineSettings = (outline, settings) => {\r\n    if (!outline || !settings) return;\r\n\r\n    const { material } = outline;\r\n    settings.forEach((value, key) => {\r\n        switch (key) {\r\n            case \"enable\":\r\n                outline.visible = value;\r\n                break;\r\n            case \"color\":\r\n                callbackOnEach(\r\n                    material,\r\n                    mat => (mat.uniforms.color.value = new THREE.Color(value))\r\n                );\r\n                break;\r\n            default:\r\n                callbackOnEach(\r\n                    material,\r\n                    mat => (mat.uniforms[key].value = value)\r\n                );\r\n        }\r\n    });\r\n};\r\n\r\n/** replace material of an object */\r\nconst replaceMaterial = (object, newMaterial) => {\r\n    const { material } = object;\r\n    // dispose old material\r\n    callbackOnEach(material, mat => {\r\n        mat.map?.dispose?.();\r\n        mat.userData.backupMap?.dispose?.();\r\n        mat.dispose();\r\n    });\r\n    // apply new material\r\n    const matIsArray = Array.isArray(object.material);\r\n    object.material = matIsArray\r\n        ? new Array(object.material.length).fill(newMaterial)\r\n        : newMaterial;\r\n};\r\n\r\n/** calculate the difference between 2 face texture files\r\n * @param {string} currentTexture\r\n * @param {string} prevTexture\r\n * @return {xyCoordinate}\r\n */\r\nexport const calculateTextureOffset = (currentTexture, prevTexture) => {\r\n    const offset = { x: 0, y: 0 };\r\n    if (currentTexture !== prevTexture) {\r\n        const [prevOffsetX, prevOffsetY] = textureOffsets[prevTexture] || [\r\n            0, 0,\r\n        ];\r\n        const [currentOffsetX, currentOffsetY] = textureOffsets[\r\n            currentTexture\r\n        ] || [0, 0];\r\n\r\n        offset.x = currentOffsetX - prevOffsetX;\r\n        offset.y = currentOffsetY - prevOffsetY;\r\n    }\r\n    return [offset.x, offset.y];\r\n};\r\n\r\n/** calculate the difference between 2 face index\r\n * @param {number} currentIdx\r\n * @param {number} prevIdx\r\n * @return {xyCoordinate}\r\n */\r\nexport const calculateIdxOffset = (currentIdx, prevIdx) => {\r\n    const offset = { x: 0, y: 0 };\r\n    if (currentIdx !== prevIdx) {\r\n        const [prevOffsetX, prevOffsetY] = idxOffsets[`face${prevIdx}`];\r\n        const [currentOffsetX, currentOffsetY] =\r\n            idxOffsets[`face${currentIdx}`];\r\n\r\n        offset.x = currentOffsetX - prevOffsetX;\r\n        offset.y = currentOffsetY - prevOffsetY;\r\n    }\r\n    return [offset.x, offset.y];\r\n};\r\n\r\n/** generate offset applying functions\r\n * @param {string} part - part to apply offset\r\n */\r\nconst applyOffset = part => (target, offset) => {\r\n    const [offsetX, offsetY] = offset;\r\n    target.traverse(child => {\r\n        if (!child.isMesh) return;\r\n\r\n        const targetGroup = child.geometry.groups?.find(\r\n            group => child.material[group.materialIndex]?.name === `mt${part}CH`\r\n        );\r\n        if (!targetGroup) return;\r\n\r\n        const { start, count } = targetGroup;\r\n        const end = start + count;\r\n        const uv = child.geometry.attributes.uv;\r\n        for (let i = start; i < end; i++) {\r\n            const u = uv.getX(i) + 0.25 * offsetX;\r\n            const v = uv.getY(i) + 0.25 * offsetY;\r\n            uv.setXY(i, u, v);\r\n        }\r\n        uv.needsUpdate = true;\r\n    });\r\n};\r\n\r\nexport const applyEyeOffset = applyOffset(\"Eye\");\r\nexport const applyMouthOffset = applyOffset(\"Mouth\");\r\n// export const applyBodyOffset = applyOffset(\"BodyAll\");\r\n\r\n/** generate texture applying functions\r\n * @param {string} part - part to apply offset\r\n */\r\nconst applyTexture =\r\n    part =>\r\n    (target, { materialType, textureId }) => {\r\n        const texturePath = getTexturePath(textureId);\r\n        const texture = new THREE.TextureLoader().load(texturePath);\r\n        texture.encoding = THREE.sRGBEncoding;\r\n\r\n        const materialParams = {\r\n            map: texture,\r\n            skinning: true,\r\n        };\r\n        const newMaterial = createNewMaterial(materialType, materialParams);\r\n        target.traverse(child => {\r\n            if (child.name !== \"mBodyAll\" || child.geometry.groups.length !== 3)\r\n                return;\r\n\r\n            const targetGroup = child.geometry.groups.find(\r\n                group =>\r\n                    child.material[group.materialIndex].name === `mt${part}CH`\r\n            );\r\n            if (!targetGroup) return;\r\n\r\n            const { materialIndex } = targetGroup;\r\n            const oldMaterial = child.material[materialIndex];\r\n            newMaterial.name = oldMaterial.name;\r\n\r\n            child.material[materialIndex] = newMaterial;\r\n        });\r\n    };\r\n\r\nexport const applyEyeTexture = applyTexture(\"Eye\");\r\nexport const applyMouthTexture = applyTexture(\"Mouth\");\r\n// export const applyBodyTexture = applyTexture(\"BodyAll\");\r\n\r\n/** get animation modifiers from a list of modifiers\r\n * @param {Array<string>} modList\r\n * @return {AniModifier} object containing values to modify animation\r\n */\r\nconst getAniModifiers = modList => {\r\n    /**\r\n     * @type {FaceChangeArray}\r\n     */\r\n    const faceChanges = [];\r\n    let timeScale = 1,\r\n        repetitions = 1;\r\n\r\n    modList.forEach(mod => {\r\n        const [key, value] = mod.split(\"=\");\r\n        if (key === \"ts\") {\r\n            timeScale = parseFloat(value);\r\n        }\r\n        if (key === \"r\") {\r\n            repetitions = parseInt(value);\r\n        }\r\n        if (key.includes(\"-\")) {\r\n            const [part, time] = key.split(\"-\");\r\n            const faceMod = { time: parseFloat(time) };\r\n            const indexName = `${part === \"e\" ? \"eye\" : \"mouth\"}Idx`;\r\n            faceMod[indexName] = value;\r\n            faceChanges.push(faceMod);\r\n        }\r\n    });\r\n\r\n    return {\r\n        timeScale,\r\n        repetitions,\r\n        faceChanges: processFaceChanges(faceChanges),\r\n    };\r\n};\r\n\r\n/** get animation data from single animation code\r\n * @param {string} code - single animation code\r\n * @return {AniListItem}\r\n */\r\nconst getAniData = code => {\r\n    const [aniName, ...modList] = code.split(\"&\");\r\n    const modifiers = getAniModifiers(modList);\r\n    return { aniName, ...modifiers };\r\n};\r\n\r\n/** turn chain animation code to a list of animation name and modifiers\r\n * @param {string} code\r\n * @return {AniList}\r\n */\r\nexport const analyzeChainCode = code => {\r\n    if (!code) return [];\r\n\r\n    const aniCodes = code.split(\">\");\r\n    const aniList = aniCodes.map(getAniData);\r\n\r\n    return aniList;\r\n};\r\n\r\n/** simplify and sort a face change array\r\n * @param {FaceChangeArray} faceChanges\r\n * @return {FaceChangeArray} simplified and sorted face change array\r\n */\r\nexport const processFaceChanges = faceChanges => {\r\n    if (!faceChanges.length) return faceChanges;\r\n\r\n    const sorted = faceChanges.sort((a, b) => a.time - b.time);\r\n    const timeStamps = new Set(faceChanges.map(change => change.time));\r\n    if (faceChanges.length === timeStamps.size) {\r\n        sorted.forEach(change => {\r\n            change.id = nanoid();\r\n        });\r\n        return sorted;\r\n    }\r\n\r\n    /**\r\n     * @type {FaceChangeArray}\r\n     */\r\n    const simplified = [];\r\n    timeStamps.forEach(time => {\r\n        let output = { time, id: nanoid(), eyeIdx: NaN, mouthIdx: NaN };\r\n        const changes = sorted.filter(change => change.time === time);\r\n        changes.forEach(change => (output = Object.assign(output, change)));\r\n        simplified.push(output);\r\n    });\r\n    return simplified;\r\n};\r\n\r\n/** extend face change array if repetitions > 1\r\n * @param {FaceChangeArray} faceChanges - face change array\r\n * @param {number} repetitions - number of repetitions\r\n * @return {FaceChangeArray} extended face change array\r\n */\r\nexport const getFaceChangesQueue = (faceChanges, repetitions) => {\r\n    if (!faceChanges) return [];\r\n    if (repetitions === 1) return [...faceChanges];\r\n    // [0, 100, 200,...]\r\n    const timeOffset = new Array(repetitions).fill().map((_, i) => i * 100);\r\n\r\n    /** offset the time of the whole face change array\r\n     * @param {number} offset\r\n     * @return {FaceChangeArray} offsetted array\r\n     */\r\n    const offsetFaceChanges = offset =>\r\n        faceChanges.map(({ time, id, ...others }) => ({\r\n            ...others,\r\n            time: time + offset,\r\n        }));\r\n\r\n    return timeOffset.flatMap(offsetFaceChanges);\r\n};\r\n\r\n/** convert animation chain code to AnimationChain\r\n * @param {string} code - animation chain code\r\n * @param {string} name - animation name\r\n * @return {AnimationChain}\r\n */\r\nexport const chainCodeToList = (code, name) => {\r\n    const aniList = analyzeChainCode(code);\r\n    const length = aniList.length;\r\n    const output = aniList.map((ani, i) => {\r\n        const { aniName, timeScale, repetitions, faceChanges } = ani;\r\n        const partName = name.concat(length > 1 ? `#${i + 1}` : \"\");\r\n        /**\r\n         * @type {AniChainItem}\r\n         */\r\n        const listItem = {\r\n            name: partName,\r\n            id: nanoid(),\r\n            aniName,\r\n            timeScale,\r\n            repetitions,\r\n            faceChanges,\r\n        };\r\n        return listItem;\r\n    });\r\n    return output;\r\n};\r\n\r\n/** create gradient map for toon material\r\n * @param {number} nTones - number of tones\r\n */\r\nexport const createGradientMap = nTones => {\r\n    const colors = new Uint8Array(nTones).map((_, i) => (i * 256) / nTones);\r\n    const map = new THREE.DataTexture(colors, nTones, 1, THREE.LuminanceFormat);\r\n    map.minFilter = THREE.NearestFilter;\r\n    map.magFilter = THREE.NearestFilter;\r\n    map.generateMipmaps = false;\r\n\r\n    return map;\r\n};\r\n\r\n/** apply a parameter change to all material of input array\r\n * @param {Array} materials - array of materials\r\n * @param {[paramName: string, value:*]} param parameters to apply\r\n */\r\nexport const applyMaterialParam = (materials, param) => {\r\n    const [key, value] = param;\r\n    let handler;\r\n    const needsUpdate = needsUpdateParams.includes(key);\r\n\r\n    switch (key) {\r\n        case \"gradientMap\":\r\n            const nTones = parseInt(value);\r\n            const newMap = nTones ? createGradientMap(nTones) : null;\r\n            handler = mat => (mat.gradientMap = newMap);\r\n            break;\r\n        case \"useTexture\":\r\n            handler = value\r\n                ? mat => {\r\n                      mat.map = mat.userData.backupMap;\r\n                      mat.userData.backupMap = null;\r\n                  }\r\n                : mat => {\r\n                      if (mat.map) mat.userData.backupMap = mat.map;\r\n                      mat.map = null;\r\n                  };\r\n            break;\r\n        case \"matcap\":\r\n            const matcapPromise = loadMatcap(value);\r\n            handler = mat => {\r\n                matcapPromise.then(matcap => {\r\n                    mat.matcap = matcap;\r\n                    mat.needsUpdate = true;\r\n                });\r\n            };\r\n            break;\r\n        default:\r\n            const isColor = matColorParams.includes(key);\r\n            handler = mat =>\r\n                (mat[key] = isColor ? new THREE.Color(value) : value);\r\n    }\r\n\r\n    materials.forEach(mat => {\r\n        handler(mat);\r\n        mat.needsUpdate = needsUpdate;\r\n    });\r\n};\r\n\r\n/** update model's material parameters\r\n * @param {THREE.Group} model\r\n * @param {{ prevParams?: {}, params: {} }} data\r\n */\r\nexport const updateMatParams = (model, { prevParams = {}, params }) => {\r\n    const materials = getMaterial(model);\r\n    const updated = getUpdated(prevParams, params);\r\n    updated.forEach(update => applyMaterialParam(materials, update));\r\n};\r\n\r\n/** create light from params\r\n * @param {LightParam} params\r\n * @return {THREE.Light}\r\n */\r\nexport const createLight = params => {\r\n    const { type, color, intensity, ...others } = params;\r\n\r\n    const constructor = `${type}Light`;\r\n    const light = new THREE[constructor](color, intensity);\r\n\r\n    for (const [key, value] of Object.entries(others)) {\r\n        if (key === \"position\") {\r\n            const setValue = value.map(v => v || 0);\r\n            light.position.set(...setValue);\r\n            continue;\r\n        }\r\n        light[key] = value;\r\n    }\r\n\r\n    return light;\r\n};\r\n\r\n/** replace model's old texture with a new texture from provided path\r\n * @param {THREE.Group} target - object to replace texture\r\n * @param {Object} params\r\n * @param {string} params.oldTexture - name of texture to be replaced\r\n * @param {string} params.texturePath - path to new texture file\r\n */\r\nexport const replaceTexture = async (target, { oldTexture, texturePath }) => {\r\n    const newTexture = await loadTexture(texturePath);\r\n    newTexture.encoding = THREE.sRGBEncoding;\r\n\r\n    const material = getMaterial(target);\r\n    material.forEach(mat => {\r\n        const textureName = mat.map?.name;\r\n        if (textureName?.includes(oldTexture)) {\r\n            mat.map?.dispose?.();\r\n            mat.map = newTexture;\r\n        }\r\n    });\r\n};\r\n\r\n/**\r\n * @param {string} modCode\r\n */\r\nconst analyzeModelModCode = modCode => {\r\n    const output = {};\r\n    const cmds = modCode.split(\";\").map(str => str.trim());\r\n\r\n    cmds.forEach(cmd => {\r\n        const [opcode, ...args] = cmd.split(\" \");\r\n        const outArgs = args.join(\"\").split(\",\");\r\n        output[opcode] = outArgs;\r\n    });\r\n\r\n    return output;\r\n};\r\n\r\n/** apply modifier code to a 3D model\r\n * @param {THREE.Group} target - model to apply\r\n * @param {string} modCode - code to apply\r\n */\r\nexport const applyMod = (target, modCode) => {\r\n    if (!modCode) return;\r\n\r\n    const meshes = getMeshes(target);\r\n    const { show, hide } = analyzeModelModCode(modCode);\r\n\r\n    meshes.forEach(mesh => {\r\n        if (hide?.includes(mesh.name)) {\r\n            mesh.visible = false;\r\n            const outline = mesh.children?.find?.(\r\n                ({ name }) => name === \"outline\"\r\n            );\r\n            outline && (outline.visible = false);\r\n        }\r\n        if (show?.includes(mesh.name)) {\r\n            mesh.visible = true;\r\n            const outline = mesh.children?.find?.(\r\n                ({ name }) => name === \"outline\"\r\n            );\r\n            outline && (outline.visible = true);\r\n        }\r\n    });\r\n};\r\n\r\n/** log the updated values to console\r\n * @param {{ }} prev - previous state\r\n * @param {{ }} current - current state\r\n */\r\nexport const logUpdate = (prev, current) => {\r\n    const updated = getUpdated(prev, current);\r\n    updated.forEach(([key, value]) => {\r\n        const oldValue = prev[key];\r\n        const subkeys = Object.keys(value);\r\n\r\n        const isSingleValue = subkeys.length === 0 || typeof value === \"string\";\r\n        if (isSingleValue) {\r\n            console.log(\r\n                `${key}: ${JSON.stringify(oldValue)} to ${JSON.stringify(\r\n                    value\r\n                )}`\r\n            );\r\n            return;\r\n        }\r\n        subkeys.forEach(subkey => {\r\n            if (oldValue[subkey] === value[subkey]) return;\r\n\r\n            console.log(\r\n                `${key}.${subkey}: ${JSON.stringify(\r\n                    oldValue[subkey]\r\n                )} to ${JSON.stringify(value[subkey])}`\r\n            );\r\n        });\r\n    });\r\n};\r\n","import { isDragon, isCharaWithAni } from \"../helpers\";\r\nimport { DEFAULT_ADV_ANI, incompatibleModels } from \"../consts\";\r\n\r\n/** get the default animation code base on model ID\r\n * @param {string} modelId\r\n * @return {Promise<string | undefined>}\r\n */\r\nexport const getDefaultAni = async modelId => {\r\n    if (isDragon(modelId)) return getDefaultDragonAni(modelId);\r\n\r\n    if (modelId.startsWith(\"h\") || incompatibleModels.has(modelId))\r\n        return getDefaultEnemyAni(modelId);\r\n\r\n    if (isCharaWithAni(modelId)) return DEFAULT_ADV_ANI;\r\n\r\n    return \"\";\r\n};\r\n\r\n/**\r\n * @param {string} modelId\r\n * @return {Promise<string | undefined>}\r\n */\r\nconst getDefaultDragonAni = async modelId => {\r\n    const { default: dragonAni } = await import(\r\n        /* webpackChunkName: \"aniDragon\" */\r\n        \"data/aniDragon\"\r\n    );\r\n\r\n    return dragonAni[modelId]?.[0].code;\r\n};\r\n\r\n/**\r\n * @param {string} modelId\r\n * @return {Promise<string | undefined>}\r\n */\r\nconst getDefaultEnemyAni = async modelId => {\r\n    const { default: enemyAni } = await import(\r\n        /* webpackChunkName: \"aniEnemies\" */\r\n        \"data/aniEnemies\"\r\n    );\r\n\r\n    return enemyAni[modelId]?.[0].code;\r\n};\r\n\r\nexport default getDefaultAni;\r\n","/** default camera coordinates\r\n * @type {{ [key: string]: xyzCoordinate }}\r\n */\r\nexport const cameraPositions = {\r\n    c: [0, 0.5, 1.5],\r\n    d: [0, 1.5, 6],\r\n    w: [2, 0, 0],\r\n    b: [1, 0.5, 6],\r\n    e: [1, 1, 4],\r\n    h: [0, 1, 4],\r\n    o: [0, 0.5, 8],\r\n    r: [3, 3, 20],\r\n\r\n    c100034_01: [0, 0.5, 1.75],\r\n    c110379_01: [0, 0.75, 2],\r\n    d200017_01: [0, 1, 4],\r\n    d210001_01: [0, 1, 4],\r\n    d210002_01: [0, 1, 4],\r\n    d210003_01: [0, 1, 4],\r\n    d210004_01: [0, 1, 4],\r\n    d210005_01: [0, 1, 4],\r\n    d210020_01: [0, 2, 6],\r\n    d210038_01: [0, 1, 4],\r\n    d210039_01: [0, 1, 4],\r\n    d210040_01: [0, 1, 4],\r\n    d210041_01: [0, 1, 4],\r\n    d210042_01: [0, 1, 4],\r\n    d210048_01: [0, 2, 8],\r\n    d210052_01: [0, 2, 8],\r\n    d210054_01: [0, 1.5, 6],\r\n    d210072_01: [0, 1, 4],\r\n    d210076_01: [0, 2, 6],\r\n    d210077_01: [0, 2, 6],\r\n    d210078_01: [0, 6, 20],\r\n    d210079_01: [0, 2, 6],\r\n    d210081_01: [0, 2, 6],\r\n    d210082_01: [0, 1.5, 4],\r\n    d210087_01: [0, 2, 6],\r\n    d210093_01: [0, 1, 3],\r\n    d210094_01: [0, 1.5, 6],\r\n    d210095_01: [0, 1, 4],\r\n    d210102_01: [0, 2, 6],\r\n    d210103_01: [0, 4, 8],\r\n    d210104_01: [0, 1, 4],\r\n    d210109_01: [0, 1, 4],\r\n    d210111_01: [0, 0.5, 1.5],\r\n    d210112_01: [0, 4, 8],\r\n    d210113_01: [0, 1, 4],\r\n    d210114_01: [0, 6, 20],\r\n    d210115_01: [0, 2, 4],\r\n    d210116_01: [0, 2, 6],\r\n    d210117_01: [0, 2, 6],\r\n    d210118_01: [0, 1, 2],\r\n    d210123_01: [0, 3, 9],\r\n    d210125_01: [0, 1.5, 5],\r\n    d210126_01: [0, 2, 8],\r\n    d210127_01: [0, 0.5, 1.5],\r\n    d210128_01: [0, 0.5, 1.5], // Puppy\r\n    d210133_01: [0, 0.5, 1.5],\r\n    d210146_01: [0, 0.5, 1.5],\r\n    d210136_01: [0, 6, 20],\r\n    d210142_01: [0, 2, 4],\r\n    d210147_01: [0, 1.5, 6.5],\r\n    d210152_01: [0, 1.5, 4],\r\n\r\n    h0010001: [6, 0.5, 8],\r\n    h0010001_02: [2, 0, 0],\r\n    h0040101: [1, 0.5, 4],\r\n    h0080501: [0, 2, 5],\r\n    h0090501: [0, 2, 5],\r\n    h0100301: [0, 1.5, 4],\r\n    h0110401: [0, 3.5, 12],\r\n    r0070401: [30, 30, 100],\r\n    r0070501: [30, 30, 100],\r\n    r0080401: [1, 2, 5],\r\n\r\n    smith: [1, 1, 2],\r\n};\r\n\r\nexport default cameraPositions;\r\n","import { useState, useCallback } from \"react\";\r\n\r\n/** custom hook for a boolean state\r\n * @param {Boolean} initVal - initial value, default is false\r\n * @return {[state: Boolean, toggleFunction: Function]}\r\n */\r\nfunction useToggleState(initVal = false) {\r\n    const [state, setState] = useState(initVal);\r\n    const toggleState = useCallback(() => {\r\n        setState(state => !state);\r\n    }, [setState]);\r\n    return [state, toggleState];\r\n}\r\n\r\nexport default useToggleState;\r\n","/** convert hex color code to rgb triplet\r\n * @param {ColorCode} hex\r\n * @return {RGBTriplet}\r\n */\r\nconst hexToRgb = hex => {\r\n    const result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hex);\r\n    return result\r\n        ? {\r\n              r: parseInt(result[1], 16),\r\n              g: parseInt(result[2], 16),\r\n              b: parseInt(result[3], 16),\r\n          }\r\n        : null;\r\n};\r\n\r\n/**\r\n * @param {RGBTriplet} color\r\n */\r\nconst getBrightness = ({ r, g, b }) => (r * 299 + g * 587 + b * 114) / 1000;\r\n\r\n/** get the suitable text color for a given background color\r\n * @param {ColorCode | 'camera'} background\r\n */\r\nexport const getTextColor = background => {\r\n    if (background === \"camera\") return \"#ffffff\";\r\n\r\n    const rgb = hexToRgb(background);\r\n    return getBrightness(rgb) > 128 ? \"#000000\" : \"#ffffff\";\r\n};\r\n\r\nexport default getTextColor;\r\n"],"sourceRoot":""}