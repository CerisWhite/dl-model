(this["webpackJsonpdl-model"]=this["webpackJsonpdl-model"]||[]).push([[49],{181:function(e,t,a){"use strict";function n(e,t){var a=URL.createObjectURL(e),n=document.createElement("a");n.style.display="none",n.href=a,n.download=t,document.body.appendChild(n),n.click(),window.URL.revokeObjectURL(a),document.body.removeChild(n)}a.d(t,"a",(function(){return n}))},204:function(e,t,a){"use strict";var n=a(35),o=a.n(n),i=a(45),r=a(2),c=a(5),u=a(26),d=a(3),s=a(4),p=a(281),l=a(1),m=a(66),f=a(181),h=function(e){Object(d.a)(a,e);var t=Object(s.a)(a);function a(){var e;Object(r.a)(this,a);for(var n=arguments.length,c=new Array(n),d=0;d<n;d++)c[d]=arguments[d];return(e=t.call.apply(t,[this].concat(c))).afterMainModelLoad=function(){e.saveMainModelInitState(),e.addAnimation()},e.afterMainModelUpdate=function(){e.saveMainModelInitState(),e.addAnimation()},e.updateModel=function(){var t=Object(i.a)(o.a.mark((function t(a,n){return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.updateMainModel(a.model,n.model);case 2:e.updateAnimation(a.animation,n.animation);case 3:case"end":return t.stop()}}),t)})));return function(e,a){return t.apply(this,arguments)}}(),e.otherUpdate=function(t,a){a.capture.enable&&!t.capture.enable&&e.captureAnimation()},e.saveMainModelInitState=function(){var t=e.models.main;t.userData.initPos=t.position.clone(),t.userData.initRot=t.rotation.clone()},e.resetFace=function(){var t=e.props.model,a=t.eyeIdx,n=t.mouthIdx;e.eyeIdx=a,e.mouthIdx=n},e.beforeAddAni=function(){e.resetFace()},e.addAnimation=Object(i.a)(o.a.mark((function t(){var a,n,i,r,c;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.beforeAddAni(),a=e.props.animation,n=a.code,i=a.timeScale,n){t.next=4;break}return t.abrupt("return");case 4:return e.disableInput(),r=e.models.main,c=Object(m.a)(n),e.nAni=c.length,r.mixer=new l.AnimationMixer(r),e.mixer=r.mixer,e._aniIdx=0,r.mixer.timeScale=i,r.mixer.addEventListener("finished",e.playNextAni),e.aniSettings=c,t.next=16,Object(m.u)(c);case 16:e.animations=t.sent,e.aniIdx=0,e.enableInput();case 19:case"end":return t.stop()}}),t)}))),e.removeAnimation=function(){var t,a,n=e.models.main;null===(t=n.mixer)||void 0===t||null===(a=t.stopAllAction)||void 0===a||a.call(t);var o=n.userData,i=o.initPos,r=o.initRot;n.position.copy(i),n.rotation.copy(r),e.mixer=null,e.animations=[],e.aniSettings=[]},e.playNextAni=function(){var t=Object(u.a)(e).nAni;e.props.capture.enable&&e._aniIdx===t-1&&(e.mediaRecorder.stop(),e.props.toggleCapture());var a=(e._aniIdx+1)%t;e.aniIdx=a},e.updateAnimation=function(t,a){var n=a.code,o=a.timeScale;if(t.code!==n)return e.removeAnimation(),void e.addAnimation();t.timeScale!==o&&(e.mixer.timeScale=o)},e.captureAnimation=function(){if(e.chunks=[],e.videoStream=e.canvas.captureStream(30),!e.mediaRecorder){var t=e.props.capture.codec;e.mediaRecorder=new MediaRecorder(e.videoStream,{mimeType:t}),e.mediaRecorder.ondataavailable=function(t){return e.chunks.push(t.data)},e.mediaRecorder.onstop=function(){e.enableInput();var t=e.props.capture.format,a=new Blob(e.chunks,{type:"video/".concat(t)});Object(f.a)(a,"animation.".concat(t))}}e.disableInput("Recording"),e.beforeCaptureAnimation(),e.aniIdx=0,e.mediaRecorder.start()},e.beforeCaptureAnimation=function(){},e.everyAnimate=function(){var t,a=e.clock.getDelta();if((e.rotateFloor(a),null===(t=e.mixer)||void 0===t||t.update(a),e.faceChanges&&e.faceChanges.length)&&e.mixer.time>=e.faceChangeTime[0]){e.faceChangeTime.shift();var n=e.faceChanges.shift(),o=n.eyeIdx,i=n.mouthIdx;e.eyeIdx=o,e.mouthIdx=i}},e}return Object(c.a)(a,[{key:"aniIdx",set:function(e){this._aniIdx=e;var t=this.mixer;t.stopAllAction();var a=this.animations[e],n=t.clipAction(a),o=this.aniSettings[e],i=o.timeScale,r=o.repetitions,c=o.faceChanges,u=a.duration;n.setLoop(l.LoopRepeat,r),n.timeScale=i,n.time=0,this.faceChanges=Object(m.r)(c,r),this.faceChangeTime=this.faceChanges.map((function(e){return u*e.time/100})),t.setTime(0),n.play()}},{key:"eyeIdx",set:function(e){}},{key:"mouthIdx",set:function(e){}}]),a}(p.default);t.a=h},474:function(e,t,a){"use strict";a.r(t),a.d(t,"AdvViewer",(function(){return h}));var n=a(11),o=a(35),i=a.n(o),r=a(45),c=a(2),u=a(5),d=a(3),s=a(4),p=a(204),l=a(10),m=a(66),f=["Right","Left"],h=function(e){Object(d.a)(a,e);var t=Object(s.a)(a);function a(e){var o;return Object(c.a)(this,a),(o=t.call(this,e)).afterMainModelLoad=function(){o.saveMainModelInitState(),o.initFace(),o.addWeapons(),o.addAnimation()},o.beforeMainModelUpdate=function(){o.detachAllWeapons()},o.afterMainModelUpdate=function(){o.saveMainModelInitState(),o.initFace(),o.attachAllWeapons(),o.addAnimation()},o.updateModel=function(){var e=Object(r.a)(i.a.mark((function e(t,a){var n,r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t!==a){e.next=2;break}return e.abrupt("return");case 2:if(n=t.model,r=a.model,n.id===r.id){e.next=9;break}return e.next=7,o.updateMainModel(n,r);case 7:e.next=10;break;case 9:o.updateFace(n,r);case 10:o.updateWeapons(n,r),o.updateAnimation(t.animation,a.animation);case 12:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),o.initFace=function(){var e=o.props.model.id;o._eyeIdx=o._mouthIdx=l.e;var t={mouthTexture:e,mouthIdx:l.e,eyeTexture:e,eyeIdx:l.e};o.updateFace(t,o.props.model)},o.addWeapons=Object(r.a)(i.a.mark((function e(){var t,a,r,c;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o.getWeaponInfo(),e.next=3,o.initWeaponLoad();case 3:return t=e.sent,a=Object(n.a)(t,2),r=a[0],c=a[1],o.models=Object.assign(o.models,{weaponRight:r,weaponLeft:c}),e.next=10,o.initAllWeapons();case 10:o.attachAllWeapons();case 11:case"end":return e.stop()}}),e)}))),o.getWeaponInfo=function(){var e=o.props.model,t=e.weaponRight,a=e.weaponLeft,n={weaponRight:Object(m.b)(t),weaponLeft:Object(m.b)(a)};o.modelInfo=Object.assign(o.modelInfo,n)},o.initWeaponLoad=function(){var e,t,a=null===(e=o.modelInfo.weaponRight)||void 0===e?void 0:e.modelPath,n=Object(m.v)(a),i=null===(t=o.modelInfo.weaponLeft)||void 0===t?void 0:t.modelPath,r=Object(m.v)(i);return Promise.all([n,r])},o.initAllWeapons=Object(r.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=o.matType,f.forEach((function(e){var a="weapon".concat(e),n=o.models[a];if(n){var i=o.modelInfo[a],r=i.texturePath,c=i.flipped;Object(m.k)(n,{materialType:t,texturePath:r}),c&&(n.rotation.y+=Math.PI);var u=o.props.outline;o.outlines[a]=Object(m.n)(n,u)}}));case 2:case"end":return e.stop()}}),e)}))),o.attachWeapon=function(e,t){var a="jWeapon".concat(t[0]);o.models.main.traverse((function(t){t.name.includes(a)&&0===t.children.length&&t.add(e)}))},o.attachAllWeapons=function(){f.forEach((function(e){var t="weapon".concat(e),a=o.models[t];a&&o.attachWeapon(a,e)}))},o.detachWeapon=function(e){var t="weapon".concat(e),a=o.models[t];a&&a.parent.remove(a)},o.detachAllWeapons=function(){return f.forEach((function(e){return o.detachWeapon(e)}))},o.updateEyeTexture=function(e,t){var a=t.eyeTexture,n=e.eyeTexture;if(a===n)return!1;var i=o.matType;Object(m.d)(o.models.main,{materialType:i,textureId:a});var r=Object(m.i)(a,n);return Object(m.c)(o.models.main,r),!0},o.updateMouthTexture=function(e,t){var a=t.mouthTexture,n=e.mouthTexture;if(a===n)return!1;var i=o.matType;Object(m.f)(o.models.main,{materialType:i,textureId:a});var r=Object(m.i)(a,n);return Object(m.e)(o.models.main,r),!0},o.updateFaceTexture=function(e,t){var a=o.updateEyeTexture(e,t),n=o.updateMouthTexture(e,t);if(a||n){var i=o.models.main;o.applyNewModelMat(i)}},o.updateFaceOffset=function(e){var t=e.eyeIdx,a=e.mouthIdx;o.eyeIdx=t,o.mouthIdx=a},o.updateFace=function(e,t){o.updateFaceTexture(e,t),o.updateFaceOffset(t)},o.updateWeapons=function(){var e=Object(r.a)(i.a.mark((function e(t,a){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o.disableInput(),f.forEach(function(){var e=Object(r.a)(i.a.mark((function e(n){var r,c,u,d,s,p,l,f;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r="weapon".concat(n),t[r]!==a[r]){e.next=3;break}return e.abrupt("return");case 3:if(o.detachWeapon(n),Object(m.o)(o.models[r]),a[r]){e.next=10;break}return o.models[r]=null,o.modelInfo[r]="",o.outlines[r]=null,e.abrupt("return");case 10:return o.modelInfo[r]=Object(m.b)(a[r]),c=o.modelInfo[r],u=c.modelPath,d=c.texturePath,s=c.flipped,e.next=14,Object(m.v)(u);case 14:p=e.sent,o.models[r]=p,l=o.matType,Object(m.k)(p,{materialType:l,texturePath:d}),o.applyNewModelMat(p),s&&(p.rotation.y+=Math.PI),f=o.props.outline,o.outlines[r]=Object(m.n)(p,f),o.attachWeapon(p,n);case 23:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),o.enableInput();case 3:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),o._eyeIdx=o._mouthIdx=l.e,o}return Object(u.a)(a,[{key:"eyeIdx",set:function(e){if(e){var t=this._eyeIdx;if(e!==t){var a=Object(m.h)(e,t);Object(m.c)(this.models.main,a),this._eyeIdx=e}}}},{key:"mouthIdx",set:function(e){if(e){var t=this._mouthIdx;if(e!==t){var a=Object(m.h)(e,t);Object(m.e)(this.models.main,a),this._mouthIdx=e}}}}]),a}(p.a);t.default=h}}]);
//# sourceMappingURL=49.a9e587b6.chunk.js.map