(this["webpackJsonpdl-model"]=this["webpackJsonpdl-model"]||[]).push([[50],{182:function(e,t,n){"use strict";function a(e,t){var n=URL.createObjectURL(e),a=document.createElement("a");a.style.display="none",a.href=n,a.download=t,document.body.appendChild(a),a.click(),window.URL.revokeObjectURL(n),document.body.removeChild(a)}n.d(t,"a",(function(){return a}))},205:function(e,t,n){"use strict";var a=n(35),i=n.n(a),o=n(46),r=n(2),c=n(5),d=n(26),u=n(3),s=n(4),m=n(282),l=n(1),f=n(45),p=n(182),h=function(e){Object(u.a)(n,e);var t=Object(s.a)(n);function n(){var e;Object(r.a)(this,n);for(var a=arguments.length,c=new Array(a),u=0;u<a;u++)c[u]=arguments[u];return(e=t.call.apply(t,[this].concat(c))).afterMainModelLoad=function(){e.saveMainModelInitState(),e.addAnimation()},e.afterMainModelUpdate=function(){e.saveMainModelInitState(),e.addAnimation()},e.updateModel=function(){var t=Object(o.a)(i.a.mark((function t(n,a){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.updateMainModel(n.model,a.model);case 2:e.updateAnimation(n.animation,a.animation);case 3:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),e.otherUpdate=function(t,n){n.capture.enable&&!t.capture.enable&&e.captureAnimation()},e.saveMainModelInitState=function(){var t=e.models.main;t.userData.initPos=t.position.clone(),t.userData.initRot=t.rotation.clone()},e.resetFace=function(){var t=e.props.model,n=t.eyeIdx,a=t.mouthIdx;e.eyeIdx=n,e.mouthIdx=a},e.beforeAddAni=function(){e.resetFace()},e.addAnimation=Object(o.a)(i.a.mark((function t(){var n,a,o,r,c;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.beforeAddAni(),n=e.props.animation,a=n.code,o=n.timeScale,a){t.next=4;break}return t.abrupt("return");case 4:return e.disableInput(),r=e.models.main,c=Object(f.a)(a),e.nAni=c.length,r.mixer=new l.AnimationMixer(r),e.mixer=r.mixer,e._aniIdx=0,r.mixer.timeScale=o,r.mixer.addEventListener("finished",e.playNextAni),e.aniSettings=c,t.next=16,Object(f.v)(c);case 16:e.animations=t.sent,e.aniIdx=0,e.enableInput();case 19:case"end":return t.stop()}}),t)}))),e.removeAnimation=function(){var t,n,a=e.models.main;null===(t=a.mixer)||void 0===t||null===(n=t.stopAllAction)||void 0===n||n.call(t);var i=a.userData,o=i.initPos,r=i.initRot;a.position.copy(o),a.rotation.copy(r),e.mixer=null,e.animations=[],e.aniSettings=[]},e.playNextAni=function(){var t=Object(d.a)(e).nAni;e.props.capture.enable&&e._aniIdx===t-1&&(e.mediaRecorder.stop(),e.props.toggleCapture());var n=(e._aniIdx+1)%t;e.aniIdx=n},e.updateAnimation=function(t,n){var a=n.code,i=n.timeScale;if(t.code!==a)return e.removeAnimation(),void e.addAnimation();t.timeScale!==i&&(e.mixer.timeScale=i)},e.captureAnimation=function(){if(e.chunks=[],e.videoStream=e.canvas.captureStream(30),!e.mediaRecorder){var t=e.props.capture.codec;e.mediaRecorder=new MediaRecorder(e.videoStream,{mimeType:t}),e.mediaRecorder.ondataavailable=function(t){return e.chunks.push(t.data)},e.mediaRecorder.onstop=function(){e.enableInput();var t=e.props.capture.format,n=new Blob(e.chunks,{type:"video/".concat(t)});Object(p.a)(n,"animation.".concat(t))}}e.disableInput("Recording"),e.beforeCaptureAnimation(),e.aniIdx=0,e.mediaRecorder.start()},e.beforeCaptureAnimation=function(){},e.everyAnimate=function(){var t,n=e.clock.getDelta();if((e.rotateFloor(n),null===(t=e.mixer)||void 0===t||t.update(n),e.faceChanges&&e.faceChanges.length)&&e.mixer.time>=e.faceChangeTime[0]){e.faceChangeTime.shift();var a=e.faceChanges.shift(),i=a.eyeIdx,o=a.mouthIdx;e.eyeIdx=i,e.mouthIdx=o}},e}return Object(c.a)(n,[{key:"aniIdx",set:function(e){this._aniIdx=e;var t=this.mixer;t.stopAllAction();var n=this.animations[e],a=t.clipAction(n),i=this.aniSettings[e],o=i.timeScale,r=i.repetitions,c=i.faceChanges,d=n.duration;a.setLoop(l.LoopRepeat,r),a.timeScale=o,a.time=0,this.faceChanges=Object(f.s)(c,r),this.faceChangeTime=this.faceChanges.map((function(e){return d*e.time/100})),t.setTime(0),a.play()}},{key:"eyeIdx",set:function(e){}},{key:"mouthIdx",set:function(e){}}]),n}(m.default);t.a=h},476:function(e,t,n){"use strict";n.r(t),n.d(t,"DragonViewer",(function(){return l}));var a=n(35),i=n.n(a),o=n(46),r=n(2),c=n(5),d=n(3),u=n(4),s=n(205),m=n(45),l=function(e){Object(d.a)(n,e);var t=Object(u.a)(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,e)).initNewModel=function(){a.saveMainModelInitState(),a.initFace(),a.addAnimation()},a.afterMainModelLoad=function(){a.initNewModel()},a.updateModel=function(){var e=Object(o.a)(i.a.mark((function e(t,n){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.updateMainModel(t.model,n.model);case 2:a.updateFace(n.model),a.updateAnimation(t.animation,n.animation);case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),a.updateFace=function(e){var t=e.eyeIdx,n=e.mouthIdx;a.eyeIdx=t,a.mouthIdx=n},a.afterMainModelUpdate=function(){a.initNewModel()},a.initFace=function(){var e=a.models.main;a.eyes=Object(m.q)(e),a.eyes.forEach((function(e){return e.frustumCulled=!1})),a.mouths=Object(m.r)(e),a.mouths.forEach((function(e){return e.frustumCulled=!1}));var t=a.props.model,n=t.eyeIdx,i=t.mouthIdx;a.eyeIdx=n,a.mouthIdx=i},a._eyeIdx=a._mouthIdx=0,a}return Object(c.a)(n,[{key:"eyeIdx",set:function(e){var t=this._eyeIdx;if(e!==t){this._eyeIdx=e;var n=/[0-9]{2}/;this.eyes.forEach((function(t){var a=t.name,i=n.exec(a)[0];t.visible=parseInt(i)===e}))}}},{key:"mouthIdx",set:function(e){var t=this._mouthIdx;if(e!==t){this._mouthIdx=e;var n=/[0-9]{2}/;this.mouths.forEach((function(t){var a=t.name,i=n.exec(a)[0];t.visible=parseInt(i)===e}))}}}]),n}(s.a);t.default=l}}]);
//# sourceMappingURL=50.ff0f4ce9.chunk.js.map