(this["webpackJsonpdl-model"]=this["webpackJsonpdl-model"]||[]).push([[66],{478:function(e,t,a){"use strict";a.r(t),a.d(t,"AdvViewer",(function(){return h}));var n=a(11),o=a(8),r=a.n(o),c=a(15),u=a(0),i=a(2),d=a(4),p=a(5),s=a(240),l=a(13),f=a(49),m=["Right","Left"],h=function(e){Object(d.a)(a,e);var t=Object(p.a)(a);function a(e){var o;return Object(u.a)(this,a),(o=t.call(this,e)).afterMainModelLoad=function(){o.saveMainModelInitState(),o.initFace(),o.addWeapons(),o.addAnimation()},o.beforeMainModelUpdate=function(){o.detachAllWeapons()},o.afterMainModelUpdate=function(){o.saveMainModelInitState(),o.initFace(),o.attachAllWeapons(),o.addAnimation()},o.updateModel=function(){var e=Object(c.a)(r.a.mark((function e(t,a){var n,c;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t!==a){e.next=2;break}return e.abrupt("return");case 2:return n=t.model,c=a.model,e.next=6,o.updateMainModel(n,c);case 6:n.id===c.id&&o.updateFace(n,c),o.updateWeapons(n,c),o.updateAnimation(t.animation,a.animation);case 9:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),o.initFace=function(){var e=o.props.model.id;o._eyeIdx=o._mouthIdx=l.c;var t={mouthTexture:e,mouthIdx:l.c,eyeTexture:e,eyeIdx:l.c};o.updateFace(t,o.props.model)},o.addWeapons=Object(c.a)(r.a.mark((function e(){var t,a,c,u;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o.getWeaponInfo(),e.next=3,o.initWeaponLoad();case 3:return t=e.sent,a=Object(n.a)(t,2),c=a[0],u=a[1],o.models=Object.assign(o.models,{weaponRight:c,weaponLeft:u}),e.next=10,o.initAllWeapons();case 10:o.attachAllWeapons();case 11:case"end":return e.stop()}}),e)}))),o.getWeaponInfo=function(){var e=o.props.model,t=e.weaponRight,a=e.weaponLeft,n={weaponRight:Object(f.b)(t),weaponLeft:Object(f.b)(a)};o.modelInfo=Object.assign(o.modelInfo,n)},o.initWeaponLoad=function(){var e,t,a=null===(e=o.modelInfo.weaponRight)||void 0===e?void 0:e.modelPath,n=Object(f.x)(a),r=null===(t=o.modelInfo.weaponLeft)||void 0===t?void 0:t.modelPath,c=Object(f.x)(r);return Promise.all([n,c])},o.initAllWeapons=Object(c.a)(r.a.mark((function e(){var t;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=o.matType,m.forEach(function(){var e=Object(c.a)(r.a.mark((function e(a){var n,c,u,i,d,p;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n="weapon".concat(a),c=o.models[n]){e.next=4;break}return e.abrupt("return");case 4:return u=o.modelInfo[n],i=u.texturePath,d=u.flipped,Object(f.l)(c,{materialType:t,texturePath:i}),d&&(c.rotation.y+=Math.PI),p=o.props.outline,e.next=11,Object(f.o)(c,p);case 11:o.outlines[n]=e.sent;case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 2:case"end":return e.stop()}}),e)}))),o.attachWeapon=function(e,t){var a="jWeapon".concat(t[0]);o.models.main.traverse((function(t){t.name.includes(a)&&0===t.children.length&&t.add(e)}))},o.attachAllWeapons=function(){m.forEach((function(e){var t="weapon".concat(e),a=o.models[t];a&&o.attachWeapon(a,e)}))},o.detachWeapon=function(e){var t="weapon".concat(e),a=o.models[t];a&&a.parent.remove(a)},o.detachAllWeapons=function(){return m.forEach((function(e){return o.detachWeapon(e)}))},o.updateEyeTexture=function(e,t){var a=t.eyeTexture,n=e.eyeTexture;if(a===n)return!1;var r=o.matType;Object(f.d)(o.models.main,{materialType:r,textureId:a});var c=Object(f.j)(a,n);return Object(f.c)(o.models.main,c),!0},o.updateMouthTexture=function(e,t){var a=t.mouthTexture,n=e.mouthTexture;if(a===n)return!1;var r=o.matType;Object(f.g)(o.models.main,{materialType:r,textureId:a});var c=Object(f.j)(a,n);return Object(f.f)(o.models.main,c),!0},o.updateFaceTexture=function(e,t){var a=o.updateEyeTexture(e,t),n=o.updateMouthTexture(e,t);if(a||n){var r=o.models.main;o.applyNewModelMat(r)}},o.updateFaceOffset=function(e){var t=e.eyeIdx,a=e.mouthIdx;o.eyeIdx=t,o.mouthIdx=a},o.updateFace=function(e,t){o.updateFaceTexture(e,t),o.updateFaceOffset(t)},o.updateWeapons=function(){var e=Object(c.a)(r.a.mark((function e(t,a){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o.disableInput(),m.forEach(function(){var e=Object(c.a)(r.a.mark((function e(n){var c,u,i,d,p,s,l,m;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c="weapon".concat(n),t[c]!==a[c]){e.next=3;break}return e.abrupt("return");case 3:if(o.detachWeapon(n),Object(f.q)(o.models[c]),a[c]){e.next=10;break}return o.models[c]=null,o.modelInfo[c]="",o.outlines[c]=null,e.abrupt("return");case 10:return o.modelInfo[c]=Object(f.b)(a[c]),u=o.modelInfo[c],i=u.modelPath,d=u.texturePath,p=u.flipped,e.next=14,Object(f.x)(i);case 14:return s=e.sent,o.models[c]=s,l=o.matType,Object(f.l)(s,{materialType:l,texturePath:d}),o.applyNewModelMat(s),p&&(s.rotation.y+=Math.PI),m=o.props.outline,e.next=23,Object(f.o)(s,m);case 23:o.outlines[c]=e.sent,o.attachWeapon(s,n);case 25:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),o.enableInput();case 3:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),o._eyeIdx=o._mouthIdx=l.c,o}return Object(i.a)(a,[{key:"eyeIdx",set:function(e){if(e){var t=this._eyeIdx;if(e!==t){var a=Object(f.i)(e,t);Object(f.c)(this.models.main,a),this._eyeIdx=e}}}},{key:"mouthIdx",set:function(e){if(e){var t=this._mouthIdx;if(e!==t){var a=Object(f.i)(e,t);Object(f.f)(this.models.main,a),this._mouthIdx=e}}}}]),a}(s.default);t.default=h}}]);
//# sourceMappingURL=66.a7c5617a.chunk.js.map