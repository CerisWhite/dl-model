(this["webpackJsonpdl-model"]=this["webpackJsonpdl-model"]||[]).push([[65],{497:function(n,t,e){"use strict";e.r(t),e.d(t,"USDZExporter",(function(){return s}));var r=e(35),a=e.n(r),o=e(46),i=e(2),u=e(5),c=e(60),s=function(){function n(){Object(i.a)(this,n)}return Object(u.a)(n,[{key:"parse",value:function(){var n=Object(o.a)(a.a.mark((function n(t){var e,r,o,i,u,s,l,m,h,x,M,b;return a.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:e='#usda 1.0\n(\n    customLayerData = {\n        string creator = "Three.js USDZExporter"\n    }\n    metersPerUnit = 1\n    upAxis = "Y"\n)\n\n',r={},o={},t.traverse((function(n){if(n.isMesh){var t=n.geometry,a=n.material;r[a.uuid]=a,null!==a.map&&(o[a.map.uuid]=a.map),null!==a.normalMap&&(o[a.normalMap.uuid]=a.normalMap),null!==a.aoMap&&(o[a.aoMap.uuid]=a.aoMap),null!==a.roughnessMap&&(o[a.roughnessMap.uuid]=a.roughnessMap),null!==a.metalnessMap&&(o[a.metalnessMap.uuid]=a.metalnessMap),null!==a.emissiveMap&&(o[a.emissiveMap.uuid]=a.emissiveMap),e+=f(n,d(t,a))}})),e+=v(r),e+=g(o),i={"model.usda":Object(c.strToU8)(e)},n.t0=a.a.keys(o);case 8:if((n.t1=n.t0()).done){n.next=16;break}return u=n.t1.value,s=o[u],n.next=13,p(s.image);case 13:i["textures/Texture_"+s.id+".jpg"]=n.sent,n.next=8;break;case 16:for(m in l=0,i)h=i[m],x=34+m.length,4!==(M=63&(l+=x))&&(b=new Uint8Array(64-M),i[m]=[h,{extra:{12345:b}}]),l=h.length;return n.abrupt("return",Object(c.zipSync)(i,{level:0}));case 19:case"end":return n.stop()}}),n)})));return function(t){return n.apply(this,arguments)}}()}]),n}();function p(n){return l.apply(this,arguments)}function l(){return(l=Object(o.a)(a.a.mark((function n(t){var e,r,o;return a.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!("undefined"!==typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!==typeof OffscreenCanvas&&t instanceof OffscreenCanvas||"undefined"!==typeof ImageBitmap&&t instanceof ImageBitmap)){n.next=15;break}return e=1024/Math.max(t.width,t.height),(r=document.createElement("canvas")).width=t.width*Math.min(1,e),r.height=t.height*Math.min(1,e),r.getContext("2d").drawImage(t,0,0,r.width,r.height),n.next=9,new Promise((function(n){return r.toBlob(n,"image/jpeg",1)}));case 9:return o=n.sent,n.t0=Uint8Array,n.next=13,o.arrayBuffer();case 13:return n.t1=n.sent,n.abrupt("return",new n.t0(n.t1));case 15:case"end":return n.stop()}}),n)})))).apply(this,arguments)}function f(n,t){var e="Object_"+n.id,r=function(n){var t=n.elements;return"( ".concat(m(t,0),", ").concat(m(t,4),", ").concat(m(t,8),", ").concat(m(t,12)," )")}(n.matrixWorld);return'def Xform "'.concat(e,'"\n{\n    matrix4d xformOp:transform = ').concat(r,'\n    uniform token[] xformOpOrder = ["xformOp:transform"]\n\n    ').concat(t,"\n}\n\n")}function m(n,t){return"(".concat(n[t+0],", ").concat(n[t+1],", ").concat(n[t+2],", ").concat(n[t+3],")")}function d(n,t){var e="Geometry_"+n.id,r=n.attributes,a=r.position.count;return"uv2"in r&&console.warn("THREE.USDZExporter: uv2 not supported yet."),'def Mesh "'.concat(e,'"\n    {\n        int[] faceVertexCounts = [').concat(function(n){var t=null!==n.index?n.index.array.length:n.attributes.position.count;return Array(t/3).fill(3).join(", ")}(n),"]\n        int[] faceVertexIndices = [").concat(function(n){if(null!==n.index)return n.index.array.join(", ");for(var t=[],e=n.attributes.position.count,r=0;r<e;r++)t.push(r);return t.join(", ")}(n),"]\n        rel material:binding = </Materials/Material_").concat(t.id,">\n        normal3f[] normals = [").concat(h(r.normal,a),'] (\n            interpolation = "vertex"\n        )\n        point3f[] points = [').concat(h(r.position,a),"]\n        float2[] primvars:st = [").concat(function(n,t){if(void 0===n)return console.warn("USDZExporter: UVs missing."),Array(t).fill("(0, 0)").join(", ");for(var e=[],r=n.array,a=0;a<r.length;a+=2)e.push("(".concat(r[a+0].toPrecision(7),", ").concat(1-r[a+1].toPrecision(7),")"));return e.join(", ")}(r.uv,a),'] (\n            interpolation = "vertex"\n        )\n        uniform token subdivisionScheme = "none"\n    }\n')}function h(n,t){if(void 0===n)return console.warn("USDZExporter: Normals missing."),Array(t).fill("(0, 0, 0)").join(", ");for(var e=[],r=n.array,a=0;a<r.length;a+=3)e.push("(".concat(r[a+0].toPrecision(7),", ").concat(r[a+1].toPrecision(7),", ").concat(r[a+2].toPrecision(7),")"));return e.join(", ")}function v(n){var t=[];for(var e in n){var r=n[e];t.push(x(r))}return'def "Materials"\n{\n'.concat(t.join(""),"\n}\n\n")}function x(n){var t="            ",e=[];return null!==n.map?e.push("".concat(t,"color3f inputs:diffuseColor.connect = </Textures/Texture_").concat(n.map.id,".outputs:rgb>")):e.push("".concat(t,"color3f inputs:diffuseColor = ").concat(b(n.color))),null!==n.emissiveMap?e.push("".concat(t,"color3f inputs:emissiveColor.connect = </Textures/Texture_").concat(n.emissiveMap.id,".outputs:rgb>")):n.emissive.getHex()>0&&e.push("".concat(t,"color3f inputs:emissiveColor = ").concat(b(n.emissive))),null!==n.normalMap&&e.push("".concat(t,"normal3f inputs:normal.connect = </Textures/Texture_").concat(n.normalMap.id,".outputs:rgb>")),null!==n.aoMap&&e.push("".concat(t,"float inputs:occlusion.connect = </Textures/Texture_").concat(n.aoMap.id,".outputs:r>")),null!==n.roughnessMap?e.push("".concat(t,"float inputs:roughness.connect = </Textures/Texture_").concat(n.roughnessMap.id,".outputs:g>")):e.push("".concat(t,"float inputs:roughness = ").concat(n.roughness)),null!==n.metalnessMap?e.push("".concat(t,"float inputs:metallic.connect = </Textures/Texture_").concat(n.metalnessMap.id,".outputs:b>")):e.push("".concat(t,"float inputs:metallic = ").concat(n.metalness)),'\n    def Material "Material_'.concat(n.id,'"\n    {\n        token outputs:surface.connect = </Materials/Material_').concat(n.id,'/PreviewSurface.outputs:surface>\n\n        def Shader "PreviewSurface"\n        {\n            uniform token info:id = "UsdPreviewSurface"\n').concat(e.join("\n"),"\n            int inputs:useSpecularWorkflow = 0\n            token outputs:surface\n        }\n    }\n")}function g(n){var t=[];for(var e in n){var r=n[e];t.push(M(r))}return'def "Textures"\n{\n'.concat(t.join(""),"\n}\n\n")}function M(n){return'\n    def Shader "Texture_'.concat(n.id,'"\n    {\n        uniform token info:id = "UsdUVTexture"\n        asset inputs:file = @textures/Texture_').concat(n.id,'.jpg@\n        token inputs:wrapS = "repeat"\n        token inputs:wrapT = "repeat"\n        float outputs:r\n        float outputs:g\n        float outputs:b\n        float3 outputs:rgb\n    }\n')}function b(n){return"(".concat(n.r,", ").concat(n.g,", ").concat(n.b,")")}}}]);
//# sourceMappingURL=65.37510204.chunk.js.map