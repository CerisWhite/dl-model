(this["webpackJsonpdl-model"]=this["webpackJsonpdl-model"]||[]).push([[53],{190:function(e,t,n){"use strict";var a=n(34),o=n.n(a),i=n(46),r=n(3),c=n(4),u=n(25),d=n(5),s=n(6),p=n(264),l=n(1),m=n(65),f=function(e){Object(d.a)(n,e);var t=Object(s.a)(n);function n(){var e;Object(r.a)(this,n);for(var a=arguments.length,c=new Array(a),d=0;d<a;d++)c[d]=arguments[d];return(e=t.call.apply(t,[this].concat(c))).afterMainModelLoad=function(){e.saveMainModelInitState(),e.addAnimation()},e.afterMainModelUpdate=function(){e.saveMainModelInitState(),e.addAnimation()},e.updateModel=function(){var t=Object(i.a)(o.a.mark((function t(n,a){return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.updateMainModel(n.model,a.model);case 2:e.updateAnimation(n.animation,a.animation);case 3:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),e.otherUpdate=function(t,n){n.capture.enable&&!t.capture.enable&&e.captureAnimation()},e.saveMainModelInitState=function(){var t=e.models.main;t.initPos=t.position.clone(),t.initRot=t.rotation.clone()},e.resetFace=function(){var t=e.props.model,n=t.eyeIdx,a=t.mouthIdx;e.eyeIdx=n,e.mouthIdx=a},e.beforeAddAni=function(){e.resetFace()},e.addAnimation=Object(i.a)(o.a.mark((function t(){var n,a,i,r,c;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.beforeAddAni(),n=e.props.animation,a=n.code,i=n.timeScale,a){t.next=4;break}return t.abrupt("return");case 4:return e.disableInput(),r=e.models.main,c=Object(m.a)(a),e.nAni=c.length,r.mixer=new l.AnimationMixer(r),e.mixer=r.mixer,e._aniIdx=0,r.mixer.timeScale=i,r.mixer.addEventListener("finished",e.playNextAni),e.aniSettings=c,t.next=16,Object(m.v)(c);case 16:e.animations=t.sent,e.aniIdx=0,e.enableInput();case 19:case"end":return t.stop()}}),t)}))),e.removeAnimation=function(){var t,n,a=e.models.main;null===(t=a.mixer)||void 0===t||null===(n=t.stopAllAction)||void 0===n||n.call(t);var o=a.initPos,i=a.initRot;a.position.copy(o),a.rotation.copy(i),e.mixer=null,e.animations=[],e.aniSettings=[]},e.playNextAni=function(){var t=Object(u.a)(e).nAni;e.props.capture.enable&&e._aniIdx===t-1&&(e.mediaRecorder.stop(),e.props.toggleCapture());var n=(e._aniIdx+1)%t;e.aniIdx=n},e.updateAnimation=function(t,n){var a=n.code,o=n.timeScale;if(t.code!==a)return e.removeAnimation(),void e.addAnimation();t.timeScale!==o&&(e.mixer.timeScale=o)},e.captureAnimation=function(){if(e.chunks=[],e.videoStream=e.canvas.captureStream(30),!e.mediaRecorder){var t=e.props.capture.codec;e.mediaRecorder=new MediaRecorder(e.videoStream,{mimeType:t}),e.mediaRecorder.ondataavailable=function(t){return e.chunks.push(t.data)},e.mediaRecorder.onstop=function(){e.enableInput();var t=new Blob(e.chunks,{type:"video/webm"}),n=URL.createObjectURL(t),a=document.createElement("a");a.style.display="none",a.href=n,a.download="animation.webm",document.body.appendChild(a),a.click(),window.URL.revokeObjectURL(n),document.body.removeChild(a)}}e.disableInput("Recording"),e.beforeCaptureAnimation(),e.aniIdx=0,e.mediaRecorder.start()},e.beforeCaptureAnimation=function(){},e.everyAnimate=function(){var t,n=e.clock.getDelta();if((e.rotateFloor(n),null===(t=e.mixer)||void 0===t||t.update(n),e.faceChanges&&e.faceChanges.length)&&e.mixer.time>=e.faceChangeTime[0]){e.faceChangeTime.shift();var a=e.faceChanges.shift(),o=a.eyeIdx,i=a.mouthIdx;e.eyeIdx=o,e.mouthIdx=i}},e}return Object(c.a)(n,[{key:"aniIdx",set:function(e){this._aniIdx=e;var t=this.mixer;t.stopAllAction();var n=this.animations[e],a=t.clipAction(n),o=this.aniSettings[e],i=o.timeScale,r=o.repetitions,c=o.faceChanges,u=n.duration;a.setLoop(l.LoopRepeat,r),a.clampWhenFinished=!0,a.timeScale=i,a.time=0,this.faceChanges=Object(m.r)(c,r),this.faceChangeTime=this.faceChanges.map((function(e){return u*e.time/100})),t.setTime(0),a.play()}},{key:"eyeIdx",set:function(e){}},{key:"mouthIdx",set:function(e){}}]),n}(p.default);t.a=f},455:function(e,t,n){"use strict";n.r(t),n.d(t,"AdvViewer",(function(){return h}));var a=n(10),o=n(34),i=n.n(o),r=n(46),c=n(3),u=n(4),d=n(5),s=n(6),p=n(190),l=n(7),m=n(65),f=["Right","Left"],h=function(e){Object(d.a)(n,e);var t=Object(s.a)(n);function n(){var e;return Object(c.a)(this,n),(e=t.call(this)).afterMainModelLoad=function(){e.saveMainModelInitState(),e.initFace(),e.addWeapons(),e.addAnimation()},e.beforeMainModelUpdate=function(){e.detachAllWeapons()},e.afterMainModelUpdate=function(){e.saveMainModelInitState(),e.initFace(),e.attachAllWeapons(),e.addAnimation()},e.updateModel=function(){var t=Object(r.a)(i.a.mark((function t(n,a){var o,r;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n!==a){t.next=2;break}return t.abrupt("return");case 2:if(o=n.model,r=a.model,o.id===r.id){t.next=9;break}return t.next=7,e.updateMainModel(o,r);case 7:t.next=10;break;case 9:e.updateFace(o,r);case 10:e.updateWeapons(o,r),e.updateAnimation(n.animation,a.animation);case 12:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),e.initFace=function(){var t=e.props.model.id;e._eyeIdx=e._mouthIdx=l.e;var n={mouthTexture:t,mouthIdx:l.e,eyeTexture:t,eyeIdx:l.e};e.updateFace(n,e.props.model)},e.addWeapons=Object(r.a)(i.a.mark((function t(){var n,o,r,c;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.getWeaponInfo(),t.next=3,e.initWeaponLoad();case 3:return n=t.sent,o=Object(a.a)(n,2),r=o[0],c=o[1],e.models=Object.assign(e.models,{weaponRight:r,weaponLeft:c}),t.next=10,e.initAllWeapons();case 10:e.attachAllWeapons();case 11:case"end":return t.stop()}}),t)}))),e.getWeaponInfo=function(){var t=e.props.model,n=t.weaponRight,a=t.weaponLeft,o={weaponRight:Object(m.b)(n),weaponLeft:Object(m.b)(a)};e.modelInfo=Object.assign(e.modelInfo,o)},e.initWeaponLoad=function(){var t,n,a=null===(t=e.modelInfo.weaponRight)||void 0===t?void 0:t.modelPath,o=Object(m.w)(a),i=null===(n=e.modelInfo.weaponLeft)||void 0===n?void 0:n.modelPath,r=Object(m.w)(i);return Promise.all([o,r])},e.initAllWeapons=Object(r.a)(i.a.mark((function t(){var n;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=e.matType,f.forEach((function(t){var a="weapon".concat(t),o=e.models[a];if(o){var i=e.modelInfo[a],r=i.texturePath,c=i.flipped;Object(m.k)(o,{materialType:n,texturePath:r}),c&&(o.rotation.y+=Math.PI);var u=e.props.outline;e.outlines[a]=Object(m.n)(o,u)}}));case 2:case"end":return t.stop()}}),t)}))),e.attachWeapon=function(t,n){var a="jWeapon".concat(n[0]);e.models.main.traverse((function(e){e.name.includes(a)&&0===e.children.length&&e.add(t)}))},e.attachAllWeapons=function(){f.forEach((function(t){var n="weapon".concat(t),a=e.models[n];a&&e.attachWeapon(a,t)}))},e.detachWeapon=function(t){var n="weapon".concat(t),a=e.models[n];a&&a.parent.remove(a)},e.detachAllWeapons=function(){return f.forEach((function(t){return e.detachWeapon(t)}))},e.updateEyeTexture=function(t,n){var a=n.eyeTexture,o=t.eyeTexture;if(a===o)return!1;var i=e.matType;Object(m.d)(e.models.main,{materialType:i,textureId:a});var r=Object(m.i)(a,o);return Object(m.c)(e.models.main,r),!0},e.updateMouthTexture=function(t,n){var a=n.mouthTexture,o=t.mouthTexture;if(a===o)return!1;var i=e.matType;Object(m.f)(e.models.main,{materialType:i,textureId:a});var r=Object(m.i)(a,o);return Object(m.e)(e.models.main,r),!0},e.updateFaceTexture=function(t,n){var a=e.updateEyeTexture(t,n),o=e.updateMouthTexture(t,n);if(a||o){var i=e.models.main;e.applyNewModelMat(i)}},e.updateFaceOffset=function(t){var n=t.eyeIdx,a=t.mouthIdx;e.eyeIdx=n,e.mouthIdx=a},e.updateFace=function(t,n){e.updateFaceTexture(t,n),e.updateFaceOffset(n)},e.updateWeapons=function(){var t=Object(r.a)(i.a.mark((function t(n,a){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.disableInput(),f.forEach(function(){var t=Object(r.a)(i.a.mark((function t(o){var r,c,u,d,s,p,l,f;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r="weapon".concat(o),n[r]!==a[r]){t.next=3;break}return t.abrupt("return");case 3:if(e.detachWeapon(o),Object(m.o)(e.models[r]),a[r]){t.next=10;break}return e.models[r]=null,e.modelInfo[r]="",e.outlines[r]=null,t.abrupt("return");case 10:return e.modelInfo[r]=Object(m.b)(a[r]),c=e.modelInfo[r],u=c.modelPath,d=c.texturePath,s=c.flipped,t.next=14,Object(m.w)(u);case 14:p=t.sent,e.models[r]=p,l=e.matType,Object(m.k)(p,{materialType:l,texturePath:d}),e.applyNewModelMat(p),s&&(p.rotation.y+=Math.PI),f=e.props.outline,e.outlines[r]=Object(m.n)(p,f),e.attachWeapon(p,o);case 23:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),e.enableInput();case 3:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),e._eyeIdx=e._mouthIdx=l.e,e}return Object(u.a)(n,[{key:"eyeIdx",set:function(e){if(e){var t=this._eyeIdx;if(e!==t){var n=Object(m.h)(e,t);Object(m.c)(this.models.main,n),this._eyeIdx=e}}}},{key:"mouthIdx",set:function(e){if(e){var t=this._mouthIdx;if(e!==t){var n=Object(m.h)(e,t);Object(m.e)(this.models.main,n),this._mouthIdx=e}}}}]),n}(p.a);t.default=h}}]);
//# sourceMappingURL=53.33c97b3f.chunk.js.map