import{av as e,aU as k,aD as b,az as x}from"./vendor.0af045b4.js";import{u as S,S as F}from"./lists.9f1cd60b.js";import{b as N,x as G,y as T,v as L,C as R}from"./index.de068d06.js";import{f as M,B as $,F as E,a as P}from"./filterConfig.fbcf942c.js";import{G as H}from"./GlowToggle.50d2d622.js";import{g as z}from"./index.102a0288.js";import{b as q}from"./useAppData.889f8996.js";import{G as O}from"./Gallery.95fb88f8.js";import{u as y}from"./useToggleState.48a04f36.js";import{L as Q,I as U}from"./LoadSpinner.8aa50140.js";import{M as V}from"./ModelIcon.fa2fda67.js";import{B}from"./Box.36edcd22.js";import{D as Y,a as J}from"./DialogTitle.a02af59f.js";import"./ButtonBase.749220ee.js";import"./Popover.fb02a82b.js";import"./MenuItem.992d5651.js";import"./ToggleGroup.22f21e39.js";import"./DialogContext.faaa0fa1.js";const f={root:{display:"flex",flexDirection:"column",overflowY:"hidden",minHeight:"90vh","& svg":{color:"rgba(16, 16, 16, 0.8)"}},top:{display:"flex",flexWrap:"wrap",borderBottom:"1px solid rgba(16, 16, 16, 0.4)",boxShadow:"0 0.2rem 0.3rem rgba(16, 16, 16, 0.4)"},searchFilter:{marginTop:"0.2rem",display:"flex",flexDirection:"column",width:"100%",minWidth:"20rem",alignItems:"center",justifyContent:"center","& .MuiTextField-root":{justifyContent:"center"}},search:{display:"flex",width:"100%",justifyContent:"center"},title:{padding:"0.5rem 1rem",textAlign:"center",flexGrow:.1,margin:"auto"},content:{padding:"0.3rem",textAlign:"center",minHeight:"60vh"}},w=[{value:"weapon",label:"Weapon",icon:"img/appIcon/weapon.png",options:[{value:"regular",label:"Regular"},{value:"special",label:"Special"},{value:"extra",label:"Extra"}]},{value:"chara",label:"Adventurer",icon:"img/appIcon/chara.png",options:[{value:"regular",label:"Regular"},{value:"allies",label:"Allies"},{value:"enemies",label:"Enemies"}]},{value:"dragon",label:"Dragon",icon:"img/appIcon/dragon.png",options:[{value:"regular",label:"Regular"},{value:"special",label:"Special"}]},{value:"boss",label:"Boss",icon:"img/appIcon/boss.png",options:[{value:"archdemon",label:"Archdemon",icon:"img/appIcon/archdemon.png"},{value:"agito",label:"Agito",icon:"img/appIcon/agito.png"},{value:"raid",label:"Raid",icon:"img/appIcon/raid.png"},{value:"void",label:"Void",icon:"img/appIcon/void.png"},{value:"others",label:"Others"}]}],K=o=>{let t=w;const i=[];return o.forEach(c=>{const a=t[c],l=a==null?void 0:a.value;l!==void 0&&(i.push(l),t=a.options)}),i.join("-")},X={Left:"\u21D0",Right:"\u21D2"},D=({side:o,onClick:t})=>e("div",{className:"WeaponButton-addBtn","data-side":o,onClick:t},X[o]);const Z=o=>o.stopPropagation();function _({id:o,name:t,noIcon:i,onClick:c}){const[a,l]=y(!1),[d,g]=y(!1),u=!i&&e(V,{modelId:o,className:"WeaponButton-icon"}),n=a&&e("div",{className:"WeaponButton-grip",onClick:Z},e("input",{type:"checkbox",id:`grip-${o}`,checked:d,onChange:g}),e("label",{htmlFor:`grip-${o}`},"Reverse Grip")),m=p=>{p.stopPropagation();const{side:s}=p.currentTarget.dataset;c({side:s,id:o,name:t,reverse:d})};return e("div",{className:"WeaponButton"},u,a?e("div",{className:"WeaponButton-add",onClick:l},n,e("div",{className:"WeaponButton-addBtnGroup"},e(D,{side:"Left",onClick:m}),e("div",null,"ADD"),e(D,{side:"Right",onClick:m}))):e("div",{className:"WeaponButton-name",onClick:l},t))}const ee=[];function oe({content:o,searchQuery:t,searchAll:i,filter:c=ee}){var p;const a=(p=q(s=>s[o]))!=null?p:[],[l,d]=b([]),[g,u]=b(!1),{activeModel:n}=N();x(()=>d(a),[o]),x(()=>{u(!0);async function s(){if(i)return t?await G(t):a;const r=await T(a,t);return await M(r,c)}setTimeout(async()=>{const r=await s();d(r),u(!1)})},[t,c,i]);const m=async({side:s,id:r,name:h,reverse:A})=>{var j;const C=`jWeapon${s[0]}`;if(!(n==null?void 0:n.bones.list.includes(C)))return;const v=await L.loadDLModel(r);v.userData.name=h,A&&(v.rotation.y=Math.PI),(j=n.attachment[C])==null||j.forEach(W=>W.dispose()),n.attach(v,C),v.outline.code=n.outline.code,v.material.code=n.material.code};return a.length&&!g?e(O,{list:l,component:_,onClick:m}):e(Q,null)}var ae=k(oe);const I=[];function Ce(){const{indices:o,setIndex:t,showFilter:i,toggleFilter:c,searchAll:a,toggleSearchAll:l}=R(),d=!!indexedDB,[g,u]=b(""),n=S(g,500),[m,p]=b(I),s=K(o),r=z(s);x(()=>p(I),[i,o]),x(()=>{u(""),a&&l()},[o]);const h=o.join();return e(B,{className:"AddWeapon",sx:f.root},e(B,{sx:f.top},e(Y,{sx:f.title},"Add Weapon"),e($,{options:w,selectedIndices:o,setIndex:t}),e(B,{sx:f.searchFilter},e(B,{sx:f.search},d&&e(H,{type:"text",value:"All",checked:a,onClick:l}),e(F,{key:h,query:g,onChange:u}),r&&!a&&e(U,{onClick:c,size:"large"},e(E,null))),!a&&i&&r&&e(P,{key:h,config:r,onChange:p}))),e(J,{sx:f.content},e(ae,{searchQuery:n,filter:m,content:s,searchAll:a})))}export{Ce as default};
