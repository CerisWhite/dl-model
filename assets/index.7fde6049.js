var xt=Object.defineProperty,wt=Object.defineProperties;var At=Object.getOwnPropertyDescriptors;var G=Object.getOwnPropertySymbols;var Ae=Object.prototype.hasOwnProperty,Pe=Object.prototype.propertyIsEnumerable;var ne=(e,t,n)=>t in e?xt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,g=(e,t)=>{for(var n in t||(t={}))Ae.call(t,n)&&ne(e,n,t[n]);if(G)for(var n of G(t))Pe.call(t,n)&&ne(e,n,t[n]);return e},T=(e,t)=>wt(e,At(t));var $=(e,t)=>{var n={};for(var s in e)Ae.call(e,s)&&t.indexOf(s)<0&&(n[s]=e[s]);if(e!=null&&G)for(var s of G(e))t.indexOf(s)<0&&Pe.call(e,s)&&(n[s]=e[s]);return n};var _=(e,t,n)=>(ne(e,typeof t!="symbol"?t+"":t,n),n);import{F as Pt,T as N,C as St,P as _t,a as I,W as Et,s as O,S as se,A as Se,b as Lt,M as _e,c as H,U as Ct,D as Tt,L as Ot,N as It,d as kt,e as jt,f as Dt,R as $t,g as Rt,h as Ft,B as Nt,i as Bt,j as Vt,k as zt,l as Wt,m as Ut,n as Gt,o as Ht,p as qt,q as Kt,r as ae,t as Ee,u as Xt,E as Zt,v as Yt,w as Jt,x as Qt,V as B,y as Le,z as en,G as tn,H as nn,I as sn,J as an,K as rn,O as on,Q as cn,X as ln,Y as q,Z as un,_ as dn,$ as pn,a0 as S,a1 as Ce,a2 as fn,a3 as re,a4 as oe,a5 as Te,a6 as hn}from"./vendor.2ce87b54.js";const mn=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const r of a)if(r.type==="childList")for(const u of r.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&s(u)}).observe(document,{childList:!0,subtree:!0});function n(a){const r={};return a.integrity&&(r.integrity=a.integrity),a.referrerpolicy&&(r.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?r.credentials="include":a.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(a){if(a.ep)return;a.ep=!0;const r=n(a);fetch(a.href,r)}};mn();const gn="modulepreload",Oe={},yn="/dl-model/",b=function(t,n){return!n||n.length===0?t():Promise.all(n.map(s=>{if(s=`${yn}${s}`,s in Oe)return;Oe[s]=!0;const a=s.endsWith(".css"),r=a?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${s}"]${r}`))return;const u=document.createElement("link");if(u.rel=a?"stylesheet":gn,a||(u.as="script",u.crossOrigin=""),u.href=s,document.head.appendChild(u),a)return new Promise((d,i)=>{u.addEventListener("load",d),u.addEventListener("error",i)})})).then(()=>t())};function bn(){return new Worker("/dl-model/assets/fetchWorker.6ff9ca49.js",{type:"module"})}const vn=e=>{const t=new bn;return new Promise(n=>{t.addEventListener("message",s=>{t.terminate(),n(s.data)}),t.postMessage(e)})};function Ie(){return new Worker("/dl-model/assets/dbWorker.b98a6301.js",{type:"module"})}const ke=(e,t)=>{const n=new Ie;return new Promise(s=>{n.addEventListener("message",()=>{s(),n.terminate()}),n.postMessage({type:"put",store:t,value:e})})};function Mn(){return new Worker("/dl-model/assets/searchWorker.d631f240.js",{type:"module"})}async function xn(e,t="",n=["name"]){if(!t||!n.length)return e;const s=new Mn;return new Promise(a=>{s.addEventListener("message",r=>{s.terminate(),a(r.data)}),s.postMessage({fullList:e,query:t,keys:n})})}const pr=async e=>{const t=Object.values(e).flat();await ke(t,"model"),console.log("Model DB Initialized")},fr=e=>K({type:"get",store:"model",value:e}),hr=e=>K({type:"search",store:"model",index:"name",value:e}),mr=async e=>{const n=(await K({type:"getByKeyRange",store:"model",value:"c100000_00-c199999_99"})).filter(({id:s})=>!s.endsWith("h"));return xn(n,e)},wn=()=>K({type:"getMap",store:"model",index:"name"}),K=e=>{const t=new Ie;return new Promise(n=>{t.addEventListener("message",s=>{t.terminate(),n(s.data)}),t.postMessage(e)})},V={},An=async()=>{if(Object.keys(V).length)return;const e="ani-personal",t=(await vn([e]))[e];Object.assign(V,t)},gr=e=>V[e],Pn=e=>{var t,n;return(n=(t=V[e])==null?void 0:t[0])!=null?n:e.startsWith("c")?{name:"Bob",code:"CMN_MWM_03"}:null},yr=async()=>{const e=await wn(),t=Object.entries(V).map(([n,s])=>{const a=e.get(n);return s.map(r=>T(g({},r),{user:n,fullName:`${a} ${r.name}`}))}).flat();await ke(t,"animation")},je=e=>e==="true",De={"<":">","(":")","[":"]","{":"}"},Sn=e=>{let t="";const n=[],s=[];for(const a of e){if(n.length){t+=a;const r=n.at(-1);a===De[r]&&n.pop();continue}if(a==="/"){t&&s.push(t),t="";continue}t+=a,a in De&&n.push(a)}return t&&s.push(t),s},$e=e=>Sn(e).reduce((n,s)=>{const[a,...r]=s.split("="),u=r==null?void 0:r.join("=");return a&&u&&n.push([a,u]),n},[]),Re=e=>({indices:[0,0],_indicesCache:{},setIndex:(t,n)=>{e(s=>{var l,p;const{indices:a,_indicesCache:r}=s;a[t]=n;const u=a.slice(0,t+1).join(),d=(l=r[u])!=null?l:[],{length:i}=a;for(let f=0;t+1+f<i;f++)a[t+1+f]=(p=d[f])!=null?p:0;const c=a.slice(t),o=a.slice(0,t).join();o&&(r[o]=c)})},showFilter:!1,toggleFilter:()=>e(t=>{t.showFilter=!t.showFilter}),searchAll:!1,toggleSearchAll:()=>e(t=>{t.searchAll=!t.searchAll})}),_n=e=>({category:"Adventurer",setCategory:t=>e(n=>{n.category=t}),advAni:{category:"home",setCategory:t=>e(n=>{n.advAni.category=t}),home:{gender:"Male",setGender:t=>e(n=>{n.advAni.home.gender=t})},weapon:{type:"Sword",setType:t=>e(n=>{n.advAni.weapon.type=t}),gunMode:"Long",setGunMode:t=>e(n=>{n.advAni.weapon.gunMode=t})},genericSkill:{type:"Sword",setType:t=>e(n=>{n.advAni.genericSkill.type=t})},groupByWeapon:{setGroupWeaponType:(t,n)=>e(s=>{s.advAni.groupByWeapon[t]=n})},uniqueOther:{type:"Sword",setType:t=>e(n=>{n.advAni.uniqueOther.type=t}),selected:"",setSelected:t=>e(n=>{n.advAni.uniqueOther.selected=t})}},extraAni:{category:"Dance",setCategory:t=>e(n=>{n.extraAni.category=t})},personalAni:{source:"",setSource:t=>e(n=>{n.personalAni.source=t}),sourceName:"",setSourceName:t=>e(n=>{n.personalAni.sourceName=t})}}),Fe="fbx",Ne="animations",En="img/textures/matcap",X="data",Be=e=>e&&new Promise(t=>{new Pt().load(e,t)}),Ve=e=>e&&new Promise(t=>{new N().load(e,t)}),Ln=["px.png","nx.png","py.png","ny.png","pz.png","nz.png"],Cn=e=>e&&new Promise(t=>{new St().setPath(`${e}/`).load(Ln,t)}),Tn=["c100007_01","c100007_05","c100007_09","c100034_01","c100035_01","c100036_01","c100037_01","c100041_01"],On=async e=>await(await fetch(e)).json(),Z=async e=>(await On(e)).data,In=(...e)=>t=>e.reduce((n,s)=>s(n),t),kn=e=>[...new Set(e)],C=e=>e==="false"?!1:!!e,ze=(e,t,n)=>{if(!t.length)return;const s=t.pop(),a=t.reduce((r,u)=>r==null?void 0:r[u],e);a&&(a[s]=n)};function ie(e){return!!/[0-9A-Fa-f]{6}/.test(e)}function Y(e){return ie(e)&&!e.startsWith("#")?new I(`#${e}`):new I(e)}async function jn(e=100){return await new Promise(t=>setTimeout(t,e))}function We(e,t="="){const[n,...s]=e.split(t),a=s.join(t);return[n,a]}const Dn=e=>e.startsWith("w302"),Ue=([e,...t])=>`${e.toUpperCase()}${t.join("")}`;function $n(e){var n;return e==="smith"?"dragon":e.endsWith("h")?"story":Tn.includes(e)?"spAdventurer":(n={c:"adventurer",b:"boss",d:"dragon",e:"enemy",h:"high boss",o:"object",r:"raid boss",w:"weapon"}[e[0]])!=null?n:"other"}function Rn(e=ns){const t=new Et(e);return t.outputEncoding=O,t}function Fn(e={}){const{fov:t,aspect:n,near:s,far:a}=g(g({},as),e);return new _t(t,n,s,a)}async function Nn(e){if(e.startsWith("img:")){const t=e.replace("img:",""),n=await Ve(t);return n.encoding=O,n.center.set(.5,0),n}if(e.startsWith("sky:")){const t=e.replace("sky:",""),n=await Cn(t);return n.encoding=O,n}if(e==="transparent")return null;if(ie(e)){const t=e.startsWith("#")?e:`#${e}`;return new I(t)}}function Bn(e){var t,n,s,a;(n=(t=e.map)==null?void 0:t.dispose)==null||n.call(t),(a=(s=e.userData.backupMap)==null?void 0:s.dispose)==null||a.call(s),e.dispose()}const Ge=e=>{const t=new N().load(e);return t.encoding=O,t};function Vn(e){const t=[],n=[];return e.traverse(s=>{s.isMesh&&t.push(s),s.isBone&&n.push(s)}),[t,n]}function zn(e){var n,s;if(!e)return;[e.material].flat().forEach(a=>{var r,u,d,i,c,o;(u=(r=a.map)==null?void 0:r.dispose)==null||u.call(r),(c=(i=(d=a.userData)==null?void 0:d.backupMap)==null?void 0:i.dispose)==null||c.call(i),(o=a.dispose)==null||o.call(a)}),(s=(n=e.geometry)==null?void 0:n.dispose)==null||s.call(n)}const Wn=()=>{const e=new Date,t=e.toDateString().replace(/ /g,"_"),n=e.toLocaleTimeString().replace(/:/g,"-").replace(/ /g,"");return`${t}_${n}`},He=e=>e?e.split("/").reduce((n,s)=>{const[a,r]=s.split("=");return a&&r&&(n[a]=r),n},{}):{};class qe extends se{constructor(t){super();this._matcapCombine=Se,this.emissiveIntensity=1,this.normalMapType=Lt,this.combine=_e,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.lights=!0,this.vertexShader=H.vertexShader,this.fragmentShader=H.fragmentShader,this.defines=Object.assign({},H.defines),Object.defineProperty(this,"matcapCombine",{get:function(){return this._matcapCombine},set:function(s){switch(this._matcapCombine=s,s){case _e:this.defines.MATCAP_BLENDING_MULTIPLY=!0,delete this.defines.MATCAP_BLENDING_ADD;break;default:case Se:this.defines.MATCAP_BLENDING_ADD=!0,delete this.defines.MATCAP_BLENDING_MULTIPLY;break}}}),this.uniforms=Ct.clone(H.uniforms);const n=["specular","shininess","opacity","diffuse","map","matcap","gradientMap","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveMap","bumpMap","bumpScale","normalMap","normalScale","displacemantBias","displacemantMap","displacemantScale","specularMap","alphaMap","envMap","reflectivity","refractionRatio"];for(const s of n)Object.defineProperty(this,s,{get:function(){return this.uniforms[s].value},set:function(a){this.uniforms[s].value=a}});Object.defineProperty(this,"color",Object.getOwnPropertyDescriptor(this,"diffuse")),this.setValues(t)}copy(t){return super.copy(t),this.matcapCombine=t.matcapCombine,this.emissiveIntensity=t.emissiveIntensity,this.normalMapType=t.normalMapType,this.combine=t.combine,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this}}qe.prototype.isMMDToonMaterial=!0;const Un=["color","emissive","specular"],Gn=["wireframe","metalness","opacity","roughness","shininess","transparent","emissiveIntensity"],Ke=["type","flatShading","showTexture","gradientMap","matcap"],Hn=[...Un,...Gn,...Ke],qn=["transparent","opacity","wireframe","showTexture","color"],Kn={Basic:[],Toon:["emissive","emissiveIntensity","gradientMap"],Lambert:["emissive","emissiveIntensity"],Phong:["emissive","emissiveIntensity","specular","shininess","flatShading"],Standard:["emissive","emissiveIntensity","metalness","roughness","flatShading"],Matcap:["flatShading","matcap"],MMDToon:["emissive","emissiveIntensity","specular","shininess","matcap","gradientMap","flatShading"]},E=e=>`${e}`,ce=e=>ie(e)?`${e.startsWith("#")?"":"#"}${e}`:e,Xn=e=>Array.isArray(e)?e.join(","):e,le={wireframe:{name:"Wireframe",type:"boolean",default:!1,valueMap:C,toString:E},showTexture:{name:"Texture",type:"boolean",default:!0,valueMap:C,toString:E},transparent:{name:"Transparent",type:"boolean",default:!1,valueMap:C,toString:E},flatShading:{name:"Flat Shading",type:"boolean",default:!1,valueMap:C,toString:E},color:{name:"Color",type:"color",default:"#ffffff",valueMap:Y,toString:ce},emissive:{name:"Emissive",type:"color",default:"#000000",valueMap:Y,toString:ce},opacity:{name:"Opacity",type:"percentage",default:1,min:0,max:1,valueMap:parseFloat,toString:E},emissiveIntensity:{name:"Emissive Intensity",type:"percentage",default:1,min:0,max:1,valueMap:parseFloat,toString:E},specular:{name:"Specular",type:"color",default:"#111111",valueMap:Y,toString:ce},metalness:{name:"Metalness",type:"percentage",default:0,min:0,max:1,valueMap:parseFloat,toString:E},roughness:{name:"Roughness",type:"percentage",default:1,min:0,max:1,valueMap:parseFloat,toString:E},shininess:{name:"Shininess",type:"number",default:30,min:1,max:100,valueMap:parseFloat,toString:E},gradientMap:{name:"Gradient Map",type:"select",default:"none",valueMap:Ze,toString:Xn},matcap:{name:"Matcap",type:"select",default:"matcap_fresnel.jpg",valueMap:Ye,toString:E}},Zn=Object.fromEntries(Object.entries(le).map(([e,{default:t}])=>[e,t])),k=T(g({},Zn),{type:"Basic"}),Yn=Object.fromEntries(Object.entries(le).map(([e,{valueMap:t}])=>[e,t])),Jn=Object.fromEntries(Object.entries(le).map(([e,{toString:t}])=>[e,t])),ue=e=>[...qn,...Kn[e]],Qn=(e,t={})=>{if(e==="MMDToon")return new qe(t);const n=`Mesh${e}Material`;return new kt[n](t)},Xe=(e,{matType:t="Basic",texturePath:n="",force:s=!1}={})=>{e.forEach(a=>{const r=[a.material].flat(),u=Array.isArray(a.material);if(!s&&!n){const d=`isMesh${t}Material`;if(!r.some(c=>!c[d]))return}r.forEach((d,i)=>{var l,p,f,h;const c=n?new N().load(n):r[i].map;n&&(c.encoding=O);const o=Qn(t);if(o.name=d.name,o.map=c,o.userData.backupMap=d.userData.backupMap,n&&((p=(l=d.map)==null?void 0:l.dispose)==null||p.call(l),(h=(f=d.userData.backupMap)==null?void 0:f.dispose)==null||h.call(f)),d.dispose(),u){a.material[i]=o;return}a.material=o})})},es=e=>Array.isArray(e)?e:e.split(",").map(t=>parseInt(t));function Ze(e){const t=es(e),n=t.length;if(n<2)return null;const s=Uint8Array.from(t),a=new Tt(s,n,1,Ot);return a.minFilter=a.magFilter=It,a.generateMipmaps=!1,a}const ts=e=>e.includes("/")||e.includes(":")?e:`${En}/${e}`;function Ye(e){const t=ts(e);return t?Ge(t):null}const ns={alpha:!0,antialias:!0},ss="#cccccc",as={type:"Perspective",fov:45,aspect:1,far:300,near:.01},rs="c100001_01",R={enabled:!0,size:5,color:"#000000",opacity:1},os={noBackground:!0,fileName:"screenshot",frameRate:30},Je=1,de=30,is={directional:{color:"#ffffff",intensity:.8,position:[1,0,2]},ambient:{color:"#444444",intensity:1},point:{color:"#ffffff",intensity:1}},pe={"No Mapping":jt,Linear:Dt,Reinhard:$t,Cineon:Rt,"ACES Filmic":Ft},z={addEventListener(e,t){var a,r;if(!t)return;this._listeners=(a=this._listeners)!=null?a:{};const n=this._listeners,s=e.toLowerCase();return n[s]=(r=n[s])!=null?r:[],!n[s].includes(t)&&n[s].push(t),t},hasEventListener(e,t){var s;return this._listeners===void 0?!1:!!((s=this._listeners[e.toLowerCase()])==null?void 0:s.includes(t))},removeEventListener(e,t){if(this._listeners===void 0)return;const n=e.toLowerCase(),a=this._listeners[n];if(a!==void 0){const r=a.indexOf(t);r!==-1&&a.splice(r,1)}},dispatchEvent(e){if(this._listeners===void 0)return;const t=this._listeners,n=e.type.toLowerCase(),s=t[n];if(s){e.target=this;const a=s.slice(0);for(let r=0,u=a.length;r<u;r++)a[r].call(this,e)}},addCountedEventListener(e,t,n=1){const s=this;let a=n;function r(u){t.call(s,u),a--,a===0&&s.removeEventListener(e,r)}this.addEventListener(e,r)}},cs={face1:[2,1],face2:[0,0],face3:[1,0],face4:[2,0],face5:[3,0],face6:[0,-1],face7:[1,-1],face8:[2,-1],face9:[3,-1]},Qe={},ls=async()=>{const e=await Z(`${X}/face-offset.json`);Object.assign(Qe,e)},et=e=>Qe[e]||[0,0],fe={},us=async()=>{const e=await Z(`${X}/camera-position.json`);Object.assign(fe,e)},ds=e=>{var t;return(t=fe[e])!=null?t:fe[e[0]]},he={},ps=async()=>{const e=await Z(`${X}/control-position.json`);Object.assign(he,e)},fs=e=>{var t;return(t=he[e])!=null?t:he[e[0]]},tt=e=>cs[`face${e}`],hs=(e,t)=>{const n={x:0,y:0};if(e!==t){const[s,a]=tt(t),[r,u]=tt(e);n.x=r-s,n.y=u-a}return[n.x,n.y]},ms=(e,t)=>{const n={x:0,y:0};if(e!==t){const[s,a]=et(t),[r,u]=et(e);n.x=r-s,n.y=u-a}return[n.x,n.y]},J=e=>new Proxy(Object.assign(e,z),{get(t,n){return t[n]},set(t,n,s){return t[n]=s,t.dispatchEvent({type:"change",propName:n,value:s}),!0}}),nt=/mEye_[0-9]/m,st=/mMouth_[0-9]/m,gs=/[0-9]{2}/,at=["eye","mouth"];function ys(e){const{type:t,meshes:n}=e;return t==="adventurer"?bs(e):n.some(({name:a})=>a.match(/mEye|mMouth/))?vs(e):e}function bs(e){const{meshes:t,id:n}=e,s=c=>`${Fe}/${c}/${c}.png`,a=t.find(({name:c})=>c==="mBodyAll"),r={eyeIdx:2,eyeBaseIdx:2,mouthIdx:2,mouthBaseIdx:2,eyeTexture:n,mouthTexture:n},u={type:"uv"},d=c=>([o,l])=>{var w;if(!a)return;const p=`mt${Ue(c)}CH`,f=(w=a.geometry.groups)==null?void 0:w.find(M=>{var P;return((P=a.material[M.materialIndex])==null?void 0:P.name)===p});if(!f)return;const{start:h,count:m}=f,y=h+m,v=a.geometry.attributes.uv;for(let M=h;M<y;M++){const P=v.getX(M)+.25*o,A=v.getY(M)+.25*l;v.setXY(M,P,A)}v.needsUpdate=!0},i=c=>o=>{var h,m;if(!a)return;const l=`mt${Ue(c)}CH`,p=(m=(h=a.material).find)==null?void 0:m.call(h,({name:y})=>y===l);if(!p)return;const f=s(o);p.map.dispose(),p.map=Ge(f),p.needsUpdate=!0};return at.forEach(c=>{Object.defineProperties(u,{[`${c}Idx`]:{get(){return r[`${c}Idx`]},set(o){const l=parseInt(o),p=this[`${c}Idx`];r[`${c}Idx`]=l;const f=hs(l,p);d(c)(f)}},[`${c}BaseIdx`]:{get(){return r[`${c}BaseIdx`]},set(o){r[`${c}BaseIdx`]=o,this[`${c}Idx`]=o}},[`${c}Texture`]:{get(){return r[`${c}Texture`]},set(o){const l=this[`${c}Texture`];r[`${c}Texture`]=o,i(c)(o);const p=ms(o,l);d(c)(p)}}})}),e.face=J(u),e}function vs(e){const{meshes:t}=e,[n,s]=Ms(t);[...n,...s].forEach(i=>i.frustumCulled=!1);const a={eye:n,mouth:s},r={eyeIdx:"",eyeBaseIdx:"",mouthIdx:"",mouthBaseIdx:""},u={eyeList:n,mouthList:s,type:"meshes"},d=i=>c=>{a[i].forEach(o=>{const{name:l}=o,p=gs.exec(l)[0];o.visible=parseInt(p)===c})};return at.forEach(i=>Object.defineProperties(u,{[`${i}Idx`]:{get(){return r[`${i}Idx`]},set(c){const o=parseInt(c);d(i)(o),r[`${i}Idx`]=`${o}`}},[`${i}BaseIdx`]:{get(){return r[`${i}BaseIdx`]},set(c){r[`${i}BaseIdx`]=c,this[`${i}Idx`]=c}}})),u.eyeBaseIdx=Je,u.mouthBaseIdx=Je,e.face=J(u),e}function Ms(e){const t=e.filter(({name:s})=>s.match(nt)),n=e.filter(({name:s})=>s.match(st));return[t,n]}function xs(e){const{model:t,uniqueId:n}=e,[s,a]=Vn(t);return Object.defineProperty(a,"list",{value:kn(a.map(({name:r})=>r))}),Object.defineProperty(s,"visible",{get(){return this.filter(({visible:r})=>r)}}),a.forEach(r=>{r.name=`${n}|${r.name}`}),Object.defineProperties(e,{meshes:{get(){return s}},bones:{get(){return a}}})}const rt={},ws=async()=>{const e=await Z(`${X}/model-parts.json`);Object.assign(rt,e)},As=e=>rt[e],Ps=/mParts([A-Za-z]+)/,ot=/mParts[A-Za-z]+_([A-Za-z]*)/;function Ss(e){const{meshes:t,id:n}=e,s=As(n),a=[],r=[];if(t.forEach(c=>{var l;let{name:o}=c;if(!!(o==null?void 0:o.match)){if((o.includes("Effect")||o.includes("Extension"))&&(c.visible=!1),((l=s==null?void 0:s.custom)==null?void 0:l[o])&&(o=c.name=s.custom[o]),o.match(/mParts/)){a.push(c);return}!o.match(nt)&&!o.match(st)&&r.push(c)}}),!a.length&&r.length<2)return e;const u=Object.defineProperties({},{list:{get(){return Object.keys(this)},enumerable:!1},reset:{value:function(){this.list.forEach(c=>this[c].reset())},enumerable:!1},others:{get(){return r},enumerable:!1}});if(e.parts=u,!a.length)return e;const d=new Set(a.map(({name:c})=>{var o;return(o=Ps.exec(c))==null?void 0:o[1]}).sort((c,o)=>c>o?1:-1)),i=c=>a.filter(({name:o})=>o.includes(`mParts${c}`)).sort((o,l)=>o.name>l.name?1:-1);return d.forEach(c=>{var y,v,w;const o=s==null?void 0:s[c],l=(v=(y=o==null?void 0:o.name)==null?void 0:y.replace(/ /g,"_"))!=null?v:c,p=o==null?void 0:o.options,f=i(c);f.forEach(M=>M.frustumCulled=!1);const h=f.map(({name:M})=>{var A,D,F;const P=(D=(A=ot.exec(M))==null?void 0:A[1])!=null?D:"default";return(F=p==null?void 0:p[P])!=null?F:P}),m=(w=o==null?void 0:o.default)!=null?w:h[0];u[l]={_meshes:f,list:h,default:m!=null?m:h[0]},Object.defineProperties(u[l],{current:{get(){var F,xe,we;const M=f.filter(({visible:te})=>te).length;if(M===0)return"None";if(M!==1)return"custom";const A=(F=f.find(({visible:te})=>te).name.match(ot))==null?void 0:F[1];return(we=(xe=p==null?void 0:p[A!=null?A:"default"])!=null?xe:A)!=null?we:"default"},set(M){if(M.toLowerCase()==="none"){this._meshes.forEach((A,D)=>{A.visible=!1});return}if(!this.list.includes(M))return;const P=this.list.indexOf(M);this._meshes.forEach((A,D)=>{A.visible=D===P})}},index:{get(){return this.current==="custom"?NaN:this.list.indexOf(this.current)},set(M){this._meshes.forEach((P,A)=>{P.visible=A===Number(M)})}},reset:{value:function(){this.current=this.default}}})}),u.reset(),e.parts=u,e}const _s=e=>t=>{const n=t.meshes,s=g(g({},k),e),{type:a}=s;Xe(n,{force:!0,matType:a});let r={type:a,showTexture:!0},u=ue(a);const d={get code(){const{type:i,propList:c}=this,o=[];return i!==k.type&&o.push(`type=${i}`),c.forEach(p=>{const f=Jn[p],h=f(this[p]),m=f(k[p]);h!==m&&o.push(`${p}=${h}`)}),o.join("/").replace(/#/g,"")},set code(i){const c=Object.keys(k),o=g(g({},k),He(i));c.forEach(l=>{this[l]=o[l]})},toString(){const{code:i}=this;return i?`mat=(${i})`:""},get list(){return n.flatMap(({material:i})=>i)},get propList(){return u},set type(i){if(this.type===i)return;u=ue(i),Xe(n,{matType:i}),r.type=i;const c=g({},r);r={showTexture:c.showTexture},u.forEach(o=>this[o]=c[o]),r=c},set flatShading(i){const c=C(i);c!==this.flatShading&&(r.flatShading=c,!!this.propList.includes("flatShading")&&this.list.forEach(o=>{o.flatShading=c,o.needsUpdate=!0}))},set gradientMap(i){var l,p;if(i===this.gradientMap||(r.gradientMap=i,!this.propList.includes("gradientMap")))return;const c=(l=this.list[0])==null?void 0:l.gradientMap;(p=c==null?void 0:c.dispose)==null||p.call(c);const o=i==="none"?null:Ze(i);this.list.forEach(f=>{f.gradientMap=o,f.needsUpdate=!0})},set showTexture(i){const c=C(i);if(this.showTexture===c)return;r.showTexture=c;const o=c?l=>{l.map=l.userData.backupMap,l.userData.backupMap=null,l.needsUpdate=!0}:l=>{l.userData.backupMap=l.map,l.map=null,l.needsUpdate=!0};this.list.forEach(o)},set matcap(i){var l,p;if(r.matcap===i||(r.matcap=i,!this.propList.includes("matcap")))return;const c=(l=this.list[0])==null?void 0:l.matcap;(p=c==null?void 0:c.dispose)==null||p.call(c);const o=Ye(i);this.list.forEach(f=>{f.matcap=o,f.needsUpdate=!0})}};return Hn.forEach(i=>Object.defineProperty(d,i,g({get(){return r[i]}},!Ke.includes(i)&&{set(c){c!==this[i]&&(r[i]=c,!!this.propList.includes(i)&&this.list.forEach(o=>o[i]=Yn[i](c)))}}))),ue(a).forEach(i=>d[i]=s[i]),r=g(g({},k),r),t.material=J(d),t};var Es=`uniform float opacity;\r
uniform vec3 color;\r
\r
void main() {\r
	gl_FragColor = vec4( color, opacity );\r
}\r
`,Ls=`uniform float size;\r
\r
#include <skinning_pars_vertex>\r
\r
void main() {\r
	#include <skinbase_vertex>\r
	\r
    vec3 transformed = position + normal * 0.0005 * size;\r
        \r
	#include <skinning_vertex>\r
	#include <project_vertex>\r
}`;const Cs=e=>new se({side:Nt,transparent:!0,depthFunc:Bt,vertexShader:Ls,fragmentShader:Es,uniforms:e});function Ts(e,t){const{material:n}=e,s=Array.isArray(e.material);[n].flat().forEach(Bn),e.material=s?new Array(e.material.length).fill(t):t}function Os(e,t){const n=Cs(t),s=[],a=["Eff","Extension"];return e.forEach(r=>{const{name:u}=r;if(a.some(i=>u.includes(i)))return;const d=r.clone();d.name=`outline-${r.name}`,Ts(d,n),r.isSkinnedMesh&&d.bind(r.skeleton,r.bindMatrix),r.add(d),s.push(d)}),s}const Is={size:parseFloat,opacity:parseFloat,color:Y},ks=e=>t=>{const n=g(g({},R),e),s=t.meshes,a={size:{value:n.size},opacity:{value:n.opacity},color:{value:new I(n.color)}},r=Os(s,a),u=T(g({},n),{enabled:!0}),d={get propList(){return["enabled","color","size","opacity"]},get enabled(){return u.enabled},set enabled(i){const c=C(i);r.forEach(o=>o.visible=c),u.enabled=c},get code(){if(!this.enabled)return"none";const i=[];return Object.keys(R).forEach(c=>{const o=this[c];o!==R[c]&&i.push(`${c}=${o}`)}),i.join("/").replace(/#/g,"")},set code(i){if(i==="none"){this.enabled=!1;return}const c=Object.keys(R),o=g(g({},R),He(i));c.forEach(l=>{this[l]=o[l]})},toString(){const{code:i}=this;return i?`ol=(${i})`:""}};return["size","opacity","color"].forEach(i=>Object.defineProperty(d,i,{get(){return u[i]},set(c){c!==this[i]&&(u[i]=c,a[i].value=Is[i](c))}})),d.enabled=n.enabled,t.outline=J(d),t},it={chainName:"",chainCode:"",chainLength:0,aniIdx:0,clipDuration:0,clipTimeScale:1,action:null,aniAction:[],aniActionPointer:0};function ct(e){return e.split(">").map(js)}function js(e){const[t,...n]=e.split("&"),s=Ds(n);return g({aniName:t},s)}function Ds(e){const t={},n=[],s={r:{name:"reps",map:parseInt},ts:{name:"timeScale",map:parseFloat},dur:{name:"duration",map:$s}};return e.forEach(a=>{const[r,u]=We(a);if(r.startsWith("@")){const c=Rs(u.replace(/[()]/g,""));c.time=parseFloat(r.slice(1)),n.push(c);return}if(!s[r])return;const{name:d,map:i}=s[r];t[d]=i(u)}),t.aniAction=n.filter(({time:a})=>a<=100&&a>=0).sort((a,r)=>a.time-r.time),t}function $s(e){if(!e)return[0,100];const t=e.split("-").slice(0,2).map(parseFloat),n=t.length===2?t:[0,t[0]];return n.some(s=>s>100||s<0)||n[0]>n[1]?[0,100]:n}function Rs(e){return e.split("/").reduce((n,s)=>{const[a,r]=We(s);return g(g({},n),Fs(a,r))},{})}const lt={ei:{name:"face.eyeIdx",valueMap:parseInt},mi:{name:"face.mouthIdx",valueMap:parseInt},et:{name:"face.eyeTexture"},mt:{name:"face.mouthTexture"}};function Fs(e,t){var a;if(e in lt){const{name:r,valueMap:u}=lt[e];return{[r]:(a=u==null?void 0:u(t))!=null?a:t}}let n=e,s=t;return e.startsWith("att")&&n.replace("att","attachment"),e.startsWith("parts")&&(n+="index",s=parseInt(t)),{[n]:s}}const Ns=e=>`${Ne}/${e}.json`;function Bs(e){if(e.startsWith("fbx:"))return Vs(e);const t=Ns(e);return new Promise(n=>fetch(t).then(s=>s.json()).then(s=>zt.parse(s)).then(n))}async function Vs(e){const t=e.replace("fbx:",""),[n,s]=t.split("+");console.log(n);const{animations:a}=await Be(n);return s?a.find(({name:r})=>r===s):a[0]}function zs(e){return Promise.all(e.map(Bs))}function Ws(e,t=[]){return e.map((n,s)=>{const a=t[s];if(!a||a[0]===0&&a[1]===100)return n;const r=n.duration*de,[u,d]=a.map(i=>Math.round(i*r/100));return Vt.subclip(n,n.name,u,d,de)})}async function Us(e){const t=ct(e),n=t.map(({aniName:i})=>i),s=t.map(({duration:i})=>i),a=t.map(l=>{var p=l,{aniName:i,duration:c}=p,o=$(p,["aniName","duration"]);return g({},o)}),r=await zs(n),u=Ws(r,s);return{code:e,clips:u,mod:a,get duration(){return a.some(({timeScale:c})=>c===0)?1/0:u.map((c,o)=>{var l,p;return c.duration/Math.abs((l=a[o].timeScale)!=null?l:1)*((p=a[o].reps)!=null?p:1)}).reduce((c,o)=>c+o,0)}}}const Gs=/[a-z][0-9]{6}/;function Hs(e){var c;const{model:t,uniqueId:n,bones:s,id:a}=e,r=new Wt(t),u=(c=s==null?void 0:s.list)!=null?c:[],d=T(g({},z),{mixer:r,chain:{},current:g({},it),toString(){var l;const o=(l=this.chain.default)==null?void 0:l.code;return o?`ani=${o}`:""},async addChain(o,{name:l="default",autoplay:p=!0}={}){var h;if(!o||((h=this.chain[l])==null?void 0:h.code)===o)return;r.stopAllAction();const f=await Us(o);f.clips.forEach(m=>{m.tracks=m.tracks.reduce((y,v)=>{let w=v.name.split(".")[0];return Gs.test(w)&&(v.name.replace(w,a),w=a),u.includes(w)&&(v.name=`${n}|${v.name}`,y.push(v)),y},[])}),this.chain[l]=f,r.addEventListener("finished",i),p&&this.play(l)},play(o=this.current.chainName||"default"){const l=this.chain[o];!l||(this.current.chainName=o,this.current.chainCode=l.code,this.current.chainLength=l.clips.length,this.aniIdx=0)},pause(){this.current.action&&(this.current.action.paused=!0)},resume(){this.current.action&&(this.current.action.paused=!1)},stop(){r.stopAllAction()},reset(){const o=this.current.chainName;this.stop(),this.current=g({},it),this.chain[o]=void 0},update(o){var m;r.update(o);const{current:l}=this,{action:p,aniAction:f,clipDuration:h}=l;if(!(!f[l.aniActionPointer]||!p))for(;(p==null?void 0:p.time)>((m=f[l.aniActionPointer])==null?void 0:m.time)*h/100;)this.applyAniAction(f[l.aniActionPointer]),this.current.aniActionPointer++},applyAniAction(o){e.dispatchEvent({type:"aniAction",id:n,aniAction:o});const f=o,{time:l}=f,p=$(f,["time"]);Object.entries(p).forEach(([h,m])=>{const y=h.split(".");ze(e,y,m)})},nextFrame(o=1,l=de){if(!this.isPaused)return;const{clipTimeScale:p,clipDuration:f,action:h}=this.current,m=o*p/l;if(h.time+=m,h.time>=f){const y=h.time-f;i(),this.pause(),this.current.action.time+=y*this.current.clipTimeScale}},setTime(o){const{clipDuration:l,action:p}=this.current;!l||o>l||(p.time=o)},get isPaused(){var o;return(o=this.current.action)==null?void 0:o.paused},get aniIdx(){return this.current.aniIdx},set aniIdx(o){if(o>=this.current.chainLength)return;this.current.aniIdx=o,this.current.aniActionPointer=0;const l={type:o===0?"chainStart":"chainMove",index:o,uniqueId:n,chainName:this.current.chainName};this.dispatchEvent(l),r.stopAllAction();const p=this.chain[this.current.chainName],f=p.mod[o],{timeScale:h,reps:m,aniAction:y}=f,v=p.clips[o],w=r.clipAction(v);w.timeScale=h!=null?h:1,w.setLoop(Ut,m!=null?m:1),this.current.clipDuration=v.duration,this.current.action=w,this.current.aniAction=y,this.current.aniActionPointer=0,this.current.clipTimeScale=h!=null?h:1,w.play()}});function i(){const{aniIdx:o,chainLength:l}=d.current,p=(o+1)%l;if(p===0){d.dispatchEvent({type:"ChainFinished",chainName:d.current.chainName});const{face:f}=e;f&&(f.eyeIdx=f.eyeBaseIdx,f.mouthIdx=f.mouthBaseIdx)}d.aniIdx=p}return e.animation=d,e.addEventListener("TimeUpdated",({dt:o})=>d.update(o)),e}const qs=["push","pop","shift","unshift","splice","reverse","sort"];class j extends Array{constructor(...t){super(...t);Object.assign(this,z),qs.forEach(n=>{Object.defineProperty(this,n,{value:(...s)=>{Array.prototype[n].call(this,...s),this.dispatchEvent({type:"change",method:n,args:s})},enumerable:!1})})}remove(t){const n=this.indexOf(t);n!==-1&&this.splice(n,1)}}function Ks(e){const{model:t,bones:n,uniqueId:s}=e,a={};return Object.defineProperty(a,"list",{get(){return Object.values(this).flat()}}),Object.defineProperty(a,"traverse",{value:function(o){this.list.forEach(l=>{var p,f;o(l),(f=(p=l.attachment)==null?void 0:p.traverse)==null||f.call(p,o)})}}),Object.assign(e,{attachment:a,parent:null,parentBone:"",attach:(o,l="root")=>{var f;a[l]=(f=a[l])!=null?f:new j;const p=l==="root"?t:n.find(({name:h})=>h===`${s}|${l}`);!(p==null?void 0:p.add)||(o.detach(),p.add(o.model),a[l].push(o),o.parent=e,o.parentBone=l,e.dispatchEvent({type:"AttachmentChanged"}))},remove:(o,l="")=>{var f,h,m;const p=l||Object.keys(a).find(y=>a[y].indexOf(o)!==-1);!p||((h=(f=a[p]).remove)==null||h.call(f,o),(m=o.model.parent)==null||m.remove(o.model),e.dispatchEvent({type:"AttachmentChanged"}))},detach:()=>{var p;(p=t.parent)==null||p.remove(t);const{parent:o,parentBone:l}=e;!o||(o.remove(e,l),e.parent=e.parentBone=null)},attachTo:(o,l="root")=>{var p;e.detach(),(p=o==null?void 0:o.attach)==null||p.call(o,e,l)}})}function Xs(e){const{material:t,id:n}=e,s=ee.source.fbx,a=ut(n);Dn(n)&&async function(){const i=d(a),c=new N().load(i);c.encoding=O,c.name=a,t.list.forEach(o=>{var l;return o.map=(l=o.map)!=null?l:c})}();let r=a;Object.defineProperty(e,"texture",{get(){return r},set(i){if(!i){this.texture=a;return}if(i===r)return;const c=d(i),[,o]=u(i),[,l]=u(this.texture),p=t.list.filter(f=>{var h,m,y,v;return((m=(h=f.map)==null?void 0:h.name)==null?void 0:m.includes(l))||((v=(y=f.userData.backupMap)==null?void 0:y.name)==null?void 0:v.includes(l))});!p.length||(async function(){const f=await Ve(c);f.name=o,f.encoding=O,p.forEach(h=>{var m,y,v,w;h.map&&((y=(m=h.map).dispose)==null||y.call(m),h.map=f),h.userData.backupMap&&((w=(v=h.userData.backupMap).dispose)==null||w.call(v),h.userData.backupMap=f)})}(),r=i)}});function u(i){const[c,o]=i.split(">"),l=c||n,p=o||ut(l);return[l,p]}function d(i){const[c,o]=u(i);return`${s}/${c}/${o}.png`}return e}const ut=e=>e.match(/_[0-9]{2}/)||e.startsWith("h")?e:`>${e}_01`;var Zs=`uniform float uTime;\r
uniform float uSpread;\r
uniform float uThreshold;\r
uniform float uSpeed;\r
uniform float uParticleSize;\r
uniform float uAuraSize;\r
\r
attribute float aRandom;\r
\r
varying float vIsParticle;\r
varying float vRandom;\r
\r
#include <skinning_pars_vertex>\r
void main() {\r
    #include <skinbase_vertex>\r
\r
    vec3 transformed = position + normal * 0.005 * uSpread;\r
\r
    #include <skinning_vertex>\r
\r
    vec3 objectNormal = normal;\r
\r
	#include <skinnormal_vertex>\r
    \r
    vec4 viewPosition = viewMatrix * modelMatrix * vec4(transformed, 1.0);\r
    float yDisplacement = fract( uTime * uSpeed + aRandom ) * 0.1;\r
    viewPosition.y += yDisplacement;\r
    viewPosition.x += sin( uTime * aRandom * uSpeed + aRandom ) * 0.02;\r
    \r
    gl_Position = projectionMatrix * viewPosition;\r
    \r
    objectNormal.z *= objectNormal.z > 0.7 ? -1.0 : 1.0;\r
    vIsParticle = objectNormal.z - uThreshold;\r
\r
    gl_PointSize = vIsParticle > 0.0 ? uParticleSize : uAuraSize;\r
    gl_PointSize /= -viewPosition.z;\r
\r
    vRandom = aRandom;\r
}\r
`,Ys=`uniform sampler2D uTexture;\r
\r
uniform float uTime;\r
uniform float uParticleOpacity;\r
uniform float uAuraOpacity;\r
uniform vec3 uColor;\r
uniform vec3 uColor2;\r
\r
varying float vRandom;\r
varying float vIsParticle;\r
\r
void main(){\r
    vec4 textureColor = texture2D( uTexture, gl_PointCoord );\r
    textureColor.a = length( textureColor.rgb ) ;\r
    textureColor.a *= abs( 1.0 - fract( uTime + vRandom ) ) * 0.5;\r
    textureColor.rgb = mix( uColor, uColor2,  textureColor.a * 2.0 );\r
    textureColor.a *= vIsParticle > 0.0 ? uParticleOpacity * 4.0 : uAuraOpacity;\r
\r
    gl_FragColor = textureColor;\r
    gl_FragColor /= vIsParticle > 0.0 ? 2.0 : 4.0;\r
}\r
`;const Q=[{name:"time",uName:"uTime",defaultValue:0,valueMap:Number},{name:"speed",uName:"uSpeed",defaultValue:1,valueMap:Number},{name:"particleOpacity",uName:"uParticleOpacity",defaultValue:.3,valueMap:Number},{name:"auraOpacity",uName:"uAuraOpacity",defaultValue:.3,valueMap:Number},{name:"particleSize",uName:"uParticleSize",defaultValue:10,valueMap:Number},{name:"auraSize",uName:"uAuraSize",defaultValue:100,valueMap:Number},{name:"spread",uName:"uSpread",defaultValue:5,valueMap:Number},{name:"threshold",uName:"uThreshold",defaultValue:.3,valueMap:Number},{name:"texture",uName:"uTexture",defaultValue:"img/textures/particle/cloud.png",valueMap:e=>new N().load(e)},{name:"color",uName:"uColor",defaultValue:"#ffffff",valueMap:e=>new I(e)},{name:"color2",uName:"uColor2",defaultValue:"#33ffff",valueMap:e=>new I(e)}],Js={aura:["visible",...Q.slice(1).map(({name:e})=>e)]},Qs=(e="aura")=>(t,n={})=>{if(!!(t==null?void 0:t.length)&&e==="aura")return ta(t,n)};function ea(e){return new se({vertexShader:Zs,fragmentShader:Ys,uniforms:e,transparent:!0,blending:qt,depthWrite:!1,side:Kt})}function ta(e,t){const n=Q.map(i=>{var f;const{uName:c,defaultValue:o,valueMap:l}=i,p=(f=l==null?void 0:l(o))!=null?f:o;return[c,{value:p}]}),s=Object.fromEntries(n),a=ea(s),r=[];e.forEach(i=>{const{name:c}=i.geometry;if(c.startsWith("mEye")||c.startsWith("mMouth"))return;const o=i.geometry.clone(),l=o.attributes.position.count,p=new Float32Array(l).fill(0).map(()=>Math.random()-.5);o.setAttribute("aRandom",new Gt(p,1)),o.deleteAttribute("color"),o.deleteAttribute("uv");const f=new Ht(o,a);f.name="aura",i.isSkinnedMesh&&(f.type="SkinnedMesh",f.isSkinnedMesh=!0,f.skeleton=i.skeleton,f.bindMatrix=i.bindMatrix,f.bindMatrixInverse=i.bindMatrixInverse,f.bindMode=i.bindMode,f.bind=i.bind,f.clone=i.clone,f.initBones=i.initBones,f.normalizeSkinWeights=i.normalizeSkinWeights,f.pose=i.pose,f.updateMatrixWorld=i.updateMatrixWorld),i.add(f),r.push(f)});const u={visible:!0},d={name:"aura",onDispose:()=>{},get list(){return r},get propList(){return Js.aura},get visible(){return u.visible},set visible(i){const c=C(i);this.list.forEach(o=>o.visible=c),u.visible=c},dispose(){this.onDispose(),this.list.forEach(i=>{var c,o,l,p,f;(c=i.parent)==null||c.remove(i),(l=(o=i.material).dispose)==null||l.call(o),(f=(p=i.geometry).dispose)==null||f.call(p)})},set code(i){i.split("/").forEach(o=>{const[l,p]=o.split("=");!Q.map(({name:f})=>f).includes(l)||(this[l]=p)})}};return Q.forEach(i=>{const{name:c,uName:o,defaultValue:l,valueMap:p}=i;u[c]=l,Object.defineProperty(d,c,{get(){return u[c]},set(f){var h;u[c]=f,s[o].value=(h=p==null?void 0:p(f))!=null?h:f}})}),d.onTimeUpdate=({time:i})=>d.time=i,Object.entries(t).forEach(([i,c])=>d[i]=c),d}function na(e){const{meshes:t}=e,n={list:new j,dispose(){this.list.forEach(s=>{var a;return(a=s.dispose)==null?void 0:a.call(s)})},add(s="aura",a={}){const r=Qs(s)(t,a);return r.onDispose=()=>this.list.remove(r),this.list.push(r),e.addEventListener("TimeUpdated",r.onTimeUpdate),r}};return e.particle=n,e}const sa=e=>{var d,i;if(e.dispatchEvent({type:"dispose"}),!e)return;const{model:t,meshes:n,outline:s,particle:a,viewer:r}=e;a==null||a.list.forEach(c=>c.dispose()),((d=t.parent)==null?void 0:d.isScene)&&(t.parent.remove(t),r.loadedModel.remove(e)),(i=e.detach)==null||i.call(e),[n.reverse(),s==null?void 0:s.all].flat().forEach(zn)};function aa(e){const{x:t,y:n,z:s}=e;return[t,n,s].map(a=>a||"").join()}const ra={position:",,",rotation:",,",scale:"1,1,1"},oa={position:"pos",rotation:"rot",scale:"scl"};function ia(e){return Object.assign(e,T(g({},e.isDLModel&&{toString(){const{id:t,animation:n,outline:s,material:a}=this,r=Object.entries(ra).map(([u,d])=>{const i=aa(this[u]);return i===d?"":`${oa[u]}=${i}`});return[`id=${t}`,...r,n,s,a].filter(u=>`${u}`).join("/")}}),{dispose(){const{attachment:t,parent:n,parentBone:s}=this;t.list.forEach(a=>a.dispose()),n==null||n.remove(this,s),sa(this)}}))}function ca(e,t){const{id:n,material:s,outline:a,viewer:r}=t,u=[xs,Ss,Ks,ks(a),_s(s),Xs,ys,Hs,na,ia],d=T(g({},z),{isDLModel:!0,model:e,id:n,uniqueId:ae(),type:$n(n),viewer:r,userData:{},_time:0,update(i){var c;this._time+=i,(c=this.attachment)==null||c.list.forEach(o=>{var l;return(l=o.update)==null?void 0:l.call(o,i)}),this.dispatchEvent({type:"TimeUpdated",dt:i,time:this._time})},set scale(i){var o;if((o=i.includes)==null?void 0:o.call(i,",")){const[l,p,f]=i.split(",").map(h=>h?parseFloat(h):1);this.model.scale.set(l,p,f);return}const c=Number(i)||1;this.model.scale.set(c,c,c)},get scale(){const{scale:i}=this.model,{x:c,y:o,z:l}=i;return c===o&&c===l?c:[c,o,l].join(",")},set visible(i){this.model.visible=C(i)}});return["position","rotation","visible"].forEach(i=>Object.defineProperty(d,i,{get(){return this.model[i]},enumerable:!0})),e.userData.container=d,In(...u)(d)}function dt({antialias:e="SMAA",renderer:t,scene:n,camera:s}){const a=la(e),r=new Zt(t,a),u=new Yt(n,s);return r.addPass(u),r}function la(e="SMAA"){const t=e==="SMAA"?Jt:Qt;return new t(800,600,{minFilter:Ee,magFilter:Ee,format:Xt,encoding:O})}const me={bloom:da,pixel:fa,afterimage:ba,sobel:ha,halftone:ma,dotscreen:ga,bokeh:ya,smaa:pa};async function ua(e,t){var s;const n=await((s=me[e.toLowerCase()])==null?void 0:s.call(me,t));return n.type=e,n.name=ge[e].name,n}function W(e,t){Object.defineProperty(e,"propList",{value:t}),t.forEach(n=>{Object.defineProperty(e,n,{get(){return this.uniforms[n].value},set(s){this.uniforms[n].value=s}})})}async function da({resolution:e=new B(800,600),strength:t=.3,radius:n=.5,threshold:s=.8}={}){const{UnrealBloomPass:a}=await b(()=>import("./UnrealBloomPass.e7162be8.js"),["assets/UnrealBloomPass.e7162be8.js","assets/vendor.2ce87b54.js"]),r=new a(e,t,n,s);return Object.defineProperty(r,"propList",{value:["radius","strength","threshold"],writable:!1}),r}async function pa({renderer:e}){const{SMAAPass:t}=await b(()=>import("./SMAAPass.8b3806bf.js"),["assets/SMAAPass.8b3806bf.js","assets/vendor.2ce87b54.js"]),n=new B;e.getSize(n);const s=new t(n.x,n.y);return Object.defineProperty(s,"propList",{value:[],writable:!1}),s}async function fa({renderer:e}){const{ShaderPass:t}=await b(()=>import("./vendor.2ce87b54.js").then(function(r){return r.aF}),[]),{PixelShader:n}=await b(()=>import("./PixelShader.ee1b9117.js"),[]),s=new t(n),a=new B;return e.getSize(a),a.multiplyScalar(window.devicePixelRatio),s.uniforms.resolution.value=a,W(s,["pixelSize"]),s.pixelSize=10,s}async function ha({renderer:e}){const{ShaderPass:t}=await b(()=>import("./vendor.2ce87b54.js").then(function(r){return r.aF}),[]),{SobelOperatorShader:n}=await b(()=>import("./SobelOperatorShader.a98a9f0b.js"),["assets/SobelOperatorShader.a98a9f0b.js","assets/vendor.2ce87b54.js"]),s=new B;e.getSize(s),s.multiplyScalar(window.devicePixelRatio);const a=new t(n);return a.uniforms.resolution.value.x=s.x,a.uniforms.resolution.value.y=s.y,Object.defineProperty(a,"propList",{value:[],writable:!1}),a}async function ma({renderer:e}){const{HalftonePass:t}=await b(()=>import("./HalftonePass.bc506a06.js"),["assets/HalftonePass.bc506a06.js","assets/vendor.2ce87b54.js"]),n=new B;e.getSize(n);const s=new t(n.x,n.y,{radius:4});return W(s,["greyscale","radius","scatter","shape"]),s}async function ga(){const{DotScreenPass:e}=await b(()=>import("./DotScreenPass.ea7958d8.js"),["assets/DotScreenPass.ea7958d8.js","assets/vendor.2ce87b54.js"]),t=new e;return W(t,["scale","center"]),t}async function ya({scene:e,camera:t}){const{BokehPass:n}=await b(()=>import("./BokehPass.b7e3f2a0.js"),["assets/BokehPass.b7e3f2a0.js","assets/vendor.2ce87b54.js"]),s=new n(e,t,{});return W(s,["focus","aperture","aspect"]),s}async function ba(){const{AfterimagePass:e}=await b(()=>import("./AfterimagePass.2b65d9fd.js"),["assets/AfterimagePass.2b65d9fd.js","assets/vendor.2ce87b54.js"]),t=new e(.7);return W(t,["damp"]),t}function va(e){var u;const{name:t,type:n}=e,s=(u=ge[n].propList)!=null?u:[],a={};return s.forEach(d=>{Object.defineProperty(a,d,{get(){return e[d]},set(i){e[d]=i},enumerable:!0})}),{target:e,name:t,type:n,params:a,id:ae()}}const ge={bloom:{name:"Bloom",propList:["enabled","radius","strength","threshold"]},pixel:{name:"Pixelate",propList:["enabled","pixelSize"]},afterimage:{name:"Afterimage",propList:["enabled","damp"]},sobel:{name:"Sobel",propList:["enabled"]},halftone:{name:"Halftone",propList:["enabled","greyscale","radius","scatter","shape"]},dotscreen:{name:"Dot Screen",propList:["enabled","scale"]},bokeh:{name:"Bokeh",propList:["enabled","focus","aperture","aspect"]},smaa:{name:"SMAA",propList:["enabled"]}};Object.entries(ge).map(([e,{name:t}])=>({value:e,label:t}));const Ma=["video/mp4;codecs=h264","video/webm;codecs=h264","video/webm;codecs=vp9","video/webm;codecs=vp8","video/webm"],ye=Ma.filter(MediaRecorder.isTypeSupported);function xa(e){if(!ye.length)return;const t=[],n=ye[0],s={settings:{frameRate:30,fileName:"ani",mimeType:n,appendDate:!0},get supportedMimeTypes(){return ye},get mimeType(){return this.settings.mimeType},set mimeType(a){this.supportedMimeTypes.includes(a)&&(this.settings.mimeType=a)},start(){if(this.recorder)return;const{fileName:a,frameRate:r,mimeType:u}=this.settings,d=e.captureStream(r||30),i=d.getTracks()[0],c=new MediaRecorder(d,{mimeType:u});c.onstart=()=>t.length=0,c.ondataavailable=({data:o})=>t.push(o),c.onstop=()=>{i.stop(),this.recorder=void 0;const o=this.settings.mimeType.includes("webm")?"webm":"mp4",l=new Blob(t,{type:`video/${o}`}),p=this.settings.appendDate?`_${Wn()}`:"",f=`${a||"ani"}${p}.${o}`;Le.exports.saveAs(l,f)},c.start(),this.recorder=c},get state(){var a,r;return(r=(a=this.recorder)==null?void 0:a.state)!=null?r:"idle"}};return["pause","resume","stop"].forEach(a=>{Object.defineProperty(s,a,{value:()=>{var r;return(r=s.recorder)==null?void 0:r[a]()}})}),s}function wa(e){let t=1,n=!1,s=!1;const a=()=>{e.stats.begin(),e.controls.update();const c=n?-t:t,o=e.clock.getDelta()*c;s||e.update(o),e.render(),e.stats.end()};let r=!1;const u=()=>{r||(e.render(),r=!0,setTimeout(()=>r=!1,50))};let d="";return{start(){d!=="active"&&(e.renderer.setAnimationLoop(a),e.controls.removeEventListener("change",u),d="active")},stop(){d!=="inactive"&&(e.renderer.setAnimationLoop(null),e.controls.addEventListener("change",u),d="inactive")},pause(){s=!0},resume(){s=!1},get state(){return d},get timeScale(){return t},set timeScale(c){const o=parseFloat(c);t=isNaN(o)?1:Math.abs(o)},get reverse(){return n},set reverse(c){n=!!c},get paused(){return s},set paused(c){s=!!c}}}function Aa(e,t){const n=document.createElement("a");n.style.display="none",n.href=e,n.download=t,document.body.appendChild(n),n.click(),document.body.removeChild(n)}async function Pa(e,t){const n=e.length.toString().length,a=(await b(()=>import("./jszip.min.8075c97f.js").then(function(r){return r.j}),["assets/jszip.min.8075c97f.js","assets/vendor.2ce87b54.js"]).then(r=>r.default))();return e.forEach((r,u)=>{const d=u.toString().padStart(n,"0"),i=`${t||"ss"}_${d}.png`,c="data:image/png;base64,".length;a.file(i,r.slice(c,1/0),{base64:!0})}),a.generateAsync({type:"blob"})}async function pt(e,t){const n=await Pa(e,t);Le.exports.saveAs(n,`${t}.zip`)}async function br(e){const n=(await b(()=>import("./jszip.min.8075c97f.js").then(function(s){return s.j}),["assets/jszip.min.8075c97f.js","assets/vendor.2ce87b54.js"]).then(s=>s.default))();return e.forEach(({name:s,data:a})=>n.file(s,a)),n.generateAsync({type:"blob"})}function Sa(e){const{canvas:t,scene:n}=e;return{settings:os,get(a=1){const{noBackground:r,fileName:u}=this.settings,d=r&&!e.postProcessing.enabled;let i;if(e.loop.state==="inactive"||a===1){d&&([n.background,i]=[null,n.background]),e.render();const p=t.toDataURL();d&&(n.background=i),Aa(p,`${u}.png`),e.render();return}let c=0;const o=[];d&&e.addCountedEventListener("beforeRender",()=>[i,n.background]=[n.background,null]);function l(){const p=t.toDataURL("image/png");o.push(p),++c===a&&(d&&e.addCountedEventListener("beforeRender",()=>[i,n.background]=[null,i]),pt(o,u))}e.addCountedEventListener("afterRender",l,a)},getAllFrames(a){const r=a==null?void 0:a.animation.current.chainName;if(!r||a.animation.chain[r].duration===1/0)return;console.log("main thread locked");const d=e.loop.state;e.loop.stop(),a.animation.stop();const i=[],{frameRate:c,noBackground:o}=this.settings,l=1/(c||30);let p=null,f=!0;for(o&&([n.background,p]=[p,n.background]),a.animation.addCountedEventListener("chainFinished",()=>f=!1),a.animation.play();f;){e.update(l);const h=t.toDataURL();i.push(h)}return console.log("main thread unlocked"),o&&([n.background,p]=[p,n.background]),d==="active"&&e.loop.start(),i},downloadAllFrames(a=0){const{fileName:r}=this.settings,u=this.getAllFrames(a);pt(u,r)}}}const _a=()=>Promise.all([ls(),us(),ps(),ws()]),ft={directional:en,ambient:tn,point:nn},ht={directional:sn,point:an},Ea=e=>{var d,i;if(!ft[e])return null;const u=is[e],{color:n,intensity:s}=u,a=$(u,["color","intensity"]),r=new ft[e](n,s);return r.name=(i=(d=r.type)==null?void 0:d.replace)==null?void 0:i.call(d,"Light",""),ht[e]&&(r.helper=new ht[e](r),Object.defineProperty(r,"showHelper",{get(){return r.helper.visible},set(c){r.helper.visible=!!c,r.helper.update()}}),r.showHelper=!1),Object.defineProperty(r,"colorCode",{get(){return"#"+this.color.getHexString()},set(c){var o,l;this.color=new I(c),(l=(o=this.helper)==null?void 0:o.update)==null||l.call(o)}}),Object.entries(a).forEach(([c,o])=>{r[c].isVector3?r[c].set(...o):r[c]=o}),r};function La(e){const t={list:new j,add:n=>{const s=Ea(n);if(!!s)return e.scene.add(s),s.helper&&(e.scene.add(s.helper),s.helper.update()),t.list.push(s),s.remove=()=>{var a,r,u,d,i;t.list.remove(s),s.helper&&((a=s.parent)==null||a.remove(s.helper),(u=(r=s.helper).dispose)==null||u.call(r)),(d=s.parent)==null||d.remove(s),(i=s.dispose)==null||i.call(s)},s}};return t}const Ca={mat:{keys:["material","code"],valueMap:e=>e.slice(1,-1)},ol:{keys:["outline","code"],valueMap:e=>e.slice(1,-1)},ei:{keys:["face","eyeBaseIdx"]},et:{keys:["face","eyeTexture"]},mi:{keys:["face","mouthBaseIdx"]},mt:{keys:["face","mouthTexture"]},tx:{keys:["texture"]},scl:{keys:["scale"]}};async function Ta(e){const t=$e(e),n=Object.fromEntries(t),{id:s}=n,a=await this.loadDLModel(s);return await Oa(a,n),a}async function Oa(e,t){const a=t,{ani:n}=a,s=$(a,["ani"]);Object.entries(s).forEach(([r,u])=>{var l;const d=Ca[r];if(!d)return;const{keys:i,valueMap:c}=d,o=(l=c==null?void 0:c(u))!=null?l:u;ze(e,i,o)}),n&&await e.animation.addChain(n)}const Me=class{constructor(){_(this,"dataLoaded",!1);_(this,"initData",async()=>{await _a(),this.dataLoaded=!0});_(this,"_background","");_(this,"model",new j);_(this,"loadedModel",new j);_(this,"loadModelFromCode",Ta);_(this,"settings",{outline:R,material:k});_(this,"viewport",{width:0,height:0,set(t,n){this.width=t,this.height=n}});Object.assign(this,z);const t=new rn;this.scene=t,this.background=ss,this.clock=new on;const n=Fn();this.camera=n;const s=La(this);this.light=s,s.add("directional"),s.add("ambient");const a=Rn();this.renderer=a,this.canvas=a.domElement,this.screenshot=Sa(this),this.record=xa(this.canvas),this.controls=new cn(this.camera,this.canvas);const r=this.renderer.capabilities.isWebGL2?"MSAA":"SMAA";this.postProcessing={enabled:!1,passes:new j,composer:dt({antialias:r,renderer:a,scene:t,camera:n}),async addPass(u,d={}){const i=await ua(u,T(g({},d),{renderer:a,scene:t,camera:n}));this.composer.addPass(i);const c=va(i),{passes:o}=this,l=this;return c.remove=()=>{o.remove(c),l.refresh()},o.push(c),i},async refresh(){this.composer=dt({antialias:r,renderer:a,scene:t,camera:n});const u=this.passes.map(({type:i,params:c})=>({type:i,params:Object.entries(c)}));this.passes.length=0;const{length:d}=u;for(let i=0;i<d;i++){const{type:c,params:o}=u[i],l=await this.addPass(c);o.forEach(([p,f])=>void(l[p]=f))}},updatePasses(u){this.passes.length=0,this.passes.splice(0,0,...u),this.refresh()}},this.stats=new ln,this.loop=wa(this),this.loop.start(),console.log("%cDragalia Lost Model Viewer","color:yellow;background-color:black;font-size:1.5rem;text-shadow: 0 0 0.5rem white")}get background(){return this._background}set background(t){var s,a;if(this._background===t)return;this._background="loading",(a=(s=this.scene.background)==null?void 0:s.dispose)==null||a.call(s);const n=this;(async function(){n.scene.background=await Nn(t),n._background=t,t.startsWith("img:")&&n.updateBgAspectRatio()})()}get toneMapping(){var n,s;const{toneMapping:t}=this.renderer;return(s=(n=Object.entries(pe).find(([,a])=>a===t))==null?void 0:n[0])!=null?s:"Unknown"}set toneMapping(t){const n=pe[t]?t:"No Mapping";this.renderer.toneMapping=pe[n]}get pixelRatio(){return this.renderer.getPixelRatio()}set pixelRatio(t){this.renderer.setPixelRatio(t),this.postProcessing.composer.setPixelRatio(t)}get unusedModel(){return this.loadedModel.filter(t=>!this.model.includes(t))}async loadDLModel(t=rs){this.dataLoaded||await this.initData();const n=Me.getModelPath(t),s=await Be(n);s.name=t;const a={id:t,outline:this.settings.outline,material:this.settings.material,viewer:this},r=ca(s,a);return this.loadedModel.push(r),r.addEventListener("dispose",()=>this.loadedModel.remove(r)),r}add(t){t.detach(),this.model.push(t),this.scene.add(t.model),t.parent=this}remove(t){this.model.remove(t),this.scene.remove(t.model)}disposeAllModels(){this.loadedModel.forEach(t=>{var n;return(n=t.dispose)==null?void 0:n.call(t)}),this.model.length=0}static getModelPath(t){return`${this.source.fbx}/${t}/${t}.fbx`}async setViewport(t,n){var u;await jn(200);const s=t!=null?t:window.innerWidth,a=n!=null?n:window.innerHeight;this.viewport.set(s,a),this.renderer.setSize(s,a);const r=s/a;return this.camera.aspect=r,this.camera.updateProjectionMatrix(),(u=this.postProcessing.composer)==null||u.setSize(s,a),this.background.startsWith("img:")&&this.updateBgAspectRatio(),this}updateBgAspectRatio(){if(!this.background.startsWith("img:"))return;const{width:t,height:n}=this.viewport,s=t/n,{background:a}=this.scene,{naturalWidth:r,naturalHeight:u}=a.image,d=r/u,i=s/d,c=s>d?[1,1/i]:[i,1];a.repeat.set(...c)}update(t){var n;(n=this.animation)==null||n.update(t),this.model.forEach(s=>{var a;return(a=s.update)==null?void 0:a.call(s,t)}),this.loop.state==="inactive"&&this.render()}stopAll(){this.model.forEach(t=>{var n,s;return(s=(n=t.animation)==null?void 0:n.stop)==null?void 0:s.call(n)})}playAll(){this.model.forEach(t=>{var n,s;return(s=(n=t.animation)==null?void 0:n.play)==null?void 0:s.call(n)})}render(){this.dispatchEvent({type:"beforeRender"}),this.postProcessing.enabled?this.postProcessing.composer.render():this.renderer.render(this.scene,this.camera),this.dispatchEvent({type:"afterRender"})}toString(){return"Dragalia Lost Model Viewer"}dispose(){var t,n,s;this.model.forEach(a=>a.dispose()),(n=(t=this.scene.background)==null?void 0:t.dispose)==null||n.call(t),(s=this.renderer.renderLists)==null||s.dispose(),this.renderer.dispose()}};let ee=Me;_(ee,"source",{fbx:Fe,ani:Ne});const x=new ee;x.initData();x.setViewport();window.addEventListener("resize",()=>x.setViewport());x.canvas.addEventListener("dblclick",Ia);window.viewer=x;window.model=x.model;function Ia(){if(!!q.fullscreenEnabled){if(!q.fullscreenElement){q.requestFullscreen(x.canvas);return}q.exitFullscreen()}}function ka(){try{return window.self!==window.top}catch{return!0}}let mt="";const gt=ka(),ja=gt?!1:!window.location.hash.includes("showSettings=false"),Da=gt?!1:!window.location.hash.includes("showAC=false"),$a=e=>({showSettings:ja,toggleSettings:()=>e(t=>void(t.showSettings=!t.showSettings)),loadingMsg:"",setLoadingMsg:t=>e(n=>void(n.loadingMsg=t)),showTimeControl:Da,toggleTimeControl:()=>e(t=>void(t.showTimeControl=!t.showTimeControl)),showFrameRate:!1,toggleFrameRate:()=>e(t=>void(t.showFrameRate=!t.showFrameRate)),sidebar:{open:!0,toggle:()=>e(({sidebar:t})=>void(t.open=!t.open)),chainMaker:!1,toggleChainMaker:()=>e(({sidebar:t})=>void(t.chainMaker=!t.chainMaker)),settings:{tab:"Model",setTab:t=>e(({sidebar:n})=>void(n.settings.tab=t))},modal:{mode:"",handleSelect:void 0,open:(t,n)=>{mt=x.loop.state,x.loop.stop(),e(({sidebar:s})=>{const{modal:a}=s;a.mode=t,a.handleSelect=n})},close:()=>{mt==="active"&&x.loop.start(),e(({sidebar:t})=>{const{modal:n}=t;n.mode="",n.handleSelect=void 0})}}},dock:{mode:"",handleSelect:void 0,open:(t="",n)=>e(({dock:s})=>{s.mode=t,s.handleSelect=n}),close:()=>e(({dock:t})=>{t.mode="",t.handleSelect=void 0})}}),L=un,Ra=dn,Fa=pn,Na=S(()=>b(()=>import("./index.9ef9f8f9.js"),["assets/index.9ef9f8f9.js","assets/vendor.2ce87b54.js","assets/TabBar.e2885d28.js","assets/ButtonBase.4084469d.js","assets/Popover.9c21d0e9.js","assets/ColorPicker.2b46398c.js","assets/ColorPicker.108f083b.css","assets/ColorButton.6b7928be.js","assets/Button.f074731b.js","assets/Gallery.445ae716.js","assets/Box.79a6be63.js","assets/DialogTitle.a37c9672.js"])),Ba=S(()=>b(()=>import("./index.517b2ac3.js"),["assets/index.517b2ac3.js","assets/vendor.2ce87b54.js","assets/lists.644be61b.js","assets/lists.d7ac4d5c.css","assets/Gallery.445ae716.js","assets/ButtonBase.4084469d.js","assets/Popover.9c21d0e9.js","assets/Box.79a6be63.js","assets/DialogTitle.a37c9672.js","assets/Close.46558584.js","assets/filterConfig.e6f7088c.js","assets/filterConfig.37d3f97f.css","assets/MenuItem.46696f19.js","assets/GlowToggle.841e1dbe.js","assets/GlowToggle.ada43627.css","assets/styles.d1351c1a.js","assets/styles.a7d845f9.css","assets/index.51113a60.js"])),Va=S(()=>b(()=>import("./index.95f83316.js"),["assets/index.95f83316.js","assets/index.8c10e5f6.css","assets/vendor.2ce87b54.js","assets/lists.644be61b.js","assets/lists.d7ac4d5c.css","assets/Gallery.445ae716.js","assets/ButtonBase.4084469d.js","assets/Popover.9c21d0e9.js","assets/Box.79a6be63.js","assets/DialogTitle.a37c9672.js","assets/Close.46558584.js","assets/Stretcher.769e822e.js","assets/Stretcher.7165086b.css","assets/TabBar.e2885d28.js","assets/Button.f074731b.js","assets/ModelIcon.6c7baedb.js","assets/aniFunction.2c8070be.js","assets/Selector.d7e77f06.js","assets/Selector.4835a2b1.css","assets/GlowToggle.841e1dbe.js","assets/GlowToggle.ada43627.css"])),za=S(()=>b(()=>import("./index.2c5337b6.js"),["assets/index.2c5337b6.js","assets/AddWeapon.a7dfdc84.js","assets/AddWeapon.b09a520b.css","assets/lists.644be61b.js","assets/lists.d7ac4d5c.css","assets/vendor.2ce87b54.js","assets/Gallery.445ae716.js","assets/ButtonBase.4084469d.js","assets/Popover.9c21d0e9.js","assets/Box.79a6be63.js","assets/DialogTitle.a37c9672.js","assets/Close.46558584.js","assets/filterConfig.e6f7088c.js","assets/filterConfig.37d3f97f.css","assets/MenuItem.46696f19.js","assets/GlowToggle.841e1dbe.js","assets/GlowToggle.ada43627.css","assets/index.51113a60.js","assets/useToggleState.35b79c22.js","assets/ModelIcon.6c7baedb.js"])),Wa=S(()=>b(()=>import("./ColorSelect.86dffacb.js"),["assets/ColorSelect.86dffacb.js","assets/ColorPicker.2b46398c.js","assets/ColorPicker.108f083b.css","assets/vendor.2ce87b54.js","assets/ColorButton.6b7928be.js","assets/Button.f074731b.js","assets/ButtonBase.4084469d.js","assets/DialogTitle.a37c9672.js"])),Ua=S(()=>b(()=>import("./index.4dd86f53.js"),["assets/index.4dd86f53.js","assets/FaceSelect.e1558510.js","assets/FaceSelect.79f9cc78.css","assets/vendor.2ce87b54.js","assets/FacePartSelector.012a8b8c.js","assets/Selector.d7e77f06.js","assets/Selector.4835a2b1.css","assets/GlowToggle.841e1dbe.js","assets/GlowToggle.ada43627.css","assets/MeshMouthSelect.af9541cf.js","assets/MeshMouthSelect.cfd3c0f0.css","assets/Box.79a6be63.js","assets/ButtonBase.4084469d.js","assets/DialogTitle.a37c9672.js","assets/Button.f074731b.js"])),Ga=S(()=>b(()=>import("./index.c7c59249.js"),["assets/index.c7c59249.js","assets/FaceTexture.63c6c2cf.js","assets/vendor.2ce87b54.js","assets/useToggleState.35b79c22.js","assets/lists.644be61b.js","assets/lists.d7ac4d5c.css","assets/Gallery.445ae716.js","assets/ButtonBase.4084469d.js","assets/Popover.9c21d0e9.js","assets/Box.79a6be63.js","assets/DialogTitle.a37c9672.js","assets/Close.46558584.js","assets/FacePartSelector.012a8b8c.js","assets/Selector.d7e77f06.js","assets/Selector.4835a2b1.css","assets/GlowToggle.841e1dbe.js","assets/GlowToggle.ada43627.css","assets/filterConfig.e6f7088c.js","assets/filterConfig.37d3f97f.css","assets/MenuItem.46696f19.js","assets/styles.d1351c1a.js","assets/styles.a7d845f9.css"])),Ha=S(()=>b(()=>import("./index.25810b2f.js"),["assets/index.25810b2f.js","assets/index.85d3b8bf.css","assets/vendor.2ce87b54.js","assets/FaceSelect.e1558510.js","assets/FaceSelect.79f9cc78.css","assets/FacePartSelector.012a8b8c.js","assets/Selector.d7e77f06.js","assets/Selector.4835a2b1.css","assets/GlowToggle.841e1dbe.js","assets/GlowToggle.ada43627.css","assets/MeshMouthSelect.af9541cf.js","assets/MeshMouthSelect.cfd3c0f0.css","assets/Box.79a6be63.js","assets/ButtonBase.4084469d.js","assets/DialogTitle.a37c9672.js","assets/Button.f074731b.js","assets/Stretcher.769e822e.js","assets/Stretcher.7165086b.css","assets/BoneManager.e959b868.js","assets/BoneManager.3cee5e0c.css","assets/lists.644be61b.js","assets/lists.d7ac4d5c.css","assets/Gallery.445ae716.js","assets/Popover.9c21d0e9.js","assets/Close.46558584.js","assets/ModelIcon.6c7baedb.js","assets/useToggleState.35b79c22.js","assets/MenuItem.46696f19.js","assets/ColorButton.6b7928be.js","assets/filterConfig.e6f7088c.js","assets/filterConfig.37d3f97f.css","assets/FaceTexture.63c6c2cf.js","assets/styles.d1351c1a.js","assets/styles.a7d845f9.css","assets/SkipPrevious.2e62c6ab.js","assets/AddWeapon.a7dfdc84.js","assets/AddWeapon.b09a520b.css","assets/index.51113a60.js"])),yt=S(()=>b(()=>import("./index.b78badd1.js"),["assets/index.b78badd1.js","assets/index.0a4d2222.css","assets/MeshMouthSelect.af9541cf.js","assets/MeshMouthSelect.cfd3c0f0.css","assets/vendor.2ce87b54.js","assets/Box.79a6be63.js","assets/ButtonBase.4084469d.js","assets/DialogTitle.a37c9672.js","assets/Button.f074731b.js"])),bt={background:Na,model:Ba,animation:Va,weapon:za,color:Wa,face:Ua,faceTexture:Ga,attachment:Ha,eye:({onSelect:e})=>L(yt,{part:"eye",onSelect:e}),mouth:({onSelect:e})=>L(yt,{part:"mouth",onSelect:e})},qa=(e,t)=>({Component:void 0,props:void 0,openModal:(n,s)=>e(a=>{a.props=s,a.Component=n}),close:()=>e(n=>n.Component=void 0),onClose:void 0,reset:()=>e(n=>{n.Component=n.props=n.onClose=void 0}),getInput:async n=>{if(!bt[n])return null;const{close:s,reset:a}=t(),r=new Promise((u,d)=>{const i=(...c)=>u(c);e(c=>{c.onClose=()=>{d(),s()},c.props={onSelect:i,onAfterSelect:s},c.Component=bt[n]})});try{return await r}catch{return null}finally{a()}},inputModel:()=>t().getInput("model"),inputAni:()=>t().getInput("animation"),inputColor:async()=>{const n=await t().getInput("color");return n==null?void 0:n[0]},inputEye:()=>t().getInput("eye"),inputMouth:()=>t().getInput("mouth")}),Ka=e=>({activeModel:void 0,setActiveModel:t=>e({activeModel:t})}),Xa=e=>(t,n,s)=>e(a=>t(fn(a)),n,s),U=e=>Ce(Xa(e)),be=U($a),vr=Ce(Ka),Mr=U(Re),xr=U(Re),Za=U(_n),wr=U(qa),Ya="cccccc",Ja="c100001_01",vt=(e,t="Unknown")=>{const n=ct(e),{length:s}=n,a=n.map((r,u)=>{const{aniName:d,reps:i=1,timeScale:c=1,duration:o=[0,100],aniAction:l}=r,p=s>1?t+` #${u+1}`:t;return{id:ae(),name:p,aniName:d,reps:i,timeScale:c,duration:o,aniAction:l}});return j.from(a)},Mt={ts:{key:"timeScale",defaultValue:1},r:{key:"reps",defaultValue:1}},Qa={"face.eyeIdx":"ei","face.mouthIdx":"mi"},Ar=e=>e.map(er).join(">"),er=e=>{const{aniName:t}=e,n=tr(e),s=nr(e),a=sr(e);return`${t}${n}${s}${a}`},tr=e=>{const t=[];return Object.keys(Mt).forEach(n=>{const{key:s,defaultValue:a}=Mt[n];e[s]&&e[s]!==a&&t.push(`&${n}=${e[s]}`)}),t.join("")},nr=e=>{const{duration:t=[0,100]}=e,[n,s]=t;return n!==0?`&dur=${n}-${s}`:s===100?"":`&dur=${s}`},sr=e=>{const{aniAction:t}=e;if(!t.length)return"";const n=t.map(s=>{const d=s,{time:a}=d,r=$(d,["time"]),u=Object.entries(r).map(([i,c])=>{var o;return`${(o=Qa[i])!=null?o:i}=${c}`});return`@${a}=(${u.join("/")})`});return"&"+n.join("&")};function ve(){const{hash:e}=window.location,t=$e(e),n=Object.fromEntries(t);ar(n),rr(e)}function ar(e){const{bg:t=Ya,showAC:n="true",showSettings:s="true"}=e;x.background=t,be.setState({showTimeControl:je(n)}),be.setState({showSettings:je(s)})}async function rr(e){x.disposeAllModels();const t=decodeURI(e);setTimeout(async()=>{var u;const n=t.includes("id=")?t:t+`/id=${Ja}`,s=await x.loadModelFromCode(n);x.add(s),Za.getState().setCategory(s.type==="adventurer"?"Adventurer":"Personal");const{id:a}=s;if(!t.includes("camPos=")){const d=ds(a);x.camera.position.set(...d)}const r=fs(a);if(x.controls.target.set(...r),t.includes("ani=")){const d=(u=s.animation.current.chainCode)!=null?u:"";d&&(s.userData.chain=vt(d,"init"))}else{const d=Pn(a);if(d){const{code:i,name:c}=d;s.animation.addChain(i),s.userData.chain=vt(i,c)}}})}const or=()=>{const e=re(!0);return oe(()=>{e.current=!1},[]),e.current},ir=S(()=>b(()=>import("./index.d82006fc.js"),["assets/index.d82006fc.js","assets/index.060e60b2.css","assets/vendor.2ce87b54.js","assets/Popover.9c21d0e9.js","assets/ButtonBase.4084469d.js","assets/BoneManager.e959b868.js","assets/BoneManager.3cee5e0c.css","assets/lists.644be61b.js","assets/lists.d7ac4d5c.css","assets/Gallery.445ae716.js","assets/Box.79a6be63.js","assets/DialogTitle.a37c9672.js","assets/Close.46558584.js","assets/ModelIcon.6c7baedb.js","assets/useToggleState.35b79c22.js","assets/MenuItem.46696f19.js","assets/ColorButton.6b7928be.js","assets/Button.f074731b.js","assets/filterConfig.e6f7088c.js","assets/filterConfig.37d3f97f.css","assets/GlowToggle.841e1dbe.js","assets/GlowToggle.ada43627.css","assets/FaceSelect.e1558510.js","assets/FaceSelect.79f9cc78.css","assets/FacePartSelector.012a8b8c.js","assets/Selector.d7e77f06.js","assets/Selector.4835a2b1.css","assets/MeshMouthSelect.af9541cf.js","assets/MeshMouthSelect.cfd3c0f0.css","assets/FaceTexture.63c6c2cf.js","assets/styles.d1351c1a.js","assets/styles.a7d845f9.css","assets/SkipPrevious.2e62c6ab.js","assets/AddWeapon.a7dfdc84.js","assets/AddWeapon.b09a520b.css","assets/index.51113a60.js","assets/TabBar.e2885d28.js","assets/aniFunction.2c8070be.js"])),cr=S(()=>b(()=>import("./index.1095d0b9.js"),["assets/index.1095d0b9.js","assets/index.691abef7.css","assets/vendor.2ce87b54.js","assets/useToggleState.35b79c22.js","assets/GlowToggle.841e1dbe.js","assets/GlowToggle.ada43627.css","assets/Button.f074731b.js","assets/ButtonBase.4084469d.js","assets/Popover.9c21d0e9.js","assets/MenuItem.46696f19.js","assets/SkipPrevious.2e62c6ab.js","assets/Close.46558584.js"]));function lr(){const e=or(),t=re(),n=re(),{loadingMsg:s,showTimeControl:a,showSettings:r,showFrameRate:u}=be();return oe(()=>(e&&An().then(ve),window.addEventListener("hashchange",ve),()=>window.removeEventListener("hashchange",ve))),oe(()=>{var d,i;(d=t.current)==null||d.appendChild(x.canvas),x.stats.dom.style.position="",(i=n.current)==null||i.appendChild(x.stats.dom)},[]),Ra(Fa,{children:[r&&L(Te,{fallback:null,children:L(ir,{})}),L("div",{className:"mount",ref:d=>t.current=d}),L("div",{className:"stats",style:{display:u?"unset":"none"},ref:d=>n.current=d}),s&&L("div",{className:"loading-msg",children:s}),a&&L(Te,{fallback:null,children:L(cr,{})})]})}hn(L(lr,{}),document.getElementById("app"));export{j as A,K as B,et as C,Fe as D,ut as E,Fa as F,mr as G,hr as H,xn as I,xr as J,fr as K,gr as L,as as P,b as _,Ra as a,vr as b,vt as c,bt as d,ds as e,fs as f,Pn as g,Za as h,Mr as i,L as j,Ue as k,Pa as l,br as m,wr as n,Ar as o,ge as p,vn as q,An as r,pr as s,pe as t,be as u,x as v,yr as w,or as x,kn as y,ke as z};
