var At=Object.defineProperty,xt=Object.defineProperties;var Pt=Object.getOwnPropertyDescriptors;var G=Object.getOwnPropertySymbols;var Se=Object.prototype.hasOwnProperty,_e=Object.prototype.propertyIsEnumerable;var se=(e,t,n)=>t in e?At(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,v=(e,t)=>{for(var n in t||(t={}))Se.call(t,n)&&se(e,n,t[n]);if(G)for(var n of G(t))_e.call(t,n)&&se(e,n,t[n]);return e},C=(e,t)=>xt(e,Pt(t));var $=(e,t)=>{var n={};for(var s in e)Se.call(e,s)&&t.indexOf(s)<0&&(n[s]=e[s]);if(e!=null&&G)for(var s of G(e))t.indexOf(s)<0&&_e.call(e,s)&&(n[s]=e[s]);return n};var _=(e,t,n)=>(se(e,typeof t!="symbol"?t+"":t,n),n);import{s as ue,y as le,F as Et,T as B,C as St,P as _t,a as k,W as Lt,b as I,S as ge,A as Le,c as Ct,M as Ce,d as H,U as Tt,D as Ot,L as It,N as Dt,e as Ye,f as kt,g as Rt,R as $t,h as Ft,i as jt,B as Nt,j as Bt,k as Vt,l as zt,m as Wt,n as Ut,o as Gt,p as Ht,q as qt,r as Kt,t as ye,u as Te,v as Xt,E as Yt,w as Zt,x as Jt,z as Qt,V,G as ve,H as en,I as tn,J as nn,K as sn,O as an,Q as rn,X as on,Y as cn,Z as un,_ as q,$ as ln,a0 as dn,a1 as pn,a2 as S,a3 as be,a4 as mn,a5 as Oe,a6 as fn}from"./vendor.5500c094.js";const hn=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const u of o.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&s(u)}).observe(document,{childList:!0,subtree:!0});function n(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerpolicy&&(o.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?o.credentials="include":a.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(a){if(a.ep)return;a.ep=!0;const o=n(a);fetch(a.href,o)}};hn();const gn="modulepreload",Ie={},yn="/dl-model/",w=function(t,n){return!n||n.length===0?t():Promise.all(n.map(s=>{if(s=`${yn}${s}`,s in Ie)return;Ie[s]=!0;const a=s.endsWith(".css"),o=a?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${s}"]${o}`))return;const u=document.createElement("link");if(u.rel=a?"stylesheet":gn,a||(u.as="script",u.crossOrigin=""),u.href=s,document.head.appendChild(u),a)return new Promise((d,i)=>{u.addEventListener("load",d),u.addEventListener("error",i)})})).then(()=>t())},vn=()=>{const e=ue(!0);return le(()=>{e.current=!1},[]),e.current},Ze=e=>({indices:[0,0],_indicesCache:{},setIndex:(t,n)=>{e(s=>{var p,l;const{indices:a,_indicesCache:o}=s;a[t]=n;const u=a.slice(0,t+1).join(),d=(p=o[u])!=null?p:[],{length:i}=a;for(let m=0;t+1+m<i;m++)a[t+1+m]=(l=d[m])!=null?l:0;const r=a.slice(t),c=a.slice(0,t).join();c&&(o[c]=r)})},showFilter:!1,toggleFilter:()=>e(t=>{t.showFilter=!t.showFilter}),searchAll:!1,toggleSearchAll:()=>e(t=>{t.searchAll=!t.searchAll})}),De=e=>e==="true";function Je(e,t){return e&&t&&Object.keys(t).forEach(n=>{const s=t[n];typeof s=="object"?(e[n]||(e[n]={}),Je(e[n],s)):e[n]=s}),e}const bn=(e,t)=>({category:"Adv",setCategory:n=>e(s=>{s.category=n}),advAni:{category:"home",setCategory:n=>e(s=>{s.advAni.category=n}),home:{gender:"Male",setGender:n=>e(s=>{s.advAni.home.gender=n})},weapon:{type:"Sword",setType:n=>e(s=>{s.advAni.weapon.type=n}),gunMode:"Long",setGunMode:n=>e(s=>{s.advAni.weapon.gunMode=n})},genericSkill:{type:"Sword",setType:n=>e(s=>{s.advAni.genericSkill.type=n})},groupByWeapon:{setGroupWeaponType:(n,s)=>e(a=>{a.advAni.groupByWeapon[n]=s})},uniqueOther:{type:"Sword",setType:n=>e(s=>{s.advAni.uniqueOther.type=n}),selected:"",setSelected:n=>e(s=>{s.advAni.uniqueOther.selected=n})}},extraAni:{category:"Dance",setCategory:n=>e(s=>{s.extraAni.category=n})},personalAni:{source:"",setSource:n=>e(s=>{s.personalAni.source=n}),sourceName:"",setSourceName:n=>e(s=>{s.personalAni.sourceName=n})},getCurrentState:()=>{const n=t();return JSON.parse(JSON.stringify(n))},loadState:(n={})=>{e(s=>Je(s,n))}}),Qe="fbx",et="animations",wn="img/textures/matcap",J="data",tt=e=>e&&new Promise(t=>{new Et().load(e,t)}),nt=e=>e&&new Promise(t=>{new B().load(e,t)}),Mn=["px.png","nx.png","py.png","ny.png","pz.png","nz.png"],An=e=>e&&new Promise(t=>{new St().setPath(`${e}/`).load(Mn,t)}),xn=["c100007_01","c100007_05","c100007_09","c100034_01","c100035_01","c100036_01","c100037_01","c100041_01"],Pn=async e=>await(await fetch(e)).json(),Q=async e=>(await Pn(e)).data,En=(...e)=>t=>e.reduce((n,s)=>s(n),t),Sn=e=>[...new Set(e)],T=e=>e==="false"?!1:!!e,st=(e,t,n)=>{if(!t.length)return;const s=t.pop(),a=t.reduce((o,u)=>o==null?void 0:o[u],e);a&&(a[s]=n)};function we(e){return!!/[0-9A-Fa-f]{6}/.test(e)}function X(e){return we(e)&&!e.startsWith("#")?new k(`#${e}`):new k(e)}async function _n(e=100){return await new Promise(t=>setTimeout(t,e))}function at(e,t="="){const[n,...s]=e.split(t),a=s.join(t);return[n,a]}const Ln=e=>e.startsWith("w302"),ke=([e,...t])=>`${e.toUpperCase()}${t.join("")}`;function Cn(e){var n;return e==="smith"?"dragon":e.endsWith("h")?"story":xn.includes(e)?"spAdventurer":(n={c:"adventurer",b:"boss",d:"dragon",e:"enemy",h:"high boss",o:"object",r:"raid boss",w:"weapon"}[e[0]])!=null?n:"other"}function Tn(e=Xn){const t=new Lt(e);return t.outputEncoding=I,t}function On(e={}){const{fov:t,aspect:n,near:s,far:a}=v(v({},Zn),e);return new _t(t,n,s,a)}async function In(e){if(e.startsWith("img:")){const t=e.replace("img:",""),n=await nt(t);return n.encoding=I,n.center.set(.5,0),n}if(e.startsWith("sky:")){const t=e.replace("sky:",""),n=await An(t);return n.encoding=I,n}if(e==="transparent")return null;if(we(e)){const t=e.startsWith("#")?e:`#${e}`;return new k(t)}}function Dn(e){var t,n,s,a;(n=(t=e.map)==null?void 0:t.dispose)==null||n.call(t),(a=(s=e.userData.backupMap)==null?void 0:s.dispose)==null||a.call(s),e.dispose()}const rt=e=>{const t=new B().load(e);return t.encoding=I,t};function kn(e){const t=[],n=[];return e.traverse(s=>{s.isMesh&&t.push(s),s.isBone&&n.push(s)}),[t,n]}function Rn(e){var n,s;if(!e)return;[e.material].flat().forEach(a=>{var o,u,d,i,r,c;(u=(o=a.map)==null?void 0:o.dispose)==null||u.call(o),(r=(i=(d=a.userData)==null?void 0:d.backupMap)==null?void 0:i.dispose)==null||r.call(i),(c=a.dispose)==null||c.call(a)}),(s=(n=e.geometry)==null?void 0:n.dispose)==null||s.call(n)}const $n=()=>{const e=new Date,t=e.toDateString().replaceAll(" ","_"),n=e.toLocaleTimeString().replaceAll(":","-").replaceAll(" ","");return`${t}_${n}`},ot=e=>e?e.split("/").reduce((n,s)=>{const[a,o]=s.split("=");return a&&o&&(n[a]=o),n},{}):{};class it extends ge{constructor(t){super();this._matcapCombine=Le,this.emissiveIntensity=1,this.normalMapType=Ct,this.combine=Ce,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.lights=!0,this.vertexShader=H.vertexShader,this.fragmentShader=H.fragmentShader,this.defines=Object.assign({},H.defines),Object.defineProperty(this,"matcapCombine",{get:function(){return this._matcapCombine},set:function(s){switch(this._matcapCombine=s,s){case Ce:this.defines.MATCAP_BLENDING_MULTIPLY=!0,delete this.defines.MATCAP_BLENDING_ADD;break;default:case Le:this.defines.MATCAP_BLENDING_ADD=!0,delete this.defines.MATCAP_BLENDING_MULTIPLY;break}}}),this.uniforms=Tt.clone(H.uniforms);const n=["specular","shininess","opacity","diffuse","map","matcap","gradientMap","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveMap","bumpMap","bumpScale","normalMap","normalScale","displacemantBias","displacemantMap","displacemantScale","specularMap","alphaMap","envMap","reflectivity","refractionRatio"];for(const s of n)Object.defineProperty(this,s,{get:function(){return this.uniforms[s].value},set:function(a){this.uniforms[s].value=a}});Object.defineProperty(this,"color",Object.getOwnPropertyDescriptor(this,"diffuse")),this.setValues(t)}copy(t){return super.copy(t),this.matcapCombine=t.matcapCombine,this.emissiveIntensity=t.emissiveIntensity,this.normalMapType=t.normalMapType,this.combine=t.combine,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this}}it.prototype.isMMDToonMaterial=!0;const Fn=["color","emissive","specular"],jn=["wireframe","metalness","opacity","roughness","shininess","transparent","emissiveIntensity","transmission","thickness","ior"],ct=["type","flatShading","showTexture","gradientMap","matcap"],Nn=[...Fn,...jn,...ct],Bn=["transparent","opacity","wireframe","showTexture","color"],Vn={Basic:[],Toon:["emissive","emissiveIntensity","gradientMap"],Lambert:["emissive","emissiveIntensity"],Phong:["emissive","emissiveIntensity","specular","shininess","flatShading"],Standard:["emissive","emissiveIntensity","metalness","roughness","flatShading"],Physical:["emissive","emissiveIntensity","metalness","roughness","flatShading","transmission","thickness","ior"],Matcap:["flatShading","matcap"],MMDToon:["emissive","emissiveIntensity","specular","shininess","matcap","gradientMap","flatShading"]},E=e=>`${e}`,ae=e=>we(e)?`${e.startsWith("#")?"":"#"}${e}`:e,zn=e=>Array.isArray(e)?e.join(","):e,Me={wireframe:{name:"Wireframe",type:"boolean",default:!1,valueMap:T,toString:E},showTexture:{name:"Texture",type:"boolean",default:!0,valueMap:T,toString:E},transparent:{name:"Transparent",type:"boolean",default:!1,valueMap:T,toString:E},flatShading:{name:"Flat Shading",type:"boolean",default:!1,valueMap:T,toString:E},color:{name:"Color",type:"color",default:"#ffffff",valueMap:X,toString:ae},emissive:{name:"Emissive",type:"color",default:"#000000",valueMap:X,toString:ae},opacity:{name:"Opacity",type:"percentage",default:1,min:0,max:1,valueMap:parseFloat,toString:E},emissiveIntensity:{name:"Emissive Intensity",type:"percentage",default:1,min:0,max:1,valueMap:parseFloat,toString:E},specular:{name:"Specular",type:"color",default:"#111111",valueMap:X,toString:ae},metalness:{name:"Metalness",type:"percentage",default:0,min:0,max:1,valueMap:parseFloat,toString:E},roughness:{name:"Roughness",type:"percentage",default:1,min:0,max:1,valueMap:parseFloat,toString:E},shininess:{name:"Shininess",type:"number",default:30,min:1,max:100,valueMap:parseFloat,toString:E},gradientMap:{name:"Gradient Map",type:"select",default:"none",valueMap:ut,toString:zn},matcap:{name:"Matcap",type:"select",default:"matcap_fresnel.jpg",valueMap:lt,toString:E},transmission:{name:"Transmission",type:"number",default:1,min:0,max:1,valueMap:parseFloat,toString:E},thickness:{name:"Thickness",type:"number",default:.01,min:0,max:10,valueMap:parseFloat,toString:E},ior:{name:"Index-of-refraction",type:"number",default:1.5,min:1,max:2.333,valueMap:parseFloat,toString:E}},Wn=Object.fromEntries(Object.entries(Me).map(([e,{default:t}])=>[e,t])),D=C(v({},Wn),{type:"Basic"}),Un=Object.fromEntries(Object.entries(Me).map(([e,{valueMap:t}])=>[e,t])),Gn=Object.fromEntries(Object.entries(Me).map(([e,{toString:t}])=>[e,t])),re=e=>[...Bn,...Vn[e]],Hn=(e,t={})=>{if(e==="MMDToon")return new it(t);const n=`Mesh${e}Material`;return new Ye[n](t)},Re=(e,{matType:t="Basic",texturePath:n="",force:s=!1}={})=>{e.forEach(a=>{const o=[a.material].flat(),u=Array.isArray(a.material);if(!s&&!n){const d=`isMesh${t}Material`;if(!o.some(r=>!r[d]))return}o.forEach((d,i)=>{var p,l,m,f;const r=n?new B().load(n):o[i].map;n&&(r.encoding=I);const c=Hn(t);if(c.name=d.name,c.map=r,c.userData.backupMap=d.userData.backupMap,n&&((l=(p=d.map)==null?void 0:p.dispose)==null||l.call(p),(f=(m=d.userData.backupMap)==null?void 0:m.dispose)==null||f.call(m)),d.dispose(),u){a.material[i]=c;return}a.material=c})})},qn=e=>Array.isArray(e)?e:e.split(",").map(t=>parseInt(t));function ut(e){const t=qn(e),n=t.length;if(n<2)return null;const s=Uint8Array.from(t),a=new Ot(s,n,1,It);return a.minFilter=a.magFilter=Dt,a.generateMipmaps=!1,a}const Kn=e=>e.includes("/")||e.includes(":")?e:`${wn}/${e}`;function lt(e){const t=Kn(e);return t?rt(t):null}const Xn={alpha:!0,antialias:!0},Yn="#cccccc",Zn={type:"Perspective",fov:45,aspect:1,far:300,near:.01},Jn="c100001_01",F={enabled:!0,size:5,color:"#000000",opacity:1},Qn={noBackground:!0,fileName:"screenshot",frameRate:30},es={frameRate:30,fileName:"ani",appendDate:!0},$e=1,de=30,ts={directional:{color:"#ffffff",intensity:.8,position:[1,0,2]},ambient:{color:"#444444",intensity:1},point:{color:"#ffffff",intensity:1}},oe={"No Mapping":kt,Linear:Rt,Reinhard:$t,Cineon:Ft,"ACES Filmic":jt},z={addEventListener(e,t){var s,a;if(!t)return;(s=this._listeners)!=null||(this._listeners={});const n=this._listeners;return e=e.toLowerCase(),(a=n[e])!=null||(n[e]=[]),n[e].includes(t)||n[e].push(t),t},hasEventListener(e,t){var n,s;return e=e.toLowerCase(),!!((s=(n=this._listeners)==null?void 0:n[e])==null?void 0:s.includes(t))},removeEventListener(e,t){var a;e=e.toLowerCase();const n=(a=this._listeners)==null?void 0:a[e];if(!n)return;const s=n.indexOf(t);s!==-1&&n.splice(s,1)},dispatchEvent(e){var a,o;const t=(a=e.type)==null?void 0:a.toLowerCase(),n=(o=this._listeners)==null?void 0:o[t];if(!n)return;e.target=this,[...n].forEach(u=>u.call(this,e))},addCountedEventListener(e,t,n=1){const s=this;function a(o){t.call(s,o),n--,n===0&&s.removeEventListener(e,a)}this.addEventListener(e,a)}},ns={face1:[2,1],face2:[0,0],face3:[1,0],face4:[2,0],face5:[3,0],face6:[0,-1],face7:[1,-1],face8:[2,-1],face9:[3,-1]},dt={},ss=async()=>{const e=await Q(`${J}/face-offset.json`);Object.assign(dt,e)},Fe=e=>dt[e]||[0,0],pe={},as=async()=>{const e=await Q(`${J}/camera-position.json`);Object.assign(pe,e)},rs=e=>{var t;return(t=pe[e])!=null?t:pe[e[0]]},me={},os=async()=>{const e=await Q(`${J}/control-position.json`);Object.assign(me,e)},is=e=>{var t;return(t=me[e])!=null?t:me[e[0]]},je=e=>ns[`face${e}`],cs=(e,t)=>{const n={x:0,y:0};if(e!==t){const[s,a]=je(t),[o,u]=je(e);n.x=o-s,n.y=u-a}return[n.x,n.y]},us=(e,t)=>{const n={x:0,y:0};if(e!==t){const[s,a]=Fe(t),[o,u]=Fe(e);n.x=o-s,n.y=u-a}return[n.x,n.y]},ee=e=>new Proxy(Object.assign(e,z),{get(t,n){return t[n]},set(t,n,s){return t[n]=s,t.dispatchEvent({type:"change",propName:n,value:s}),!0}}),pt=/mEye_[0-9]/m,mt=/mMouth_[0-9]/m,ls=/[0-9]{2}/,ft=["eye","mouth"];function ds(e){const{type:t,meshes:n}=e;return t==="adventurer"?ps(e):n.some(({name:a})=>a.match(/mEye|mMouth/))?ms(e):e}function ps(e){const{meshes:t,id:n}=e,s=r=>`${Qe}/${r}/${r}.png`,a=t.find(({name:r})=>r==="mBodyAll"),o={eyeIdx:2,eyeBaseIdx:2,mouthIdx:2,mouthBaseIdx:2,eyeTexture:n,mouthTexture:n},u={type:"uv"},d=r=>([c,p])=>{var x;if(!a)return;const l=`mt${ke(r)}CH`,m=(x=a.geometry.groups)==null?void 0:x.find(y=>{var M;return((M=a.material[y.materialIndex])==null?void 0:M.name)===l});if(!m)return;const{start:f,count:h}=m,g=f+h,b=a.geometry.attributes.uv;for(let y=f;y<g;y++){const M=b.getX(y)+.25*c,P=b.getY(y)+.25*p;b.setXY(y,M,P)}b.needsUpdate=!0},i=r=>c=>{var f,h;if(!a)return;const p=`mt${ke(r)}CH`,l=(h=(f=a.material).find)==null?void 0:h.call(f,({name:g})=>g===p);if(!l)return;const m=s(c);l.map.dispose(),l.map=rt(m),l.needsUpdate=!0};return ft.forEach(r=>{Object.defineProperties(u,{[`${r}Idx`]:{get(){return o[`${r}Idx`]},set(c){const p=parseInt(c),l=this[`${r}Idx`];o[`${r}Idx`]=p;const m=cs(p,l);d(r)(m)}},[`${r}BaseIdx`]:{get(){return o[`${r}BaseIdx`]},set(c){o[`${r}BaseIdx`]=c,this[`${r}Idx`]=c}},[`${r}Texture`]:{get(){return o[`${r}Texture`]},set(c){const p=this[`${r}Texture`];o[`${r}Texture`]=c,i(r)(c);const l=us(c,p);d(r)(l)}}})}),e.face=ee(u),e}function ms(e){const{meshes:t}=e,[n,s]=fs(t);[...n,...s].forEach(i=>i.frustumCulled=!1);const a={eye:n,mouth:s},o={eyeIdx:"",eyeBaseIdx:"",mouthIdx:"",mouthBaseIdx:""},u={eyeList:n,mouthList:s,type:"meshes"},d=i=>r=>{a[i].forEach(c=>{const{name:p}=c,l=ls.exec(p)[0];c.visible=parseInt(l)===r})};return ft.forEach(i=>Object.defineProperties(u,{[`${i}Idx`]:{get(){return o[`${i}Idx`]},set(r){const c=parseInt(r);d(i)(c),o[`${i}Idx`]=`${c}`}},[`${i}BaseIdx`]:{get(){return o[`${i}BaseIdx`]},set(r){o[`${i}BaseIdx`]=r,this[`${i}Idx`]=r}}})),u.eyeBaseIdx=$e,u.mouthBaseIdx=$e,e.face=ee(u),e}function fs(e){const t=e.filter(({name:s})=>s.match(pt)),n=e.filter(({name:s})=>s.match(mt));return[t,n]}function hs(e){const{model:t,uniqueId:n}=e,[s,a]=kn(t);return Object.defineProperty(a,"list",{value:Sn(a.map(({name:o})=>o))}),Object.defineProperty(s,"visible",{get(){return this.filter(({visible:o})=>o)}}),a.forEach(o=>{o.name=`${n}|${o.name}`}),Object.defineProperties(e,{meshes:{get(){return s}},bones:{get(){return a}}})}const ht={},gs=async()=>{const e=await Q(`${J}/model-parts.json`);Object.assign(ht,e)},ys=e=>ht[e],vs=/mParts([A-Za-z]+)/,Ne=/mParts[A-Za-z]+_([A-Za-z]*)/;function bs(e){const{meshes:t,id:n}=e,s=ys(n),a=[],o=[];if(t.forEach(r=>{var p;let{name:c}=r;if(!!(c==null?void 0:c.match)){if((c.includes("Effect")||c.includes("Extension"))&&(r.visible=!1),((p=s==null?void 0:s.custom)==null?void 0:p[c])&&(c=r.name=s.custom[c]),c.match(/mParts/)){a.push(r);return}!c.match(pt)&&!c.match(mt)&&o.push(r)}}),!a.length&&o.length<2)return e;const u=Object.defineProperties({},{list:{get(){return Object.keys(this)},enumerable:!1},reset:{value:function(){this.list.forEach(r=>this[r].reset())},enumerable:!1},others:{get(){return o},enumerable:!1}});if(e.parts=u,!a.length)return e;const d=new Set(a.map(({name:r})=>{var c;return(c=vs.exec(r))==null?void 0:c[1]}).sort((r,c)=>r>c?1:-1)),i=r=>a.filter(({name:c})=>c.includes(`mParts${r}`)).sort((c,p)=>c.name>p.name?1:-1);return d.forEach(r=>{var g,b,x;const c=s==null?void 0:s[r],p=(b=(g=c==null?void 0:c.name)==null?void 0:g.replaceAll(" ","_"))!=null?b:r,l=c==null?void 0:c.options,m=i(r);m.forEach(y=>y.frustumCulled=!1);const f=m.map(({name:y})=>{var P,R,j;const M=(R=(P=Ne.exec(y))==null?void 0:P[1])!=null?R:"default";return(j=l==null?void 0:l[M])!=null?j:M}),h=(x=c==null?void 0:c.default)!=null?x:f[0];u[p]={_meshes:m,list:f,default:h!=null?h:f[0]},Object.defineProperties(u[p],{current:{get(){var j,Pe,Ee;const y=m.filter(({visible:ne})=>ne).length;if(y===0)return"None";if(y!==1)return"custom";const P=(j=m.find(({visible:ne})=>ne).name.match(Ne))==null?void 0:j[1];return(Ee=(Pe=l==null?void 0:l[P!=null?P:"default"])!=null?Pe:P)!=null?Ee:"default"},set(y){if(y.toLowerCase()==="none"){this._meshes.forEach((P,R)=>{P.visible=!1});return}if(!this.list.includes(y))return;const M=this.list.indexOf(y);this._meshes.forEach((P,R)=>{P.visible=R===M})}},index:{get(){return this.current==="custom"?NaN:this.list.indexOf(this.current)},set(y){this._meshes.forEach((M,P)=>{M.visible=P===Number(y)})}},reset:{value:function(){this.current=this.default}}})}),u.reset(),e.parts=u,e}const ws=e=>t=>{const n=t.meshes,s=v(v({},D),e),{type:a}=s;Re(n,{force:!0,matType:a});let o={type:a,showTexture:!0},u=re(a);const d={get code(){const{type:i,propList:r}=this,c=[];return i!==D.type&&c.push(`type=${i}`),r.forEach(l=>{const m=Gn[l],f=m(this[l]),h=m(D[l]);f!==h&&c.push(`${l}=${f}`)}),c.join("/").replaceAll("#","")},set code(i){const r=Object.keys(D),c=v(v({},D),ot(i));r.forEach(p=>{this[p]=c[p]})},toString(){const{code:i}=this;return i?`mat=(${i})`:""},get list(){return n.flatMap(({material:i})=>i)},get propList(){return u},set type(i){if(this.type===i)return;u=re(i),Re(n,{matType:i}),o.type=i;const r=v({},o);o={showTexture:r.showTexture},u.forEach(c=>this[c]=r[c]),o=r},set flatShading(i){const r=T(i);r!==this.flatShading&&(o.flatShading=r,!!this.propList.includes("flatShading")&&this.list.forEach(c=>{c.flatShading=r,c.needsUpdate=!0}))},set gradientMap(i){var p,l;if(i===this.gradientMap||(o.gradientMap=i,!this.propList.includes("gradientMap")))return;const r=(p=this.list[0])==null?void 0:p.gradientMap;(l=r==null?void 0:r.dispose)==null||l.call(r);const c=i==="none"?null:ut(i);this.list.forEach(m=>{m.gradientMap=c,m.needsUpdate=!0})},set showTexture(i){const r=T(i);if(this.showTexture===r)return;o.showTexture=r;const c=r?p=>{p.map=p.userData.backupMap,p.userData.backupMap=null,p.needsUpdate=!0}:p=>{p.userData.backupMap=p.map,p.map=null,p.needsUpdate=!0};this.list.forEach(c)},set matcap(i){var p,l;if(o.matcap===i||(o.matcap=i,!this.propList.includes("matcap")))return;const r=(p=this.list[0])==null?void 0:p.matcap;(l=r==null?void 0:r.dispose)==null||l.call(r);const c=lt(i);this.list.forEach(m=>{m.matcap=c,m.needsUpdate=!0})}};return Nn.forEach(i=>Object.defineProperty(d,i,v({get(){return o[i]}},!ct.includes(i)&&{set(r){r!==this[i]&&(o[i]=r,!!this.propList.includes(i)&&this.list.forEach(c=>c[i]=Un[i](r)))}}))),re(a).forEach(i=>d[i]=s[i]),o=v(v({},D),o),t.material=ee(d),t};var Ms=`uniform float opacity;\r
uniform vec3 color;\r
\r
void main() {\r
	gl_FragColor = vec4( color, opacity );\r
}\r
`,As=`uniform float size;\r
\r
#include <skinning_pars_vertex>\r
\r
void main() {\r
	#include <skinbase_vertex>\r
	\r
    vec3 transformed = position + normal * 0.0005 * size;\r
        \r
	#include <skinning_vertex>\r
	#include <project_vertex>\r
}`;const xs=e=>new ge({side:Nt,transparent:!0,depthFunc:Bt,vertexShader:As,fragmentShader:Ms,uniforms:e});function Ps(e,t){const{material:n}=e,s=Array.isArray(e.material);[n].flat().forEach(Dn),e.material=s?new Array(e.material.length).fill(t):t}function Es(e,t){const n=xs(t),s=[],a=["Eff","Extension"];return e.forEach(o=>{const{name:u}=o;if(a.some(i=>u.includes(i)))return;const d=o.clone();d.name=`outline-${o.name}`,Ps(d,n),o.isSkinnedMesh&&d.bind(o.skeleton,o.bindMatrix),o.add(d),s.push(d)}),s}const Ss={size:parseFloat,opacity:parseFloat,color:X},_s=e=>t=>{const n=v(v({},F),e),s=t.meshes,a={size:{value:n.size},opacity:{value:n.opacity},color:{value:new k(n.color)}},o=Es(s,a),u=C(v({},n),{enabled:!0}),d={get propList(){return["enabled","color","size","opacity"]},get enabled(){return u.enabled},set enabled(i){const r=T(i);o.forEach(c=>c.visible=r),u.enabled=r},get code(){if(!this.enabled)return"none";const i=[];return Object.keys(F).forEach(r=>{const c=this[r];c!==F[r]&&i.push(`${r}=${c}`)}),i.join("/").replaceAll("#","")},set code(i){if(i==="none"){this.enabled=!1;return}const r=Object.keys(F),c=v(v({},F),ot(i));r.forEach(p=>{this[p]=c[p]})},toString(){const{code:i}=this;return i?`ol=(${i})`:""}};return["size","opacity","color"].forEach(i=>Object.defineProperty(d,i,{get(){return u[i]},set(r){r!==this[i]&&(u[i]=r,a[i].value=Ss[i](r))}})),d.enabled=n.enabled,t.outline=ee(d),t},Ls=["push","pop","shift","unshift","splice","reverse","sort"];class O extends Array{constructor(...t){super(...t);Object.assign(this,z),Ls.forEach(n=>{Object.defineProperty(this,n,{value:(...s)=>{Array.prototype[n].call(this,...s),this.dispatchEvent({type:"change",method:n,args:s})},enumerable:!1})})}remove(t){const n=this.indexOf(t);n!==-1&&this.splice(n,1)}}const Be={chainName:"",chainCode:"",chainLength:0,aniIdx:0,clipDuration:0,clipTimeScale:1,action:null,aniAction:[],aniActionPointer:0};function gt(e){return e.split(">").map(Cs)}function Cs(e){const[t,...n]=e.split("&"),s=Ts(n);return v({aniName:t},s)}function Ts(e){const t={},n=[],s={r:{name:"reps",map:parseInt},ts:{name:"timeScale",map:parseFloat},dur:{name:"duration",map:Os}};return e.forEach(a=>{const[o,u]=at(a);if(o.startsWith("@")){const r=Is(u.replace(/[()]/g,""));r.time=parseFloat(o.slice(1)),n.push(r);return}if(!s[o])return;const{name:d,map:i}=s[o];t[d]=i(u)}),t.aniAction=n.filter(({time:a})=>a<=100&&a>=0).sort((a,o)=>a.time-o.time),t}function Os(e){if(!e)return[0,100];const t=e.split("-").slice(0,2).map(parseFloat),n=t.length===2?t:[0,t[0]];return n.some(s=>s>100||s<0)||n[0]>n[1]?[0,100]:n}function Is(e){return e.split("/").reduce((n,s)=>{const[a,o]=at(s);return v(v({},n),Ds(a,o))},{})}const Ve={ei:{name:"face.eyeIdx",valueMap:parseInt},mi:{name:"face.mouthIdx",valueMap:parseInt},et:{name:"face.eyeTexture"},mt:{name:"face.mouthTexture"}};function Ds(e,t){var a;if(e in Ve){const{name:o,valueMap:u}=Ve[e];return{[o]:(a=u==null?void 0:u(t))!=null?a:t}}let n=e,s=t;return e.startsWith("att")&&n.replace("att","attachment"),e.startsWith("parts")&&(n+="index",s=parseInt(t)),{[n]:s}}const ks=e=>`${et}/${e}.json`;function Rs(e,t){if(e.startsWith("fbx:"))return $s(e);if(e.startsWith("ex:")){const[,s]=e.split(":"),a=t==null?void 0:t.find(({uuid:o})=>s===o);return Promise.resolve(a.clone())}const n=ks(e);return new Promise(s=>fetch(n).then(a=>a.json()).then(a=>zt.parse(a)).then(s))}async function $s(e){const t=e.replace("fbx:",""),[n,s]=t.split("+"),{animations:a}=await tt(n);return s?a.find(({name:o})=>o===s):a[0]}function Fs(e,t=null){return Promise.all(e.map(n=>Rs(n,t)))}function js(e,t=[]){return e.map((n,s)=>{const a=t[s];if(!a||a[0]===0&&a[1]===100)return n;const o=n.duration*de,[u,d]=a.map(i=>Math.round(i*o/100));return Vt.subclip(n,n.name,u,d,de)})}async function Ns(e,t=null){const n=gt(e),s=n.map(({aniName:r})=>r),a=n.map(({duration:r})=>r),o=n.map(l=>{var m=l,{aniName:r,duration:c}=m,p=$(m,["aniName","duration"]);return v({},p)}),u=await Fs(s,t),d=js(u,a);return{code:e,clips:d,mod:o,get duration(){return o.some(({timeScale:c})=>c===0)?1/0:d.map((c,p)=>{var l,m;return c.duration/Math.abs((l=o[p].timeScale)!=null?l:1)*((m=o[p].reps)!=null?m:1)}).reduce((c,p)=>c+p,0)}}}const Bs=/[a-z][0-9]{6}/;function Vs(e){var p;const{model:t,uniqueId:n,bones:s,id:a,viewer:o}=e,u=o.userData.ani,d=new Wt(t),i=(p=s==null?void 0:s.list)!=null?p:[],r=C(v({},z),{mixer:d,chain:{},current:v({},Be),toString(){var m;const l=(m=this.chain.default)==null?void 0:m.code;return l?`ani=${l}`:""},async addChain(l,{name:m="default",autoplay:f=!0}={}){var g;if(!l||((g=this.chain[m])==null?void 0:g.code)===l)return;d.stopAllAction();const h=await Ns(l,u);h.clips.forEach(b=>{b.tracks=b.tracks.reduce((x,y)=>{let M=y.name.split(".")[0];return Bs.test(M)&&(y.name.replace(M,a),M=a),i.includes(M)&&(y.name=`${n}|${y.name}`,x.push(y)),x},[])}),this.chain[m]=h,d.addEventListener("finished",c),f&&this.play(m)},play(l=this.current.chainName||"default"){const m=this.chain[l];!m||(this.current.chainName=l,this.current.chainCode=m.code,this.current.chainLength=m.clips.length,this.aniIdx=0)},pause(){this.current.action&&(this.current.action.paused=!0)},resume(){this.current.action&&(this.current.action.paused=!1)},stop(){d.stopAllAction()},reset(){const l=this.current.chainName;this.stop(),this.current=v({},Be),this.chain[l]=void 0},update(l){var b;d.update(l);const{current:m}=this,{action:f,aniAction:h,clipDuration:g}=m;if(!(!h[m.aniActionPointer]||!f))for(;(f==null?void 0:f.time)>((b=h[m.aniActionPointer])==null?void 0:b.time)*g/100;)this.applyAniAction(h[m.aniActionPointer]),this.current.aniActionPointer++},applyAniAction(l){e.dispatchEvent({type:"aniAction",id:n,aniAction:l});const h=l,{time:m}=h,f=$(h,["time"]);Object.entries(f).forEach(([g,b])=>{const x=g.split(".");st(e,x,b)})},nextFrame(l=1,m=de){if(!this.isPaused)return;const{clipTimeScale:f,clipDuration:h,action:g}=this.current,b=l*f/m;if(g.time+=b,g.time>=h){const x=g.time-h;c(),this.pause(),this.current.action.time+=x*this.current.clipTimeScale}},setTime(l){const{clipDuration:m,action:f}=this.current;!m||l>m||(f.time=l)},get isPaused(){var l;return(l=this.current.action)==null?void 0:l.paused},get aniIdx(){return this.current.aniIdx},set aniIdx(l){if(l>=this.current.chainLength)return;this.current.aniIdx=l,this.current.aniActionPointer=0;const m={type:l===0?"chainStart":"chainMove",index:l,uniqueId:n,chainName:this.current.chainName};this.dispatchEvent(m),d.stopAllAction();const f=this.chain[this.current.chainName],h=f.mod[l],{timeScale:g,reps:b,aniAction:x}=h,y=f.clips[l],M=d.clipAction(y);M.timeScale=g!=null?g:1,M.setLoop(Ut,b!=null?b:1),this.current.clipDuration=y.duration,this.current.action=M,this.current.aniAction=x,this.current.aniActionPointer=0,this.current.clipTimeScale=g!=null?g:1,M.play()}});function c(){const{aniIdx:l,chainLength:m}=r.current,f=(l+1)%m;if(f===0){r.dispatchEvent({type:"ChainFinished",chainName:r.current.chainName});const{face:h}=e;h&&(h.eyeIdx=h.eyeBaseIdx,h.mouthIdx=h.mouthBaseIdx)}r.aniIdx=f}return e.animation=r,e.addEventListener("TimeUpdated",({dt:l})=>r.update(l)),e}function zs(e){const{model:t,bones:n,uniqueId:s}=e,a={};return Object.defineProperty(a,"list",{get(){return Object.values(this).flat()}}),Object.defineProperty(a,"traverse",{value:function(c){this.list.forEach(p=>{var l,m;c(p),(m=(l=p.attachment)==null?void 0:l.traverse)==null||m.call(l,c)})}}),Object.assign(e,{attachment:a,parent:null,parentBone:"",attach:(c,p="root")=>{var m;a[p]=(m=a[p])!=null?m:new O;const l=p==="root"?t:n.find(({name:f})=>f===`${s}|${p}`);!(l==null?void 0:l.add)||(c.detach(),l.add(c.model),a[p].push(c),c.parent=e,c.parentBone=p,e.dispatchEvent({type:"AttachmentChanged"}))},remove:(c,p="")=>{var m,f,h;const l=p||Object.keys(a).find(g=>a[g].indexOf(c)!==-1);!l||((f=(m=a[l]).remove)==null||f.call(m,c),(h=c.model.parent)==null||h.remove(c.model),e.dispatchEvent({type:"AttachmentChanged"}))},detach:()=>{var l;(l=t.parent)==null||l.remove(t);const{parent:c,parentBone:p}=e;!c||(c.remove(e,p),e.parent=e.parentBone=null)},attachTo:(c,p="root")=>{var l;e.detach(),(l=c==null?void 0:c.attach)==null||l.call(c,e,p)}})}function Ws(e){const{material:t,id:n}=e,s=Z.source.fbx,a=ze(n);Ln(n)&&async function(){const i=d(a),r=new B().load(i);r.encoding=I,r.name=a,t.list.forEach(c=>{var p;return c.map=(p=c.map)!=null?p:r})}();let o=a;Object.defineProperty(e,"texture",{get(){return o},set(i){if(!i){this.texture=a;return}if(i===o)return;const r=d(i),[,c]=u(i),[,p]=u(this.texture),l=t.list.filter(m=>{var f,h,g,b;return((h=(f=m.map)==null?void 0:f.name)==null?void 0:h.includes(p))||((b=(g=m.userData.backupMap)==null?void 0:g.name)==null?void 0:b.includes(p))});!l.length||(async function(){const m=await nt(r);m.name=c,m.encoding=I,l.forEach(f=>{var h,g,b,x;f.map&&((g=(h=f.map).dispose)==null||g.call(h),f.map=m),f.userData.backupMap&&((x=(b=f.userData.backupMap).dispose)==null||x.call(b),f.userData.backupMap=m)})}(),o=i)}});function u(i){const[r,c]=i.split(">"),p=r||n,l=c||ze(p);return[p,l]}function d(i){const[r,c]=u(i);return`${s}/${r}/${c}.png`}return e}const ze=e=>e.match(/_[0-9]{2}/)||e.startsWith("h")?e:`>${e}_01`;var Us=`uniform float uTime;\r
uniform float uSpread;\r
uniform float uThreshold;\r
uniform float uSpeed;\r
uniform float uParticleSize;\r
uniform float uAuraSize;\r
\r
attribute float aRandom;\r
\r
varying float vIsParticle;\r
varying float vRandom;\r
\r
#include <skinning_pars_vertex>\r
void main() {\r
    #include <skinbase_vertex>\r
\r
    vec3 transformed = position + normal * 0.005 * uSpread;\r
\r
    #include <skinning_vertex>\r
\r
    vec3 objectNormal = normal;\r
\r
	#include <skinnormal_vertex>\r
    \r
    vec4 viewPosition = viewMatrix * modelMatrix * vec4(transformed, 1.0);\r
    float yDisplacement = fract( uTime * uSpeed + aRandom ) * 0.1;\r
    viewPosition.y += yDisplacement;\r
    viewPosition.x += sin( uTime * aRandom * uSpeed + aRandom ) * 0.02;\r
    \r
    gl_Position = projectionMatrix * viewPosition;\r
    \r
    objectNormal.z *= objectNormal.z > 0.7 ? -1.0 : 1.0;\r
    vIsParticle = objectNormal.z - uThreshold;\r
\r
    gl_PointSize = vIsParticle > 0.0 ? uParticleSize : uAuraSize;\r
    gl_PointSize /= -viewPosition.z;\r
\r
    vRandom = aRandom;\r
}\r
`,Gs=`uniform sampler2D uTexture;\r
\r
uniform float uTime;\r
uniform float uParticleOpacity;\r
uniform float uAuraOpacity;\r
uniform vec3 uColor;\r
uniform vec3 uColor2;\r
\r
varying float vRandom;\r
varying float vIsParticle;\r
\r
void main(){\r
    vec4 textureColor = texture2D( uTexture, gl_PointCoord );\r
    textureColor.a = length( textureColor.rgb ) ;\r
    textureColor.a *= abs( 1.0 - fract( uTime + vRandom ) ) * 0.5;\r
    textureColor.rgb = mix( uColor, uColor2,  textureColor.a * 2.0 );\r
    textureColor.a *= vIsParticle > 0.0 ? uParticleOpacity * 4.0 : uAuraOpacity;\r
\r
    gl_FragColor = textureColor;\r
    gl_FragColor /= vIsParticle > 0.0 ? 2.0 : 4.0;\r
}\r
`;const Y=[{name:"time",uName:"uTime",defaultValue:0,valueMap:Number},{name:"speed",uName:"uSpeed",defaultValue:1,valueMap:Number},{name:"particleOpacity",uName:"uParticleOpacity",defaultValue:.3,valueMap:Number},{name:"auraOpacity",uName:"uAuraOpacity",defaultValue:.3,valueMap:Number},{name:"particleSize",uName:"uParticleSize",defaultValue:10,valueMap:Number},{name:"auraSize",uName:"uAuraSize",defaultValue:100,valueMap:Number},{name:"spread",uName:"uSpread",defaultValue:5,valueMap:Number},{name:"threshold",uName:"uThreshold",defaultValue:.3,valueMap:Number},{name:"texture",uName:"uTexture",defaultValue:"img/textures/particle/cloud.png",valueMap:e=>new B().load(e)},{name:"color",uName:"uColor",defaultValue:"#ffffff",valueMap:e=>new k(e)},{name:"color2",uName:"uColor2",defaultValue:"#33ffff",valueMap:e=>new k(e)}],Hs={aura:["visible",...Y.slice(1).map(({name:e})=>e)]},qs=(e="aura")=>(t,n={})=>{if(!!(t==null?void 0:t.length)&&e==="aura")return Xs(t,n)};function Ks(e){return new ge({vertexShader:Us,fragmentShader:Gs,uniforms:e,transparent:!0,blending:qt,depthWrite:!1,side:Kt})}function Xs(e,t){const n=Y.map(i=>{var m;const{uName:r,defaultValue:c,valueMap:p}=i,l=(m=p==null?void 0:p(c))!=null?m:c;return[r,{value:l}]}),s=Object.fromEntries(n),a=Ks(s),o=[];e.forEach(i=>{const{name:r}=i.geometry;if(r.startsWith("mEye")||r.startsWith("mMouth"))return;const c=i.geometry.clone(),p=c.attributes.position.count,l=new Float32Array(p).fill(0).map(()=>Math.random()-.5);c.setAttribute("aRandom",new Gt(l,1)),c.deleteAttribute("color"),c.deleteAttribute("uv");const m=new Ht(c,a);m.name="aura",i.isSkinnedMesh&&(m.type="SkinnedMesh",m.isSkinnedMesh=!0,m.skeleton=i.skeleton,m.bindMatrix=i.bindMatrix,m.bindMatrixInverse=i.bindMatrixInverse,m.bindMode=i.bindMode,m.bind=i.bind,m.clone=i.clone,m.initBones=i.initBones,m.normalizeSkinWeights=i.normalizeSkinWeights,m.pose=i.pose,m.updateMatrixWorld=i.updateMatrixWorld),i.add(m),o.push(m)});const u={visible:!0},d={name:"aura",onDispose:()=>{},get list(){return o},get propList(){return Hs.aura},get visible(){return u.visible},set visible(i){const r=T(i);this.list.forEach(c=>c.visible=r),u.visible=r},dispose(){this.onDispose(),this.list.forEach(i=>{var r,c,p,l,m;(r=i.parent)==null||r.remove(i),(p=(c=i.material).dispose)==null||p.call(c),(m=(l=i.geometry).dispose)==null||m.call(l)})},set code(i){i.split("/").forEach(c=>{const[p,l]=c.split("=");!Y.map(({name:m})=>m).includes(p)||(this[p]=l)})}};return Y.forEach(i=>{const{name:r,uName:c,defaultValue:p,valueMap:l}=i;u[r]=p,Object.defineProperty(d,r,{get(){return u[r]},set(m){var f;u[r]=m,s[c].value=(f=l==null?void 0:l(m))!=null?f:m}})}),d.onTimeUpdate=({time:i})=>d.time=i,Object.entries(t).forEach(([i,r])=>d[i]=r),d}function Ys(e){const{meshes:t}=e,n={list:new O,dispose(){this.list.forEach(s=>{var a;return(a=s.dispose)==null?void 0:a.call(s)})},add(s="aura",a={}){const o=qs(s)(t,a);return o.onDispose=()=>this.list.remove(o),this.list.push(o),e.addEventListener("TimeUpdated",o.onTimeUpdate),o}};return e.particle=n,e}const Zs=e=>{var d,i;if(e.dispatchEvent({type:"dispose"}),!e)return;const{model:t,meshes:n,outline:s,particle:a,viewer:o}=e;a==null||a.list.forEach(r=>r.dispose()),((d=t.parent)==null?void 0:d.isScene)&&(t.parent.remove(t),o.loadedModel.remove(e)),(i=e.detach)==null||i.call(e),[n.reverse(),s==null?void 0:s.all].flat().forEach(Rn)};function Js(e){const{x:t,y:n,z:s}=e;return[t,n,s].map(a=>a||"").join()}const Qs={position:",,",rotation:",,",scale:"1,1,1"},ea={position:"pos",rotation:"rot",scale:"scl"};function ta(e){return Object.assign(e,C(v({},e.isDLModel&&{toString(){const{id:t,animation:n,outline:s,material:a}=this,o=Object.entries(Qs).map(([u,d])=>{const i=Js(this[u]);return i===d?"":`${ea[u]}=${i}`});return[`id=${t}`,...o,n,s,a].filter(u=>`${u}`).join("/")}}),{dispose(){const{attachment:t,parent:n,parentBone:s}=this;t.list.forEach(a=>a.dispose()),n==null||n.remove(this,s),this.dispatchEvent({type:"dispose"}),Zs(this)}}))}function na(e,t){const{id:n,material:s,outline:a,viewer:o}=t,u=[hs,bs,zs,_s(a),ws(s),Ws,ds,Vs,Ys,ta],d=C(v({},z),{isDLModel:!0,model:e,id:n,uniqueId:ye(),type:Cn(n),viewer:o,userData:{},_time:0,update(i){var r;this._time+=i,(r=this.attachment)==null||r.list.forEach(c=>{var p;return(p=c.update)==null?void 0:p.call(c,i)}),this.dispatchEvent({type:"TimeUpdated",dt:i,time:this._time})},set scale(i){var c;if((c=i.includes)==null?void 0:c.call(i,",")){const[p,l,m]=i.split(",").map(f=>f?parseFloat(f):1);this.model.scale.set(p,l,m);return}const r=Number(i)||1;this.model.scale.set(r,r,r)},get scale(){const{scale:i}=this.model,{x:r,y:c,z:p}=i;return r===c&&r===p?r:[r,c,p].join(",")},set visible(i){this.model.visible=T(i)}});return["position","rotation","visible"].forEach(i=>Object.defineProperty(d,i,{get(){return this.model[i]},enumerable:!0})),e.userData.container=d,En(...u)(d)}function We({antialias:e="SMAA",renderer:t,scene:n,camera:s}){const a=sa(e),o=new Yt(t,a),u=new Zt(n,s);return o.addPass(u),o}function sa(e="SMAA"){const t=e==="SMAA"?Jt:Qt;return new t(800,600,{minFilter:Te,magFilter:Te,format:Xt,encoding:I})}const ie={bloom:ra,pixel:ia,afterimage:pa,sobel:ca,halftone:ua,dotscreen:la,bokeh:da,smaa:oa};async function aa(e,t){var s;e=e.toLowerCase();const n=await((s=ie[e])==null?void 0:s.call(ie,t));return n.type=e,n.name=Ae[e].name,n}function W(e,t){Object.defineProperty(e,"propList",{value:t}),t.forEach(n=>{Object.defineProperty(e,n,{get(){return this.uniforms[n].value},set(s){this.uniforms[n].value=s}})})}async function ra({resolution:e=new V(800,600),strength:t=.3,radius:n=.5,threshold:s=.8}={}){const{UnrealBloomPass:a}=await w(()=>import("./UnrealBloomPass.f8b5d0cd.js"),["assets/UnrealBloomPass.f8b5d0cd.js","assets/vendor.5500c094.js"]),o=new a(e,t,n,s);return Object.defineProperty(o,"propList",{value:["radius","strength","threshold"],writable:!1}),o}async function oa({renderer:e}){const{SMAAPass:t}=await w(()=>import("./SMAAPass.6bbd13a5.js"),["assets/SMAAPass.6bbd13a5.js","assets/vendor.5500c094.js"]),n=new V;e.getSize(n);const s=new t(n.x,n.y);return Object.defineProperty(s,"propList",{value:[],writable:!1}),s}async function ia({renderer:e}){const{ShaderPass:t}=await w(()=>import("./vendor.5500c094.js").then(function(o){return o.aD}),[]),{PixelShader:n}=await w(()=>import("./PixelShader.ee1b9117.js"),[]),s=new t(n),a=new V;return e.getSize(a),a.multiplyScalar(window.devicePixelRatio),s.uniforms.resolution.value=a,W(s,["pixelSize"]),s.pixelSize=10,s}async function ca({renderer:e}){const{ShaderPass:t}=await w(()=>import("./vendor.5500c094.js").then(function(o){return o.aD}),[]),{SobelOperatorShader:n}=await w(()=>import("./SobelOperatorShader.2b1280ba.js"),["assets/SobelOperatorShader.2b1280ba.js","assets/vendor.5500c094.js"]),s=new V;e.getSize(s),s.multiplyScalar(window.devicePixelRatio);const a=new t(n);return a.uniforms.resolution.value.x=s.x,a.uniforms.resolution.value.y=s.y,Object.defineProperty(a,"propList",{value:[],writable:!1}),a}async function ua({renderer:e}){const{HalftonePass:t}=await w(()=>import("./HalftonePass.f9f68a4b.js"),["assets/HalftonePass.f9f68a4b.js","assets/vendor.5500c094.js"]),n=new V;e.getSize(n);const s=new t(n.x,n.y,{radius:4});return W(s,["greyscale","radius","scatter","shape"]),s}async function la(){const{DotScreenPass:e}=await w(()=>import("./DotScreenPass.85630ea0.js"),["assets/DotScreenPass.85630ea0.js","assets/vendor.5500c094.js"]),t=new e;return W(t,["scale","center"]),t}async function da({scene:e,camera:t}){const{BokehPass:n}=await w(()=>import("./BokehPass.d6194fff.js"),["assets/BokehPass.d6194fff.js","assets/vendor.5500c094.js"]),s=new n(e,t,{});return W(s,["focus","aperture","aspect"]),s}async function pa(){const{AfterimagePass:e}=await w(()=>import("./AfterimagePass.d4e19e2c.js"),["assets/AfterimagePass.d4e19e2c.js","assets/vendor.5500c094.js"]),t=new e(.7);return W(t,["damp"]),t}function ma(e){var u;const{name:t,type:n}=e,s=(u=Ae[n].propList)!=null?u:[],a={};return s.forEach(d=>{Object.defineProperty(a,d,{get(){return e[d]},set(i){e[d]=i},enumerable:!0})}),{target:e,name:t,type:n,params:a,id:ye()}}const Ae={bloom:{name:"Bloom",propList:["enabled","radius","strength","threshold"]},pixel:{name:"Pixelate",propList:["enabled","pixelSize"]},afterimage:{name:"Afterimage",propList:["enabled","damp"]},sobel:{name:"Sobel",propList:["enabled"]},halftone:{name:"Halftone",propList:["enabled","greyscale","radius","scatter","shape"]},dotscreen:{name:"Dot Screen",propList:["enabled","scale"]},bokeh:{name:"Bokeh",propList:["enabled","focus","aperture","aspect"]},smaa:{name:"SMAA",propList:["enabled"]}};Object.entries(Ae).map(([e,{name:t}])=>({value:e,label:t}));const fa=["video/mp4;codecs=h264","video/webm;codecs=h264","video/webm;codecs=vp9","video/webm;codecs=vp8","video/webm"],K=fa.filter(MediaRecorder.isTypeSupported);function ha(e){if(!K.length)return;const t=[],n=K[0],s={settings:C(v({},es),{mimeType:n}),get supportedMimeTypes(){return K},get mimeType(){return this.settings.mimeType},set mimeType(a){K.includes(a)&&(this.settings.mimeType=a)},start(){if(this.recorder)return;const{fileName:a,frameRate:o,mimeType:u}=this.settings,d=e.captureStream(o||30),i=d.getTracks()[0],r=new MediaRecorder(d,{mimeType:u});r.onstart=()=>t.length=0,r.ondataavailable=({data:c})=>t.push(c),r.onstop=()=>{i.stop(),this.recorder=void 0;const c=this.settings.mimeType.includes("webm")?"webm":"mp4",p=new Blob(t,{type:`video/${c}`}),l=this.settings.appendDate?`_${$n()}`:"",m=`${a||"ani"}${l}.${c}`;ve.exports.saveAs(p,m)},r.start(),this.recorder=r},get state(){var a,o;return(o=(a=this.recorder)==null?void 0:a.state)!=null?o:"idle"}};return["pause","resume","stop"].forEach(a=>{Object.defineProperty(s,a,{value:()=>{var o;return(o=s.recorder)==null?void 0:o[a]()}})}),s}function ga(e){let t=1,n=!1,s=!1;const a=()=>{e.stats.begin(),e.controls.update();const r=n?-t:t,c=e.clock.getDelta()*r;s||e.update(c),e.render(),e.stats.end()};let o=!1;const u=()=>{o||(e.render(),o=!0,setTimeout(()=>o=!1,50))};let d="";return{start(){d!=="active"&&(e.renderer.setAnimationLoop(a),e.controls.removeEventListener("change",u),d="active")},stop(){d!=="inactive"&&(e.renderer.setAnimationLoop(null),e.controls.addEventListener("change",u),d="inactive")},pause(){s=!0},resume(){s=!1},get state(){return d},get timeScale(){return t},set timeScale(r){const c=parseFloat(r);t=isNaN(c)?1:Math.abs(c)},get reverse(){return n},set reverse(r){n=!!r},get paused(){return s},set paused(r){s=!!r}}}const ya=async e=>{const{zip:t}=await w(()=>import("./browser.83a5952f.js"),[]);return new Promise(n=>t(e,{},(s,a)=>n(new Blob([a]))))},va=e=>{const t=e.indexOf(",");return e.slice(t+1,1/0)},ba=async e=>{if(e=await e,e instanceof Blob&&(e=await e.arrayBuffer()),e instanceof ArrayBuffer)return new Uint8Array(e);if(typeof e=="string"){const t=e.startsWith("data")?va(e):e,n=window.atob(t);return Uint8Array.from(n,s=>s.charCodeAt(0))}};async function wa(e){const t=await Promise.all(e.map(({data:s})=>ba(s))),n=Object.fromEntries(e.map(({name:s},a)=>[s,[t[a],{level:0,consume:!0}]]));return ya(n)}async function Ma(e,t){const n=e.length.toString().length,s=e.map((a,o)=>{const u=o.toString().padStart(n,"0");return{name:`${t||"ss"}_${u}.png`,data:a}});return wa(s)}function Aa(e,t){const n=document.createElement("a");n.style.display="none",n.href=e,n.download=t,document.body.appendChild(n),n.click(),document.body.removeChild(n)}async function fe(e,t="frames"){const n=await Ma(e,t);ve.exports.saveAs(n,`${t}.zip`)}function xa(e){const{canvas:t,scene:n}=e;return{settings:Qn,downloadFrame(a=1){const{noBackground:o,fileName:u}=this.settings,d=o&&!e.postProcessing.enabled;let i=null;const r=()=>[n.background,i]=[i,n.background];if(e.loop.state==="inactive"||a===1){d&&r(),e.render();const m=t.toDataURL();d&&r(),Aa(m,`${u}.png`),e.render();return}let c=0;const p=[];d&&e.addCountedEventListener("beforeRender",r);function l(){const m=t.toDataURL("image/png");p.push(m),++c===a&&(d&&e.addCountedEventListener("beforeRender",r),fe(p,u))}e.addCountedEventListener("afterRender",l,a)},getFrame(){let a;const{noBackground:o}=this.settings;if(o&&!e.postProcessing.enabled){let d=null;[n.background,d]=[d,n.background],e.render(),a=t.toDataURL("image/png"),[n.background,d]=[d,n.background],e.render()}else e.render(),a=t.toDataURL("image/png");return a},getAllFrames(a){const o=a==null?void 0:a.animation.current.chainName;if(!o||a.animation.chain[o].duration===1/0)return;console.info("main thread locked");const d=e.loop.state;e.loop.stop(),a.animation.stop();const i=[],{frameRate:r,noBackground:c}=this.settings,p=1/(r||30);let l=null,m=!0;for(c&&([n.background,l]=[l,n.background]),a.animation.addCountedEventListener("chainFinished",()=>m=!1),a.animation.play();m;){e.update(p);const f=t.toDataURL();i.push(f)}return console.info("main thread unlocked"),c&&([n.background,l]=[l,n.background]),d==="active"&&e.loop.start(),i},downloadAllFrames(a=0){const o=e.model[a],u=this.getAllFrames(o),{fileName:d}=this.settings;fe(u,d)}}}const Pa=()=>Promise.all([ss(),as(),os(),gs()]),Ea={directional:en,ambient:tn,point:nn},Sa={directional:sn,point:an},_a=e=>{var r,c;const t=Ea[e];if(!t)return null;const i=ts[e],{color:s,intensity:a}=i,o=$(i,["color","intensity"]),u=new t(s,a);u.name=(c=(r=u.type)==null?void 0:r.replace)==null?void 0:c.call(r,"Light","");const d=Sa[e];return d&&(u.helper=new d(u),Object.defineProperty(u,"showHelper",{get(){return u.helper.visible},set(p){u.helper.visible=!!p,u.helper.update()}}),u.showHelper=!1),Object.defineProperty(u,"colorCode",{get(){return"#"+this.color.getHexString()},set(p){var l,m;this.color=new k(p),(m=(l=this.helper)==null?void 0:l.update)==null||m.call(l)}}),Object.entries(o).forEach(([p,l])=>{u[p].isVector3?u[p].set(...l):u[p]=l}),u};function La(e){const t={list:new O,add:n=>{const s=_a(n);if(!!s)return e.scene.add(s),s.helper&&(e.scene.add(s.helper),s.helper.update()),t.list.push(s),s.remove=()=>{var a,o,u,d,i;t.list.remove(s),s.helper&&((a=s.parent)==null||a.remove(s.helper),(u=(o=s.helper).dispose)==null||u.call(o)),(d=s.parent)==null||d.remove(s),(i=s.dispose)==null||i.call(s)},s}};return t}const Ue={"<":">","(":")","[":"]","{":"}"},Ca=e=>{let t="";const n=[],s=[];for(const a of e){if(n.length){t+=a;const o=n.at(-1);a===Ue[o]&&n.pop();continue}if(a==="/"){t&&s.push(t),t="";continue}t+=a,a in Ue&&n.push(a)}return t&&s.push(t),s},yt=e=>Ca(e).reduce((n,s)=>{const[a,...o]=s.split("="),u=o==null?void 0:o.join("=");return a&&u&&n.push([a,u]),n},[]),Ta={mat:{keys:["material","code"],valueMap:e=>e.slice(1,-1)},ol:{keys:["outline","code"],valueMap:e=>e.slice(1,-1)},ei:{keys:["face","eyeBaseIdx"]},et:{keys:["face","eyeTexture"]},mi:{keys:["face","mouthBaseIdx"]},mt:{keys:["face","mouthTexture"]},tx:{keys:["texture"]},scl:{keys:["scale"]}};async function Oa(e){const t=yt(e),n=Object.fromEntries(t),{id:s}=n,a=await this.loadDLModel(s);return await Ia(a,n),a}async function Ia(e,t){const a=t,{ani:n}=a,s=$(a,["ani"]);Object.entries(s).forEach(([o,u])=>{var p;const d=Ta[o];if(!d)return;const{keys:i,valueMap:r}=d,c=(p=r==null?void 0:r(u))!=null?p:u;st(e,i,c)}),n&&await e.animation.addChain(n)}const xe=class{constructor(){_(this,"userData",{ani:new O});_(this,"dataLoaded",!1);_(this,"initData",async()=>{await Pa(),this.dataLoaded=!0,this.dispatchEvent({type:"dataLoaded"})});_(this,"_background","");_(this,"model",new O);_(this,"loadedModel",new O);_(this,"loadModelFromCode",Oa);_(this,"settings",{outline:F,material:D});_(this,"viewport",{width:0,height:0,set(t,n){this.width=t,this.height=n}});Object.assign(this,z);const t=new rn;this.scene=t,this.background=Yn,this.clock=new on;const n=On();this.camera=n;const s=La(this);s.add("directional"),s.add("ambient"),this.light=s;const a=Tn();this.renderer=a,this.canvas=a.domElement,this.screenshot=xa(this),this.record=ha(this.canvas),this.controls=new cn(this.camera,this.canvas);const o=this.renderer.capabilities.isWebGL2?"MSAA":"SMAA";this.postProcessing={enabled:!1,passes:new O,composer:We({antialias:o,renderer:a,scene:t,camera:n}),async addPass(u,d={}){const i=await aa(u,C(v({},d),{renderer:a,scene:t,camera:n}));this.composer.addPass(i);const r=ma(i),{passes:c}=this,p=this;return r.remove=()=>{c.remove(r),p.refresh()},c.push(r),i},async refresh(){this.composer=We({antialias:o,renderer:a,scene:t,camera:n});const u=this.passes.map(({type:i,params:r})=>({type:i,params:Object.entries(r)}));this.passes.length=0;const{length:d}=u;for(let i=0;i<d;i++){const{type:r,params:c}=u[i],p=await this.addPass(r);c.forEach(([l,m])=>void(p[l]=m))}},updatePasses(u){this.passes.length=0,this.passes.splice(0,0,...u),this.refresh()}},this.stats=new un,this.loop=ga(this),this.loop.start(),console.info("%cDragalia Lost Model Viewer","color:yellow;background-color:black;font-size:1.5rem;text-shadow: 0 0 0.5rem white")}get background(){return this._background}set background(t){var s,a;if(this._background===t)return;this._background="loading",(a=(s=this.scene.background)==null?void 0:s.dispose)==null||a.call(s);const n=this;(async function(){n.scene.background=await In(t),n._background=t,t.startsWith("img:")&&n.updateBgAspectRatio()})()}get toneMapping(){var n,s;const{toneMapping:t}=this.renderer;return(s=(n=Object.entries(oe).find(([,a])=>a===t))==null?void 0:n[0])!=null?s:"Unknown"}set toneMapping(t){const n=oe[t]?t:"No Mapping";this.renderer.toneMapping=oe[n]}get pixelRatio(){return this.renderer.getPixelRatio()}set pixelRatio(t){this.renderer.setPixelRatio(t),this.postProcessing.composer.setPixelRatio(t)}get unusedModel(){return this.loadedModel.filter(t=>!this.model.includes(t))}async loadDLModel(t=Jn){this.dataLoaded||await new Promise(u=>this.addCountedEventListener("dataLoaded",u));const n=xe.getModelPath(t),s=await tt(n);s.name=t;const a={id:t,outline:this.settings.outline,material:this.settings.material,viewer:this},o=na(s,a);return this.loadedModel.push(o),o.addEventListener("dispose",()=>this.loadedModel.remove(o)),o}add(t){var n;(n=t.detach)==null||n.call(t),this.model.push(t),this.scene.add(t.model),t.parent=this}remove(t){this.model.remove(t),this.scene.remove(t.model)}disposeAllModels(){this.loadedModel.forEach(t=>{var n;return(n=t.dispose)==null?void 0:n.call(t)}),this.model.length=0}static getModelPath(t){return`${this.source.fbx}/${t}/${t}.fbx`}async setViewport(t,n){var u;await _n(200);const s=t!=null?t:window.innerWidth,a=n!=null?n:window.innerHeight;this.viewport.set(s,a),this.renderer.setSize(s,a);const o=s/a;return this.camera.aspect=o,this.camera.updateProjectionMatrix(),(u=this.postProcessing.composer)==null||u.setSize(s,a),this.background.startsWith("img:")&&this.updateBgAspectRatio(),this}updateBgAspectRatio(){if(!this.background.startsWith("img:"))return;const{width:t,height:n}=this.viewport,s=t/n,{background:a}=this.scene,{naturalWidth:o,naturalHeight:u}=a.image,d=o/u,i=s/d,r=s>d?[1,1/i]:[i,1];a.repeat.set(...r)}update(t){var n;(n=this.animation)==null||n.update(t),this.model.forEach(s=>{var a;return(a=s.update)==null?void 0:a.call(s,t)}),this.loop.state==="inactive"&&this.render(),this.dispatchEvent({type:"timeUpdate",dt:t})}stopAll(){this.model.forEach(t=>{var n,s;return(s=(n=t.animation)==null?void 0:n.stop)==null?void 0:s.call(n)})}playAll(){this.model.forEach(t=>{var n,s;return(s=(n=t.animation)==null?void 0:n.play)==null?void 0:s.call(n)})}render(){this.dispatchEvent({type:"beforeRender"}),this.postProcessing.enabled?this.postProcessing.composer.render():this.renderer.render(this.scene,this.camera),this.dispatchEvent({type:"afterRender"})}toString(){return"Dragalia Lost Model Viewer"}dispose(){var t,n,s;this.model.forEach(a=>a.dispose()),(n=(t=this.scene.background)==null?void 0:t.dispose)==null||n.call(t),(s=this.renderer.renderLists)==null||s.dispose(),this.renderer.dispose()}};let Z=xe;_(Z,"source",{fbx:Qe,ani:et});const A=new Z;A.initData();A.setViewport();A.userData.specialCapture={frameRate:30,duration:5,program:"rotate"};window.addEventListener("resize",()=>A.setViewport());A.canvas.addEventListener("dblclick",Da);window.viewer=A;window.model=A.model;window.getFrame=A.screenshot.getFrame;window.downloadFrames=fe;window.saveAs=ve.exports.saveAs;window.THREE=Ye;window.makeGif=async e=>{const{makeGif:t}=await w(()=>import("./index.3a92bef7.js"),[]);return await t(e)};function Da(){!q.fullscreenEnabled||(q.fullscreenElement?q.exitFullscreen():q.requestFullscreen(A.canvas))}function ka(){try{return window.self!==window.top}catch{return!0}}let Ge="";const vt=ka(),Ra=vt?!1:!window.location.hash.includes("showSettings=false"),$a=vt?!1:!window.location.hash.includes("showAC=false"),Fa=e=>({showSettings:Ra,toggleSettings:()=>e(t=>void(t.showSettings=!t.showSettings)),loadingMsg:"",setLoadingMsg:t=>e(n=>void(n.loadingMsg=t)),showTimeControl:$a,toggleTimeControl:()=>e(t=>void(t.showTimeControl=!t.showTimeControl)),showFrameRate:!1,toggleFrameRate:()=>e(t=>void(t.showFrameRate=!t.showFrameRate)),sidebar:{open:!0,toggle:()=>e(({sidebar:t})=>void(t.open=!t.open)),settings:{tab:"Model",setTab:t=>e(({sidebar:n})=>void(n.settings.tab=t))},modal:{mode:"",handleSelect:void 0,open:(t,n)=>{Ge=A.loop.state,A.loop.stop(),e(({sidebar:s})=>{const{modal:a}=s;a.mode=t,a.handleSelect=n})},close:()=>{Ge==="active"&&A.loop.start(),e(({sidebar:t})=>{const{modal:n}=t;n.mode="",n.handleSelect=void 0})}},manageMode:"single",setManageMode:t=>e(({sidebar:n})=>void(n.manageMode=t))},chainMaker:{target:null,setTarget:t=>e(({chainMaker:n})=>void(n.target=t))},dock:{mode:"",handleSelect:void 0,open:(t="",n)=>e(({dock:s})=>{s.mode=t,s.handleSelect=n}),close:()=>e(({dock:t})=>{t.mode="",t.handleSelect=void 0})}}),L=ln,ja=dn,Na=pn,Ba=S(()=>w(()=>import("./index.f9224b0d.js"),["assets/index.f9224b0d.js","assets/vendor.5500c094.js","assets/TabBar.82330328.js","assets/ButtonBase.11ccdb12.js","assets/Popover.2e8d60a9.js","assets/Gallery.ea2527ad.js","assets/createSvgIcon.817f0bd1.js","assets/Box.df33ad7b.js","assets/DialogTitle.8282836d.js","assets/ColorPicker.a4854c3e.js","assets/ColorPicker.108f083b.css","assets/ColorButton.8c79d5b4.js","assets/Button.e37b57bc.js","assets/file2dataURL.5c7e82aa.js"])),Va=S(()=>w(()=>import("./index.4b58f1f7.js"),["assets/index.4b58f1f7.js","assets/styles.5f21a777.css","assets/vendor.5500c094.js","assets/lists.f5bd2338.js","assets/lists.6fff8870.css","assets/Gallery.ea2527ad.js","assets/ButtonBase.11ccdb12.js","assets/Popover.2e8d60a9.js","assets/createSvgIcon.817f0bd1.js","assets/Box.df33ad7b.js","assets/DialogTitle.8282836d.js","assets/Close.ec36b812.js","assets/filterConfig.5c5495a6.js","assets/filterConfig.37d3f97f.css","assets/GlowToggle.ce2a4f9a.js","assets/GlowToggle.ada43627.css","assets/styles.65418fc1.js","assets/styles.a7d845f9.css","assets/index.310fede3.js"])),za=S(()=>w(()=>import("./index.4c44baa9.js"),["assets/index.4c44baa9.js","assets/index.2b99e074.css","assets/styles.5f21a777.css","assets/vendor.5500c094.js","assets/lists.f5bd2338.js","assets/lists.6fff8870.css","assets/Gallery.ea2527ad.js","assets/ButtonBase.11ccdb12.js","assets/Popover.2e8d60a9.js","assets/createSvgIcon.817f0bd1.js","assets/Box.df33ad7b.js","assets/DialogTitle.8282836d.js","assets/Close.ec36b812.js","assets/Stretcher.a3b2fa06.js","assets/Stretcher.7165086b.css","assets/TabBar.82330328.js","assets/Button.e37b57bc.js","assets/ModelIcon.9590168c.js","assets/aniFunction.ca9cfea3.js","assets/Selector.9f781afb.js","assets/Selector.4835a2b1.css","assets/GlowToggle.ce2a4f9a.js","assets/GlowToggle.ada43627.css","assets/useKey.14ec2dfd.js","assets/file2dataURL.5c7e82aa.js","assets/useToggleState.83fd3b92.js","assets/Check.bd354d91.js"])),Wa=S(()=>w(()=>import("./index.37fc6190.js"),["assets/index.37fc6190.js","assets/styles.5f21a777.css","assets/AddWeapon.cd6b26b1.js","assets/AddWeapon.b09a520b.css","assets/lists.f5bd2338.js","assets/lists.6fff8870.css","assets/vendor.5500c094.js","assets/Gallery.ea2527ad.js","assets/ButtonBase.11ccdb12.js","assets/Popover.2e8d60a9.js","assets/createSvgIcon.817f0bd1.js","assets/Box.df33ad7b.js","assets/DialogTitle.8282836d.js","assets/Close.ec36b812.js","assets/filterConfig.5c5495a6.js","assets/filterConfig.37d3f97f.css","assets/GlowToggle.ce2a4f9a.js","assets/GlowToggle.ada43627.css","assets/index.310fede3.js","assets/useToggleState.83fd3b92.js","assets/ModelIcon.9590168c.js"])),Ua=S(()=>w(()=>import("./ColorSelect.8f242aca.js"),["assets/ColorSelect.8f242aca.js","assets/ColorPicker.a4854c3e.js","assets/ColorPicker.108f083b.css","assets/vendor.5500c094.js","assets/ColorButton.8c79d5b4.js","assets/Button.e37b57bc.js","assets/ButtonBase.11ccdb12.js","assets/DialogTitle.8282836d.js"])),Ga=S(()=>w(()=>import("./index.64e70b64.js"),["assets/index.64e70b64.js","assets/FaceSelect.c5a14e47.js","assets/FaceSelect.32c4ee29.css","assets/vendor.5500c094.js","assets/useKey.14ec2dfd.js","assets/FacePartSelector.44851110.js","assets/Selector.9f781afb.js","assets/Selector.4835a2b1.css","assets/GlowToggle.ce2a4f9a.js","assets/GlowToggle.ada43627.css","assets/MeshMouthSelect.e5562e47.js","assets/MeshMouthSelect.cfd3c0f0.css","assets/Box.df33ad7b.js","assets/ButtonBase.11ccdb12.js","assets/DialogTitle.8282836d.js","assets/Button.e37b57bc.js"])),Ha=S(()=>w(()=>import("./index.c24fdc80.js"),["assets/index.c24fdc80.js","assets/styles.5f21a777.css","assets/FaceTexture.7ac8bf8c.js","assets/vendor.5500c094.js","assets/useToggleState.83fd3b92.js","assets/lists.f5bd2338.js","assets/lists.6fff8870.css","assets/Gallery.ea2527ad.js","assets/ButtonBase.11ccdb12.js","assets/Popover.2e8d60a9.js","assets/createSvgIcon.817f0bd1.js","assets/Box.df33ad7b.js","assets/DialogTitle.8282836d.js","assets/Close.ec36b812.js","assets/FacePartSelector.44851110.js","assets/Selector.9f781afb.js","assets/Selector.4835a2b1.css","assets/GlowToggle.ce2a4f9a.js","assets/GlowToggle.ada43627.css","assets/filterConfig.5c5495a6.js","assets/filterConfig.37d3f97f.css","assets/styles.65418fc1.js","assets/styles.a7d845f9.css"])),qa=S(()=>w(()=>import("./index.52a3cce7.js"),["assets/index.52a3cce7.js","assets/index.85d3b8bf.css","assets/styles.5f21a777.css","assets/vendor.5500c094.js","assets/useKey.14ec2dfd.js","assets/Stretcher.a3b2fa06.js","assets/Stretcher.7165086b.css","assets/BoneManager.632977d9.js","assets/BoneManager.61de214b.css","assets/ModelIcon.9590168c.js","assets/Accordion.86cf67f8.js","assets/Accordion.47f0dbde.css","assets/useToggleState.83fd3b92.js","assets/createSvgIcon.817f0bd1.js","assets/ButtonBase.11ccdb12.js","assets/Gallery.ea2527ad.js","assets/Popover.2e8d60a9.js","assets/Box.df33ad7b.js","assets/DialogTitle.8282836d.js","assets/filterConfig.5c5495a6.js","assets/filterConfig.37d3f97f.css","assets/GlowToggle.ce2a4f9a.js","assets/GlowToggle.ada43627.css","assets/lists.f5bd2338.js","assets/lists.6fff8870.css","assets/Close.ec36b812.js","assets/ColorButton.8c79d5b4.js","assets/Button.e37b57bc.js","assets/SkipPrevious.75d4f865.js","assets/FaceSelect.c5a14e47.js","assets/FaceSelect.32c4ee29.css","assets/FacePartSelector.44851110.js","assets/Selector.9f781afb.js","assets/Selector.4835a2b1.css","assets/MeshMouthSelect.e5562e47.js","assets/MeshMouthSelect.cfd3c0f0.css","assets/FaceTexture.7ac8bf8c.js","assets/styles.65418fc1.js","assets/styles.a7d845f9.css","assets/AddWeapon.cd6b26b1.js","assets/AddWeapon.b09a520b.css","assets/index.310fede3.js"])),He=S(()=>w(()=>import("./index.be25e7fe.js"),["assets/index.be25e7fe.js","assets/index.cecc6469.css","assets/MeshMouthSelect.e5562e47.js","assets/MeshMouthSelect.cfd3c0f0.css","assets/vendor.5500c094.js","assets/Box.df33ad7b.js","assets/ButtonBase.11ccdb12.js","assets/DialogTitle.8282836d.js","assets/Button.e37b57bc.js"])),Ka=S(()=>w(()=>import("./index.c95f8539.js"),["assets/index.c95f8539.js","assets/index.babf73a0.css","assets/styles.5f21a777.css","assets/vendor.5500c094.js","assets/useKey.14ec2dfd.js","assets/Accordion.86cf67f8.js","assets/Accordion.47f0dbde.css","assets/useToggleState.83fd3b92.js","assets/createSvgIcon.817f0bd1.js","assets/ButtonBase.11ccdb12.js","assets/ModelIcon.9590168c.js","assets/Button.e37b57bc.js","assets/Check.bd354d91.js","assets/Box.df33ad7b.js","assets/DialogTitle.8282836d.js"])),qe={background:Ba,model:Va,animation:za,weapon:Wa,color:Ua,face:Ga,faceTexture:Ha,attachment:qa,target:Ka,eye:({onSelect:e})=>L(He,{part:"eye",onSelect:e}),mouth:({onSelect:e})=>L(He,{part:"mouth",onSelect:e})},Xa=(e,t)=>({Component:void 0,props:void 0,openModal:(n,s)=>e(a=>{a.props=s,a.Component=n}),close:()=>e(n=>n.Component=void 0),onClose:void 0,reset:()=>e(n=>{n.Component=n.props=n.onClose=void 0}),getInput:async n=>{if(!qe[n])return null;const{close:s,reset:a}=t(),o=new Promise((u,d)=>{const i=(...r)=>u(r);e(r=>{r.onClose=()=>{d(),s()},r.props={onSelect:i,onAfterSelect:s},r.Component=qe[n]})});try{return await o}catch{return null}finally{a()}},inputModel:()=>t().getInput("model"),inputAni:()=>t().getInput("animation"),inputColor:async()=>{const n=await t().getInput("color");return n==null?void 0:n[0]},inputTarget:()=>t().getInput("target"),inputEye:()=>t().getInput("eye"),inputMouth:()=>t().getInput("mouth")}),Ya=e=>({activeModel:void 0,setActiveModel:t=>e({activeModel:t})}),Za=e=>({open:!1,toggle:()=>e(t=>t.open=!t.open),target:null,setTarget:t=>e(n=>{!t||(t.userData.chain||(t.userData.chain=new O),n.target=t)})}),Ja=e=>(t,n,s)=>e(a=>t(mn(a)),n,s),U=e=>be(Ja(e)),he=U(Fa),Ar=be(Ya),xr=be(Za),Pr=U(Ze),Er=U(Ze),Qa=U(bn),Sr=U(Xa);function er(){return new Worker("/dl-model/assets/fetchWorker.5c8aea3f.js",{type:"module"})}const tr=e=>{const t=new er;return new Promise(n=>{t.addEventListener("message",s=>{t.terminate(),n(s.data)}),t.postMessage(e)})};function bt(){return new Worker("/dl-model/assets/dbWorker.6f1e69a5.js",{type:"module"})}const wt=(e,t)=>{const n=new bt;return new Promise(s=>{n.addEventListener("message",()=>{s(),n.terminate()}),n.postMessage({type:"put",store:t,value:e})})};function nr(){return new Worker("/dl-model/assets/searchWorker.9de88212.js",{type:"module"})}async function sr(e,t="",n=["name"]){if(!t||!n.length)return e;const s=new nr;return new Promise(a=>{s.addEventListener("message",o=>{s.terminate(),a(o.data)}),s.postMessage({fullList:e,query:t,keys:n})})}const _r=async e=>{const t=Object.values(e).flat();await wt(t,"model"),console.info("Model DB Initialized")},Lr=e=>te({type:"get",store:"model",value:e}),Cr=e=>te({type:"search",store:"model",index:"name",value:e}),Tr=async e=>{const n=(await te({type:"getByKeyRange",store:"model",value:"c100000_00-c199999_99"})).filter(({id:s})=>!s.endsWith("h"));return sr(n,e)},ar=()=>te({type:"getMap",store:"model",index:"name"}),te=e=>{const t=new bt;return new Promise(n=>{t.addEventListener("message",s=>{t.terminate(),n(s.data)}),t.postMessage(e)})},N={},rr=async()=>{if(Object.keys(N).length)return;const e="ani-personal",t=(await tr([e]))[e];Object.assign(N,t)},Mt=rr(),Or=e=>N[e],or=e=>{var t,n;return(n=(t=N[e])==null?void 0:t[0])!=null?n:e.startsWith("c")?{name:"Bob",code:"CMN_MWM_03"}:null},Ir=async()=>{const e=await ar();await Mt;const t=Object.entries(N).flatMap(([n,s])=>{const a=e.get(n);return s.map(o=>C(v({},o),{user:n,fullName:`${a} ${o.name}`}))});await wt(t,"animation")},ir="cccccc",cr="c100001_01",Ke=(e,t="Unknown")=>{const n=gt(e),{length:s}=n,a=n.map((o,u)=>{const{aniName:d,reps:i=1,timeScale:r=1,duration:c=[0,100],aniAction:p}=o,l=s>1?t+` #${u+1}`:t;return{id:ye(),name:l,aniName:d,reps:i,timeScale:r,duration:c,aniAction:p}});return O.from(a)},Xe={ts:{key:"timeScale",defaultValue:1},r:{key:"reps",defaultValue:1}},ur={"face.eyeIdx":"ei","face.mouthIdx":"mi"},Dr=e=>e.map(lr).join(">"),lr=e=>{const{aniName:t}=e,n=dr(e),s=pr(e),a=mr(e);return`${t}${n}${s}${a}`},dr=e=>{const t=[];return Object.keys(Xe).forEach(n=>{const{key:s,defaultValue:a}=Xe[n];e[s]&&e[s]!==a&&t.push(`&${n}=${e[s]}`)}),t.join("")},pr=e=>{const{duration:t=[0,100]}=e,[n,s]=t;return n!==0?`&dur=${n}-${s}`:s===100?"":`&dur=${s}`},mr=e=>{const{aniAction:t}=e;if(!t.length)return"";const n=t.map(s=>{const d=s,{time:a}=d,o=$(d,["time"]),u=Object.entries(o).map(([i,r])=>{var c;return`${(c=ur[i])!=null?c:i}=${r}`});return`@${a}=(${u.join("/")})`});return"&"+n.join("&")};function fr(e){if(!(e==null?void 0:e.userData))return;const{type:t,id:n}=e,{name:s}=e.userData;e.userData.aniSelectState={category:t==="adventurer"?"Adv":"Personal",personalAni:{source:n,sourceName:s}}}function ce(){const e=decodeURI(window.location.hash),t=yt(e),n=Object.fromEntries(t);hr(n),gr(e)}function hr(e){const{bg:t=ir,showAC:n="true",showSettings:s="true"}=e;A.background=t,he.setState({showTimeControl:De(n)}),he.setState({showSettings:De(s)})}async function gr(e){A.disposeAllModels(),setTimeout(async()=>{var u;const t=e.includes("id=")?e:e+`/id=${cr}`,n=await A.loadModelFromCode(t);A.add(n);const s=n.type==="adventurer"?"Adv":"Personal";Qa.getState().setCategory(s),fr(n);const{id:a}=n;if(!e.includes("camPos=")){const d=rs(a);A.camera.position.set(...d)}const o=is(a);if(A.controls.target.set(...o),e.includes("ani=")){const d=(u=n.animation.current.chainCode)!=null?u:"";d&&(n.userData.chain=Ke(d,"init"))}else{const d=or(a);if(d){const{code:i,name:r}=d;n.animation.addChain(i),n.userData.chain=Ke(i,r)}}})}const yr=S(()=>w(()=>import("./index.7caa60a2.js"),["assets/index.7caa60a2.js","assets/index.a7e8db71.css","assets/styles.5f21a777.css","assets/vendor.5500c094.js","assets/createSvgIcon.817f0bd1.js","assets/ButtonBase.11ccdb12.js","assets/BoneManager.632977d9.js","assets/BoneManager.61de214b.css","assets/ModelIcon.9590168c.js","assets/Accordion.86cf67f8.js","assets/Accordion.47f0dbde.css","assets/useToggleState.83fd3b92.js","assets/Gallery.ea2527ad.js","assets/Popover.2e8d60a9.js","assets/Box.df33ad7b.js","assets/DialogTitle.8282836d.js","assets/filterConfig.5c5495a6.js","assets/filterConfig.37d3f97f.css","assets/GlowToggle.ce2a4f9a.js","assets/GlowToggle.ada43627.css","assets/lists.f5bd2338.js","assets/lists.6fff8870.css","assets/Close.ec36b812.js","assets/ColorButton.8c79d5b4.js","assets/Button.e37b57bc.js","assets/SkipPrevious.75d4f865.js","assets/useKey.14ec2dfd.js","assets/FaceSelect.c5a14e47.js","assets/FaceSelect.32c4ee29.css","assets/FacePartSelector.44851110.js","assets/Selector.9f781afb.js","assets/Selector.4835a2b1.css","assets/MeshMouthSelect.e5562e47.js","assets/MeshMouthSelect.cfd3c0f0.css","assets/FaceTexture.7ac8bf8c.js","assets/styles.65418fc1.js","assets/styles.a7d845f9.css","assets/AddWeapon.cd6b26b1.js","assets/AddWeapon.b09a520b.css","assets/index.310fede3.js","assets/TabBar.82330328.js","assets/aniFunction.ca9cfea3.js"])),vr=S(()=>w(()=>import("./index.1182a498.js"),["assets/index.1182a498.js","assets/index.691abef7.css","assets/vendor.5500c094.js","assets/useToggleState.83fd3b92.js","assets/GlowToggle.ce2a4f9a.js","assets/GlowToggle.ada43627.css","assets/Button.e37b57bc.js","assets/ButtonBase.11ccdb12.js","assets/Popover.2e8d60a9.js","assets/SkipPrevious.75d4f865.js","assets/createSvgIcon.817f0bd1.js","assets/Close.ec36b812.js"]));function br(){const e=vn(),t=ue(),n=ue(),{loadingMsg:s,showTimeControl:a,showSettings:o,showFrameRate:u}=he();return le(()=>(e&&Mt.then(ce),window.addEventListener("hashchange",ce),()=>window.removeEventListener("hashchange",ce))),le(()=>{t.current.appendChild(A.canvas),A.stats.dom.style.position="",n.current.appendChild(A.stats.dom)},[]),ja(Na,{children:[o&&L(Oe,{fallback:null,children:L(yr,{})}),L("div",{className:"mount",ref:d=>t.current=d}),L("div",{className:"stats",style:{display:u?"unset":"none"},ref:d=>n.current=d}),s&&L("div",{className:"loading-msg",children:s}),a&&L(Oe,{fallback:null,children:L(vr,{})})]})}fn(L(br,{}),document.getElementById("app"));export{vn as A,Sn as B,wt as C,te as D,Fe as E,Na as F,Qe as G,ze as H,Tr as I,Cr as J,sr as K,Er as L,Or as M,Zn as P,w as _,ja as a,Ar as b,Ke as c,qe as d,rs as e,is as f,or as g,Qa as h,fr as i,L as j,Pr as k,Lr as l,xr as m,ke as n,Ma as o,Ae as p,wa as q,Sr as r,Dr as s,oe as t,he as u,A as v,tr as w,_r as x,Mt as y,Ir as z};
